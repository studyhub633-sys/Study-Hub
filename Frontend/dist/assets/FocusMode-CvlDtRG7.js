import{j as e,L as T,aU as C,aW as K,ao as H,aq as V,N as X,ar as Y,X as Q}from"./ui-vendor-DvDVRjyp.js";import{A as S,h as Z}from"./AppLayout-DSG6wxEf.js";import{u as ee,k as se,B as u}from"./index-DEqmCALs.js";import{C as P,a as te,b as ae,c as re,d as oe}from"./card-C99jCs8O.js";import{I as ie}from"./input-CG8Ib3hH.js";import{r as o}from"./react-vendor-Do86TxWo.js";import"./AnimatedLogoIcon-D6d7HWVb.js";import"./sheet-DlQTD0RE.js";import"./supabase-vendor-C2nLxrxH.js";import"./query-vendor-Bk-KKE7Z.js";function ge(){const{user:r,supabase:i}=ee(),{toast:d}=se(),[F,L]=o.useState(!1),[M,_]=o.useState(!0),[f,x]=o.useState(25*60),[h,g]=o.useState(!1),[c,N]=o.useState("focus"),[B,D]=o.useState(0),[l,n]=o.useState([]),[j,b]=o.useState(""),[E,v]=o.useState(!0),[y,I]=o.useState(!1);o.useEffect(()=>{(async()=>{if(!r||!i){_(!1);return}try{const t=await Z(i);L(t)}catch{}finally{_(!1)}})()},[r]),o.useEffect(()=>{r?R():v(!1)},[r]);const R=async()=>{if(!(!i||!r))try{v(!0);const{data:s,error:t}=await i.from("focus_tasks").select("*").eq("user_id",r.id).order("created_at",{ascending:!1});if(t){if(t.code==="42P01"){const a=localStorage.getItem(`focus_tasks_${r.id}`);a&&n(JSON.parse(a))}}else n(s||[])}catch{const t=localStorage.getItem(`focus_tasks_${r==null?void 0:r.id}`);t&&n(JSON.parse(t))}finally{v(!1)}},p=s=>{r&&localStorage.setItem(`focus_tasks_${r.id}`,JSON.stringify(s))},$=async()=>{if(!j.trim())return;const s={id:crypto.randomUUID(),text:j.trim(),completed:!1,created_at:new Date().toISOString()};I(!0);try{if(i&&r){const{error:a}=await i.from("focus_tasks").insert({id:s.id,user_id:r.id,text:s.text,completed:!1,created_at:s.created_at});if(a&&a.code!=="42P01")throw a}const t=[s,...l];n(t),p(t),b(""),d({title:"Task Added",description:"Your task has been added to the list."})}catch{const a=[s,...l];n(a),p(a),b("")}finally{I(!1)}},q=async s=>{const t=l.find(m=>m.id===s);if(!t)return;const a=l.map(m=>m.id===s?{...m,completed:!m.completed}:m);n(a),p(a);try{i&&r&&await i.from("focus_tasks").update({completed:!t.completed}).eq("id",s)}catch{}t.completed||d({title:"Task Completed! ðŸŽ‰",description:"Great job! Keep up the momentum."})},z=async s=>{const t=l.filter(a=>a.id!==s);n(t),p(t);try{i&&r&&await i.from("focus_tasks").delete().eq("id",s)}catch{}d({title:"Task Removed",description:"Task has been deleted."})},O=async()=>{const s=l.filter(a=>a.completed).map(a=>a.id),t=l.filter(a=>!a.completed);n(t),p(t);try{i&&r&&s.length>0&&await i.from("focus_tasks").delete().in("id",s)}catch{}d({title:"Cleared",description:`${s.length} completed task(s) removed.`})};o.useEffect(()=>{let s;return h&&f>0?s=setInterval(()=>{x(t=>t-1)},1e3):f===0&&(g(!1),"Notification"in window&&Notification.permission==="granted"&&new Notification(c==="focus"?"Focus session complete!":"Break is over!"),c==="focus"?(D(t=>t+1),d({title:"Focus Session Complete! ðŸŽ¯",description:"Great work! Take a short break."}),N("break"),x(5*60)):(d({title:"Break Over!",description:"Ready to focus again?"}),N("focus"),x(25*60))),()=>clearInterval(s)},[h,f,c,d]);const W=()=>g(!h),U=()=>{g(!1),x(c==="focus"?25*60:5*60)},A=s=>{g(!1),N(s),x(s==="focus"?25*60:5*60)},J=s=>{const t=Math.floor(s/60),a=s%60;return`${t.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},G=c==="focus"?(25*60-f)/(25*60)*100:(5*60-f)/(5*60)*100,w=l.filter(s=>s.completed).length,k=l.length;return M?e.jsx(S,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(T,{className:"h-8 w-8 animate-spin text-primary"})})}):F?e.jsx(S,{children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8 animate-fade-in pb-12",children:[e.jsxs("div",{className:"text-center space-y-2 mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center justify-center gap-2",children:[e.jsx(C,{className:"w-8 h-8 text-red-500"}),"Focus Mode"]}),e.jsx("p",{className:"text-muted-foreground",children:"Block out distractions and master your time with the Pomodoro Technique."})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 items-start",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx(u,{variant:c==="focus"?"default":"outline",onClick:()=>A("focus"),className:c==="focus"?"bg-red-500 hover:bg-red-600":"",children:"Focus (25m)"}),e.jsx(u,{variant:c==="break"?"default":"outline",onClick:()=>A("break"),className:c==="break"?"bg-green-500 hover:bg-green-600":"",children:"Break (5m)"})]}),e.jsxs("div",{className:"relative w-72 h-72 rounded-full flex items-center justify-center",children:[e.jsxs("svg",{className:"absolute inset-0 w-full h-full -rotate-90",children:[e.jsx("circle",{cx:"144",cy:"144",r:"135",stroke:"currentColor",strokeWidth:"12",fill:"none",className:"text-muted/30"}),e.jsx("circle",{cx:"144",cy:"144",r:"135",stroke:"currentColor",strokeWidth:"12",fill:"none",strokeLinecap:"round",strokeDasharray:2*Math.PI*135,strokeDashoffset:2*Math.PI*135*(1-G/100),className:`transition-all duration-300 ${c==="focus"?"text-red-500":"text-green-500"}`})]}),e.jsxs("div",{className:"text-center z-10",children:[e.jsx("div",{className:"text-6xl font-mono font-bold tracking-tighter mb-2",children:J(f)}),e.jsx("div",{className:"uppercase tracking-widest text-sm font-semibold text-muted-foreground",children:h?c==="focus"?"Focusing...":"Resting...":"Paused"})]})]}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx(u,{size:"lg",className:`rounded-full w-16 h-16 p-0 ${c==="focus"?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"}`,onClick:W,children:h?e.jsx(K,{className:"w-6 h-6"}):e.jsx(H,{className:"w-6 h-6 ml-1"})}),e.jsx(u,{size:"lg",variant:"outline",className:"rounded-full w-16 h-16 p-0",onClick:U,children:e.jsx(V,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sessions Completed Today"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:B})]})]}),e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Session Tasks"}),w>0&&e.jsx(u,{variant:"ghost",size:"sm",onClick:O,className:"text-xs text-muted-foreground hover:text-destructive",children:"Clear Completed"})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(ie,{placeholder:"Add a task for this session...",value:j,onChange:s=>b(s.target.value),onKeyDown:s=>s.key==="Enter"&&$(),disabled:y}),e.jsx(u,{onClick:$,disabled:!j.trim()||y,size:"icon",children:y?e.jsx(T,{className:"w-4 h-4 animate-spin"}):e.jsx(X,{className:"w-4 h-4"})})]}),k>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[w,"/",k," completed"]})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:`${k>0?w/k*100:0}%`}})})]}),e.jsx("div",{className:"space-y-2 max-h-[350px] overflow-y-auto",children:E?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(T,{className:"w-6 h-6 animate-spin text-muted-foreground"})}):l.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No tasks yet."}),e.jsx("p",{className:"text-sm",children:"Add tasks to track your focus session goals!"})]}):l.map(s=>e.jsxs("div",{className:`group flex items-center gap-3 p-3 rounded-lg transition-all ${s.completed?"bg-green-500/10 border border-green-500/20":"bg-secondary/50 border border-border hover:border-primary/30"}`,children:[e.jsx("button",{onClick:()=>q(s.id),className:"flex-shrink-0",children:s.completed?e.jsx(Y,{className:"w-5 h-5 text-green-500"}):e.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-primary/30 hover:border-primary transition-colors"})}),e.jsx("span",{className:`flex-1 ${s.completed?"line-through text-muted-foreground":""}`,children:s.text}),e.jsx("button",{onClick:()=>z(s.id),className:"opacity-0 group-hover:opacity-100 transition-opacity text-muted-foreground hover:text-destructive",children:e.jsx(Q,{className:"w-4 h-4"})})]},s.id))})]})]}),e.jsxs(P,{className:"p-6 bg-gradient-to-r from-red-500/5 to-orange-500/5 border-red-500/20",children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-red-500"}),"Pomodoro Tips"]}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-2",children:[e.jsx("li",{children:"â€¢ Work for 25 minutes, then take a 5-minute break"}),e.jsx("li",{children:"â€¢ After 4 sessions, take a longer 15-30 minute break"}),e.jsx("li",{children:"â€¢ Remove distractions: close unnecessary tabs and apps"}),e.jsx("li",{children:"â€¢ Write down tasks before starting to stay focused"})]})]})]})}):e.jsx(S,{children:e.jsx("div",{className:"max-w-4xl mx-auto py-12",children:e.jsxs(P,{className:"border-amber-500/20 bg-amber-500/5",children:[e.jsxs(te,{children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-6 h-6 text-amber-500"}),"Premium Feature"]}),e.jsx(re,{children:"Focus Mode is a premium feature"})]}),e.jsxs(oe,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Upgrade to premium to use the Pomodoro timer and manage your focus sessions."}),e.jsx(u,{onClick:()=>window.location.href="/premium-dashboard",className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:"View Premium Plans"})]})]})})})}export{ge as default};
