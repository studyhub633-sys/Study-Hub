import{u as te,n as se,b as ae,r as o,j as e,L as A,B as m,a as h}from"./index-7wMNJNZJ.js";import{h as re,A as N,C as O,a as U}from"./AppLayout-Cb4f3Rcb.js";import{S as oe}from"./SimpleMarkdown-Dw47DD2y.js";import{B as z}from"./badge-CT5QE6KZ.js";import{C as E,d as L}from"./card-BDQx_yt9.js";import{D as le,b as ne,c as ie,d as ce,e as de,f as me}from"./dialog-CGZvDN6x.js";import{I as xe}from"./input-CURGwIC-.js";import{L as ue}from"./label-4_8C0ZIE.js";import{S as he,a as pe,b as ge,c as fe,d as M}from"./select-Do0TjdJZ.js";import{T as je}from"./textarea-DYv1Zddw.js";import{b as be}from"./ai-client-SJ9RPCaW.js";import{F as v,B as $}from"./sheet-D4eoD1m7.js";import{L as Ne}from"./lock-R7de3u4Z.js";import{S as ve}from"./star-B_12Y3OW.js";import{S as w}from"./sparkles-BGeiEV-p.js";import{S as we}from"./search-D5Hb3sC3.js";import{F as ye}from"./filter-BGs_qK1N.js";import{D as Se}from"./download-CoW69tSE.js";import"./AnimatedLogoIcon-DY32PEux.js";import"./sun-CnDoiXzg.js";import"./index-BdQq_4o_.js";import"./index-8ugP4A3I.js";import"./chevron-down-CjDqse4M.js";function Ve(){const{supabase:n,user:i}=te(),{toast:x}=se(),y=ae(),[S,P]=o.useState([]),[W,I]=o.useState(!0),[C,q]=o.useState(!1),[H,D]=o.useState(!0),[p,Q]=o.useState(""),[c,R]=o.useState("All Subjects"),[r,G]=o.useState(null),[K,g]=o.useState(!1),[u,_]=o.useState(""),[F,B]=o.useState(!1),V=async()=>{if(!(!u.trim()||!i)){if(!n){x({title:"Error",description:"Database connection not available. Please refresh the page.",variant:"destructive"});return}B(!0);try{const t=await be({prompt:u,subject:c==="All Subjects"?"General":c,topic:u.substring(0,50)},n);if(t.error)throw new Error(t.error);if(t.data){const s=t.data.sections.map(b=>`## ${b.title}

${b.content}`).join(`

`),a=t.data.topic||t.data.sections[0]?.title||"AI Generated Note",j=t.data.subject||(c==="All Subjects"?"General":c),k=["AI Generated","Grade 9 Premium","Knowledge Organizer"],{data:d,error:l}=await n.from("notes").insert({user_id:i.id,title:a,content:s,subject:j,topic:t.data.topic||"AI Generated",tags:k}).select().single();l&&x({title:"Save Warning",description:`Note generated but save failed: ${l.message}`,variant:"destructive"});const T={id:d?.id||`ai-${Date.now()}`,title:a,content:s,subject:j,topic:t.data.topic||"AI Generated",grade_level:"9",tags:k,created_at:d?.created_at||new Date().toISOString()};P(b=>[T,...b]),G(T),g(!1),_(""),x({title:"Note Generated & Saved",description:d?"Your AI note has been created and saved to your notes.":"Your AI note has been created (save to database failed)."})}}catch(t){x({title:"Generation Failed",description:t.message||"Failed to generate note.",variant:"destructive"})}finally{B(!1)}}},Y=Array.from(new Set(S.map(t=>t.subject).filter(Boolean)));o.useEffect(()=>{i?J():D(!1)},[i]),o.useEffect(()=>{C&&X()},[C]);const J=async()=>{if(!(!i||!n))try{const t=await re(n);q(t)}catch{}finally{D(!1)}},X=async()=>{if(!(!n||!i))try{I(!0);const{data:t,error:s}=await n.from("global_premium_notes").select("*").eq("grade_level","9").order("created_at",{ascending:!1}),{data:a,error:j}=await n.from("notes").select("*").eq("user_id",i.id).contains("tags",["Grade 9 Premium"]).order("created_at",{ascending:!1}),d=[...(a||[]).map(l=>({id:l.id,title:l.title,content:l.content,subject:l.subject||"General",topic:l.topic||"AI Generated",grade_level:"9",tags:l.tags||[],created_at:l.created_at})),...t||[]];P(d),d.length>0&&!r&&G(d[0])}catch{x({title:"Error",description:"Failed to load premium notes. Please try again.",variant:"destructive"})}finally{I(!1)}},Z=t=>{const s=document.createElement("a"),a=new Blob([t.content],{type:"text/markdown"});s.href=URL.createObjectURL(a),s.download=`${t.title.replace(/\s+/g,"_")}.md`,document.body.appendChild(s),s.click(),document.body.removeChild(s),x({title:"Exported",description:"Note downloaded as Markdown file"})},ee=S.filter(t=>{const s=c==="All Subjects"||t.subject===c,a=t.title.toLowerCase().includes(p.toLowerCase())||t.content.toLowerCase().includes(p.toLowerCase())||t.topic?.toLowerCase().includes(p.toLowerCase());return s&&a}).reduce((t,s)=>{const a=s.subject||"General";return t[a]||(t[a]=[]),t[a].push(s),t},{}),f=t=>({Mathematics:{bg:"bg-blue-500/10",text:"text-blue-500"},"English Literature":{bg:"bg-yellow-500/10",text:"text-yellow-500"},Biology:{bg:"bg-green-500/10",text:"text-green-500"},Chemistry:{bg:"bg-purple-500/10",text:"text-purple-500"},Physics:{bg:"bg-red-500/10",text:"text-red-500"},History:{bg:"bg-amber-500/10",text:"text-amber-500"},Geography:{bg:"bg-cyan-500/10",text:"text-cyan-500"}})[t]||{bg:"bg-gray-500/10",text:"text-gray-500"};return H?e.jsx(N,{children:e.jsx("div",{className:"max-w-6xl mx-auto flex items-center justify-center h-[60vh]",children:e.jsx(A,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):C?W?e.jsx(N,{children:e.jsx("div",{className:"max-w-6xl mx-auto flex items-center justify-center h-[60vh]",children:e.jsx(A,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsxs(N,{children:[e.jsxs("div",{className:"max-w-6xl mx-auto animate-fade-in pb-12",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-r from-yellow-500/20 to-amber-500/20",children:e.jsx(v,{className:"w-8 h-8 text-yellow-500"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Grade 9 Premium Notes"}),e.jsxs(z,{className:"bg-gradient-to-r from-yellow-500 to-amber-600 text-white border-0",children:[e.jsx(O,{className:"w-3 h-3 mr-1"}),"Premium"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Exclusive study materials for top marks"})]})]}),e.jsxs(m,{onClick:()=>g(!0),className:"bg-gradient-to-r from-purple-500 to-blue-600 hover:from-purple-600 hover:to-blue-700 text-white",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"AI Note Generator"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(xe,{placeholder:"Search notes...",value:p,onChange:t=>Q(t.target.value),className:"pl-9"})]}),e.jsxs(he,{value:c,onValueChange:R,children:[e.jsxs(pe,{className:"w-full sm:w-[200px]",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),e.jsx(ge,{})]}),e.jsxs(fe,{children:[e.jsx(M,{value:"All Subjects",children:"All Subjects"}),Y.map(t=>e.jsx(M,{value:t,children:t},t))]})]})]}),S.length===0?e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(v,{className:"h-16 w-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No notes available yet"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Grade 9 premium notes are coming soon. Check back later for exclusive content!"}),e.jsxs(m,{variant:"outline",onClick:()=>y("/notes"),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Go to My Notes"]})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 space-y-4",children:Object.entries(ee).map(([t,s])=>e.jsxs(E,{className:"overflow-hidden",children:[e.jsx("div",{className:h("p-3 border-b",f(t).bg),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:h("h-4 w-4",f(t).text)}),e.jsx("h3",{className:"font-semibold text-sm",children:t}),e.jsx(z,{variant:"secondary",className:"ml-auto text-xs",children:s.length})]})}),e.jsx(L,{className:"p-2",children:s.map(a=>e.jsxs("button",{onClick:()=>G(a),className:h("w-full text-left p-3 rounded-lg transition-all group",r?.id===a.id?"bg-primary/10 border border-primary/30":"hover:bg-muted/50"),children:[e.jsx("p",{className:h("font-medium text-sm truncate",r?.id===a.id?"text-primary":"text-foreground"),children:a.title}),a.topic&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:a.topic})]},a.id))})]},t))}),e.jsx("div",{className:"lg:col-span-2",children:r?e.jsx(E,{className:"sticky top-4",children:e.jsxs(L,{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.subject&&e.jsx("span",{className:h("text-xs font-medium px-2 py-1 rounded-full",f(r.subject).bg,f(r.subject).text),children:r.subject}),r.topic&&e.jsx("span",{className:"text-xs text-muted-foreground px-2 py-1 rounded-md bg-muted",children:r.topic})]}),e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-foreground",children:r.title})]}),e.jsx(m,{variant:"outline",size:"icon",onClick:()=>Z(r),title:"Export as Markdown",children:e.jsx(Se,{className:"h-4 w-4"})})]}),r.tags&&r.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:r.tags.map((t,s)=>e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full bg-muted text-muted-foreground border",children:["#",t]},s))}),e.jsx("div",{className:"prose prose-sm max-w-none prose-headings:font-bold prose-h1:text-2xl prose-h2:text-xl prose-a:text-primary dark:prose-invert max-h-[60vh] overflow-y-auto pr-2 scroll-smooth",style:{scrollbarWidth:"thin",scrollbarGutter:"stable"},children:e.jsx(oe,{content:r.content})})]})}):e.jsx(E,{children:e.jsxs(L,{className:"p-12 text-center",children:[e.jsx(v,{className:"h-16 w-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Select a note"}),e.jsx("p",{className:"text-muted-foreground",children:"Choose a note from the list to view its content"})]})})})]})]}),e.jsx(le,{open:K,onOpenChange:g,children:e.jsxs(ne,{className:"sm:max-w-[500px]",children:[e.jsxs(ie,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5 text-purple-500"}),"AI Note Generator"]}),e.jsx(de,{children:"Enter a topic or specific question below, and our AI will generate a comprehensive study note for you."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(ue,{htmlFor:"prompt",children:"Topic or Question"}),e.jsx(je,{id:"prompt",placeholder:"E.g., 'Explain the causes of World War I' or 'How does photosynthesis work?'...",className:"min-h-[150px]",value:u,onChange:t=>_(t.target.value)})]})}),e.jsxs(me,{children:[e.jsx(m,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(m,{onClick:V,disabled:!u.trim()||F,className:"bg-gradient-to-r from-purple-500 to-blue-600 text-white",children:F?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"mr-2 h-4 w-4"}),"Generate Note"]})})]})]})})]}):e.jsx(N,{children:e.jsx("div",{className:"max-w-4xl mx-auto animate-fade-in",children:e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsxs("div",{className:"relative inline-block mb-6",children:[e.jsx(v,{className:"h-20 w-20 text-muted-foreground/50"}),e.jsx("div",{className:"absolute -top-2 -right-2 p-2 rounded-full bg-gradient-to-r from-yellow-500 to-amber-600",children:e.jsx(Ne,{className:"h-5 w-5 text-white"})})]}),e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-4",children:"Grade 9 Premium Notes"}),e.jsx("p",{className:"text-muted-foreground mb-8 max-w-md mx-auto",children:"Unlock exclusive Grade 9 study notes and materials designed to help you achieve top marks. These premium notes are curated by expert educators."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs(m,{size:"lg",className:"bg-gradient-to-r from-yellow-500 to-amber-600 hover:from-yellow-600 hover:to-amber-700 text-white",onClick:()=>y("/premium-dashboard"),children:[e.jsx(O,{className:"h-5 w-5 mr-2"}),"Upgrade to Premium"]}),e.jsxs(m,{variant:"outline",size:"lg",onClick:()=>y(-1),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Go Back"]})]}),e.jsxs("div",{className:"mt-12 grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"p-4 rounded-xl bg-muted/50",children:[e.jsx(ve,{className:"h-8 w-8 text-yellow-500 mx-auto mb-3"}),e.jsx("h3",{className:"font-semibold text-foreground mb-1",children:"Top Grade Content"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Notes designed for Grade 9 achievement"})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-muted/50",children:[e.jsx($,{className:"h-8 w-8 text-blue-500 mx-auto mb-3"}),e.jsx("h3",{className:"font-semibold text-foreground mb-1",children:"All Subjects"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Comprehensive coverage across subjects"})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-muted/50",children:[e.jsx(w,{className:"h-8 w-8 text-purple-500 mx-auto mb-3"}),e.jsx("h3",{className:"font-semibold text-foreground mb-1",children:"Expert Curated"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Created by experienced educators"})]})]})]})})})}export{Ve as default};
