import{j as e,L as b,y as W,aC as X,a3 as M,at as Z,ao as ee,a9 as se,a8 as te}from"./ui-vendor-CsSFJReh.js";import{A as S}from"./AppLayout-DI_SoCqt.js";import{u as ae,a as c,B as N,c as F}from"./index-D0R12c3l.js";import{C as x,a as w,b as _,c as B,d as h}from"./card-D_wUZn1S.js";import{I as C}from"./input-BOrw0D0Z.js";import{L as D}from"./label-CYC1LVAb.js";import{h as re}from"./premium-eVfGSoKP.js";import{u as ie,r as o}from"./react-vendor-BmZbDsmQ.js";import"./AnimatedLogoIcon-D5-EYdni.js";import"./sheet-0_ECFM1J.js";import"./supabase-vendor-BcRMW6g-.js";import"./query-vendor-DjEy6XLK.js";function fe(){const{supabase:t,user:a}=ae(),p=ie(),[v,R]=o.useState(!1),[U,$]=o.useState(!0),[E,T]=o.useState(!1),[j,k]=o.useState(!1),[n,z]=o.useState([]),[g,H]=o.useState([]),[d,f]=o.useState({subject:"",exam_date:"",exam_time:"",priority:"medium"});o.useEffect(()=>{a&&(J(),A(),y())},[a]);const J=async()=>{if(!(!a||!t))try{const s=await re(t);R(s),s||(c.error("This is a premium feature. Please upgrade to access."),p("/premium-dashboard"))}catch{}finally{$(!1)}},A=async()=>{if(a)try{const{data:s,error:r}=await t.from("exams").select("*").eq("user_id",a.id).order("exam_date",{ascending:!0});if(r)throw r;z(s||[])}catch{}},y=async()=>{if(a)try{const{data:s,error:r}=await t.from("study_plans").select("*").eq("user_id",a.id).order("date",{ascending:!0});if(r)throw r;H(s||[])}catch{}},K=async()=>{if(!a||!d.subject||!d.exam_date){c.error("Please fill in all required fields.");return}try{T(!0);const{error:s}=await t.from("exams").insert({user_id:a.id,subject:d.subject,exam_date:d.exam_date,exam_time:d.exam_time||null,priority:d.priority});if(s)throw s;c.success("Exam added successfully"),f({subject:"",exam_date:"",exam_time:"",priority:"medium"}),A()}catch{c.error("Failed to add exam. Please try again.")}finally{T(!1)}},G=async()=>{if(!a||n.length===0){c.error("Please add at least one exam first.");return}try{k(!0);const s=await fetch("/api/ai/generate-study-plan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({exams:n.map(i=>({subject:i.subject,exam_date:i.exam_date,priority:i.priority}))})});if(!s.ok)throw new Error("Failed to generate study plan");const{studyPlan:r}=await s.json(),l=r.map(i=>({user_id:a.id,exam_id:i.exam_id||null,date:i.date,subject:i.subject,topics:i.topics||[],duration_minutes:i.duration_minutes||60,study_method:i.study_method||"Review notes and practice questions",resources:i.resources||[],completed:!1})),{error:m}=await t.from("study_plans").insert(l);if(m)throw m;c.success("Study plan generated successfully!"),y()}catch{Y()}finally{k(!1)}},Y=async()=>{if(a)try{const s=[],r=new Date;n.forEach(m=>{const i=new Date(m.exam_date),Q=Math.ceil((i.getTime()-r.getTime())/(1e3*60*60*24)),V=Math.max(1,Math.min(Q-1,14));for(let u=0;u<V;u++){const I=new Date(r);I.setDate(r.getDate()+u),s.push({user_id:a.id,exam_id:m.id,date:I.toISOString().split("T")[0],subject:m.subject,topics:[`Topic ${u+1}`,`Topic ${u+2}`],duration_minutes:m.priority==="high"?90:60,study_method:u%2===0?"Review notes":"Practice questions",resources:["Past papers","Knowledge organisers"],completed:!1})}});const{error:l}=await t.from("study_plans").insert(s);if(l)throw l;c.success("Study plan generated successfully!"),y()}catch{c.error("Failed to generate study plan. Please try again.")}},L=async(s,r)=>{if(a)try{const{error:l}=await t.from("study_plans").update({completed:!r}).eq("id",s).eq("user_id",a.id);if(l)throw l;y()}catch{c.error("Failed to update study plan.")}};if(U)return e.jsx(S,{children:e.jsx("div",{className:"max-w-6xl mx-auto flex items-center justify-center h-[60vh]",children:e.jsx(b,{className:"h-8 w-8 animate-spin text-muted-foreground"})})});if(!v)return e.jsx(S,{children:e.jsxs("div",{className:"max-w-6xl mx-auto flex flex-col items-center justify-center h-[60vh] gap-4",children:[e.jsx(W,{className:"h-16 w-16 text-premium"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Premium Feature"}),e.jsx("p",{className:"text-muted-foreground",children:"This feature is available for premium members only."}),e.jsx(N,{onClick:()=>p("/premium-dashboard"),children:"Upgrade to Premium"})]})});const q=g.filter(s=>!s.completed),P=g.filter(s=>s.completed);return e.jsx(S,{children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground",children:"AI Study Plans"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Get personalized study schedules based on your exam dates"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(x,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Add Exam"}),e.jsx(B,{children:"Add your upcoming exams to generate a study plan"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"subject",children:"Subject *"}),e.jsx(C,{id:"subject",value:d.subject,onChange:s=>f({...d,subject:s.target.value}),placeholder:"e.g., Mathematics"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"exam_date",children:"Exam Date *"}),e.jsx(C,{id:"exam_date",type:"date",value:d.exam_date,onChange:s=>f({...d,exam_date:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"exam_time",children:"Time (optional)"}),e.jsx(C,{id:"exam_time",type:"time",value:d.exam_time,onChange:s=>f({...d,exam_time:s.target.value})})]})]}),e.jsx(N,{onClick:K,disabled:E,className:"w-full",children:E?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-4 w-4 mr-2 animate-spin"}),"Adding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Add Exam"]})})]})]}),e.jsxs(x,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Your Exams"}),e.jsxs(B,{children:[n.length," exam",n.length!==1?"s":""," scheduled"]})]}),e.jsxs(h,{children:[n.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"No exams added yet"}):e.jsx("div",{className:"space-y-2",children:n.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.subject}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[new Date(s.exam_date).toLocaleDateString(),s.exam_time&&` at ${s.exam_time}`]})]}),e.jsx("span",{className:F("text-xs px-2 py-1 rounded",s.priority==="high"?"bg-destructive/10 text-destructive":s.priority==="medium"?"bg-yellow-500/10 text-yellow-600":"bg-green-500/10 text-green-600"),children:s.priority})]},s.id))}),n.length>0&&e.jsx(N,{onClick:G,disabled:j,className:"w-full mt-4",children:j?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Generate AI Study Plan"]})})]})]})]}),g.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(x,{children:[e.jsx(w,{children:e.jsxs(_,{children:["Upcoming Study Sessions (",q.length,")"]})}),e.jsx(h,{className:"space-y-2",children:q.map(s=>e.jsx(O,{plan:s,onToggleComplete:L},s.id))})]}),P.length>0&&e.jsxs(x,{children:[e.jsx(w,{children:e.jsxs(_,{children:["Completed Sessions (",P.length,")"]})}),e.jsx(h,{className:"space-y-2",children:P.map(s=>e.jsx(O,{plan:s,onToggleComplete:L},s.id))})]})]}),g.length===0&&n.length>0&&e.jsx(x,{children:e.jsxs(h,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Z,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No study plan yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Generate an AI-powered study plan based on your exam dates"}),e.jsx(N,{onClick:G,disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Generate Study Plan"]})})]})})]})})}function O({plan:t,onToggleComplete:a}){return e.jsxs("div",{className:F("flex items-start gap-3 p-4 rounded-lg border transition-all",t.completed?"bg-muted/50 opacity-75":"bg-card hover:bg-muted/50"),children:[e.jsx("button",{onClick:()=>a(t.id,t.completed),className:"mt-1 flex-shrink-0",children:t.completed?e.jsx(ee,{className:"h-5 w-5 text-green-600"}):e.jsx("div",{className:"h-5 w-5 rounded-full border-2 border-muted-foreground/30"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:F("font-semibold",t.completed&&"line-through text-muted-foreground"),children:t.subject}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(se,{className:"h-3 w-3"}),e.jsx("span",{children:new Date(t.date).toLocaleDateString()})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:t.study_method}),t.topics&&t.topics.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:t.topics.map((p,v)=>e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-primary/10 text-primary",children:p},v))}),e.jsx("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"h-3 w-3"}),e.jsxs("span",{children:[t.duration_minutes," minutes"]})]})})]})]})}export{fe as default};
