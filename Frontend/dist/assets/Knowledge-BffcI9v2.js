import{j as e,L as H,ax as T,N as L,H as ct,Q as dt,ai as mt,$ as ut,aE as ht,aF as xt,aw as gt,az as pt,ar as V,aA as ft,aG as Ae,aj as jt,X as Te}from"./ui-vendor-DvDVRjyp.js";import{h as yt,A as _e}from"./AppLayout-DSG6wxEf.js";import{B as vt}from"./badge-BcqXIc_g.js";import{u as wt,j as bt,k as Nt,B as m,c as N}from"./index-DEqmCALs.js";import{C as St,a as kt,b as Ct}from"./collapsible-S0EwrZwi.js";import{D as Oe,b as Fe,c as Ee,d as Ke,e as Be,f as Le}from"./dialog-CeMj4lUC.js";import{D as Pt,a as zt,b as Dt,c as Me}from"./dropdown-menu-CM08DgPQ.js";import{I as P}from"./input-CG8Ib3hH.js";import{L as w}from"./label-lvNOnDGI.js";import{S as At}from"./scroll-area-tuIny8oN.js";import{S as _,a as O,b as F,c as E,d as y}from"./select-9ZKIQjAc.js";import{T as Re}from"./textarea-F7PLQ3VZ.js";import{b as Tt}from"./ai-client-BhyPJ4fF.js";import{E as $e}from"./constants-DeIw5BhA.js";import{t as _t,E as Ot}from"./jspdf.es.min-RcvtD-7z.js";import{u as Ft,i as Et,r as c}from"./react-vendor-Do86TxWo.js";import"./AnimatedLogoIcon-D6d7HWVb.js";import"./sheet-DlQTD0RE.js";import"./supabase-vendor-C2nLxrxH.js";import"./query-vendor-Bk-KKE7Z.js";import"./index-qX-aM79o.js";import"./index-Du_rhl89.js";import"./index-e3UtYKQr.js";import"./index-BdQq_4o_.js";function ns(){var Pe;const{supabase:S,user:x}=wt(),{t:f}=bt(),{toast:d}=Nt(),Y=Ft(),te=Et(),[W,Q]=c.useState([]),[Ge,se]=c.useState(!0),[X,ae]=c.useState(""),[M,re]=c.useState("All Subjects"),[R,ie]=c.useState("All Boards"),[K,ne]=c.useState("All Tiers"),[i,k]=c.useState(null),[J,z]=c.useState([]),[qe,D]=c.useState(!1),[B,le]=c.useState(null),[o,j]=c.useState({title:"",subject:"",topic:"",exam_board:"",tier:"",sections:[]}),[oe,ce]=c.useState(null),[Ue,$]=c.useState(!1),[G,de]=c.useState(""),[q,me]=c.useState(""),[U,ue]=c.useState(""),[A,he]=c.useState(!1),[h,xe]=c.useState(null),[b,He]=c.useState(10),[Ve,Ye]=c.useState(!1),[ge,pe]=c.useState(!1),[fe,je]=c.useState(!1),Z=c.useRef(null);c.useEffect(()=>{x&&(I(),ye())},[x]);const ye=async()=>{if(!(!x||!S))try{const t=new Date(Date.now()-864e5).toISOString(),{count:s,error:a}=await S.from("ai_usage_tracking").select("*",{count:"exact",head:!0}).eq("user_id",x.id).gt("created_at",t);if(a)return;const r=await yt(S),n=r?1e6:10;xe(s||0),He(n),Ye(r)}catch{}};c.useEffect(()=>{var t;(t=te.state)!=null&&t.context},[te.state,i]);const ve=t=>{var r;const s=((r=t.content)==null?void 0:r.sections)||[];if(s.length===0)return 0;const a=s.filter(n=>n.reviewed).length;return Math.round(a/s.length*100)},I=async()=>{var t;if(x)try{se(!0);const{data:s,error:a}=await S.from("knowledge_organizers").select("*").eq("user_id",x.id).order("updated_at",{ascending:!1});if(a)throw a;if(Q(s||[]),s&&s.length>0&&!i){k(s[0]);const r=s[0];(t=r.content)!=null&&t.sections&&r.content.sections.length>0&&z([r.content.sections[0].title])}}catch{d({title:"Error",description:"Failed to load knowledge organizers. Please try again.",variant:"destructive"})}finally{se(!1)}},we=()=>{le(null),j({title:"",subject:"",topic:"",exam_board:"",tier:"",sections:[]}),D(!0)},We=async()=>{var t;if(!x||!G.trim()){d({title:"Error",description:"Please enter a prompt to generate a knowledge organizer",variant:"destructive"});return}if(h!==null&&h>=b){d({title:"Limit Reached",description:"You have reached the daily limit of AI generation attempts. Please upgrade to premium for higher limits (500/day).",variant:"destructive"});return}he(!0);try{const s=await Tt({prompt:G,subject:q||void 0,topic:U||void 0},S);if(s.error){if(s.error.includes("limit")||s.error.includes("429"))d({title:"Limit Reached",description:s.error,variant:"destructive"}),ye();else throw new Error(s.error);return}(t=s.data)!=null&&t.sections&&(j({title:U||q||"AI Generated Organizer",subject:q||"",topic:U||"",exam_board:"",tier:"",sections:s.data.sections}),$(!1),D(!0),de(""),me(""),ue(""),s.data.usageCount!==void 0&&xe(s.data.usageCount),d({title:"Success",description:`Generated ${s.data.sections.length} sections! Review and edit before saving.`}))}catch(s){d({title:"Error",description:s.message||"Failed to generate knowledge organizer. Please try again.",variant:"destructive"})}finally{he(!1)}},Qe=t=>{var r,n;le(t);const a=(((r=t.content)==null?void 0:r.sections)||[]).map(l=>{var g;return{...l,keyPoints:((g=l.keyPoints)==null?void 0:g.map(p=>typeof p=="string"?{text:p,mastered:!1}:p))||[]}});j({title:t.title,subject:t.subject||"",topic:t.topic||"",exam_board:((n=t.content)==null?void 0:n.exam_board)||"",tier:t.tier||"",sections:a}),D(!0)},be=()=>{j({...o,sections:[...o.sections,{title:"",content:"",keyPoints:[],color:"primary"}]})},Xe=t=>{j({...o,sections:o.sections.filter((s,a)=>a!==t)})},ee=(t,s,a)=>{const r=[...o.sections];r[t]={...r[t],[s]:a},j({...o,sections:r})},Je=t=>{const s=[...o.sections],r=(s[t].keyPoints||[]).map(n=>typeof n=="string"?{text:n,mastered:!1}:n);r.push({text:"",mastered:!1}),s[t].keyPoints=r,j({...o,sections:s})},Ze=(t,s)=>{const a=[...o.sections];a[t].keyPoints=a[t].keyPoints.filter((r,n)=>n!==s),j({...o,sections:a})},Ie=(t,s,a)=>{const r=[...o.sections],l=(r[t].keyPoints||[]).map(g=>typeof g=="string"?{text:g,mastered:!1}:g);l[s]={...l[s],text:a},r[t].keyPoints=l,j({...o,sections:r})},et=(t,s)=>{const a=[...o.sections],n=(a[t].keyPoints||[]).map(l=>typeof l=="string"?{text:l,mastered:!1}:l);n[s]={...n[s],mastered:!n[s].mastered,lastReviewed:n[s].mastered?n[s].lastReviewed:new Date().toISOString()},a[t].keyPoints=n,j({...o,sections:a})},tt=async()=>{if(!x||!o.title.trim()){d({title:"Error",description:"Title is required",variant:"destructive"});return}if(!o.tier){d({title:"Error",description:"Please select a Tier (Foundation or Higher)",variant:"destructive"});return}const t=o.sections.filter(s=>s.title.trim()&&s.content.trim());try{const s={sections:t,exam_board:o.exam_board},a={user_id:x.id,title:o.title,subject:o.subject||null,topic:o.topic||null,tier:o.tier||null,content:s};if(B){const{error:r}=await S.from("knowledge_organizers").update(a).eq("id",B.id).eq("user_id",x.id);if(r)throw r;d({title:"Success",description:"Knowledge organizer updated successfully"})}else{const{error:r}=await S.from("knowledge_organizers").insert(a);if(r)throw r;d({title:"Success",description:"Knowledge organizer created successfully"})}D(!1),I()}catch(s){d({title:"Error",description:s.message||"Failed to save knowledge organizer. Please try again.",variant:"destructive"})}},st=async t=>{var s;if(!(!i||!x))try{ce(t);const a=[...((s=i.content)==null?void 0:s.sections)||[]];a[t]&&(a[t].reviewed=!0,a[t].lastReviewedAt=new Date().toISOString());const{error:r}=await S.from("knowledge_organizers").update({content:{sections:a}}).eq("id",i.id).eq("user_id",x.id);if(r)throw r;const{error:n}=await S.from("study_sessions").insert({user_id:x.id,organizer_id:i.id,duration:0,sections_reviewed:[t],date:new Date().toISOString()}),l={...i,content:{...i.content,sections:a}};k(l),Q(g=>g.map(p=>p.id===i.id?l:p)),d({title:"Section Reviewed",description:`"${a[t].title}" marked as reviewed`})}catch(a){d({title:"Error",description:a.message||"Failed to mark section as reviewed. Please try again.",variant:"destructive"})}finally{ce(null)}},at=async(t,s)=>{var a;if(!(!i||!x))try{const r=[...((a=i.content)==null?void 0:a.sections)||[]],n=r[t];if(!n||!n.keyPoints)return;const l=n.keyPoints.map(C=>typeof C=="string"?{text:C,mastered:!1}:C);l[s]={...l[s],mastered:!l[s].mastered,lastReviewed:l[s].mastered?l[s].lastReviewed:new Date().toISOString()},r[t]={...n,keyPoints:l};const{error:g}=await S.from("knowledge_organizers").update({content:{sections:r}}).eq("id",i.id).eq("user_id",x.id);if(g)throw g;const p={...i,content:{...i.content,sections:r}};k(p),Q(C=>C.map(u=>u.id===i.id?p:u))}catch(r){d({title:"Error",description:r.message||"Failed to update key point. Please try again.",variant:"destructive"})}},rt=async t=>{if(x&&confirm("Are you sure you want to delete this knowledge organizer?"))try{const{error:s}=await S.from("knowledge_organizers").delete().eq("id",t).eq("user_id",x.id);if(s)throw s;d({title:"Success",description:"Knowledge organizer deleted successfully"}),(i==null?void 0:i.id)===t&&k(null),I()}catch{d({title:"Error",description:"Failed to delete knowledge organizer. Please try again.",variant:"destructive"})}},Ne=async(t="png")=>{var a,r;if(!i||!Z.current){d({title:"Error",description:"No organizer selected or content not ready",variant:"destructive"});return}pe(!0);const s=J;try{const n=((r=(a=i.content)==null?void 0:a.sections)==null?void 0:r.map(u=>u.title))||[];n.length>0&&(z(n),await new Promise(u=>setTimeout(u,500)));const g=document.documentElement.classList.contains("dark")?"#020617":"#ffffff",p=await _t(Z.current,{quality:1,pixelRatio:2,backgroundColor:g,filter:u=>!(u instanceof HTMLElement&&u.classList.contains("export-exclude"))}),C=i.title.replace(/\s+/g,"_");if(t==="png"){const u=document.createElement("a");u.download=`${C}.png`,u.href=p,document.body.appendChild(u),u.click(),document.body.removeChild(u)}else{const u=new Ot({orientation:"portrait"}),ze=u.getImageProperties(p),De=u.internal.pageSize.getWidth(),ot=ze.height*De/ze.width;u.addImage(p,"PNG",0,0,De,ot),u.save(`${C}.pdf`)}d({title:"Downloaded!",description:`Knowledge organizer saved as ${t.toUpperCase()}`})}catch{d({title:"Download failed",description:"Failed to download knowledge organizer. Please try again.",variant:"destructive"})}finally{z(s),pe(!1)}},it=async()=>{var t,s;if(!(!i||!x))try{const a=((s=(t=i.content)==null?void 0:t.sections)==null?void 0:s.map(r=>{var n;return`${r.title}: ${r.content}
Key Points: ${((n=r.keyPoints)==null?void 0:n.map(l=>typeof l=="string"?l:l.text).join(", "))||""}`}).join(`

`))||"";if(!a.trim()){d({title:"No content",description:"This organizer doesn't have any content to create flashcards from.",variant:"destructive"});return}Y("/flashcards",{state:{organizerContent:a,subject:i.subject||"General",topic:i.topic}})}catch{d({title:"Error",description:"Failed to proceed to flashcards.",variant:"destructive"})}},v=W.filter(t=>{var g,p;const s=(t.title||"").toLowerCase().includes(X.toLowerCase()),a=M==="All Subjects"||t.subject===M,r=(g=t.content)==null?void 0:g.exam_board,n=R==="All Boards"||r===R,l=K==="All Tiers"||K==="Unassigned"&&!t.tier||((p=t.tier)==null?void 0:p.toLowerCase())===K.toLowerCase();return s&&a&&n&&l});c.useEffect(()=>{var t,s,a,r;i&&v.length>0?v.some(l=>l.id===i.id)||(k(v[0]),((s=(t=v[0].content)==null?void 0:t.sections)==null?void 0:s.length)>0&&z([v[0].content.sections[0].title])):i&&v.length===0?k(null):!i&&v.length>0&&(k(v[0]),((r=(a=v[0].content)==null?void 0:a.sections)==null?void 0:r.length)>0&&z([v[0].content.sections[0].title]))},[X,M,R,K,v.length]);const nt=t=>{z(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},Se=t=>{const s=new Date(t),r=Math.floor((new Date().getTime()-s.getTime())/1e3);return r<60?"Just now":r<3600?`${Math.floor(r/60)} minutes ago`:r<86400?`${Math.floor(r/3600)} hours ago`:r<604800?`${Math.floor(r/86400)} days ago`:s.toLocaleDateString()},lt=Array.from(new Set(W.map(t=>t.subject).filter(Boolean))),ke=((Pe=i==null?void 0:i.content)==null?void 0:Pe.sections)||[],Ce=i?ve(i):0;return Ge?e.jsx(_e,{children:e.jsx("div",{className:"max-w-6xl mx-auto flex items-center justify-center h-[60vh]",children:e.jsx(H,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsxs(_e,{children:[e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground",children:f("knowledge.title")}),e.jsx("p",{className:"text-muted-foreground mt-1",children:f("knowledge.subtitle")})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-2 w-full md:w-auto",children:[e.jsxs(m,{variant:"outline",onClick:()=>$(!0),className:"whitespace-nowrap",children:[e.jsx(T,{className:"h-4 w-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"whitespace-nowrap",children:f("knowledge.generateAI")}),h!==null&&e.jsx("span",{className:"ml-2 text-xs opacity-70 whitespace-nowrap",children:Ve?"(∞)":`(${b-h})`})]}),e.jsxs(m,{onClick:we,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),f("knowledge.createOrganizer")]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 animate-slide-up",style:{animationDelay:"0.1s"},children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ct,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(P,{placeholder:f("knowledge.searchPlaceholder"),value:X,onChange:t=>ae(t.target.value),className:"pl-9"})]}),e.jsxs(_,{value:M,onValueChange:re,children:[e.jsx(O,{className:"w-full sm:w-[180px]",children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(y,{value:"All Subjects",children:f("knowledge.allSubjects")}),lt.map(t=>e.jsx(y,{value:t,children:t},t))]})]}),e.jsxs(_,{value:R,onValueChange:ie,children:[e.jsx(O,{className:"w-full sm:w-[150px]",children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(y,{value:"All Boards",children:f("knowledge.allBoards")}),$e.map(t=>e.jsx(y,{value:t,children:t},t))]})]}),e.jsxs(_,{value:K,onValueChange:ne,children:[e.jsx(O,{className:"w-full sm:w-[150px]",children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(y,{value:"All Tiers",children:f("common.allTiers")}),e.jsx(y,{value:"Higher",children:f("flashcards.higher")}),e.jsx(y,{value:"Foundation",children:f("flashcards.foundation")}),e.jsx(y,{value:"Unassigned",children:f("pastPapers.unassigned")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:N("lg:col-span-1 animate-slide-up",fe?"hidden lg:block":"block"),style:{animationDelay:"0.2s",opacity:0},children:e.jsx(At,{className:"h-[calc(100vh-280px)] lg:h-[calc(100vh-220px)] rounded-lg",children:e.jsx("div",{className:"space-y-3 pr-3",children:W.length===0?e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(T,{className:"h-12 w-12 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:f("knowledge.noOrganizers")}),e.jsxs("p",{className:"text-muted-foreground mb-4",children:["Create your first knowledge organiser, generate one with AI, or add from the"," ",e.jsx("button",{type:"button",onClick:()=>Y("/library"),className:"text-primary hover:underline font-medium",children:"Global Library"})," ","(Organisers tab)."]}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsxs(m,{onClick:we,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),f("knowledge.createOrganizer")]}),e.jsx(m,{variant:"outline",onClick:()=>Y("/library"),children:f("library.title")})]})]}):v.length===0?e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(T,{className:"h-12 w-12 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No organizers found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Try adjusting your filters or create a new organizer"}),e.jsx(m,{variant:"outline",onClick:()=>{re("All Subjects"),ie("All Boards"),ne("All Tiers"),ae("")},children:"Clear Filters"})]}):v.map(t=>{const s=ve(t);return e.jsx("button",{onClick:()=>{var a;k(t),je(!0),(a=t.content)!=null&&a.sections&&t.content.sections.length>0&&z([t.content.sections[0].title])},className:N("w-full text-left p-4 rounded-xl transition-all duration-200",(i==null?void 0:i.id)===t.id?"glass-card border-primary/30 shadow-glow":"bg-muted/50 hover:bg-muted"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 flex-shrink-0",children:e.jsx(T,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-foreground truncate",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.subject||"General"," • ",t.topic||"General",t.tier&&e.jsx(vt,{variant:"secondary",className:N("text-[10px] h-4 px-1 ml-1",t.tier==="Higher"?"text-red-500 bg-red-500/10":"text-green-500 bg-green-500/10"),children:t.tier})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full transition-all duration-500",style:{width:`${s}%`}})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s,"%"]})]})]})]})},t.id)})})})}),e.jsx("div",{className:N("lg:col-span-2",fe?"block":"hidden lg:block"),children:e.jsx("div",{className:"lg:sticky lg:top-24 animate-slide-up",style:{animationDelay:"0.3s",opacity:0},children:i?e.jsxs("div",{ref:Z,className:"glass-card p-6 md:p-8 bg-white dark:bg-slate-950",children:[e.jsxs(m,{variant:"ghost",size:"sm",className:"lg:hidden mb-4 -ml-2 export-exclude",onClick:()=>je(!1),children:[e.jsx(dt,{className:"h-4 w-4 mr-1"}),"Back to List"]}),e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.subject&&e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-primary/10 text-primary",children:i.subject}),i.topic&&e.jsx("span",{className:"text-xs text-muted-foreground",children:i.topic})]}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-foreground",children:i.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("div",{className:"flex-1 max-w-[200px]",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[Ce,"%"]})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full transition-all duration-500",style:{width:`${Ce}%`}})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Last updated ",Se(i.updated_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 export-exclude",children:[e.jsx(m,{variant:"outline",size:"icon",onClick:()=>Qe(i),children:e.jsx(mt,{className:"h-4 w-4"})}),e.jsx(m,{variant:"outline",size:"icon",onClick:()=>rt(i.id),children:e.jsx(ut,{className:"h-4 w-4 text-destructive"})}),e.jsxs(Pt,{children:[e.jsx(zt,{asChild:!0,children:e.jsx(m,{variant:"outline",size:"icon",disabled:ge,children:ge?e.jsx(H,{className:"h-4 w-4 animate-spin"}):e.jsx(ht,{className:"h-4 w-4"})})}),e.jsxs(Dt,{align:"end",children:[e.jsxs(Me,{onClick:()=>Ne("png"),children:[e.jsx(xt,{className:"h-4 w-4 mr-2"}),"Download as PNG"]}),e.jsxs(Me,{onClick:()=>Ne("pdf"),children:[e.jsx(gt,{className:"h-4 w-4 mr-2"}),"Download as PDF"]})]})]})]})]}),ke.length>0?e.jsx("div",{className:"space-y-4",children:ke.map((t,s)=>e.jsxs(St,{open:J.includes(t.title),onOpenChange:()=>nt(t.title),children:[e.jsx(kt,{className:"w-full",children:e.jsxs("div",{className:N("flex items-center justify-between p-4 rounded-xl transition-all duration-200",t.color==="primary"&&"bg-primary/10 hover:bg-primary/15",t.color==="secondary"&&"bg-secondary/10 hover:bg-secondary/15",t.color==="accent"&&"bg-accent/20 hover:bg-accent/25"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:N("w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold",t.color==="primary"&&"bg-primary text-primary-foreground",t.color==="secondary"&&"bg-secondary text-secondary-foreground",t.color==="accent"&&"bg-accent text-accent-foreground"),children:s+1}),e.jsx("span",{className:"font-semibold text-foreground",children:t.title})]}),e.jsx(pt,{className:N("h-5 w-5 text-muted-foreground transition-transform duration-200",J.includes(t.title)&&"rotate-180")})]})}),e.jsx(Ct,{children:e.jsxs("div",{className:"p-4 pt-2 ml-11 space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsx("p",{className:"text-foreground whitespace-pre-wrap flex-1",children:t.content}),!t.reviewed&&e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>st(s),disabled:oe===s,className:"flex-shrink-0",children:[oe===s?e.jsx(H,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(V,{className:"h-4 w-4 mr-2"}),"Mark as Reviewed"]}),t.reviewed&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground flex-shrink-0",children:[e.jsx(V,{className:"h-4 w-4 text-primary"}),e.jsx("span",{children:"Reviewed"}),t.lastReviewedAt&&e.jsx("span",{className:"text-xs",children:Se(t.lastReviewedAt)})]})]}),t.keyPoints&&t.keyPoints.length>0&&e.jsxs("div",{className:N("p-4 rounded-lg",t.color==="primary"&&"bg-primary/5 border border-primary/20",t.color==="secondary"&&"bg-secondary/5 border border-secondary/20",t.color==="accent"&&"bg-accent/10 border border-accent/20"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ft,{className:N("h-4 w-4",t.color==="primary"&&"text-primary",t.color==="secondary"&&"text-secondary",t.color==="accent"&&"text-accent-foreground")}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:"Key Points"})]}),e.jsx("ul",{className:"space-y-2",children:t.keyPoints.map((a,r)=>{const n=typeof a=="string"?a:a.text,l=typeof a=="object"?a.mastered:!1;return e.jsxs("li",{className:"flex items-start gap-2 text-sm text-foreground group",children:[e.jsx("button",{onClick:()=>at(s,r),className:N("h-4 w-4 mt-0.5 flex-shrink-0 transition-colors cursor-pointer",l?t.color==="primary"&&"text-primary"||t.color==="secondary"&&"text-secondary"||t.color==="accent"&&"text-accent-foreground"||"text-primary":"text-muted-foreground hover:text-foreground"),title:l?"Mark as not mastered":"Mark as mastered",children:l?e.jsx(V,{className:"h-4 w-4"}):e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx("span",{className:N("flex-1",l&&"line-through opacity-60"),children:n})]},r)})})]})]})})]},t.title))}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{children:f("knowledge.noSections")})}),e.jsx("div",{className:"flex flex-col md:flex-row gap-3 mt-6 pt-6 border-t border-border",children:e.jsxs(m,{variant:"outline",className:"w-full md:flex-1",onClick:it,children:[e.jsx(jt,{className:"h-4 w-4 mr-2"}),"Create Flashcards"]})})]}):e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(T,{className:"h-16 w-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Select an organizer"}),e.jsx("p",{className:"text-muted-foreground",children:"Choose a knowledge organizer to view its contents"})]})})})]})]}),e.jsx(Oe,{open:qe,onOpenChange:D,children:e.jsxs(Fe,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ee,{children:[e.jsx(Ke,{children:B?"Edit Knowledge Organizer":"Create New Knowledge Organizer"}),e.jsx(Be,{children:B?"Update your knowledge organizer below":"Create a visual summary of your study material"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"title",children:"Title *"}),e.jsx(P,{id:"title",value:o.title,onChange:t=>j({...o,title:t.target.value}),placeholder:"e.g., Cell Biology Overview"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"subject",children:"Subject"}),e.jsx(P,{id:"subject",value:o.subject,onChange:t=>j({...o,subject:t.target.value}),placeholder:"e.g., Biology"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"topic",children:"Topic"}),e.jsx(P,{id:"topic",value:o.topic,onChange:t=>j({...o,topic:t.target.value}),placeholder:"e.g., Cell Biology"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"exam_board",children:"Exam Board"}),e.jsxs(_,{value:o.exam_board,onValueChange:t=>j({...o,exam_board:t}),children:[e.jsx(O,{id:"exam_board",children:e.jsx(F,{placeholder:"Select board"})}),e.jsx(E,{children:$e.map(t=>e.jsx(y,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"tier",children:"Tier"}),e.jsxs(_,{value:o.tier,onValueChange:t=>j({...o,tier:t}),children:[e.jsx(O,{id:"tier",children:e.jsx(F,{placeholder:"Select Tier"})}),e.jsxs(E,{children:[e.jsx(y,{value:"Higher",children:"Higher Tier"}),e.jsx(y,{value:"Foundation",children:"Foundation Tier"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(w,{children:"Sections"}),e.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:be,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Add Section"]})]}),o.sections.map((t,s)=>e.jsxs("div",{className:"p-4 border rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-semibold",children:["Section ",s+1]}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",onClick:()=>Xe(s),children:e.jsx(Te,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Section Title *"}),e.jsx(P,{value:t.title,onChange:a=>ee(s,"title",a.target.value),placeholder:"e.g., Cell Structure"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Content *"}),e.jsx(Re,{value:t.content,onChange:a=>ee(s,"content",a.target.value),placeholder:"Describe this section...",className:"min-h-[100px]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Color"}),e.jsxs(_,{value:t.color,onValueChange:a=>ee(s,"color",a),children:[e.jsx(O,{children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(y,{value:"primary",children:"Primary (Blue)"}),e.jsx(y,{value:"secondary",children:"Secondary (Purple)"}),e.jsx(y,{value:"accent",children:"Accent (Orange)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(w,{children:"Key Points"}),e.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:()=>Je(s),children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Add Point"]})]}),t.keyPoints.map((a,r)=>{const n=typeof a=="string"?a:a.text,l=typeof a=="object"?a.mastered:!1;return e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(P,{value:n,onChange:g=>Ie(s,r,g.target.value),placeholder:"Enter key point...",className:N(l&&"line-through opacity-60")}),e.jsx(m,{type:"button",variant:l?"default":"outline",size:"icon",onClick:()=>et(s,r),title:l?"Mark as not mastered":"Mark as mastered",children:l?e.jsx(V,{className:"h-4 w-4"}):e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",onClick:()=>Ze(s,r),children:e.jsx(Te,{className:"h-4 w-4"})})]},r)})]})]},s)),o.sections.length===0&&e.jsxs("div",{className:"text-center py-8 border border-dashed rounded-lg",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"No sections yet"}),e.jsxs(m,{type:"button",variant:"outline",onClick:be,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Add Your First Section"]})]})]})]}),e.jsxs(Le,{children:[e.jsx(m,{variant:"outline",onClick:()=>D(!1),children:"Cancel"}),e.jsxs(m,{onClick:tt,children:[B?"Update":"Create"," Organizer"]})]})]})}),e.jsx(Oe,{open:Ue,onOpenChange:$,children:e.jsxs(Fe,{className:"max-w-2xl",children:[e.jsxs(Ee,{children:[e.jsx(Ke,{children:"Generate Knowledge Organizer with AI"}),e.jsxs(Be,{children:["Describe what you want to learn, and AI will create a structured knowledge organizer with sections and key points.",h!==null&&e.jsx("span",{className:"block mt-2 text-sm font-medium",children:h!==null&&h>=b?e.jsx("span",{className:"text-destructive",children:"You've reached the daily limit."}):e.jsx("span",{children:b>1e3?"You have Unlimited generation attempts.":`You have ${h!==null?b-h:"..."} generation attempts remaining today.`})})]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"ai-prompt",children:"What would you like to learn? *"}),e.jsx(Re,{id:"ai-prompt",value:G,onChange:t=>de(t.target.value),placeholder:"e.g., Cell biology including organelles, their functions, and how they work together",className:"min-h-[100px]",disabled:A||h!==null&&h>=b})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"ai-subject",children:"Subject (optional)"}),e.jsx(P,{id:"ai-subject",value:q,onChange:t=>me(t.target.value),placeholder:"e.g., Biology",disabled:A||h!==null&&h>=b})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"ai-topic",children:"Topic (optional)"}),e.jsx(P,{id:"ai-topic",value:U,onChange:t=>ue(t.target.value),placeholder:"e.g., Cell Biology",disabled:A||h!==null&&h>=b})]})]}),h!==null&&h>=b&&e.jsx("div",{className:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-destructive font-medium",children:["You've reached the daily limit of ",b," AI generation attempts. ",b<=10?"Please upgrade to premium for higher limits.":"Please try again tomorrow."]})})]}),e.jsxs(Le,{children:[e.jsx(m,{variant:"outline",onClick:()=>$(!1),disabled:A,children:"Cancel"}),e.jsx(m,{onClick:We,disabled:A||!G.trim()||h!==null&&h>=b,children:A?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Generate"]})})]})]})})]})}export{ns as default};
