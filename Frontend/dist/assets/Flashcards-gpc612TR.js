import{j as e,L as Ae,a3 as Te,v as te,A as ae,p as ze,a4 as De,a5 as Ee,a6 as re,x as le,X as ie,a2 as qe,w as _e,a7 as ce,s as Le}from"./ui-vendor-C99L-hD9.js";import{A as ne}from"./AppLayout-ByMpyPpA.js";import{B as i}from"./button-BJr9rSp3.js";import{C as Pe}from"./checkbox-BsDa5eRn.js";import{D as Be,b as Ie,c as Ge,d as Me,e as He,f as Qe}from"./dialog-Dm4Wg0Dp.js";import{I as Q}from"./input-Bbf_O-WI.js";import{L as T}from"./label-CYsdHgGU.js";import{S as _,a as L,b as P,c as B,d as x}from"./select-BY7ge8Oe.js";import{T as oe}from"./textarea-GalEY1Wz.js";import{u as Oe,b as Re,c as z}from"./index-Dy4sOhmn.js";import{b as Ve}from"./ai-client-D_3hX6eY.js";import{i as $e,r as c}from"./react-vendor-CW_qxVlV.js";import"./sheet-Cazz0_fh.js";import"./index-BdQq_4o_.js";import"./index-ORJz1BqE.js";import"./supabase-vendor-BFJX04bJ.js";import"./query-vendor-CVP6rs-5.js";function ds(){const{supabase:m,user:r}=Oe(),{toast:o}=Re(),f=$e(),[v,O]=c.useState([]),[de,D]=c.useState(!0),[E,N]=c.useState(0),[R,y]=c.useState(!1),[C,he]=c.useState("All Subjects"),[I,V]=c.useState("All Topics"),[G,ue]=c.useState("All Tiers"),[M,me]=c.useState(""),[S,xe]=c.useState(!1),[q,H]=c.useState({correct:0,incorrect:0}),[fe,k]=c.useState(!1),[F,$]=c.useState(null),[a,p]=c.useState({front:"",back:"",subject:"",topic:"",tier:""}),[j,U]=c.useState(!1),[h,A]=c.useState(new Set);c.useEffect(()=>{r&&b()},[r]),c.useEffect(()=>{(async()=>{var t,l,d;if(r){if((t=f.state)!=null&&t.generatedFlashcards){await X(f.state.generatedFlashcards,f.state.subject||"General");return}if((l=f.state)!=null&&l.organizerContent){const g=f.state.organizerContent,se=f.state.subject||"General";try{o({title:"Generating flashcards...",description:"AI is creating flashcards from your organizer content. This may take a moment."});const w=await Ve({notes:g,subject:se,count:10},m);if(w.error)throw new Error(w.error);(d=w.data)!=null&&d.flashcards&&await X(w.data.flashcards,se)}catch(w){o({title:"Generation Failed",description:w.message||"Failed to generate flashcards. Please try again.",variant:"destructive"})}}}})()},[f.state,r]);const X=async(s,t)=>{try{if(!r)return;const l=s.map(g=>({user_id:r.id,front:g.question,back:g.answer,subject:g.subject||t,topic:null,difficulty:1,review_count:0})),{error:d}=await m.from("flashcards").insert(l);if(d)throw d;o({title:"Flashcards Created!",description:`${s.length} flashcards have been added to your collection.`}),window.history.replaceState({},document.title),b()}catch{o({title:"Error",description:"Failed to save generated flashcards.",variant:"destructive"})}},b=async()=>{if(r)try{D(!0);const{data:s,error:t}=await m.from("flashcards").select("*").eq("user_id",r.id).order("created_at",{ascending:!1});if(t)throw t;O(s||[])}catch{o({title:"Error",description:"Failed to load flashcards. Please try again.",variant:"destructive"})}finally{D(!1)}},J=()=>{$(null),p({front:"",back:"",subject:"",topic:"",tier:""}),k(!0)},pe=s=>{$(s),p({front:s.front,back:s.back,subject:s.subject||"",topic:s.topic||"",tier:s.tier||""}),k(!0)},je=async()=>{if(!r||!a.front.trim()||!a.back.trim()){o({title:"Error",description:"Both front and back are required",variant:"destructive"});return}if(!a.tier){o({title:"Error",description:"Please select a Tier (Foundation or Higher)",variant:"destructive"});return}try{if(F){const{error:s}=await m.from("flashcards").update({front:a.front,back:a.back,subject:a.subject||null,topic:a.topic||null,tier:a.tier||null}).eq("id",F.id).eq("user_id",r.id);if(s)throw s;o({title:"Success",description:"Flashcard updated successfully"})}else{const{error:s}=await m.from("flashcards").insert({user_id:r.id,front:a.front,back:a.back,subject:a.subject||null,topic:a.topic||null,tier:a.tier||null,difficulty:1,review_count:0});if(s)throw s;o({title:"Success",description:"Flashcard created successfully"})}k(!1),b()}catch(s){o({title:"Error",description:s.message||"Failed to save flashcard. Please try again.",variant:"destructive"})}},ge=async s=>{if(r&&confirm("Are you sure you want to delete this flashcard?"))try{const{error:t}=await m.from("flashcards").delete().eq("id",s).eq("user_id",r.id);if(t)throw t;o({title:"Success",description:"Flashcard deleted successfully"}),b()}catch{o({title:"Error",description:"Failed to delete flashcard. Please try again.",variant:"destructive"})}},ve=async(s,t)=>{if(r)try{const{data:l}=await m.from("flashcards").select("review_count").eq("id",s).eq("user_id",r.id).single(),{error:d}=await m.from("flashcards").update({last_reviewed:new Date().toISOString(),review_count:((l==null?void 0:l.review_count)||0)+1}).eq("id",s).eq("user_id",r.id);if(d)throw d;b()}catch{}},K=()=>{U(!j),A(new Set)},W=s=>{const t=new Set(h);t.has(s)?t.delete(s):t.add(s),A(t)},ye=()=>{if(h.size===n.length)A(new Set);else{const s=new Set(n.map(t=>t.id));A(s)}},be=async()=>{if(!(!r||h.size===0)&&confirm(`Are you sure you want to delete ${h.size} flashcards? This action cannot be undone.`))try{D(!0);const{error:s}=await m.from("flashcards").delete().in("id",Array.from(h)).eq("user_id",r.id);if(s)throw s;o({title:"Success",description:`Deleted ${h.size} flashcards successfully`}),A(new Set),U(!1),b()}catch{o({title:"Error",description:"Failed to delete flashcards. Please try again.",variant:"destructive"}),D(!1)}},n=v.filter(s=>{const t=C==="All Subjects"||s.subject===C,l=I==="All Topics"||s.topic===I,d=G==="All Tiers"||s.tier===G,g=s.front.toLowerCase().includes(M.toLowerCase())||s.back.toLowerCase().includes(M.toLowerCase());return t&&l&&d&&g});n.reduce((s,t)=>{const l=t.subject||"Uncategorized",d=t.topic||"General";return s[l]||(s[l]={}),s[l][d]||(s[l][d]=[]),s[l][d].push(t),s},{});const we=Array.from(new Set(v.map(s=>s.subject).filter(Boolean))),Ne=C!=="All Subjects"?Array.from(new Set(v.filter(s=>s.subject===C).map(s=>s.topic).filter(Boolean))):Array.from(new Set(v.map(s=>s.topic).filter(Boolean))),u=n[E],Ce=n.length>0?(E+1)/n.length*100:0,Y=()=>{y(!1),N(s=>(s+1)%n.length)},Se=()=>{y(!1),N(s=>(s-1+n.length)%n.length)},Z=()=>{y(!R)},ee=async s=>{H(s?t=>({...t,correct:t.correct+1}):t=>({...t,incorrect:t.incorrect+1})),Y(),u&&ve(u.id).catch(console.error)},ke=()=>{H({correct:0,incorrect:0}),N(0),y(!1)},Fe=()=>{const s=[...n].sort(()=>Math.random()-.5);O(s),N(0),y(!1)};return de?e.jsx(ne,{children:e.jsx("div",{className:"max-w-4xl mx-auto flex items-center justify-center h-[60vh]",children:e.jsx(Ae,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsxs(ne,{children:[e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground",children:"Flashcards"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:[v.length," card",v.length!==1?"s":""," total"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:j?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium mr-2",children:[h.size," selected"]}),e.jsx(i,{variant:"outline",onClick:ye,children:h.size===n.length?"Deselect All":"Select All"}),e.jsxs(i,{variant:"destructive",onClick:be,disabled:h.size===0,children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Delete (",h.size,")"]}),e.jsx(i,{variant:"ghost",onClick:K,children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"outline",onClick:K,children:"Select"}),e.jsxs(i,{variant:S?"default":"outline",onClick:()=>xe(!S),children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),S?"Exit Quiz":"Quiz Mode"]}),e.jsxs(i,{onClick:J,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Add Card"]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 animate-slide-up",style:{animationDelay:"0.1s",opacity:0},children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Q,{placeholder:"Search flashcards...",value:M,onChange:s=>me(s.target.value),className:"pl-9"})]}),e.jsxs(_,{value:C,onValueChange:s=>{he(s),V("All Topics")},children:[e.jsxs(L,{className:"w-full sm:w-[180px]",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),e.jsx(P,{})]}),e.jsxs(B,{children:[e.jsx(x,{value:"All Subjects",children:"All Subjects"}),we.map(s=>e.jsx(x,{value:s,children:s},s))]})]}),e.jsxs(_,{value:I,onValueChange:V,children:[e.jsx(L,{className:"w-full sm:w-[150px]",children:e.jsx(P,{})}),e.jsxs(B,{children:[e.jsx(x,{value:"All Topics",children:"All Topics"}),Ne.map(s=>e.jsx(x,{value:s,children:s},s))]})]}),e.jsxs(_,{value:G,onValueChange:ue,children:[e.jsx(L,{className:"w-full sm:w-[150px]",children:e.jsx(P,{})}),e.jsxs(B,{children:[e.jsx(x,{value:"All Tiers",children:"All Tiers"}),e.jsx(x,{value:"Higher",children:"Higher Tier"}),e.jsx(x,{value:"Foundation",children:"Foundation Tier"})]})]}),e.jsx(i,{variant:"outline",size:"icon",onClick:Fe,children:e.jsx(Ee,{className:"h-4 w-4"})})]}),n.length===0?e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(re,{className:"h-16 w-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No flashcards yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Create your first flashcard to get started"}),e.jsxs(i,{onClick:J,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Add Card"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass-card p-4 animate-slide-up",style:{animationDelay:"0.2s",opacity:0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Card ",E+1," of ",n.length]}),S&&e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-secondary flex items-center gap-1",children:[e.jsx(le,{className:"h-4 w-4"})," ",q.correct]}),e.jsxs("span",{className:"text-destructive flex items-center gap-1",children:[e.jsx(ie,{className:"h-4 w-4"})," ",q.incorrect]})]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all",style:{width:`${Ce}%`}})})]}),u&&e.jsxs("div",{className:z("flip-card h-80 md:h-96 cursor-pointer animate-scale-in relative",R&&"flipped"),style:{animationDelay:"0.3s",opacity:0},onClick:Z,children:[e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2 z-10",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:s=>{s.stopPropagation(),pe(u)},children:e.jsx(qe,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:s=>{s.stopPropagation(),ge(u.id)},children:e.jsx(ae,{className:"h-4 w-4 text-destructive"})})]}),e.jsxs("div",{className:"flip-card-inner",children:[e.jsxs("div",{className:"flip-card-front glass-card p-8 flex flex-col items-center justify-center text-center",children:[e.jsxs("div",{className:"absolute top-4 left-4 flex gap-2",children:[u.subject&&e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-primary/10 text-primary",children:u.subject}),u.tier&&e.jsx("span",{className:z("text-xs font-medium px-2 py-1 rounded-full",u.tier==="Higher"?"bg-red-500/10 text-red-500":"bg-green-500/10 text-green-500"),children:u.tier})]}),e.jsx(re,{className:"h-8 w-8 text-primary mb-4"}),e.jsx("h3",{className:"text-xl md:text-2xl font-semibold text-foreground",children:u.front}),e.jsx("p",{className:"text-sm text-muted-foreground mt-4",children:"Click to reveal answer"})]}),e.jsxs("div",{className:"flip-card-back glass-card p-8 flex flex-col items-center justify-center text-center bg-gradient-to-br from-secondary/10 to-primary/10",children:[e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-secondary/20 text-secondary-foreground",children:"Answer"})}),e.jsx("p",{className:"text-lg md:text-xl text-foreground leading-relaxed",children:u.back})]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 animate-slide-up",style:{animationDelay:"0.4s",opacity:0},children:[e.jsx(i,{variant:"outline",size:"icon",onClick:Se,className:"h-12 w-12 rounded-full",children:e.jsx(_e,{className:"h-5 w-5"})}),S?e.jsxs(e.Fragment,{children:[e.jsxs(i,{variant:"outline",className:"h-12 px-6 border-destructive text-destructive hover:bg-destructive hover:text-destructive-foreground",onClick:()=>ee(!1),children:[e.jsx(ie,{className:"h-5 w-5 mr-2"}),"Incorrect"]}),e.jsxs(i,{className:"h-12 px-6 bg-secondary hover:bg-secondary/90 text-secondary-foreground",onClick:()=>ee(!0),children:[e.jsx(le,{className:"h-5 w-5 mr-2"}),"Correct"]}),q.correct+q.incorrect>0&&e.jsxs(i,{variant:"outline",onClick:ke,className:"h-12 px-6",children:[e.jsx(ce,{className:"h-5 w-5 mr-2"}),"Reset"]})]}):e.jsxs(i,{variant:"outline",onClick:Z,className:"h-12 px-6",children:[e.jsx(ce,{className:"h-5 w-5 mr-2"}),"Flip Card"]}),e.jsx(i,{variant:"outline",size:"icon",onClick:Y,className:"h-12 w-12 rounded-full",children:e.jsx(Le,{className:"h-5 w-5"})})]}),n.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"All Cards"}),e.jsx("div",{className:"max-h-[50vh] overflow-y-auto pr-2 custom-scrollbar",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 animate-slide-up",style:{animationDelay:"0.5s",opacity:0},children:n.map((s,t)=>e.jsxs("button",{onClick:()=>{j?W(s.id):(N(t),y(!1))},className:z("p-4 rounded-xl text-left transition-all duration-200 relative group",E===t&&!j?"bg-primary text-primary-foreground shadow-glow":"bg-muted/50 hover:bg-muted text-foreground",j&&h.has(s.id)&&"ring-2 ring-primary bg-primary/10"),children:[j&&e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsx(Pe,{checked:h.has(s.id),onCheckedChange:()=>W(s.id),className:z("data-[state=checked]:bg-primary data-[state=checked]:border-primary",h.has(s.id)?"border-primary":"border-muted-foreground/50")})}),e.jsx("p",{className:z("text-xs font-medium mb-1 opacity-70",j&&"mr-6"),children:s.subject||"General"}),e.jsx("p",{className:"text-sm font-medium line-clamp-2",children:s.front})]},s.id))})})]})]})]}),e.jsx(Be,{open:fe,onOpenChange:k,children:e.jsxs(Ie,{className:"max-w-2xl",children:[e.jsxs(Ge,{children:[e.jsx(Me,{children:F?"Edit Flashcard":"Create New Flashcard"}),e.jsx(He,{children:F?"Update your flashcard details below":"Fill in the details to create a new flashcard"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"subject",children:"Subject"}),e.jsx(Q,{id:"subject",value:a.subject,onChange:s=>p({...a,subject:s.target.value}),placeholder:"e.g., Biology"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"topic",children:"Topic"}),e.jsx(Q,{id:"topic",value:a.topic,onChange:s=>p({...a,topic:s.target.value}),placeholder:"e.g., Cell Biology"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"tier",children:"Tier"}),e.jsxs(_,{value:a.tier,onValueChange:s=>p({...a,tier:s}),children:[e.jsx(L,{id:"tier",children:e.jsx(P,{placeholder:"Tier"})}),e.jsxs(B,{children:[e.jsx(x,{value:"Higher",children:"Higher"}),e.jsx(x,{value:"Foundation",children:"Foundation"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"front",children:"Front (Question) *"}),e.jsx(oe,{id:"front",value:a.front,onChange:s=>p({...a,front:s.target.value}),placeholder:"Enter the question or prompt...",className:"min-h-[100px]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"back",children:"Back (Answer) *"}),e.jsx(oe,{id:"back",value:a.back,onChange:s=>p({...a,back:s.target.value}),placeholder:"Enter the answer...",className:"min-h-[100px]"})]})]}),e.jsxs(Qe,{children:[e.jsx(i,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsxs(i,{onClick:je,children:[F?"Update":"Create"," Card"]})]})]})})]})}export{ds as default};
