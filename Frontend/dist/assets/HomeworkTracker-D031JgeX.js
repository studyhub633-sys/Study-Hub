import{u as Z,b as ee,r as u,d as o,j as e,L as V,B as h,a as E}from"./index-7wMNJNZJ.js";import{h as te,A,C as se}from"./AppLayout-Cb4f3Rcb.js";import{B as re}from"./badge-CT5QE6KZ.js";import{C as w,a as q,b as B,d as N}from"./card-BDQx_yt9.js";import{D as ie,b as ae,c as oe,d as ne,e as le,f as de}from"./dialog-CGZvDN6x.js";import{I}from"./input-CURGwIC-.js";import{L as f}from"./label-4_8C0ZIE.js";import{S as ce,a as me,b as ue,c as he,d as L}from"./select-Do0TjdJZ.js";import{T as xe}from"./textarea-DYv1Zddw.js";import{P as R}from"./plus-BgtP8iNg.js";import{C as G}from"./calendar-D5Qbqv8w.js";import{C as fe}from"./circle-check-C8Ohiiaq.js";import{B as pe}from"./bell-B0GSKUW5.js";import{C as ge}from"./clock-BKqJKRJR.js";import{S as je}from"./square-pen-CLPrXBHy.js";import{T as ye}from"./trash-2-CodGuS8N.js";import"./AnimatedLogoIcon-DY32PEux.js";import"./sheet-D4eoD1m7.js";import"./sun-CnDoiXzg.js";import"./index-BdQq_4o_.js";import"./index-8ugP4A3I.js";import"./chevron-down-CjDqse4M.js";function Me(){const{supabase:r,user:i}=Z(),g=ee(),[k,C]=u.useState(!1),[D,n]=u.useState(!0),[l,J]=u.useState([]),[K,U]=u.useState(!0),[Q,p]=u.useState(!1),[j,$]=u.useState(null),[s,d]=u.useState({title:"",description:"",subject:"",due_date:"",priority:"medium",notification_enabled:!0});u.useEffect(()=>{i&&(W(),y(),X())},[i]);const W=async()=>{if(!(!i||!r))try{const t=await te(r);C(t),t||(o.error("This is a premium feature. Please upgrade to access."),g("/premium-dashboard"))}catch{}finally{n(!1)}},y=async()=>{if(i)try{U(!0);const{data:t,error:a}=await r.from("homework").select("*").eq("user_id",i.id).order("due_date",{ascending:!0});if(a)throw a;J(t||[])}catch{o.error("Failed to load homework. Please try again.")}finally{U(!1)}},X=()=>{const t=setInterval(()=>{M()},6e4);return M(),()=>clearInterval(t)},M=async()=>{if(!i||!l.length)return;const t=new Date;l.filter(c=>{if(c.completed||!c.notification_enabled)return!1;const m=(new Date(c.due_date).getTime()-t.getTime())/(1e3*60*60);return m<=24&&m>0}).forEach(c=>{const m=(new Date(c.due_date).getTime()-t.getTime())/(1e3*60*60);m<=1&&m>0?o.warning(`‚è∞ "${c.title}" is due in less than 1 hour!`,{duration:1e4}):m<=24&&o.info(`üìö "${c.title}" is due in ${Math.round(m)} hours`,{duration:5e3})})},z=()=>{$(null),d({title:"",description:"",subject:"",due_date:"",priority:"medium",notification_enabled:!0}),p(!0)},_=t=>{$(t),d({title:t.title,description:t.description||"",subject:t.subject||"",due_date:t.due_date?new Date(t.due_date).toISOString().slice(0,16):"",priority:t.priority,notification_enabled:t.notification_enabled}),p(!0)},Y=async()=>{if(!i||!s.title||!s.due_date){o.error("Please fill in all required fields.");return}try{if(j){const{error:t}=await r.from("homework").update({title:s.title,description:s.description||null,subject:s.subject||null,due_date:s.due_date,priority:s.priority,notification_enabled:s.notification_enabled}).eq("id",j.id).eq("user_id",i.id);if(t)throw t;o.success("Homework updated successfully")}else{const{error:t}=await r.from("homework").insert({user_id:i.id,title:s.title,description:s.description||null,subject:s.subject||null,due_date:s.due_date,priority:s.priority,notification_enabled:s.notification_enabled,completed:!1});if(t)throw t;o.success("Homework added successfully")}p(!1),y()}catch(t){o.error(t.message||"Failed to save homework. Please try again.")}},T=async t=>{if(i)try{const{error:a}=await r.from("homework").update({completed:!t.completed}).eq("id",t.id).eq("user_id",i.id);if(a)throw a;y()}catch{o.error("Failed to update homework.")}},H=async t=>{if(i&&confirm("Are you sure you want to delete this homework?"))try{const{error:a}=await r.from("homework").delete().eq("id",t).eq("user_id",i.id);if(a)throw a;o.success("Homework deleted successfully"),y()}catch{o.error("Failed to delete homework.")}},S=t=>{switch(t){case"high":return"bg-destructive/10 text-destructive border-destructive/20";case"medium":return"bg-yellow-500/10 text-yellow-600 border-yellow-500/20";case"low":return"bg-green-500/10 text-green-600 border-green-500/20";default:return"bg-muted text-muted-foreground border-border"}},x=t=>{const a=new Date,F=new Date(t).getTime()-a.getTime();return Math.ceil(F/(1e3*60*60*24))};if(D)return e.jsx(A,{children:e.jsx("div",{className:"max-w-6xl mx-auto flex items-center justify-center h-[60vh]",children:e.jsx(V,{className:"h-8 w-8 animate-spin text-muted-foreground"})})});if(!k)return e.jsx(A,{children:e.jsxs("div",{className:"max-w-6xl mx-auto flex flex-col items-center justify-center h-[60vh] gap-4",children:[e.jsx(se,{className:"h-16 w-16 text-premium"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Premium Feature"}),e.jsx("p",{className:"text-muted-foreground",children:"This feature is available for premium members only."}),e.jsx(h,{onClick:()=>g("/premium-dashboard"),children:"Upgrade to Premium"})]})});const b=l.filter(t=>!t.completed),P=l.filter(t=>t.completed),v=b.filter(t=>x(t.due_date)<0);return e.jsx(A,{children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground",children:"Homework Tracker"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track your assignments and get notified when they're due"})]}),e.jsxs(h,{onClick:z,children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Add Homework"]})]}),K?e.jsx("div",{className:"flex items-center justify-center h-[40vh]",children:e.jsx(V,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"space-y-6",children:[v.length>0&&e.jsxs(w,{className:"border-destructive",children:[e.jsx(q,{children:e.jsxs(B,{className:"text-destructive",children:["Overdue (",v.length,")"]})}),e.jsx(N,{className:"space-y-2",children:v.map(t=>e.jsx(O,{homework:t,onEdit:_,onToggleComplete:T,onDelete:H,getPriorityColor:S,getDaysUntilDue:x},t.id))})]}),e.jsxs(w,{children:[e.jsx(q,{children:e.jsxs(B,{children:["Upcoming (",b.length-v.length,")"]})}),e.jsx(N,{className:"space-y-2",children:b.filter(t=>x(t.due_date)>=0).length===0?e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"No upcoming homework"}):b.filter(t=>x(t.due_date)>=0).map(t=>e.jsx(O,{homework:t,onEdit:_,onToggleComplete:T,onDelete:H,getPriorityColor:S,getDaysUntilDue:x},t.id))})]}),P.length>0&&e.jsxs(w,{children:[e.jsx(q,{children:e.jsxs(B,{children:["Completed (",P.length,")"]})}),e.jsx(N,{className:"space-y-2",children:P.map(t=>e.jsx(O,{homework:t,onEdit:_,onToggleComplete:T,onDelete:H,getPriorityColor:S,getDaysUntilDue:x},t.id))})]}),l.length===0&&e.jsx(w,{children:e.jsxs(N,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(G,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No homework yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Add your first assignment to get started"}),e.jsxs(h,{onClick:z,children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Add Homework"]})]})})]}),e.jsx(ie,{open:Q,onOpenChange:p,children:e.jsxs(ae,{children:[e.jsxs(oe,{children:[e.jsx(ne,{children:j?"Edit Homework":"Add Homework"}),e.jsx(le,{children:"Track your assignments and get notified when they're due"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"title",children:"Title *"}),e.jsx(I,{id:"title",value:s.title,onChange:t=>d({...s,title:t.target.value}),placeholder:"e.g., Biology Essay on Cells"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"description",children:"Description"}),e.jsx(xe,{id:"description",value:s.description,onChange:t=>d({...s,description:t.target.value}),placeholder:"Additional details...",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"subject",children:"Subject"}),e.jsx(I,{id:"subject",value:s.subject,onChange:t=>d({...s,subject:t.target.value}),placeholder:"e.g., Biology"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"priority",children:"Priority"}),e.jsxs(ce,{value:s.priority,onValueChange:t=>d({...s,priority:t}),children:[e.jsx(me,{children:e.jsx(ue,{})}),e.jsxs(he,{children:[e.jsx(L,{value:"low",children:"Low"}),e.jsx(L,{value:"medium",children:"Medium"}),e.jsx(L,{value:"high",children:"High"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"due_date",children:"Due Date & Time *"}),e.jsx(I,{id:"due_date",type:"datetime-local",value:s.due_date,onChange:t=>d({...s,due_date:t.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"notification_enabled",checked:s.notification_enabled,onChange:t=>d({...s,notification_enabled:t.target.checked}),className:"rounded"}),e.jsx(f,{htmlFor:"notification_enabled",className:"cursor-pointer",children:"Enable notifications for this homework"})]})]}),e.jsxs(de,{children:[e.jsx(h,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsxs(h,{onClick:Y,children:[j?"Update":"Add"," Homework"]})]})]})})]})})}function O({homework:r,onEdit:i,onToggleComplete:g,onDelete:k,getPriorityColor:C,getDaysUntilDue:D}){const n=D(r.due_date),l=n<0;return e.jsxs("div",{className:E("flex items-center justify-between p-4 rounded-lg border transition-all",r.completed?"bg-muted/50 opacity-75":l?"bg-destructive/5 border-destructive/20":"bg-card hover:bg-muted/50"),children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("button",{onClick:()=>g(r),className:"mt-1 flex-shrink-0",children:r.completed?e.jsx(fe,{className:"h-5 w-5 text-green-600"}):e.jsx("div",{className:"h-5 w-5 rounded-full border-2 border-muted-foreground/30"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:E("font-semibold",r.completed&&"line-through text-muted-foreground"),children:r.title}),e.jsx(re,{className:E("text-xs",C(r.priority)),children:r.priority}),r.notification_enabled&&e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"})]}),r.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:r.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[r.subject&&e.jsx("span",{className:"px-2 py-0.5 rounded bg-muted",children:r.subject}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"h-3 w-3"}),e.jsx("span",{children:l?`Overdue by ${Math.abs(n)} day${Math.abs(n)!==1?"s":""}`:n===0?"Due today":n===1?"Due tomorrow":`Due in ${n} days`})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-3 w-3"}),e.jsx("span",{children:new Date(r.due_date).toLocaleDateString()})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>i(r),children:e.jsx(je,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>k(r.id),children:e.jsx(ye,{className:"h-4 w-4 text-destructive"})})]})]})}export{Me as default};
