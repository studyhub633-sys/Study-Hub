import{j as e,L as $,aj as re,a4 as y,N as M,H as ne,ak as le,M as ie,aa as oe}from"./ui-vendor-BhfTkEdL.js";import{A as R}from"./AppLayout-DyYlXr0M.js";import{u as ce,j as de,k as me,B as m,c as z}from"./index-BWIqSF27.js";import{D as H,b as Q,c as U,d as q,e as K,f as W}from"./dialog-ByV6oEXD.js";import{I as G}from"./input-BIlMOJxd.js";import{L as F}from"./label-aiGua7-D.js";import{a as Y}from"./ai-client-Cg6MQdJC.js";import{u as ue,i as he,r as i}from"./react-vendor-Do86TxWo.js";import"./AnimatedLogoIcon-BNgjqHPG.js";import"./sheet-ByTzbT0g.js";import"./supabase-vendor-CklQTOeK.js";import"./query-vendor-C5_dwEAA.js";function w(r){return r===0?"new":r<=2?"learning":r<=4?"almostDone":"mastered"}function xe(r){if(r.totalCards===0)return 0;const n=r.learning*.33+r.almostDone*.66+r.mastered*1;return Math.round(n/r.totalCards*100)}function Ge(){const{supabase:r,user:n}=ce(),{t:f}=de(),{toast:c}=me(),L=ue(),u=he(),[g,J]=i.useState([]),[V,E]=i.useState(!0),[b,X]=i.useState(""),[Z,p]=i.useState(!1),[x,I]=i.useState(""),[ee,j]=i.useState(!1),[N,_]=i.useState(""),[A,T]=i.useState(""),[k,O]=i.useState(!1);i.useEffect(()=>{n&&D()},[n]),i.useEffect(()=>{(async()=>{var a,t,o;if(n){if((a=u.state)!=null&&a.generatedFlashcards){await C(u.state.generatedFlashcards,u.state.subject||"General");return}if((t=u.state)!=null&&t.organizerContent){const h=u.state.organizerContent,v=u.state.subject||"General";try{c({title:f("flashcards.generating"),description:f("flashcards.generatingDesc")});const d=await Y({notes:h,subject:v,count:10},r);if(d.error)throw new Error(d.error);(o=d.data)!=null&&o.flashcards&&await C(d.data.flashcards,v)}catch(d){c({title:"Generation Failed",description:d.message||"Failed to generate flashcards. Please try again.",variant:"destructive"})}}}})()},[u.state,n]);const C=async(s,a)=>{try{if(!n)return;const t=s.map(h=>({user_id:n.id,front:h.question,back:h.answer,subject:h.subject||a,topic:null,difficulty:1,review_count:0})),{error:o}=await r.from("flashcards").insert(t);if(o)throw o;c({title:f("flashcards.successCreated"),description:f("flashcards.successCreatedDesc",{count:s.length})}),window.history.replaceState({},document.title),D()}catch{c({title:"Error",description:"Failed to save generated flashcards.",variant:"destructive"})}},D=async()=>{if(n)try{E(!0);const{data:s,error:a}=await r.from("flashcards").select("*").eq("user_id",n.id).order("created_at",{ascending:!1});if(a)throw a;J(s||[])}catch{c({title:"Error",description:"Failed to load flashcards. Please try again.",variant:"destructive"})}finally{E(!1)}},P=async()=>{if(!(!n||!x.trim()))try{const{error:s}=await r.from("flashcards").insert({user_id:n.id,front:"Sample Question",back:"Sample Answer — edit or delete this card",subject:x.trim(),topic:"General",difficulty:1,review_count:0});if(s)throw s;c({title:"Deck Created",description:`"${x.trim()}" deck has been created.`}),p(!1),I(""),D(),L(`/flashcards/${encodeURIComponent(x.trim())}`)}catch{c({title:"Error",description:"Failed to create deck. Please try again.",variant:"destructive"})}},se=async()=>{var s;if(!(!n||!N.trim())){O(!0);try{const a=A.trim()||"General",t=await Y({notes:N,subject:a,count:10},r);if(t.error)throw new Error(t.error);(s=t.data)!=null&&s.flashcards&&(await C(t.data.flashcards,a),j(!1),_(""),T(""))}catch(a){c({title:"Generation Failed",description:a.message||"Failed to generate flashcards.",variant:"destructive"})}finally{O(!1)}}},S=(()=>{const s={};return g.forEach(a=>{const t=a.subject||"Uncategorised";s[t]||(s[t]=[]),s[t].push(a)}),Object.entries(s).map(([a,t])=>{const o=t.filter(l=>w(l.review_count)==="new").length,h=t.filter(l=>w(l.review_count)==="learning").length,v=t.filter(l=>w(l.review_count)==="almostDone").length,d=t.filter(l=>w(l.review_count)==="mastered").length,te=Array.from(new Set(t.map(l=>l.topic).filter(Boolean))),ae=t.map(l=>l.last_reviewed).filter(Boolean).sort().reverse()[0]||null;return{subject:a,cards:t,totalCards:t.length,newCards:o,learning:h,almostDone:v,mastered:d,lastStudied:ae,topics:te}})})(),B=S.filter(s=>s.subject.toLowerCase().includes(b.toLowerCase())||s.topics.some(a=>a.toLowerCase().includes(b.toLowerCase())));return V?e.jsx(R,{children:e.jsx("div",{className:"max-w-5xl mx-auto flex items-center justify-center h-[60vh]",children:e.jsx($,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsxs(R,{children:[e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 pb-12",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 animate-fade-in",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-foreground flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 rounded-xl bg-gradient-to-br from-primary/20 to-primary/5",children:e.jsx(re,{className:"h-7 w-7 text-primary"})}),f("flashcards.title")]}),e.jsxs("p",{className:"text-muted-foreground mt-1.5 ml-14",children:[S.length," ",S.length===1?"deck":"decks"," • ",g.length," total cards"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{variant:"outline",onClick:()=>j(!0),className:"gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),"AI Generate"]}),e.jsxs(m,{onClick:()=>p(!0),className:"gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"New Deck"]})]})]}),e.jsxs("div",{className:"relative animate-slide-up",style:{animationDelay:"0.1s"},children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search decks by name or topic...",value:b,onChange:s=>X(s.target.value),className:"pl-9"})]}),B.length===0?e.jsxs("div",{className:"glass-card p-12 text-center animate-fade-in",children:[e.jsx(le,{className:"h-16 w-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:g.length===0?"No flashcard decks yet":"No decks match your search"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:g.length===0?"Create your first deck to start organising your flashcards":"Try a different search term"}),g.length===0&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(m,{onClick:()=>p(!0),className:"gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Create a Deck"]}),e.jsxs(m,{variant:"outline",onClick:()=>j(!0),className:"gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),"AI Generate Cards"]})]})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 animate-slide-up",style:{animationDelay:"0.2s"},children:B.map((s,a)=>{const t=xe(s);return e.jsxs("button",{onClick:()=>L(`/flashcards/${encodeURIComponent(s.subject)}`),className:z("group glass-card p-5 text-left transition-all duration-300","hover:shadow-lg hover:shadow-primary/5 hover:border-primary/20","hover:translate-y-[-2px] active:translate-y-0"),style:{animationDelay:`${.05*a}s`},children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-foreground text-base truncate group-hover:text-primary transition-colors",children:s.subject}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5",children:[s.totalCards," ",s.totalCards===1?"card":"cards"]})]}),e.jsx(ie,{className:"h-5 w-5 text-muted-foreground/50 group-hover:text-primary transition-all group-hover:translate-x-0.5 flex-shrink-0 mt-0.5"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progress"}),e.jsxs("span",{className:z("font-semibold",t>=80?"text-emerald-500":t>=40?"text-blue-500":"text-muted-foreground"),children:[t,"%"]})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsxs("div",{className:"h-full flex",children:[s.mastered>0&&e.jsx("div",{className:"bg-emerald-500 transition-all duration-500",style:{width:`${s.mastered/s.totalCards*100}%`}}),s.almostDone>0&&e.jsx("div",{className:"bg-blue-500 transition-all duration-500",style:{width:`${s.almostDone/s.totalCards*100}%`}}),s.learning>0&&e.jsx("div",{className:"bg-amber-500 transition-all duration-500",style:{width:`${s.learning/s.totalCards*100}%`}})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-rose-400/80"}),e.jsx("span",{className:"text-muted-foreground",children:"New"}),e.jsx("span",{className:"ml-auto font-medium text-foreground",children:s.newCards})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-amber-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Learning"}),e.jsx("span",{className:"ml-auto font-medium text-foreground",children:s.learning})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Almost"}),e.jsx("span",{className:"ml-auto font-medium text-foreground",children:s.almostDone})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Mastered"}),e.jsx("span",{className:"ml-auto font-medium text-foreground",children:s.mastered})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-border/50",children:[s.topics.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1.5 mb-2",children:[s.topics.slice(0,3).map(o=>e.jsx("span",{className:"text-[10px] font-medium px-1.5 py-0.5 rounded bg-primary/10 text-primary",children:o},o)),s.topics.length>3&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["+",s.topics.length-3," more"]})]}),s.lastStudied&&e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-muted-foreground",children:[e.jsx(oe,{className:"h-3 w-3"}),"Last studied ",new Date(s.lastStudied).toLocaleDateString()]})]})]},s.subject)})})]}),e.jsx(H,{open:Z,onOpenChange:p,children:e.jsxs(Q,{className:"max-w-md",children:[e.jsxs(U,{children:[e.jsx(q,{children:"Create New Deck"}),e.jsx(K,{children:"Give your flashcard deck a name. You can add cards after creating it."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"deckName",children:"Deck Name"}),e.jsx(G,{id:"deckName",value:x,onChange:s=>I(s.target.value),placeholder:"e.g., Cold War, Cell Biology, Macbeth...",onKeyDown:s=>s.key==="Enter"&&P(),autoFocus:!0})]})}),e.jsxs(W,{children:[e.jsx(m,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(m,{onClick:P,disabled:!x.trim(),children:"Create Deck"})]})]})}),e.jsx(H,{open:ee,onOpenChange:j,children:e.jsxs(Q,{className:"max-w-md",children:[e.jsxs(U,{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5 text-purple-500"}),"AI Flashcard Generator"]}),e.jsx(K,{children:"Enter your study notes or a topic and our AI will generate flashcards for you."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"genSubject",children:"Deck Name (Subject)"}),e.jsx(G,{id:"genSubject",value:A,onChange:s=>T(s.target.value),placeholder:"e.g., Biology, History..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"genTopic",children:"Topic or Notes"}),e.jsx("textarea",{id:"genTopic",value:N,onChange:s=>_(s.target.value),placeholder:"Paste your notes or enter a topic...",className:"flex min-h-[120px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring resize-none"})]})]}),e.jsxs(W,{children:[e.jsx(m,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(m,{onClick:se,disabled:!N.trim()||k,className:"bg-gradient-to-r from-purple-500 to-blue-600 text-white",children:k?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),"Generate Cards"]})})]})]})})]})}export{Ge as default};
