import{j as e,L as Ne,N as H,ay as we,aw as A,aG as _e,am as Se,aU as Ce,H as Pe,aC as ke,I as Ae,ao as Te,aj as Ee,E as D,a4 as Fe}from"./ui-vendor-DvDVRjyp.js";import{A as Q}from"./AppLayout-DSG6wxEf.js";import{B as R}from"./badge-BcqXIc_g.js";import{u as Oe,k as Ue,j as $e,B as x,c as De}from"./index-DEqmCALs.js";import{D as q,b as V,c as W,d as J,e as z,f as Re}from"./dialog-CeMj4lUC.js";import{I as b}from"./input-CG8Ib3hH.js";import{L as p}from"./label-lvNOnDGI.js";import{P as G}from"./progress-DraQbaXi.js";import{S as w,a as _,b as S,c as C,d as f}from"./select-9ZKIQjAc.js";import{E as Y}from"./constants-DeIw5BhA.js";import{u as Be,h as Me,r as m}from"./react-vendor-Do86TxWo.js";import"./AnimatedLogoIcon-D6d7HWVb.js";import"./sheet-DlQTD0RE.js";import"./supabase-vendor-C2nLxrxH.js";import"./query-vendor-Bk-KKE7Z.js";import"./index-BdQq_4o_.js";import"./index-Du_rhl89.js";class Le{static parse(r){if(!r)return{board:"Unknown",type:"Other",rawUrl:r};const l=r.split("/").pop()||"";return r.includes("aqa.org.uk")?this.parseAQA(l,r):r.includes("pearson.com")||l.includes("9MA0")||l.includes("8MA0")?this.parseEdexcel(l,r):r.includes("ocr.org.uk")?this.parseOCR(l,r):{board:"Unknown",type:"Other",rawUrl:r}}static parseAQA(r,l){const c=/AQA-([A-Z0-9]+)-([A-Z]+)-([A-Z]+)(\d{2})/i,u=r.match(c);return u?{board:"AQA",subjectCode:u[1],type:this.mapType(u[2]),month:this.mapMonth(u[3]),year:"20"+u[4],rawUrl:l}:{board:"AQA",type:"Other",rawUrl:l}}static parseEdexcel(r,l){const c=/([A-Z0-9]+)_(\w+)_(\w+)_(\d{4})(\d{2})(\d{2})/,u=r.match(c);return u?{board:"Edexcel",subjectCode:u[1],type:this.mapType(u[3]),year:u[4],month:this.mapMonthNumber(u[5]),rawUrl:l}:{board:"Edexcel",type:"Other",rawUrl:l}}static parseOCR(r,l){return{board:"OCR",type:r.includes("question-paper")?"Question Paper":r.includes("mark-scheme")?"Mark Scheme":"Other",subjectCode:r.split("-")[0],rawUrl:l}}static mapType(r){const l=r.toUpperCase();return l==="QP"||l==="QUE"?"Question Paper":l==="MS"||l==="RMS"?"Mark Scheme":l==="ER"||l==="REP"?"Examiner Report":"Other"}static mapMonth(r){const l=r.toUpperCase();return l==="JUN"?"June":l==="NOV"?"November":l==="JAN"?"January":r}static mapMonthNumber(r){return r==="06"?"June":r==="11"?"November":r==="01"?"January":r}}function ls(){const{supabase:N,user:r}=Oe(),{toast:l}=Ue(),{t:c}=$e(),u=Be(),[Z]=Me(),[j,X]=m.useState([]),[K,B]=m.useState(!0),[M,ee]=m.useState(""),[T,se]=m.useState("All Subjects"),[E,te]=m.useState("All Boards"),[P,ae]=m.useState(Z.get("tier")||"All Tiers"),[re,k]=m.useState(!1),[y,le]=m.useState(null),[t,h]=m.useState({title:"",subject:"",year:"",exam_board:"",tier:"",file_url:"",file_type:"link",score:"",max_score:""}),[a,v]=m.useState(null),[ie,F]=m.useState(0),[Ie,O]=m.useState(null);m.useEffect(()=>{r&&(U(),ne())},[r]),m.useEffect(()=>{if(!a||!r){O(null);return}const s=new Date;O(s);let n=s;const i=setInterval(()=>{F(o=>o+1)},1e3);return()=>{clearInterval(i);const o=Math.floor((new Date().getTime()-n.getTime())/1e3);o>0&&a&&ce(a.id,o)}},[a,r]);const ne=async()=>{if(r)try{const n=j.filter(i=>i.completed_at).length*1;F(n*3600)}catch{}},ce=async(s,n)=>{if(!(!r||n<=0))try{F(i=>i+n)}catch{}},U=async()=>{if(r)try{B(!0);const{data:s,error:n}=await N.from("past_papers").select("*").eq("user_id",r.id).order("created_at",{ascending:!1});if(n)throw n;X(s||[])}catch{l({title:"Error",description:"Failed to load past papers. Please try again.",variant:"destructive"})}finally{B(!1)}},L=()=>{le(null),h({title:"",subject:"",year:"",exam_board:"",tier:"",file_url:"",file_type:"link",score:"",max_score:""}),k(!0)},oe=()=>{if(!t.file_url){l({title:"No Link Found",description:"Please paste a link first to use auto-fill.",variant:"destructive"});return}const s=Le.parse(t.file_url);if(s.board==="Unknown"&&s.type==="Other"&&!s.subjectCode){l({title:"Could not parse link",description:"This link format is not recognized for auto-fill.",variant:"destructive"});return}let n=t.title;if(s.subjectCode||s.board!=="Unknown"){const i=[];s.subjectCode&&i.push(s.subjectCode),s.type!=="Other"&&i.push(s.type),s.year&&i.push(s.year),s.month&&i.push(s.month),s.board!=="Unknown"&&i.push(`(${s.board})`),n=i.join(" ")}h(i=>({...i,title:n||i.title,subject:s.subjectCode||i.subject,exam_board:s.board!=="Unknown"?s.board:i.exam_board,year:s.year||i.year})),l({title:"Auto-filled!",description:`Parsed ${s.board} paper details.`})},de=async()=>{var s;if(!r||!t.title.trim()){l({title:"Error",description:"Title is required",variant:"destructive"});return}if(!t.tier){l({title:"Error",description:"Please select a Tier (Foundation or Higher)",variant:"destructive"});return}try{let n=((s=t.file_url)==null?void 0:s.trim())||null;const i={user_id:r.id,title:t.title,subject:t.subject||null,year:t.year?parseInt(t.year):null,exam_board:t.exam_board||null,tier:t.tier||null,file_url:n,file_type:t.file_type,score:t.score?parseInt(t.score):null,max_score:t.max_score?parseInt(t.max_score):null,completed_at:t.score?new Date().toISOString():null};if(y){const{error:o}=await N.from("past_papers").update(i).eq("id",y.id).eq("user_id",r.id);if(o)throw o;l({title:"Success",description:"Past paper updated successfully"})}else{const{error:o}=await N.from("past_papers").insert(i);if(o)throw o;l({title:"Success",description:"Past paper created successfully"})}k(!1),U()}catch(n){l({title:"Error",description:n.message||"Failed to save past paper. Please try again.",variant:"destructive"})}},me=s=>{if(!s.file_url){l({title:"No link available",description:"This paper doesn't have a link attached yet.",variant:"destructive"});return}window.open(s.file_url,"_blank","noopener,noreferrer")},ue=s=>{v(s),O(new Date)},he=s=>{const n=Math.floor(s/3600),i=Math.floor(s%3600/60);return n>0?`${n}h ${i}m`:`${i}m`},xe=s=>{if(!s.subject){l({title:"No subject available",description:"This paper needs a subject to generate flashcards.",variant:"destructive"});return}u("/flashcards",{state:{organizerContent:`Generate flashcards for ${s.subject} based on the ${s.exam_board||"GCSE"} syllabus. Year: ${s.year||"recent"}. Paper title: ${s.title}. Focus on key concepts, definitions, and exam-style questions that would appear in this type of paper.`,subject:s.subject,topic:s.title}}),l({title:"Generating flashcards...",description:`Creating flashcards for ${s.subject}`})},I=j.filter(s=>{const n=(s.title||"").toLowerCase().includes(M.toLowerCase()),i=T==="All Subjects"||s.subject===T,o=E==="All Boards"||s.exam_board===E;let g=s.tier;if(!g&&s.title){const d=s.title.toLowerCase(),ye=d.includes("foundation")||d.includes(" 1f")||d.includes(" 2f")||d.includes(" 3f")||d.endsWith("1f")||d.endsWith("2f")||d.endsWith("3f")||/\b[1-3]f\b/.test(d),ve=d.includes("higher")||d.includes(" 1h")||d.includes(" 2h")||d.includes(" 3h")||d.endsWith("1h")||d.endsWith("2h")||d.endsWith("3h")||/\b[1-3]h\b/.test(d);ye?g="Foundation":ve&&(g="Higher")}const be=P==="All Tiers"||P==="Unassigned"&&!g||(g==null?void 0:g.toLowerCase())===P.toLowerCase();return n&&i&&o&&be}),pe=j.filter(s=>s.completed_at).length,$=j.filter(s=>s.score!==null&&s.max_score!==null),fe=$.length>0?$.reduce((s,n)=>s+(n.score||0)/(n.max_score||1)*100,0)/$.length:0,je=Array.from(new Set(j.map(s=>s.subject).filter(Boolean)));m.useEffect(()=>{if(!y&&t.year&&t.subject&&t.tier){const s=t.tier==="Higher"?"H":"F",n=t.exam_board?` ${t.exam_board}`:"",i=`${t.year}${s} ${t.subject}${n}`;(!t.title||t.title.trim()==="")&&h(o=>({...o,title:i}))}},[t.year,t.subject,t.tier,t.exam_board,y]);const ge=s=>{if(s.year&&s.subject&&s.tier){const n=s.tier==="Higher"?"H":"F",i=s.exam_board?` ${s.exam_board}`:"",o=s.title.match(/(?:Paper|Component)\s*(\d+)/i),g=o?` P${o[1]}`:"";return`${s.year}${n} ${s.subject}${g}${i}`}return s.title};return K?e.jsx(Q,{children:e.jsx("div",{className:"max-w-6xl mx-auto flex items-center justify-center h-[60vh]",children:e.jsx(Ne,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsxs(Q,{children:[e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground",children:c("pastPapers.title")}),e.jsx("p",{className:"text-muted-foreground mt-1",children:c("pastPapers.subtitle",{count:j.length,plural:j.length!==1?"s":""})})]}),e.jsxs(x,{onClick:L,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),c("pastPapers.addPaper")]})]}),e.jsxs("div",{className:"rounded-lg border border-amber-500/20 bg-amber-500/5 p-4 flex items-start gap-3 animate-fade-in",children:[e.jsx(we,{className:"h-5 w-5 text-amber-500 mt-0.5 shrink-0"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx("p",{className:"font-medium text-foreground mb-1",children:"Copyright Notice"}),e.jsx("p",{children:"All past examination papers are the copyright of their respective exam boards (AQA, Pearson Edexcel, OCR, Eduqas/WJEC). Revisely.ai does not host, store, or reproduce any exam board content. Links provided open directly on the official exam board websites. Revisely.ai is not affiliated with, endorsed by, or connected to any exam board."})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 animate-slide-up",style:{animationDelay:"0.1s"},children:[{label:c("pastPapers.totalPapers"),value:j.length,icon:A},{label:c("pastPapers.completed"),value:pe,icon:_e},{label:c("pastPapers.averageScore"),value:`${Math.round(fe)}%`,icon:Se},{label:c("pastPapers.studyTime"),value:he(ie),icon:Ce}].map(s=>e.jsx("div",{className:"glass-card p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(s.icon,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-foreground",children:s.value}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.label})]})]})},s.label))}),e.jsxs("div",{className:"flex flex-wrap gap-3 animate-slide-up",style:{animationDelay:"0.2s"},children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(Pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(b,{placeholder:c("pastPapers.searchPlaceholder"),value:M,onChange:s=>ee(s.target.value),className:"pl-9"})]}),e.jsxs(w,{value:T,onValueChange:se,children:[e.jsx(_,{className:"w-[150px]",children:e.jsx(S,{})}),e.jsxs(C,{children:[e.jsx(f,{value:"All Subjects",children:c("common.allSubjects")}),je.map(s=>e.jsx(f,{value:s,children:s},s))]})]}),e.jsxs(w,{value:E,onValueChange:te,children:[e.jsx(_,{className:"w-[140px]",children:e.jsx(S,{})}),e.jsxs(C,{children:[e.jsx(f,{value:"All Boards",children:c("common.allBoards")}),Y.map(s=>e.jsx(f,{value:s,children:s},s))]})]}),e.jsxs(w,{value:P,onValueChange:ae,children:[e.jsx(_,{className:"w-[180px]",children:e.jsx(S,{})}),e.jsxs(C,{children:[e.jsx(f,{value:"All Tiers",children:c("common.allTiers")}),e.jsx(f,{value:"Higher",children:c("flashcards.higher")}),e.jsx(f,{value:"Foundation",children:c("flashcards.foundation")}),e.jsx(f,{value:"Unassigned",children:c("pastPapers.unassigned")})]})]})]}),j.length===0?e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(A,{className:"h-16 w-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:c("pastPapers.noPapers")}),e.jsx("p",{className:"text-muted-foreground mb-4",children:c("pastPapers.createFirst")}),e.jsxs(x,{onClick:L,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),c("pastPapers.addPaper")]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:I.map((s,n)=>{const i=!!s.completed_at,o=s.score&&s.max_score?s.score/s.max_score*100:0;return e.jsxs("div",{className:"glass-card p-5 hover-lift animate-slide-up",style:{animationDelay:`${.1*n}s`},children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.subject&&e.jsx(R,{variant:"outline",children:s.subject}),s.exam_board&&e.jsx(R,{variant:"outline",children:s.exam_board}),s.tier&&e.jsx(R,{variant:"secondary",className:s.tier==="Higher"?"bg-red-500/10 text-red-500 border-red-500/20":"bg-green-500/10 text-green-500 border-green-500/20",children:s.tier})]})}),e.jsx("h3",{className:"font-semibold text-foreground mb-1",children:ge(s)}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:[s.subject," • ",s.year]}),i&&s.score!==null&&s.max_score!==null?e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-muted-foreground",children:c("pastPapers.yourScore")}),e.jsxs("span",{className:De("font-bold",o>=70?"text-secondary":o>=50?"text-accent-foreground":"text-destructive"),children:[Math.round(o),"%"]})]}),e.jsx(G,{value:o,className:"h-2"})]}):e.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-muted/50 flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ke,{className:"h-4 w-4"}),e.jsx("span",{children:c("pastPapers.notAttempted")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:i?"outline":"default",className:"flex-1",onClick:()=>ue(s),children:i?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),c("common.review")]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),c("pastPapers.startQuiz")]})}),e.jsx(x,{variant:"outline",size:"icon",onClick:()=>xe(s),title:c("pastPapers.generateFlashcards"),children:e.jsx(Ee,{className:"h-4 w-4"})}),s.file_url&&e.jsx(e.Fragment,{children:e.jsx(x,{variant:"outline",size:"icon",onClick:()=>me(s),title:"Open on exam board website",children:e.jsx(D,{className:"h-4 w-4"})})})]})]},s.id)})}),I.length===0&&j.length>0&&e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(A,{className:"h-16 w-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No papers found"}),e.jsx("p",{className:"text-muted-foreground",children:"Try adjusting your filters"})]})]}),e.jsx(q,{open:re,onOpenChange:k,children:e.jsxs(V,{className:"max-w-2xl",children:[e.jsxs(W,{children:[e.jsx(J,{children:y?"Edit Past Paper":"Create New Past Paper"}),e.jsx(z,{children:y?"Update your past paper details below":"Fill in the details to create a new past paper"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"title",children:"Title *"}),e.jsx(b,{id:"title",value:t.title,onChange:s=>h({...t,title:s.target.value}),placeholder:"Enter paper title"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"subject",children:"Subject"}),e.jsx(b,{id:"subject",value:t.subject,onChange:s=>h({...t,subject:s.target.value}),placeholder:"e.g., Biology"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"exam_board",children:"Exam Board"}),e.jsxs(w,{value:t.exam_board,onValueChange:s=>h({...t,exam_board:s}),children:[e.jsx(_,{id:"exam_board",children:e.jsx(S,{placeholder:"Select board"})}),e.jsx(C,{children:Y.map(s=>e.jsx(f,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"year",children:"Year"}),e.jsx(b,{id:"year",type:"number",value:t.year,onChange:s=>h({...t,year:s.target.value}),placeholder:"2024"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"tier",children:"Tier"}),e.jsxs(w,{value:t.tier,onValueChange:s=>h({...t,tier:s}),children:[e.jsx(_,{id:"tier",children:e.jsx(S,{placeholder:"Select Tier"})}),e.jsxs(C,{children:[e.jsx(f,{value:"Higher",children:"Higher Tier"}),e.jsx(f,{value:"Foundation",children:"Foundation Tier"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Link to Paper (Official Exam Board URL)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{id:"file_url",value:t.file_url,onChange:s=>h({...t,file_url:s.target.value}),placeholder:"https://www.aqa.org.uk/find-past-papers-and-mark-schemes",className:"flex-1"}),e.jsx(x,{type:"button",variant:"secondary",size:"icon",onClick:oe,title:"Auto-fill from link",children:e.jsx(Fe,{className:"h-4 w-4 text-primary"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Paste a link to the official exam board past papers page. Links must point to official exam board websites only (e.g. aqa.org.uk, pearson.com, ocr.org.uk, eduqas.co.uk)."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"score",children:"Score"}),e.jsx(b,{id:"score",type:"number",value:t.score,onChange:s=>h({...t,score:s.target.value}),placeholder:"82"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"max_score",children:"Max Score"}),e.jsx(b,{id:"max_score",type:"number",value:t.max_score,onChange:s=>h({...t,max_score:s.target.value}),placeholder:"100"})]})]})]}),e.jsxs(Re,{children:[e.jsx(x,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsxs(x,{onClick:de,children:[y?"Update":"Create"," Paper"]})]})]})}),e.jsx(q,{open:!!a,onOpenChange:s=>!s&&v(null),children:e.jsxs(V,{className:"max-w-5xl h-[90vh] flex flex-col p-0 overflow-hidden",children:[e.jsxs(W,{className:"p-6 pb-2",children:[e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5 text-primary"}),a==null?void 0:a.title]}),e.jsxs(z,{children:[a==null?void 0:a.subject," • ",a==null?void 0:a.exam_board," • ",a==null?void 0:a.year]})]}),e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row border-t overflow-hidden",children:[e.jsx("div",{className:"flex-1 bg-muted/30 relative min-h-[300px]",children:a!=null&&a.file_url?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(D,{className:"h-12 w-12 text-primary mb-4 opacity-60"}),e.jsx("h4",{className:"font-semibold mb-2 text-lg",children:"View on Official Website"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6 max-w-sm",children:"This paper is hosted on the official exam board website. Click below to open it in a new tab."}),e.jsxs(x,{onClick:()=>window.open(a.file_url,"_blank","noopener,noreferrer"),children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Open Paper in New Tab"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-4 max-w-xs",children:["© ",a.exam_board||"Exam Board",". All rights reserved. Revisely.ai is not affiliated with or endorsed by any exam board."]})]}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-muted-foreground",children:"No link available for this paper."})}),e.jsxs("div",{className:"w-full md:w-80 border-l bg-background p-6 space-y-6 overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx(p,{className:"text-sm font-medium mb-3 block",children:"Review Results"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"review-score",children:"Your Score"}),e.jsx(b,{id:"review-score",type:"number",placeholder:"e.g. 85",defaultValue:(a==null?void 0:a.score)||"",onChange:s=>{a&&v({...a,score:parseInt(s.target.value)||null})}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"review-max",children:"Max Score"}),e.jsx(b,{id:"review-max",type:"number",placeholder:"e.g. 100",defaultValue:(a==null?void 0:a.max_score)||"",onChange:s=>{a&&v({...a,max_score:parseInt(s.target.value)||null})}})]})]})]}),a&&a.score!==null&&a.max_score!==null&&e.jsxs("div",{className:"p-4 rounded-lg bg-primary/5 border border-primary/10",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Percentage"}),e.jsxs("span",{className:"font-bold text-primary",children:[Math.round(a.score/a.max_score*100),"%"]})]}),e.jsx(G,{value:a.score/a.max_score*100,className:"h-2"})]}),e.jsxs("div",{className:"pt-4 border-t space-y-2",children:[e.jsx(x,{className:"w-full",onClick:async()=>{if(!(!a||!r))try{const{error:s}=await N.from("past_papers").update({score:a.score,max_score:a.max_score,completed_at:a.score!==null?new Date().toISOString():null}).eq("id",a.id);if(s)throw s;l({title:"Review Saved",description:"Your scores have been updated."}),v(null),U()}catch(s){l({title:"Error",description:s.message,variant:"destructive"})}},children:"Save Results"}),e.jsx(x,{variant:"outline",className:"w-full",onClick:()=>v(null),children:"Close"})]})]})]})]})})]})}export{ls as default};
