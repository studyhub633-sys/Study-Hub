import{u as nt,m as lt,n as ot,b as ct,p as dt,r as c,j as e,L as U,B as u,a as b,X as Pe}from"./index-7wMNJNZJ.js";import{h as mt,A as ze,a as ut}from"./AppLayout-Cb4f3Rcb.js";import{B as ht}from"./badge-CT5QE6KZ.js";import{C as xt,a as gt,b as pt}from"./collapsible-CjC-8iC3.js";import{D as De,b as Ae,c as Oe,d as Te,e as _e,f as Fe}from"./dialog-CGZvDN6x.js";import{D as ft,a as jt,b as yt,c as Ee}from"./dropdown-menu-BwE0Hcir.js";import{I as C}from"./input-CURGwIC-.js";import{L as v}from"./label-4_8C0ZIE.js";import{S as vt}from"./scroll-area-Dz-2y2_q.js";import{S as D,a as A,b as O,c as T,d as j}from"./select-Do0TjdJZ.js";import{T as Ke}from"./textarea-DYv1Zddw.js";import{b as wt}from"./ai-client-SJ9RPCaW.js";import{E as Le}from"./constants-DeIw5BhA.js";import{F as bt,t as Nt,E as St}from"./jspdf.es.min-DP4S0BN-.js";import{c as _,F as Ct,L as kt}from"./sheet-D4eoD1m7.js";import{P as L}from"./plus-BgtP8iNg.js";import{S as Pt}from"./search-D5Hb3sC3.js";import{S as zt}from"./square-pen-CLPrXBHy.js";import{T as Dt}from"./trash-2-CodGuS8N.js";import{D as At}from"./download-CoW69tSE.js";import{C as Ot}from"./chevron-down-CjDqse4M.js";import{C as H}from"./circle-check-C8Ohiiaq.js";import{L as Tt}from"./lightbulb-LqjOXS8C.js";import{C as Be}from"./circle-check-big-BnnLIOVu.js";import"./AnimatedLogoIcon-DY32PEux.js";import"./sun-CnDoiXzg.js";import"./index-iU3ZkQd9.js";import"./index-8ugP4A3I.js";import"./index-BVEf_URQ.js";import"./index-BdQq_4o_.js";function cs(){const{supabase:N,user:x}=nt(),{t:g}=lt(),{toast:m}=ot(),V=ct(),ee=dt(),[Y,W]=c.useState([]),[Me,te]=c.useState(!0),[Q,se]=c.useState(""),[B,ae]=c.useState("All Subjects"),[M,re]=c.useState("All Boards"),[F,ie]=c.useState("All Tiers"),[i,S]=c.useState(null),[X,k]=c.useState([]),[Re,P]=c.useState(!1),[E,ne]=c.useState(null),[l,p]=c.useState({title:"",subject:"",topic:"",exam_board:"",tier:"",sections:[]}),[le,oe]=c.useState(null),[$e,R]=c.useState(!1),[$,ce]=c.useState(""),[G,de]=c.useState(""),[q,me]=c.useState(""),[z,ue]=c.useState(!1),[h,he]=c.useState(null),[w,Ge]=c.useState(10),[qe,Ue]=c.useState(!1),[xe,ge]=c.useState(!1),[pe,fe]=c.useState(!1),J=c.useRef(null);c.useEffect(()=>{x&&(Z(),je())},[x]);const je=async()=>{if(!(!x||!N))try{const t=new Date(Date.now()-864e5).toISOString(),{count:s,error:a}=await N.from("ai_usage_tracking").select("*",{count:"exact",head:!0}).eq("user_id",x.id).gt("created_at",t);if(a)return;const r=await mt(N),n=r?1e6:10;he(s||0),Ge(n),Ue(r)}catch{}};c.useEffect(()=>{ee.state?.context},[ee.state,i]);const ye=t=>{const s=t.content?.sections||[];if(s.length===0)return 0;const a=s.filter(r=>r.reviewed).length;return Math.round(a/s.length*100)},Z=async()=>{if(x)try{te(!0);const{data:t,error:s}=await N.from("knowledge_organizers").select("*").eq("user_id",x.id).order("updated_at",{ascending:!1});if(s)throw s;if(W(t||[]),t&&t.length>0&&!i){S(t[0]);const a=t[0];a.content?.sections&&a.content.sections.length>0&&k([a.content.sections[0].title])}}catch{m({title:"Error",description:"Failed to load knowledge organizers. Please try again.",variant:"destructive"})}finally{te(!1)}},ve=()=>{ne(null),p({title:"",subject:"",topic:"",exam_board:"",tier:"",sections:[]}),P(!0)},He=async()=>{if(!x||!$.trim()){m({title:"Error",description:"Please enter a prompt to generate a knowledge organizer",variant:"destructive"});return}if(h!==null&&h>=w){m({title:"Limit Reached",description:"You have reached the daily limit of AI generation attempts. Please upgrade to premium for higher limits (500/day).",variant:"destructive"});return}ue(!0);try{const t=await wt({prompt:$,subject:G||void 0,topic:q||void 0},N);if(t.error){if(t.error.includes("limit")||t.error.includes("429"))m({title:"Limit Reached",description:t.error,variant:"destructive"}),je();else throw new Error(t.error);return}t.data?.sections&&(p({title:q||G||"AI Generated Organizer",subject:G||"",topic:q||"",exam_board:"",tier:"",sections:t.data.sections}),R(!1),P(!0),ce(""),de(""),me(""),t.data.usageCount!==void 0&&he(t.data.usageCount),m({title:"Success",description:`Generated ${t.data.sections.length} sections! Review and edit before saving.`}))}catch(t){m({title:"Error",description:t.message||"Failed to generate knowledge organizer. Please try again.",variant:"destructive"})}finally{ue(!1)}},Ve=t=>{ne(t);const a=(t.content?.sections||[]).map(r=>({...r,keyPoints:r.keyPoints?.map(n=>typeof n=="string"?{text:n,mastered:!1}:n)||[]}));p({title:t.title,subject:t.subject||"",topic:t.topic||"",exam_board:t.content?.exam_board||"",tier:t.tier||"",sections:a}),P(!0)},we=()=>{p({...l,sections:[...l.sections,{title:"",content:"",keyPoints:[],color:"primary"}]})},Ye=t=>{p({...l,sections:l.sections.filter((s,a)=>a!==t)})},I=(t,s,a)=>{const r=[...l.sections];r[t]={...r[t],[s]:a},p({...l,sections:r})},We=t=>{const s=[...l.sections],r=(s[t].keyPoints||[]).map(n=>typeof n=="string"?{text:n,mastered:!1}:n);r.push({text:"",mastered:!1}),s[t].keyPoints=r,p({...l,sections:s})},Qe=(t,s)=>{const a=[...l.sections];a[t].keyPoints=a[t].keyPoints.filter((r,n)=>n!==s),p({...l,sections:a})},Xe=(t,s,a)=>{const r=[...l.sections],o=(r[t].keyPoints||[]).map(f=>typeof f=="string"?{text:f,mastered:!1}:f);o[s]={...o[s],text:a},r[t].keyPoints=o,p({...l,sections:r})},Je=(t,s)=>{const a=[...l.sections],n=(a[t].keyPoints||[]).map(o=>typeof o=="string"?{text:o,mastered:!1}:o);n[s]={...n[s],mastered:!n[s].mastered,lastReviewed:n[s].mastered?n[s].lastReviewed:new Date().toISOString()},a[t].keyPoints=n,p({...l,sections:a})},Ze=async()=>{if(!x||!l.title.trim()){m({title:"Error",description:"Title is required",variant:"destructive"});return}if(!l.tier){m({title:"Error",description:"Please select a Tier (Foundation or Higher)",variant:"destructive"});return}const t=l.sections.filter(s=>s.title.trim()&&s.content.trim());try{const s={sections:t,exam_board:l.exam_board},a={user_id:x.id,title:l.title,subject:l.subject||null,topic:l.topic||null,tier:l.tier||null,content:s};if(E){const{error:r}=await N.from("knowledge_organizers").update(a).eq("id",E.id).eq("user_id",x.id);if(r)throw r;m({title:"Success",description:"Knowledge organizer updated successfully"})}else{const{error:r}=await N.from("knowledge_organizers").insert(a);if(r)throw r;m({title:"Success",description:"Knowledge organizer created successfully"})}P(!1),Z()}catch(s){m({title:"Error",description:s.message||"Failed to save knowledge organizer. Please try again.",variant:"destructive"})}},Ie=async t=>{if(!(!i||!x))try{oe(t);const s=[...i.content?.sections||[]];s[t]&&(s[t].reviewed=!0,s[t].lastReviewedAt=new Date().toISOString());const{error:a}=await N.from("knowledge_organizers").update({content:{sections:s}}).eq("id",i.id).eq("user_id",x.id);if(a)throw a;const{error:r}=await N.from("study_sessions").insert({user_id:x.id,organizer_id:i.id,duration:0,sections_reviewed:[t],date:new Date().toISOString()}),n={...i,content:{...i.content,sections:s}};S(n),W(o=>o.map(f=>f.id===i.id?n:f)),m({title:"Section Reviewed",description:`"${s[t].title}" marked as reviewed`})}catch(s){m({title:"Error",description:s.message||"Failed to mark section as reviewed. Please try again.",variant:"destructive"})}finally{oe(null)}},et=async(t,s)=>{if(!(!i||!x))try{const a=[...i.content?.sections||[]],r=a[t];if(!r||!r.keyPoints)return;const n=r.keyPoints.map(d=>typeof d=="string"?{text:d,mastered:!1}:d);n[s]={...n[s],mastered:!n[s].mastered,lastReviewed:n[s].mastered?n[s].lastReviewed:new Date().toISOString()},a[t]={...r,keyPoints:n};const{error:o}=await N.from("knowledge_organizers").update({content:{sections:a}}).eq("id",i.id).eq("user_id",x.id);if(o)throw o;const f={...i,content:{...i.content,sections:a}};S(f),W(d=>d.map(K=>K.id===i.id?f:K))}catch(a){m({title:"Error",description:a.message||"Failed to update key point. Please try again.",variant:"destructive"})}},tt=async t=>{if(x&&confirm("Are you sure you want to delete this knowledge organizer?"))try{const{error:s}=await N.from("knowledge_organizers").delete().eq("id",t).eq("user_id",x.id);if(s)throw s;m({title:"Success",description:"Knowledge organizer deleted successfully"}),i?.id===t&&S(null),Z()}catch{m({title:"Error",description:"Failed to delete knowledge organizer. Please try again.",variant:"destructive"})}},be=async(t="png")=>{if(!i||!J.current){m({title:"Error",description:"No organizer selected or content not ready",variant:"destructive"});return}ge(!0);const s=X;try{const a=i.content?.sections?.map(d=>d.title)||[];a.length>0&&(k(a),await new Promise(d=>setTimeout(d,500)));const n=document.documentElement.classList.contains("dark")?"#020617":"#ffffff",o=await Nt(J.current,{quality:1,pixelRatio:2,backgroundColor:n,filter:d=>!(d instanceof HTMLElement&&d.classList.contains("export-exclude"))}),f=i.title.replace(/\s+/g,"_");if(t==="png"){const d=document.createElement("a");d.download=`${f}.png`,d.href=o,document.body.appendChild(d),d.click(),document.body.removeChild(d)}else{const d=new St({orientation:"portrait"}),K=d.getImageProperties(o),ke=d.internal.pageSize.getWidth(),it=K.height*ke/K.width;d.addImage(o,"PNG",0,0,ke,it),d.save(`${f}.pdf`)}m({title:"Downloaded!",description:`Knowledge organizer saved as ${t.toUpperCase()}`})}catch{m({title:"Download failed",description:"Failed to download knowledge organizer. Please try again.",variant:"destructive"})}finally{k(s),ge(!1)}},st=async()=>{if(!(!i||!x))try{const t=i.content?.sections?.map(s=>`${s.title}: ${s.content}
Key Points: ${s.keyPoints?.map(a=>typeof a=="string"?a:a.text).join(", ")||""}`).join(`

`)||"";if(!t.trim()){m({title:"No content",description:"This organizer doesn't have any content to create flashcards from.",variant:"destructive"});return}V("/flashcards",{state:{organizerContent:t,subject:i.subject||"General",topic:i.topic}})}catch{m({title:"Error",description:"Failed to proceed to flashcards.",variant:"destructive"})}},y=Y.filter(t=>{const s=(t.title||"").toLowerCase().includes(Q.toLowerCase()),a=B==="All Subjects"||t.subject===B,r=t.content?.exam_board,n=M==="All Boards"||r===M,o=F==="All Tiers"||F==="Unassigned"&&!t.tier||t.tier?.toLowerCase()===F.toLowerCase();return s&&a&&n&&o});c.useEffect(()=>{i&&y.length>0?y.some(s=>s.id===i.id)||(S(y[0]),y[0].content?.sections?.length>0&&k([y[0].content.sections[0].title])):i&&y.length===0?S(null):!i&&y.length>0&&(S(y[0]),y[0].content?.sections?.length>0&&k([y[0].content.sections[0].title]))},[Q,B,M,F,y.length]);const at=t=>{k(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},Ne=t=>{const s=new Date(t),r=Math.floor((new Date().getTime()-s.getTime())/1e3);return r<60?"Just now":r<3600?`${Math.floor(r/60)} minutes ago`:r<86400?`${Math.floor(r/3600)} hours ago`:r<604800?`${Math.floor(r/86400)} days ago`:s.toLocaleDateString()},rt=Array.from(new Set(Y.map(t=>t.subject).filter(Boolean))),Se=i?.content?.sections||[],Ce=i?ye(i):0;return Me?e.jsx(ze,{children:e.jsx("div",{className:"max-w-6xl mx-auto flex items-center justify-center h-[60vh]",children:e.jsx(U,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsxs(ze,{children:[e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground",children:g("knowledge.title")}),e.jsx("p",{className:"text-muted-foreground mt-1",children:g("knowledge.subtitle")})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-2 w-full md:w-auto",children:[e.jsxs(u,{variant:"outline",onClick:()=>R(!0),className:"whitespace-nowrap",children:[e.jsx(_,{className:"h-4 w-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"whitespace-nowrap",children:g("knowledge.generateAI")}),h!==null&&e.jsx("span",{className:"ml-2 text-xs opacity-70 whitespace-nowrap",children:qe?"(∞)":`(${w-h})`})]}),e.jsxs(u,{onClick:ve,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),g("knowledge.createOrganizer")]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 animate-slide-up",style:{animationDelay:"0.1s"},children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Pt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(C,{placeholder:g("knowledge.searchPlaceholder"),value:Q,onChange:t=>se(t.target.value),className:"pl-9"})]}),e.jsxs(D,{value:B,onValueChange:ae,children:[e.jsx(A,{className:"w-full sm:w-[180px]",children:e.jsx(O,{})}),e.jsxs(T,{children:[e.jsx(j,{value:"All Subjects",children:g("knowledge.allSubjects")}),rt.map(t=>e.jsx(j,{value:t,children:t},t))]})]}),e.jsxs(D,{value:M,onValueChange:re,children:[e.jsx(A,{className:"w-full sm:w-[150px]",children:e.jsx(O,{})}),e.jsxs(T,{children:[e.jsx(j,{value:"All Boards",children:g("knowledge.allBoards")}),Le.map(t=>e.jsx(j,{value:t,children:t},t))]})]}),e.jsxs(D,{value:F,onValueChange:ie,children:[e.jsx(A,{className:"w-full sm:w-[150px]",children:e.jsx(O,{})}),e.jsxs(T,{children:[e.jsx(j,{value:"All Tiers",children:g("common.allTiers")}),e.jsx(j,{value:"Higher",children:g("flashcards.higher")}),e.jsx(j,{value:"Foundation",children:g("flashcards.foundation")}),e.jsx(j,{value:"Unassigned",children:g("pastPapers.unassigned")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:b("lg:col-span-1 animate-slide-up",pe?"hidden lg:block":"block"),style:{animationDelay:"0.2s",opacity:0},children:e.jsx(vt,{className:"h-[calc(100vh-280px)] lg:h-[calc(100vh-220px)] rounded-lg",children:e.jsx("div",{className:"space-y-3 pr-3",children:Y.length===0?e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(_,{className:"h-12 w-12 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:g("knowledge.noOrganizers")}),e.jsxs("p",{className:"text-muted-foreground mb-4",children:["Create your first knowledge organiser, generate one with AI, or add from the"," ",e.jsx("button",{type:"button",onClick:()=>V("/library"),className:"text-primary hover:underline font-medium",children:"Global Library"})," ","(Organisers tab)."]}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsxs(u,{onClick:ve,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),g("knowledge.createOrganizer")]}),e.jsx(u,{variant:"outline",onClick:()=>V("/library"),children:g("library.title")})]})]}):y.length===0?e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(_,{className:"h-12 w-12 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No organizers found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Try adjusting your filters or create a new organizer"}),e.jsx(u,{variant:"outline",onClick:()=>{ae("All Subjects"),re("All Boards"),ie("All Tiers"),se("")},children:"Clear Filters"})]}):y.map(t=>{const s=ye(t);return e.jsx("button",{onClick:()=>{S(t),fe(!0),t.content?.sections&&t.content.sections.length>0&&k([t.content.sections[0].title])},className:b("w-full text-left p-4 rounded-xl transition-all duration-200",i?.id===t.id?"glass-card border-primary/30 shadow-glow":"bg-muted/50 hover:bg-muted"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 flex-shrink-0",children:e.jsx(_,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-foreground truncate",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.subject||"General"," • ",t.topic||"General",t.tier&&e.jsx(ht,{variant:"secondary",className:b("text-[10px] h-4 px-1 ml-1",t.tier==="Higher"?"text-red-500 bg-red-500/10":"text-green-500 bg-green-500/10"),children:t.tier})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full transition-all duration-500",style:{width:`${s}%`}})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s,"%"]})]})]})]})},t.id)})})})}),e.jsx("div",{className:b("lg:col-span-2",pe?"block":"hidden lg:block"),children:e.jsx("div",{className:"lg:sticky lg:top-24 animate-slide-up",style:{animationDelay:"0.3s",opacity:0},children:i?e.jsxs("div",{ref:J,className:"glass-card p-6 md:p-8 bg-white dark:bg-slate-950",children:[e.jsxs(u,{variant:"ghost",size:"sm",className:"lg:hidden mb-4 -ml-2 export-exclude",onClick:()=>fe(!1),children:[e.jsx(ut,{className:"h-4 w-4 mr-1"}),"Back to List"]}),e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.subject&&e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-primary/10 text-primary",children:i.subject}),i.topic&&e.jsx("span",{className:"text-xs text-muted-foreground",children:i.topic})]}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-foreground",children:i.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("div",{className:"flex-1 max-w-[200px]",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[Ce,"%"]})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full transition-all duration-500",style:{width:`${Ce}%`}})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Last updated ",Ne(i.updated_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 export-exclude",children:[e.jsx(u,{variant:"outline",size:"icon",onClick:()=>Ve(i),children:e.jsx(zt,{className:"h-4 w-4"})}),e.jsx(u,{variant:"outline",size:"icon",onClick:()=>tt(i.id),children:e.jsx(Dt,{className:"h-4 w-4 text-destructive"})}),e.jsxs(ft,{children:[e.jsx(jt,{asChild:!0,children:e.jsx(u,{variant:"outline",size:"icon",disabled:xe,children:xe?e.jsx(U,{className:"h-4 w-4 animate-spin"}):e.jsx(At,{className:"h-4 w-4"})})}),e.jsxs(yt,{align:"end",children:[e.jsxs(Ee,{onClick:()=>be("png"),children:[e.jsx(bt,{className:"h-4 w-4 mr-2"}),"Download as PNG"]}),e.jsxs(Ee,{onClick:()=>be("pdf"),children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Download as PDF"]})]})]})]})]}),Se.length>0?e.jsx("div",{className:"space-y-4",children:Se.map((t,s)=>e.jsxs(xt,{open:X.includes(t.title),onOpenChange:()=>at(t.title),children:[e.jsx(gt,{className:"w-full",children:e.jsxs("div",{className:b("flex items-center justify-between p-4 rounded-xl transition-all duration-200",t.color==="primary"&&"bg-primary/10 hover:bg-primary/15",t.color==="secondary"&&"bg-secondary/10 hover:bg-secondary/15",t.color==="accent"&&"bg-accent/20 hover:bg-accent/25"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:b("w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold",t.color==="primary"&&"bg-primary text-primary-foreground",t.color==="secondary"&&"bg-secondary text-secondary-foreground",t.color==="accent"&&"bg-accent text-accent-foreground"),children:s+1}),e.jsx("span",{className:"font-semibold text-foreground",children:t.title})]}),e.jsx(Ot,{className:b("h-5 w-5 text-muted-foreground transition-transform duration-200",X.includes(t.title)&&"rotate-180")})]})}),e.jsx(pt,{children:e.jsxs("div",{className:"p-4 pt-2 ml-11 space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsx("p",{className:"text-foreground whitespace-pre-wrap flex-1",children:t.content}),!t.reviewed&&e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>Ie(s),disabled:le===s,className:"flex-shrink-0",children:[le===s?e.jsx(U,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(H,{className:"h-4 w-4 mr-2"}),"Mark as Reviewed"]}),t.reviewed&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground flex-shrink-0",children:[e.jsx(H,{className:"h-4 w-4 text-primary"}),e.jsx("span",{children:"Reviewed"}),t.lastReviewedAt&&e.jsx("span",{className:"text-xs",children:Ne(t.lastReviewedAt)})]})]}),t.keyPoints&&t.keyPoints.length>0&&e.jsxs("div",{className:b("p-4 rounded-lg",t.color==="primary"&&"bg-primary/5 border border-primary/20",t.color==="secondary"&&"bg-secondary/5 border border-secondary/20",t.color==="accent"&&"bg-accent/10 border border-accent/20"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Tt,{className:b("h-4 w-4",t.color==="primary"&&"text-primary",t.color==="secondary"&&"text-secondary",t.color==="accent"&&"text-accent-foreground")}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:"Key Points"})]}),e.jsx("ul",{className:"space-y-2",children:t.keyPoints.map((a,r)=>{const n=typeof a=="string"?a:a.text,o=typeof a=="object"?a.mastered:!1;return e.jsxs("li",{className:"flex items-start gap-2 text-sm text-foreground group",children:[e.jsx("button",{onClick:()=>et(s,r),className:b("h-4 w-4 mt-0.5 flex-shrink-0 transition-colors cursor-pointer",o?t.color==="primary"&&"text-primary"||t.color==="secondary"&&"text-secondary"||t.color==="accent"&&"text-accent-foreground"||"text-primary":"text-muted-foreground hover:text-foreground"),title:o?"Mark as not mastered":"Mark as mastered",children:o?e.jsx(H,{className:"h-4 w-4"}):e.jsx(Be,{className:"h-4 w-4"})}),e.jsx("span",{className:b("flex-1",o&&"line-through opacity-60"),children:n})]},r)})})]})]})})]},t.title))}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{children:g("knowledge.noSections")})}),e.jsx("div",{className:"flex flex-col md:flex-row gap-3 mt-6 pt-6 border-t border-border",children:e.jsxs(u,{variant:"outline",className:"w-full md:flex-1",onClick:st,children:[e.jsx(kt,{className:"h-4 w-4 mr-2"}),"Create Flashcards"]})})]}):e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(_,{className:"h-16 w-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Select an organizer"}),e.jsx("p",{className:"text-muted-foreground",children:"Choose a knowledge organizer to view its contents"})]})})})]})]}),e.jsx(De,{open:Re,onOpenChange:P,children:e.jsxs(Ae,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Oe,{children:[e.jsx(Te,{children:E?"Edit Knowledge Organizer":"Create New Knowledge Organizer"}),e.jsx(_e,{children:E?"Update your knowledge organizer below":"Create a visual summary of your study material"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"title",children:"Title *"}),e.jsx(C,{id:"title",value:l.title,onChange:t=>p({...l,title:t.target.value}),placeholder:"e.g., Cell Biology Overview"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"subject",children:"Subject"}),e.jsx(C,{id:"subject",value:l.subject,onChange:t=>p({...l,subject:t.target.value}),placeholder:"e.g., Biology"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"topic",children:"Topic"}),e.jsx(C,{id:"topic",value:l.topic,onChange:t=>p({...l,topic:t.target.value}),placeholder:"e.g., Cell Biology"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"exam_board",children:"Exam Board"}),e.jsxs(D,{value:l.exam_board,onValueChange:t=>p({...l,exam_board:t}),children:[e.jsx(A,{id:"exam_board",children:e.jsx(O,{placeholder:"Select board"})}),e.jsx(T,{children:Le.map(t=>e.jsx(j,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"tier",children:"Tier"}),e.jsxs(D,{value:l.tier,onValueChange:t=>p({...l,tier:t}),children:[e.jsx(A,{id:"tier",children:e.jsx(O,{placeholder:"Select Tier"})}),e.jsxs(T,{children:[e.jsx(j,{value:"Higher",children:"Higher Tier"}),e.jsx(j,{value:"Foundation",children:"Foundation Tier"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(v,{children:"Sections"}),e.jsxs(u,{type:"button",variant:"outline",size:"sm",onClick:we,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Add Section"]})]}),l.sections.map((t,s)=>e.jsxs("div",{className:"p-4 border rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-semibold",children:["Section ",s+1]}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",onClick:()=>Ye(s),children:e.jsx(Pe,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Section Title *"}),e.jsx(C,{value:t.title,onChange:a=>I(s,"title",a.target.value),placeholder:"e.g., Cell Structure"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Content *"}),e.jsx(Ke,{value:t.content,onChange:a=>I(s,"content",a.target.value),placeholder:"Describe this section...",className:"min-h-[100px]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Color"}),e.jsxs(D,{value:t.color,onValueChange:a=>I(s,"color",a),children:[e.jsx(A,{children:e.jsx(O,{})}),e.jsxs(T,{children:[e.jsx(j,{value:"primary",children:"Primary (Blue)"}),e.jsx(j,{value:"secondary",children:"Secondary (Purple)"}),e.jsx(j,{value:"accent",children:"Accent (Orange)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(v,{children:"Key Points"}),e.jsxs(u,{type:"button",variant:"outline",size:"sm",onClick:()=>We(s),children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Add Point"]})]}),t.keyPoints.map((a,r)=>{const n=typeof a=="string"?a:a.text,o=typeof a=="object"?a.mastered:!1;return e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(C,{value:n,onChange:f=>Xe(s,r,f.target.value),placeholder:"Enter key point...",className:b(o&&"line-through opacity-60")}),e.jsx(u,{type:"button",variant:o?"default":"outline",size:"icon",onClick:()=>Je(s,r),title:o?"Mark as not mastered":"Mark as mastered",children:o?e.jsx(H,{className:"h-4 w-4"}):e.jsx(Be,{className:"h-4 w-4"})}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",onClick:()=>Qe(s,r),children:e.jsx(Pe,{className:"h-4 w-4"})})]},r)})]})]},s)),l.sections.length===0&&e.jsxs("div",{className:"text-center py-8 border border-dashed rounded-lg",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"No sections yet"}),e.jsxs(u,{type:"button",variant:"outline",onClick:we,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Add Your First Section"]})]})]})]}),e.jsxs(Fe,{children:[e.jsx(u,{variant:"outline",onClick:()=>P(!1),children:"Cancel"}),e.jsxs(u,{onClick:Ze,children:[E?"Update":"Create"," Organizer"]})]})]})}),e.jsx(De,{open:$e,onOpenChange:R,children:e.jsxs(Ae,{className:"max-w-2xl",children:[e.jsxs(Oe,{children:[e.jsx(Te,{children:"Generate Knowledge Organizer with AI"}),e.jsxs(_e,{children:["Describe what you want to learn, and AI will create a structured knowledge organizer with sections and key points.",h!==null&&e.jsx("span",{className:"block mt-2 text-sm font-medium",children:h!==null&&h>=w?e.jsx("span",{className:"text-destructive",children:"You've reached the daily limit."}):e.jsx("span",{children:w>1e3?"You have Unlimited generation attempts.":`You have ${h!==null?w-h:"..."} generation attempts remaining today.`})})]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"ai-prompt",children:"What would you like to learn? *"}),e.jsx(Ke,{id:"ai-prompt",value:$,onChange:t=>ce(t.target.value),placeholder:"e.g., Cell biology including organelles, their functions, and how they work together",className:"min-h-[100px]",disabled:z||h!==null&&h>=w})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"ai-subject",children:"Subject (optional)"}),e.jsx(C,{id:"ai-subject",value:G,onChange:t=>de(t.target.value),placeholder:"e.g., Biology",disabled:z||h!==null&&h>=w})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"ai-topic",children:"Topic (optional)"}),e.jsx(C,{id:"ai-topic",value:q,onChange:t=>me(t.target.value),placeholder:"e.g., Cell Biology",disabled:z||h!==null&&h>=w})]})]}),h!==null&&h>=w&&e.jsx("div",{className:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-destructive font-medium",children:["You've reached the daily limit of ",w," AI generation attempts. ",w<=10?"Please upgrade to premium for higher limits.":"Please try again tomorrow."]})})]}),e.jsxs(Fe,{children:[e.jsx(u,{variant:"outline",onClick:()=>R(!1),disabled:z,children:"Cancel"}),e.jsx(u,{onClick:He,disabled:z||!$.trim()||h!==null&&h>=w,children:z?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Generate"]})})]})]})})]})}export{cs as default};
