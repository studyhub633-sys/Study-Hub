import{c as ye,r as o,v as Ne,j as e,P as A,w as we,x as F,y as Ce,z as Se,a as D,u as _e,m as Te,n as Le,B as C,E as ke}from"./index-7wMNJNZJ.js";import{A as Ae,L as Pe}from"./AppLayout-Cb4f3Rcb.js";import{B as w}from"./badge-CT5QE6KZ.js";import{C as R,a as z,b as I,d as E,c as Fe}from"./card-BDQx_yt9.js";import{C as Re,a as ze,b as Ie}from"./collapsible-CjC-8iC3.js";import{D as Ee,b as De,c as Me,d as Ve,e as Ge}from"./dialog-CGZvDN6x.js";import{I as $e}from"./input-CURGwIC-.js";import{S as qe}from"./scroll-area-Dz-2y2_q.js";import{S as K,a as H,b as J,c as Q,d as _}from"./select-Do0TjdJZ.js";import{R as Oe,I as Be,c as U}from"./index-BVEf_URQ.js";import{u as Ye}from"./index-8ugP4A3I.js";import{S as Ke}from"./search-D5Hb3sC3.js";import{C as He}from"./calendar-D5Qbqv8w.js";import{F as Je}from"./filter-BGs_qK1N.js";import{F as Qe,c as W,L as We}from"./sheet-D4eoD1m7.js";import{T as Ue}from"./triangle-alert-llFSr_Vx.js";import{P as T}from"./plus-BgtP8iNg.js";import{C as Xe}from"./chevron-down-CjDqse4M.js";import"./AnimatedLogoIcon-DY32PEux.js";import"./sun-CnDoiXzg.js";import"./index-iU3ZkQd9.js";import"./index-BdQq_4o_.js";const Ze=ye("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var P="Tabs",[es]=Se(P,[U]),X=U(),[ss,M]=es(P),Z=o.forwardRef((t,i)=>{const{__scopeTabs:r,value:n,onValueChange:u,defaultValue:x,orientation:d="horizontal",dir:p,activationMode:y="automatic",...c}=t,h=Ye(p),[m,b]=Ne({prop:n,onChange:u,defaultProp:x??"",caller:P});return e.jsx(ss,{scope:r,baseId:we(),value:m,onValueChange:b,orientation:d,dir:h,activationMode:y,children:e.jsx(A.div,{dir:h,"data-orientation":d,...c,ref:i})})});Z.displayName=P;var ee="TabsList",se=o.forwardRef((t,i)=>{const{__scopeTabs:r,loop:n=!0,...u}=t,x=M(ee,r),d=X(r);return e.jsx(Oe,{asChild:!0,...d,orientation:x.orientation,dir:x.dir,loop:n,children:e.jsx(A.div,{role:"tablist","aria-orientation":x.orientation,...u,ref:i})})});se.displayName=ee;var ae="TabsTrigger",te=o.forwardRef((t,i)=>{const{__scopeTabs:r,value:n,disabled:u=!1,...x}=t,d=M(ae,r),p=X(r),y=le(d.baseId,n),c=oe(d.baseId,n),h=n===d.value;return e.jsx(Be,{asChild:!0,...p,focusable:!u,active:h,children:e.jsx(A.button,{type:"button",role:"tab","aria-selected":h,"aria-controls":c,"data-state":h?"active":"inactive","data-disabled":u?"":void 0,disabled:u,id:y,...x,ref:i,onMouseDown:F(t.onMouseDown,m=>{!u&&m.button===0&&m.ctrlKey===!1?d.onValueChange(n):m.preventDefault()}),onKeyDown:F(t.onKeyDown,m=>{[" ","Enter"].includes(m.key)&&d.onValueChange(n)}),onFocus:F(t.onFocus,()=>{const m=d.activationMode!=="manual";!h&&!u&&m&&d.onValueChange(n)})})})});te.displayName=ae;var re="TabsContent",ie=o.forwardRef((t,i)=>{const{__scopeTabs:r,value:n,forceMount:u,children:x,...d}=t,p=M(re,r),y=le(p.baseId,n),c=oe(p.baseId,n),h=n===p.value,m=o.useRef(h);return o.useEffect(()=>{const b=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(b)},[]),e.jsx(Ce,{present:u||h,children:({present:b})=>e.jsx(A.div,{"data-state":h?"active":"inactive","data-orientation":p.orientation,role:"tabpanel","aria-labelledby":y,hidden:!b,id:c,tabIndex:0,...d,ref:i,style:{...t.style,animationDuration:m.current?"0s":void 0},children:b&&x})})});ie.displayName=re;function le(t,i){return`${t}-trigger-${i}`}function oe(t,i){return`${t}-content-${i}`}var as=Z,ne=se,ce=te,de=ie;const ts=as,me=o.forwardRef(({className:t,...i},r)=>e.jsx(ne,{ref:r,className:D("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...i}));me.displayName=ne.displayName;const L=o.forwardRef(({className:t,...i},r)=>e.jsx(ce,{ref:r,className:D("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",t),...i}));L.displayName=ce.displayName;const k=o.forwardRef(({className:t,...i},r)=>e.jsx(de,{ref:r,className:D("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...i}));k.displayName=de.displayName;function _s(){const{supabase:t,user:i}=_e(),{t:r}=Te(),[n,u]=o.useState([]),[x,d]=o.useState([]),[p,y]=o.useState([]),[c,h]=o.useState(""),[m,b]=o.useState("all"),[N,ue]=o.useState("all"),[V,xe]=o.useState("papers"),[g,S]=o.useState(null),[G,$]=o.useState([]),{toast:f}=Le(),he=o.useMemo(()=>[...new Set(n.map(a=>a.year))].filter(Boolean).sort((a,l)=>l-a),[n]),pe=o.useMemo(()=>{const s=n.map(v=>v.subject),a=x.map(v=>v.subject),l=p.map(v=>v.subject);return[...new Set([...s,...a,...l])].filter(Boolean).sort()},[n,x,p]);o.useEffect(()=>{t&&(fe(),be(),ge())},[t]);const fe=async()=>{const{data:s,error:a}=await t.from("global_past_papers").select("*").order("created_at",{ascending:!1});a||u(s||[])},be=async()=>{const{data:s,error:a}=await t.from("global_knowledge_organizers").select("*").order("created_at",{ascending:!1});a||d(s||[])},ge=async()=>{const{data:s,error:a}=await t.from("global_flashcards").select("*").order("created_at",{ascending:!1});a||y(s||[])},je=async s=>{if(!i){f({title:"Login Required",description:"You must be logged in to add papers.",variant:"destructive"});return}try{const{data:a}=await t.from("past_papers").select("id").eq("user_id",i.id).eq("file_url",s.file_url).maybeSingle();if(a){f({title:"Already Added",description:"This paper is already in your collection."});return}const{error:l}=await t.from("past_papers").insert({user_id:i.id,title:s.title,subject:s.subject,year:s.year,exam_board:s.exam_board,file_url:s.file_url,file_type:s.file_type});if(l)throw l;f({title:"Added to Library",description:`${s.title} has been added to your papers.`})}catch(a){f({title:"Error",description:a.message,variant:"destructive"})}},q=async s=>{if(!i){f({title:"Login Required",description:"You must be logged in to add organizers.",variant:"destructive"});return}try{const{data:a}=await t.from("knowledge_organizers").select("id").eq("user_id",i.id).eq("title",s.title).maybeSingle();if(a){f({title:"Already Added",description:"This organizer is already in your collection."});return}const l=s.content?.exam_board||null,j=null,{error:v}=await t.from("knowledge_organizers").insert({user_id:i.id,title:s.title,subject:s.subject,topic:s.topic,content:s.content,tier:j});if(v)throw v;f({title:"Added to Library",description:`${s.title} has been added to your organizers.`})}catch(a){f({title:"Error",description:a.message||"Failed to add organizer",variant:"destructive"})}},ve=async s=>{if(!i){f({title:"Login Required",description:"You must be logged in to add flashcards.",variant:"destructive"});return}try{const{data:a}=await t.from("flashcards").select("id").eq("user_id",i.id).eq("front",s.front).maybeSingle();if(a){f({title:"Already Added",description:"This flashcard is already in your collection."});return}const{error:l}=await t.from("flashcards").insert({user_id:i.id,front:s.front,back:s.back,subject:s.subject,topic:s.topic,difficulty:1,review_count:0});if(l)throw l;f({title:"Added to Flashcards",description:"Flashcard added successfully."})}catch(a){f({title:"Error",description:a.message,variant:"destructive"})}},O=n.filter(s=>{const a=(s.title||"").toLowerCase().includes(c.toLowerCase())||s.subject?.toLowerCase().includes(c.toLowerCase())||s.exam_board?.toLowerCase().includes(c.toLowerCase()),l=m==="all"||s.year?.toString()===m,j=N==="all"||s.subject===N;return a&&l&&j}),B=x.filter(s=>{const a=(s.title||"").toLowerCase().includes(c.toLowerCase())||s.subject?.toLowerCase().includes(c.toLowerCase())||s.topic?.toLowerCase().includes(c.toLowerCase()),l=N==="all"||s.subject===N;return a&&l}),Y=p.filter(s=>{const a=(s.front||"").toLowerCase().includes(c.toLowerCase())||(s.back||"").toLowerCase().includes(c.toLowerCase())||s.topic?.toLowerCase().includes(c.toLowerCase())||s.subject?.toLowerCase().includes(c.toLowerCase()),l=N==="all"||s.subject===N;return a&&l});return e.jsxs(Ae,{children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8 animate-fade-in pb-20",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Pe,{className:"h-8 w-8 text-primary"}),e.jsx("h1",{className:"text-4xl font-extrabold tracking-tight",children:r("library.title")})]}),e.jsx("p",{className:"text-muted-foreground text-lg",children:r("library.subtitle")})]}),e.jsx("div",{className:"flex flex-col items-end gap-2",children:e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-500/10 border border-emerald-500/20 text-emerald-600",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-bold uppercase tracking-wider",children:r("library.trustedSources")})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-muted-foreground group-focus-within:text-primary transition-colors",children:e.jsx(Ke,{className:"h-5 w-5"})}),e.jsx($e,{placeholder:r("library.searchPlaceholder"),value:c,onChange:s=>h(s.target.value),className:"pl-10 h-12 bg-background border-primary/10 rounded-xl shadow-sm"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[V==="papers"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(K,{value:m,onValueChange:b,children:[e.jsx(H,{className:"w-[130px] h-10",children:e.jsx(J,{placeholder:"Year"})}),e.jsxs(Q,{children:[e.jsx(_,{value:"all",children:r("common.allYears")}),he.map(s=>e.jsx(_,{value:s.toString(),children:s},s))]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(K,{value:N,onValueChange:ue,children:[e.jsx(H,{className:"w-[160px] h-10",children:e.jsx(J,{placeholder:"Subject"})}),e.jsxs(Q,{children:[e.jsx(_,{value:"all",children:r("common.allSubjects")}),pe.map(s=>e.jsx(_,{value:s,children:s},s))]})]})]})]})]}),e.jsxs(ts,{value:V,onValueChange:xe,className:"w-full",children:[e.jsxs(me,{className:"grid w-full grid-cols-3 mb-8 h-12 p-1 bg-muted/50 backdrop-blur-sm rounded-xl",children:[e.jsxs(L,{value:"papers",className:"rounded-lg font-bold text-base flex gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"})," ",r("library.pastPapers")]}),e.jsxs(L,{value:"organizers",className:"rounded-lg font-bold text-base flex gap-2",children:[e.jsx(W,{className:"h-4 w-4"})," ",r("library.organisers")]}),e.jsxs(L,{value:"flashcards",className:"rounded-lg font-bold text-base flex gap-2",children:[e.jsx(We,{className:"h-4 w-4"})," ",r("library.flashcards")]})]}),e.jsxs(k,{value:"papers",className:"space-y-8",children:[e.jsxs("div",{className:"rounded-lg border border-amber-500/20 bg-amber-500/5 p-4 flex items-start gap-3",children:[e.jsx(Ue,{className:"h-5 w-5 text-amber-500 mt-0.5 shrink-0"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx("p",{className:"font-medium text-foreground mb-1",children:"Copyright Notice"}),e.jsx("p",{children:"All past examination papers are the copyright of their respective exam boards (AQA, Pearson Edexcel, OCR, Eduqas/WJEC). Revisely.ai does not host, store, or reproduce any exam board content. Links open directly on the official exam board websites. Revisely.ai is not affiliated with, endorsed by, or connected to any exam board."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[O.map(s=>e.jsxs(R,{className:"hover:shadow-lg transition-all border-primary/5 group cursor-pointer",onClick:()=>window.open(s.file_url,"_blank"),children:[e.jsxs(z,{className:"p-4 pb-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(w,{variant:"outline",className:"bg-primary/5 text-primary border-primary/10",children:s.exam_board}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(C,{size:"icon",variant:"ghost",onClick:a=>{a.stopPropagation(),window.open(s.file_url,"_blank")},className:"h-8 w-8 text-muted-foreground hover:text-primary hover:bg-primary/10",children:e.jsx(ke,{className:"h-4 w-4"})}),e.jsx(C,{size:"icon",variant:"ghost",onClick:a=>{a.stopPropagation(),je(s)},className:"h-8 w-8 text-primary hover:bg-primary/10",children:e.jsx(T,{className:"h-5 w-5"})})]})]}),e.jsx(I,{className:"text-base mt-2 line-clamp-2 group-hover:text-primary transition-colors",children:s.title})]}),e.jsxs(E,{className:"p-4 pt-0 flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:[s.subject," • ",s.year]}),e.jsx("div",{className:"text-[10px] font-bold text-emerald-500 bg-emerald-500/10 px-2 py-0.5 rounded-full uppercase",children:"Verified"})]})]},s.id)),O.length===0&&e.jsx("div",{className:"col-span-full py-20 text-center text-muted-foreground",children:r("library.noPapersFound")})]})]}),e.jsx(k,{value:"organizers",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[B.map(s=>e.jsxs(R,{className:"hover:shadow-xl transition-all border-primary/5 group relative overflow-hidden cursor-pointer",onClick:()=>{S(s),$(s.content?.sections?.slice(0,1).map(a=>a.title)||[])},children:[e.jsx("div",{className:"absolute top-0 right-0 p-3",children:e.jsx(C,{size:"icon",variant:"secondary",onClick:a=>{a.stopPropagation(),q(s)},className:"h-10 w-10 shadow-lg",children:e.jsx(T,{className:"h-6 w-6"})})}),e.jsxs(z,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{className:"bg-primary/10 text-primary border-none",children:s.content?.exam_board||"General"}),e.jsx(w,{variant:"outline",className:"text-muted-foreground",children:s.subject})]}),e.jsx(I,{className:"text-xl group-hover:text-primary transition-colors",children:s.title}),e.jsx(Fe,{className:"line-clamp-2 mt-2",children:s.topic})]}),e.jsx(E,{children:e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-2",children:[e.jsx(W,{className:"h-3 w-3"}),r("knowledge.sections",{count:s.content?.sections?.length||0}),e.jsx("span",{className:"ml-auto text-primary text-xs font-medium",children:"Click to view →"})]})})]},s.id)),B.length===0&&e.jsx("div",{className:"col-span-full py-20 text-center text-muted-foreground",children:r("common.noResults")})]})}),e.jsx(k,{value:"flashcards",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[Y.map(s=>e.jsxs(R,{className:"hover:shadow-xl transition-all border-primary/5 group relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-3",children:e.jsx(C,{size:"icon",variant:"secondary",onClick:()=>ve(s),className:"h-10 w-10 shadow-lg",children:e.jsx(T,{className:"h-6 w-6"})})}),e.jsxs(z,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{variant:"outline",className:"text-muted-foreground",children:s.subject}),e.jsx(w,{className:"bg-primary/10 text-primary border-none",children:s.topic})]}),e.jsx(I,{className:"text-lg group-hover:text-primary transition-colors line-clamp-2",children:s.front})]}),e.jsx(E,{children:e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3",children:s.back})})]},s.id)),Y.length===0&&e.jsx("div",{className:"col-span-full py-20 text-center text-muted-foreground",children:r("common.noResults")})]})})]})]}),e.jsx(Ee,{open:!!g,onOpenChange:s=>!s&&S(null),children:e.jsxs(De,{className:"max-w-3xl max-h-[85vh] overflow-hidden flex flex-col",children:[e.jsxs(Me,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{className:"bg-primary/10 text-primary border-none",children:g?.content?.exam_board||"General"}),e.jsx(w,{variant:"outline",className:"text-muted-foreground",children:g?.subject})]}),e.jsx(Ve,{className:"text-2xl",children:g?.title}),e.jsx(Ge,{children:g?.topic})]}),e.jsx(qe,{className:"flex-1 pr-4",children:e.jsx("div",{className:"space-y-4 pb-4",children:g?.content?.sections?.map((s,a)=>e.jsxs(Re,{open:G.includes(s.title),onOpenChange:()=>{$(l=>l.includes(s.title)?l.filter(j=>j!==s.title):[...l,s.title])},children:[e.jsx(ze,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg hover:bg-muted transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-3 w-3 rounded-full bg-${s.color||"primary"}`}),e.jsx("span",{className:"font-semibold text-left",children:s.title})]}),e.jsx(Xe,{className:`h-5 w-5 transition-transform ${G.includes(s.title)?"rotate-180":""}`})]})}),e.jsx(Ie,{children:e.jsxs("div",{className:"p-4 border border-t-0 rounded-b-lg space-y-4",children:[e.jsx("p",{className:"text-muted-foreground",children:s.content}),s.keyPoints&&s.keyPoints.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Key Points:"}),e.jsx("ul",{className:"space-y-1",children:s.keyPoints.map((l,j)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"text-primary mt-1",children:"•"}),e.jsx("span",{children:typeof l=="string"?l:l.text})]},j))})]})]})})]},a))})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(C,{variant:"outline",onClick:()=>S(null),children:"Close"}),e.jsxs(C,{onClick:()=>{g&&(q(g),S(null))},children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Add to My Library"]})]})]})})]})}export{_s as default};
