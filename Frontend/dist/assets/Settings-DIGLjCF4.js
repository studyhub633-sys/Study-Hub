import{c as z,r as o,N as L,v as K,j as e,P as M,x as X,ag as Z,aj as J,z as Q,a as U,u as ee,D as se,n as te,m as ae,S as I,L as A,B as w}from"./index-7wMNJNZJ.js";import{U as ie,A as re,b as ne,c as le,d as oe,C as B}from"./AppLayout-Cb4f3Rcb.js";import{I as P}from"./input-CURGwIC-.js";import{L as _}from"./label-4_8C0ZIE.js";import{S as ce,a as de,b as me,c as ue,d as T}from"./select-Do0TjdJZ.js";import{B as pe}from"./bell-B0GSKUW5.js";import{C as fe}from"./camera-Lim5GATx.js";import{M as he}from"./mail-CiVjm5FM.js";import{G as ge}from"./graduation-cap-DuPBMw0y.js";import{T as xe}from"./trash-2-CodGuS8N.js";import"./AnimatedLogoIcon-DY32PEux.js";import"./sheet-D4eoD1m7.js";import"./sun-CnDoiXzg.js";import"./index-BdQq_4o_.js";import"./index-8ugP4A3I.js";import"./chevron-down-CjDqse4M.js";const ve=z("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);const je=z("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);var F="Switch",[ye]=Q(F),[be,Ne]=ye(F),q=o.forwardRef((n,i)=>{const{__scopeSwitch:l,name:g,checked:f,defaultChecked:c,required:s,disabled:d,value:j="on",onCheckedChange:C,form:x,...v}=n,[h,y]=o.useState(null),t=L(i,N=>y(N)),m=o.useRef(!1),k=h?x||!!h.closest("form"):!0,[b,R]=K({prop:f,defaultProp:c??!1,onChange:C,caller:F});return e.jsxs(be,{scope:l,checked:b,disabled:d,children:[e.jsx(M.button,{type:"button",role:"switch","aria-checked":b,"aria-required":s,"data-state":G(b),"data-disabled":d?"":void 0,disabled:d,value:j,...v,ref:t,onClick:X(n.onClick,N=>{R(D=>!D),k&&(m.current=N.isPropagationStopped(),m.current||N.stopPropagation())})}),k&&e.jsx(H,{control:h,bubbles:!m.current,name:g,value:j,checked:b,required:s,disabled:d,form:x,style:{transform:"translateX(-100%)"}})]})});q.displayName=F;var $="SwitchThumb",Y=o.forwardRef((n,i)=>{const{__scopeSwitch:l,...g}=n,f=Ne($,l);return e.jsx(M.span,{"data-state":G(f.checked),"data-disabled":f.disabled?"":void 0,...g,ref:i})});Y.displayName=$;var we="SwitchBubbleInput",H=o.forwardRef(({__scopeSwitch:n,control:i,checked:l,bubbles:g=!0,...f},c)=>{const s=o.useRef(null),d=L(s,c),j=Z(l),C=J(i);return o.useEffect(()=>{const x=s.current;if(!x)return;const v=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(v,"checked").set;if(j!==l&&y){const t=new Event("click",{bubbles:g});y.call(x,l),x.dispatchEvent(t)}},[j,l,g]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:l,...f,tabIndex:-1,ref:d,style:{...f.style,...C,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});H.displayName=we;function G(n){return n?"checked":"unchecked"}var O=q,_e=Y;const V=o.forwardRef(({className:n,...i},l)=>e.jsx(O,{className:U("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",n),...i,ref:l,children:e.jsx(_e,{className:U("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));V.displayName=O.displayName;function qe(){const{supabase:n,user:i}=ee(),{theme:l,toggleTheme:g,setTheme:f}=se(),{toast:c}=te(),{t:s}=ae(),[d,j]=o.useState("profile"),[C,x]=o.useState(!0),[v,h]=o.useState(!1),y=[{icon:ie,label:s("settings.profile.title"),id:"profile"},{icon:pe,label:s("settings.notifications.title"),id:"notifications"},{icon:je,label:s("settings.appearance.title"),id:"appearance"},{icon:I,label:s("settings.privacy.title"),id:"privacy"},{icon:ve,label:s("settings.subscription.title"),id:"subscription"}],[t,m]=o.useState({full_name:"",email:"",first_name:"",last_name:"",school:"",year_group:"",subjects:"",avatar_url:"",is_premium:!1}),[k,b]=o.useState({studyReminders:!0,progressUpdates:!0,newContentAlerts:!1,achievementNotifications:!0});o.useEffect(()=>{if(!i)return;(async()=>{try{const{data:r,error:u}=await n.from("profiles").select("*").eq("id",i.id).single();if(u&&u.code,r){const p=r.full_name?.split(" ")||[],S=p[0]||"",E=p.slice(1).join(" ")||"";m({full_name:r.full_name||"",email:r.email||i.email||"",first_name:S,last_name:E,school:r.school||"",year_group:r.year_group||"",subjects:r.subjects||"",avatar_url:r.avatar_url||"",is_premium:r.is_premium||!1})}else m({full_name:i.email?.split("@")[0]||"",email:i.email||"",first_name:"",last_name:"",school:"",year_group:"",subjects:"",avatar_url:"",is_premium:!1})}catch{}finally{x(!1)}})()},[i,n]);const R=async a=>{const r=a.target.files?.[0];if(!r)return;if(!r.type.startsWith("image/")){c({title:"Invalid file type",description:"Please upload an image file.",variant:"destructive"});return}if(r.size>2*1024*1024){c({title:"File too large",description:"Please upload an image smaller than 2MB.",variant:"destructive"});return}const u=new FileReader;u.onloadend=async()=>{const p=u.result;if(m({...t,avatar_url:p}),i)try{const{error:S}=await n.from("profiles").upsert({id:i.id,avatar_url:p},{onConflict:"id"});if(S)throw S;const E=`avatar_url_${i.id}`;localStorage.setItem(E,p),window.dispatchEvent(new CustomEvent("avatarUpdated",{detail:{avatarUrl:p}})),window.dispatchEvent(new StorageEvent("storage",{key:E,newValue:p,storageArea:localStorage})),c({title:"Avatar updated",description:"Your profile picture has been updated."})}catch{c({title:"Error",description:"Failed to save avatar. Please try again.",variant:"destructive"})}},u.onerror=()=>{c({title:"Error",description:"Failed to read image file.",variant:"destructive"})},u.readAsDataURL(r)},N=async()=>{if(i){h(!0);try{const a=t.first_name&&t.last_name?`${t.first_name} ${t.last_name}`:t.first_name||t.last_name||t.full_name||"";if(t.email&&t.email!==i.email){const{error:p}=await n.auth.updateUser({email:t.email});if(p)throw p}const r={id:i.id,email:t.email||i.email,full_name:a,avatar_url:t.avatar_url||null,school:t.school||null,year_group:t.year_group||null,subjects:t.subjects||null},{error:u}=await n.from("profiles").upsert(r,{onConflict:"id"});if(u)throw u.message?.includes("column")||u.code==="42703"?new Error("School, year group, and subjects fields are not available. Please run the database migration (add_profile_fields.sql) first."):u;c({title:"Profile updated",description:t.email!==i.email?"Your profile has been updated. Please check your email to verify the new address.":"Your profile information has been saved successfully."})}catch(a){c({title:"Error",description:a.message||"Failed to save profile. Please try again.",variant:"destructive"})}finally{h(!1)}}},D=t.first_name&&t.last_name?`${t.first_name} ${t.last_name}`:t.full_name||t.email?.split("@")[0]||"User",W=t.first_name&&t.last_name?`${t.first_name[0]}${t.last_name[0]}`:D.substring(0,2).toUpperCase();return e.jsx(re,{children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground",children:"Settings"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"md:col-span-1",children:e.jsx("nav",{className:"space-y-1 animate-slide-up",style:{animationDelay:"0.1s",opacity:0},children:y.map(a=>e.jsxs("button",{onClick:()=>j(a.id),className:U("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors",d===a.id?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-muted"),children:[e.jsx(a.icon,{className:"h-4 w-4"}),a.label]},a.id))})}),e.jsx("div",{className:"md:col-span-3 space-y-6",children:C?e.jsx("div",{className:"glass-card p-6 flex items-center justify-center",children:e.jsx(A,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):e.jsxs(e.Fragment,{children:[d==="profile"&&e.jsxs("div",{className:"glass-card p-6 animate-slide-up",style:{animationDelay:"0.2s",opacity:0},children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-6",children:s("settings.profile.heading")}),e.jsxs("div",{className:"flex items-center gap-6 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(ne,{className:"h-20 w-20 border-4 border-primary/20",children:[e.jsx(le,{src:t.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${i?.email}`}),e.jsx(oe,{children:W})]}),e.jsxs("label",{className:"absolute bottom-0 right-0 p-1.5 rounded-full bg-primary text-primary-foreground shadow-lg hover:bg-primary/90 transition-colors cursor-pointer",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx("input",{type:"file",accept:"image/*",onChange:R,className:"hidden"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground",children:D}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.email||i?.email}),e.jsx("div",{className:"flex items-center gap-1 mt-1",children:t.is_premium?e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gradient-to-r from-yellow-400 to-yellow-600 text-white font-medium flex items-center gap-1",children:[e.jsx(B,{className:"w-3 h-3"})," ",s("settings.profile.premiumUser")]}):e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-primary/10 text-primary",children:s("settings.profile.freePlan")})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"firstName",children:s("settings.profile.firstName")}),e.jsx(P,{id:"firstName",value:t.first_name,onChange:a=>m({...t,first_name:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"lastName",children:s("settings.profile.lastName")}),e.jsx(P,{id:"lastName",value:t.last_name,onChange:a=>m({...t,last_name:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"email",children:s("settings.profile.email")}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(P,{id:"email",type:"email",value:t.email,onChange:a=>m({...t,email:a.target.value}),className:"pl-9"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s("settings.profile.emailHint")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"school",children:s("settings.profile.school")}),e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(P,{id:"school",value:t.school,onChange:a=>m({...t,school:a.target.value}),className:"pl-9"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"year",children:s("settings.profile.yearGroup")}),e.jsxs(ce,{value:t.year_group,onValueChange:a=>m({...t,year_group:a}),children:[e.jsx(de,{children:e.jsx(me,{placeholder:s("settings.profile.selectYearGroup")})}),e.jsxs(ue,{children:[e.jsx(T,{value:"10",children:"Year 10"}),e.jsx(T,{value:"11",children:"Year 11"}),e.jsx(T,{value:"12",children:"Year 12"}),e.jsx(T,{value:"13",children:"Year 13"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"subjects",children:s("settings.profile.subjects")}),e.jsx(P,{id:"subjects",value:t.subjects,onChange:a=>m({...t,subjects:a.target.value}),placeholder:s("settings.profile.subjectsPlaceholder")})]})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx(w,{onClick:N,disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"mr-2 h-4 w-4 animate-spin"}),s("settings.profile.saving")]}):s("settings.profile.saveChanges")})})]}),d==="notifications"&&e.jsxs("div",{className:"glass-card p-6 animate-slide-up",style:{animationDelay:"0.3s",opacity:0},children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-6",children:s("settings.notifications.title")}),e.jsx("div",{className:"space-y-4",children:[{key:"studyReminders",label:s("settings.notifications.studyReminders"),description:s("settings.notifications.studyRemindersDesc")},{key:"progressUpdates",label:s("settings.notifications.progressUpdates"),description:s("settings.notifications.progressUpdatesDesc")},{key:"newContentAlerts",label:s("settings.notifications.newContentAlerts"),description:s("settings.notifications.newContentAlertsDesc")},{key:"achievementNotifications",label:s("settings.notifications.achievementNotifications"),description:s("settings.notifications.achievementNotificationsDesc")}].map(a=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:a.label}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description})]}),e.jsx(V,{checked:k[a.key],onCheckedChange:r=>b({...k,[a.key]:r})})]},a.key))})]}),d==="appearance"&&e.jsxs("div",{className:"glass-card p-6 animate-slide-up",style:{animationDelay:"0.3s",opacity:0},children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-6",children:s("settings.appearance.title")}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s("settings.appearance.theme")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("settings.appearance.themeDesc")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{variant:l==="light"?"default":"outline",size:"sm",onClick:()=>f("light"),children:s("settings.appearance.light")}),e.jsx(w,{variant:l==="dark"?"default":"outline",size:"sm",onClick:()=>f("dark"),children:s("settings.appearance.dark")})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s("settings.appearance.quickToggle")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("settings.appearance.quickToggleDesc")})]}),e.jsx(w,{variant:"outline",size:"sm",onClick:g,className:"gap-2",children:l==="light"?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"ðŸŒ™"})," ",s("settings.appearance.switchToDark")]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â˜€ï¸"})," ",s("settings.appearance.switchToLight")]})})]})]})]}),d==="privacy"&&e.jsxs("div",{className:"glass-card p-6 animate-slide-up",style:{animationDelay:"0.3s",opacity:0},children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-6",children:s("settings.privacy.heading")}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"p-4 rounded-xl bg-destructive/10 border border-destructive/20",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-2",children:s("settings.privacy.dangerZone")}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:s("settings.privacy.deleteWarning")}),e.jsx(w,{variant:"destructive",onClick:async()=>{if(confirm(s("settings.privacy.deleteConfirm1"))&&confirm(s("settings.privacy.deleteConfirm2"))){h(!0);try{const a=["notes","flashcards","past_papers","knowledge_organizers","extracurriculars"];for(const r of a)await n.from(r).delete().eq("user_id",i?.id);await n.from("profiles").delete().eq("id",i?.id),await n.auth.signOut(),c({title:s("settings.privacy.deletionInitiated"),description:s("settings.privacy.deletionInitiatedDesc")}),window.location.href="/landing"}catch(a){c({title:s("common.error"),description:a.message||"Failed to delete account. Please contact support.",variant:"destructive"})}finally{h(!1)}}},disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"mr-2 h-4 w-4 animate-spin"}),s("settings.privacy.deleting")]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),s("settings.privacy.deleteAccount")]})})]})})]}),d==="subscription"&&e.jsxs("div",{className:"glass-card p-6 animate-slide-up",style:{animationDelay:"0.4s",opacity:0},children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-6",children:s("settings.subscription.title")}),e.jsx("div",{className:"p-4 rounded-xl bg-muted/50 border border-border mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:t.is_premium?s("settings.subscription.premiumPlan"):s("settings.subscription.freePlan")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.is_premium?s("settings.subscription.premiumDesc"):s("settings.subscription.freeDesc")})]}),!t.is_premium&&e.jsxs(w,{className:"bg-premium hover:bg-premium/90 text-premium-foreground",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),s("settings.subscription.upgradeToPremium")]}),t.is_premium&&e.jsxs("div",{className:"flex items-center text-green-500 font-medium",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),s("settings.subscription.active")]})]})}),!t.is_premium&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s("settings.subscription.upgradeHint")})]})]})})]})]})})}export{qe as default};
