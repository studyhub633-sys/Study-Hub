import{j as e,L as B,v as W,ac as F,ak as ke,aB as Fe,aC as Te,p as Ee,ah as q,E as Pe,a3 as De,ad as Ae,ai as $e,au as L,aD as Ue,G as Be}from"./ui-vendor-C99L-hD9.js";import{A as G}from"./AppLayout-ByMpyPpA.js";import{B as I}from"./badge-CRXmZtPU.js";import{B as o}from"./button-BJr9rSp3.js";import{D as Y,b as Q,c as X,d as J,e as K,f as Le}from"./dialog-Dm4Wg0Dp.js";import{I as p}from"./input-Bbf_O-WI.js";import{L as m}from"./label-CYsdHgGU.js";import{P as Z}from"./progress-ksma2pXi.js";import{S as N,a as _,b as w,c as S,d as x}from"./select-BY7ge8Oe.js";import{u as Ie,b as Re,c as He}from"./index-Dy4sOhmn.js";import{E as ee}from"./constants-DeIw5BhA.js";import{S as Me}from"./paper-parser-BorTS_p9.js";import{u as Oe,r as n}from"./react-vendor-CW_qxVlV.js";import"./sheet-Cazz0_fh.js";import"./index-BdQq_4o_.js";import"./index-ORJz1BqE.js";import"./supabase-vendor-BFJX04bJ.js";import"./query-vendor-CVP6rs-5.js";function cs(){const{supabase:v,user:d}=Ie(),{toast:c}=Re(),se=Oe(),[h,te]=n.useState([]),[ae,R]=n.useState(!0),[H,le]=n.useState(""),[T,re]=n.useState("All Subjects"),[E,ie]=n.useState("All Boards"),[C,ne]=n.useState("All Tiers"),[ce,k]=n.useState(!1),[g,oe]=n.useState(null),[t,u]=n.useState({title:"",subject:"",year:"",exam_board:"",tier:"",file_url:"",file_type:"link",file:null,score:"",max_score:""}),[a,b]=n.useState(null),[M,O]=n.useState(!1),[de,P]=n.useState(0),[ze,D]=n.useState(null),[ue,y]=n.useState(!1),[me,f]=n.useState(!1);n.useEffect(()=>{if(a!=null&&a.file_url){if(y(!0),f(!1),a.file_url.startsWith("http://")||a.file_url.startsWith("https://")){y(!1),f(!1);return}const s=new AbortController,r=setTimeout(()=>s.abort(),5e3);fetch(a.file_url,{method:"HEAD",signal:s.signal}).then(l=>{clearTimeout(r),!l.ok&&l.status!==0?f(!0):f(!1)}).catch(l=>{clearTimeout(r),l.name,f(!1)}).finally(()=>y(!1))}else y(!1),f(!1)},[a]),n.useEffect(()=>{d&&(A(),xe())},[d]),n.useEffect(()=>{if(!a||!d){D(null);return}const s=new Date;D(s);let r=s;const l=setInterval(()=>{P(i=>i+1)},1e3);return()=>{clearInterval(l);const i=Math.floor((new Date().getTime()-r.getTime())/1e3);i>0&&a&&he(a.id,i)}},[a,d]);const xe=async()=>{if(d)try{const r=h.filter(l=>l.completed_at).length*1;P(r*3600)}catch{}},he=async(s,r)=>{if(!(!d||r<=0))try{P(l=>l+r)}catch{}},A=async()=>{if(d)try{R(!0);const{data:s,error:r}=await v.from("past_papers").select("*").eq("user_id",d.id).order("created_at",{ascending:!1});if(r)throw r;te(s||[])}catch{c({title:"Error",description:"Failed to load past papers. Please try again.",variant:"destructive"})}finally{R(!1)}},z=()=>{oe(null),u({title:"",subject:"",year:"",exam_board:"",tier:"",file_url:"",file_type:"link",file:null,score:"",max_score:""}),k(!0)},fe=async s=>{if(!d)return null;try{O(!0);const r=s.name.split(".").pop(),i=`${d.id}/${Date.now()}_${Math.random().toString(36).substring(7)}.${r}`,{error:j,data:U}=await v.storage.from("past-papers").upload(i,s,{cacheControl:"3600",upsert:!1});if(j)throw j;const{data:Ce}=v.storage.from("past-papers").getPublicUrl(i);return Ce.publicUrl}catch(r){return c({title:"Upload Error",description:r.message||"Failed to upload file. Please try again.",variant:"destructive"}),null}finally{O(!1)}},je=()=>{if(!t.file_url){c({title:"No Link Found",description:"Please paste a link first to use auto-fill.",variant:"destructive"});return}const s=Me.parse(t.file_url);if(s.board==="Unknown"&&s.type==="Other"&&!s.subjectCode){c({title:"Could not parse link",description:"This link format is not recognized for auto-fill.",variant:"destructive"});return}let r=t.title;if(s.subjectCode||s.board!=="Unknown"){const l=[];s.subjectCode&&l.push(s.subjectCode),s.type!=="Other"&&l.push(s.type),s.year&&l.push(s.year),s.month&&l.push(s.month),s.board!=="Unknown"&&l.push(`(${s.board})`),r=l.join(" ")}u(l=>({...l,title:r||l.title,subject:s.subjectCode||l.subject,exam_board:s.board!=="Unknown"?s.board:l.exam_board,year:s.year||l.year})),c({title:"Auto-filled!",description:`Parsed ${s.board} paper details.`})},pe=async()=>{if(!d||!t.title.trim()){c({title:"Error",description:"Title is required",variant:"destructive"});return}if(!t.tier){c({title:"Error",description:"Please select a Tier (Foundation or Higher)",variant:"destructive"});return}try{let s=t.file_url;if(t.file_type==="upload"&&t.file){const l=await fe(t.file);if(!l)return;s=l}else t.file_type==="link"&&!t.file_url.trim()&&(s=null);const r={user_id:d.id,title:t.title,subject:t.subject||null,year:t.year?parseInt(t.year):null,exam_board:t.exam_board||null,tier:t.tier||null,file_url:s,file_type:t.file_type,score:t.score?parseInt(t.score):null,max_score:t.max_score?parseInt(t.max_score):null,completed_at:t.score?new Date().toISOString():null};if(g){const{error:l}=await v.from("past_papers").update(r).eq("id",g.id).eq("user_id",d.id);if(l)throw l;c({title:"Success",description:"Past paper updated successfully"})}else{const{error:l}=await v.from("past_papers").insert(r);if(l)throw l;c({title:"Success",description:"Past paper created successfully"})}k(!1),A()}catch(s){c({title:"Error",description:s.message||"Failed to save past paper. Please try again.",variant:"destructive"})}},ge=async s=>{if(!s.file_url){c({title:"No file available",description:"This paper doesn't have a file attached yet.",variant:"destructive"});return}if(s.file_type==="upload"||!s.file_type&&!s.file_url.startsWith("http"))try{const r=await fetch(s.file_url);if(!r.ok)throw new Error(`Failed to fetch file: ${r.status} ${r.statusText}`);const l=await r.blob(),i=window.URL.createObjectURL(l),j=document.createElement("a");j.href=i,j.download=`${s.title.replace(/\s+/g,"_")}.pdf`,document.body.appendChild(j),j.click(),window.URL.revokeObjectURL(i),document.body.removeChild(j)}catch{c({title:"Download failed",description:"Could not download the file. It may have been deleted or moved.",variant:"destructive"})}else window.open(s.file_url,"_blank")},be=s=>{b(s),D(new Date)},ve=s=>{const r=Math.floor(s/3600),l=Math.floor(s%3600/60);return r>0?`${r}h ${l}m`:`${l}m`},ye=s=>{if(!s.subject){c({title:"No subject available",description:"This paper needs a subject to generate flashcards.",variant:"destructive"});return}se("/flashcards",{state:{organizerContent:`Generate flashcards for ${s.subject} based on the ${s.exam_board||"GCSE"} syllabus. Year: ${s.year||"recent"}. Paper title: ${s.title}. Focus on key concepts, definitions, and exam-style questions that would appear in this type of paper.`,subject:s.subject,topic:s.title}}),c({title:"Generating flashcards...",description:`Creating flashcards for ${s.subject}`})},V=h.filter(s=>{var U;const r=s.title.toLowerCase().includes(H.toLowerCase()),l=T==="All Subjects"||s.subject===T,i=E==="All Boards"||s.exam_board===E,j=C==="All Tiers"||C==="Unassigned"&&!s.tier||((U=s.tier)==null?void 0:U.toLowerCase())===C.toLowerCase();return r&&l&&i&&j}),Ne=h.filter(s=>s.completed_at).length,$=h.filter(s=>s.score!==null&&s.max_score!==null),_e=$.length>0?$.reduce((s,r)=>s+(r.score||0)/(r.max_score||1)*100,0)/$.length:0,we=Array.from(new Set(h.map(s=>s.subject).filter(Boolean)));n.useEffect(()=>{if(!g&&t.year&&t.subject&&t.tier){const s=t.tier==="Higher"?"H":"F",r=t.exam_board?` ${t.exam_board}`:"",l=`${t.year}${s} ${t.subject}${r}`;(!t.title||t.title.trim()==="")&&u(i=>({...i,title:l}))}},[t.year,t.subject,t.tier,t.exam_board,g]);const Se=s=>{if(s.year&&s.subject&&s.tier){const r=s.tier==="Higher"?"H":"F",l=s.exam_board?` ${s.exam_board}`:"";return`${s.year}${r} ${s.subject}${l}`}return s.title};return ae?e.jsx(G,{children:e.jsx("div",{className:"max-w-6xl mx-auto flex items-center justify-center h-[60vh]",children:e.jsx(B,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsxs(G,{children:[e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground",children:"Past Papers"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:[h.length," paper",h.length!==1?"s":""," from various exam boards"]})]}),e.jsxs(o,{onClick:z,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Add Paper"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 animate-slide-up",style:{animationDelay:"0.1s",opacity:0},children:[{label:"Total Papers",value:h.length,icon:F},{label:"Completed",value:Ne,icon:ke},{label:"Average Score",value:`${Math.round(_e)}%`,icon:Fe},{label:"Study Time",value:ve(de),icon:Te}].map(s=>e.jsx("div",{className:"glass-card p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(s.icon,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-foreground",children:s.value}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.label})]})]})},s.label))}),e.jsxs("div",{className:"flex flex-wrap gap-3 animate-slide-up",style:{animationDelay:"0.2s",opacity:0},children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(p,{placeholder:"Search papers...",value:H,onChange:s=>le(s.target.value),className:"pl-9"})]}),e.jsxs(N,{value:T,onValueChange:re,children:[e.jsx(_,{className:"w-[150px]",children:e.jsx(w,{})}),e.jsxs(S,{children:[e.jsx(x,{value:"All Subjects",children:"All Subjects"}),we.map(s=>e.jsx(x,{value:s,children:s},s))]})]}),e.jsxs(N,{value:E,onValueChange:ie,children:[e.jsx(_,{className:"w-[140px]",children:e.jsx(w,{})}),e.jsxs(S,{children:[e.jsx(x,{value:"All Boards",children:"All Boards"}),ee.map(s=>e.jsx(x,{value:s,children:s},s))]})]}),e.jsxs(N,{value:C,onValueChange:ne,children:[e.jsx(_,{className:"w-[140px]",children:e.jsx(w,{})}),e.jsxs(S,{children:[e.jsx(x,{value:"All Tiers",children:"All Tiers"}),e.jsx(x,{value:"Higher",children:"Higher Tier"}),e.jsx(x,{value:"Foundation",children:"Foundation Tier"}),e.jsx(x,{value:"Unassigned",children:"Unassigned"})]})]})]}),h.length===0?e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(F,{className:"h-16 w-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No past papers yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Create your first past paper to get started"}),e.jsxs(o,{onClick:z,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Add Paper"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:V.map((s,r)=>{const l=!!s.completed_at,i=s.score&&s.max_score?s.score/s.max_score*100:0;return e.jsxs("div",{className:"glass-card p-5 hover-lift animate-slide-up",style:{animationDelay:`${.1*r}s`,opacity:0},children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.subject&&e.jsx(I,{variant:"outline",children:s.subject}),s.exam_board&&e.jsx(I,{variant:"outline",children:s.exam_board}),s.tier&&e.jsx(I,{variant:"secondary",className:s.tier==="Higher"?"bg-red-500/10 text-red-500 border-red-500/20":"bg-green-500/10 text-green-500 border-green-500/20",children:s.tier})]})}),e.jsx("h3",{className:"font-semibold text-foreground mb-1",children:Se(s)}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:[s.subject," • ",s.year]}),l&&s.score!==null&&s.max_score!==null?e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Your Score"}),e.jsxs("span",{className:He("font-bold",i>=70?"text-secondary":i>=50?"text-accent-foreground":"text-destructive"),children:[Math.round(i),"%"]})]}),e.jsx(Z,{value:i,className:"h-2"})]}):e.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-muted/50 flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{children:"Not attempted yet"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:l?"outline":"default",className:"flex-1",onClick:()=>be(s),children:l?e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Review"]}):e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Start Quiz"]})}),e.jsx(o,{variant:"outline",size:"icon",onClick:()=>ye(s),title:"Generate Flashcards",children:e.jsx(Ae,{className:"h-4 w-4"})}),s.file_url&&e.jsxs(e.Fragment,{children:[(s.file_type==="upload"||!s.file_type&&s.file_url&&!s.file_url.startsWith("http"))&&e.jsx(o,{variant:"outline",size:"icon",onClick:()=>ge(s),children:e.jsx($e,{className:"h-4 w-4"})}),s.file_url&&s.file_url.startsWith("http")&&e.jsx(o,{variant:"outline",size:"icon",onClick:()=>window.open(s.file_url,"_blank"),children:e.jsx(L,{className:"h-4 w-4"})})]})]})]},s.id)})}),V.length===0&&h.length>0&&e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(F,{className:"h-16 w-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No papers found"}),e.jsx("p",{className:"text-muted-foreground",children:"Try adjusting your filters"})]})]}),e.jsx(Y,{open:ce,onOpenChange:k,children:e.jsxs(Q,{className:"max-w-2xl",children:[e.jsxs(X,{children:[e.jsx(J,{children:g?"Edit Past Paper":"Create New Past Paper"}),e.jsx(K,{children:g?"Update your past paper details below":"Fill in the details to create a new past paper"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"title",children:"Title *"}),e.jsx(p,{id:"title",value:t.title,onChange:s=>u({...t,title:s.target.value}),placeholder:"Enter paper title"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"subject",children:"Subject"}),e.jsx(p,{id:"subject",value:t.subject,onChange:s=>u({...t,subject:s.target.value}),placeholder:"e.g., Biology"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"exam_board",children:"Exam Board"}),e.jsxs(N,{value:t.exam_board,onValueChange:s=>u({...t,exam_board:s}),children:[e.jsx(_,{id:"exam_board",children:e.jsx(w,{placeholder:"Select board"})}),e.jsx(S,{children:ee.map(s=>e.jsx(x,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"year",children:"Year"}),e.jsx(p,{id:"year",type:"number",value:t.year,onChange:s=>u({...t,year:s.target.value}),placeholder:"2024"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"tier",children:"Tier"}),e.jsxs(N,{value:t.tier,onValueChange:s=>u({...t,tier:s}),children:[e.jsx(_,{id:"tier",children:e.jsx(w,{placeholder:"Select Tier"})}),e.jsxs(S,{children:[e.jsx(x,{value:"Higher",children:"Higher Tier"}),e.jsx(x,{value:"Foundation",children:"Foundation Tier"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"File Attachment"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsxs(o,{type:"button",variant:t.file_type==="link"?"default":"outline",size:"sm",onClick:()=>u({...t,file_type:"link",file:null}),children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Link"]}),e.jsxs(o,{type:"button",variant:t.file_type==="upload"?"default":"outline",size:"sm",onClick:()=>u({...t,file_type:"upload",file_url:""}),children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Upload File"]})]}),t.file_type==="link"?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{id:"file_url",value:t.file_url,onChange:s=>u({...t,file_url:s.target.value}),placeholder:"https://example.com/past-paper.pdf",className:"flex-1"}),e.jsx(o,{type:"button",variant:"secondary",size:"icon",onClick:je,title:"Auto-fill from link",children:e.jsx(Be,{className:"h-4 w-4 text-primary"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Paste a link to the past paper and click the sparkles ✨ to auto-fill details."})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{id:"file",type:"file",accept:".pdf,.doc,.docx,.txt",onChange:s=>{var l;const r=(l=s.target.files)==null?void 0:l[0];if(r){if(r.size>10*1024*1024){c({title:"File too large",description:"Please upload a file smaller than 10MB.",variant:"destructive"});return}u({...t,file:r})}},className:"cursor-pointer"}),t.file&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Selected: ",t.file.name," (",(t.file.size/1024/1024).toFixed(2)," MB)"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Upload PDF, Word, or text files (max 10MB)"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"score",children:"Score"}),e.jsx(p,{id:"score",type:"number",value:t.score,onChange:s=>u({...t,score:s.target.value}),placeholder:"82"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"max_score",children:"Max Score"}),e.jsx(p,{id:"max_score",type:"number",value:t.max_score,onChange:s=>u({...t,max_score:s.target.value}),placeholder:"100"})]})]})]}),e.jsxs(Le,{children:[e.jsx(o,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsx(o,{onClick:pe,disabled:M,children:M?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-4 w-4 mr-2 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[g?"Update":"Create"," Paper"]})})]})]})}),e.jsx(Y,{open:!!a,onOpenChange:s=>!s&&b(null),children:e.jsxs(Q,{className:"max-w-5xl h-[90vh] flex flex-col p-0 overflow-hidden",children:[e.jsxs(X,{className:"p-6 pb-2",children:[e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5 text-primary"}),a==null?void 0:a.title]}),e.jsxs(K,{children:[a==null?void 0:a.subject," • ",a==null?void 0:a.exam_board," • ",a==null?void 0:a.year]})]}),e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row border-t overflow-hidden",children:[e.jsx("div",{className:"flex-1 bg-muted/30 relative min-h-[300px]",children:a!=null&&a.file_url?ue?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(B,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading preview..."})]})}):me?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center p-8 text-center bg-background/50 backdrop-blur-sm",children:[e.jsx("div",{className:"bg-destructive/10 p-4 rounded-full mb-4",children:e.jsx(q,{className:"h-8 w-8 text-destructive"})}),e.jsx("h4",{className:"font-semibold mb-2 text-lg",children:"File Not Found"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6 max-w-xs",children:"The file for this past paper seems to be missing or deleted."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",onClick:()=>b(null),children:"Close"}),e.jsx(o,{variant:"default",onClick:()=>{y(!0),f(!1),fetch(a.file_url).then(s=>{if(!s.ok)throw new Error("Status "+s.status);f(!1)}).catch(()=>f(!0)).finally(()=>y(!1))},children:"Retry"})]})]}):a.file_url.startsWith("https://filestore.aqa.org.uk")||a.file_url.endsWith(".pdf")?e.jsx("iframe",{src:a.file_url,className:"w-full h-full border-none",title:"Paper Content"}):e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(L,{className:"h-12 w-12 text-muted-foreground mb-4 opacity-20"}),e.jsx("h4",{className:"font-semibold mb-2",children:"External Content"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"This paper is hosted on an external site. Open it in a new tab to study."}),e.jsx(o,{onClick:()=>window.open(a.file_url,"_blank"),children:"Open Paper in New Tab"})]}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-muted-foreground",children:"No file content available."})}),e.jsxs("div",{className:"w-full md:w-80 border-l bg-background p-6 space-y-6 overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx(m,{className:"text-sm font-medium mb-3 block",children:"Review Results"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"review-score",children:"Your Score"}),e.jsx(p,{id:"review-score",type:"number",placeholder:"e.g. 85",defaultValue:(a==null?void 0:a.score)||"",onChange:s=>{a&&b({...a,score:parseInt(s.target.value)||null})}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"review-max",children:"Max Score"}),e.jsx(p,{id:"review-max",type:"number",placeholder:"e.g. 100",defaultValue:(a==null?void 0:a.max_score)||"",onChange:s=>{a&&b({...a,max_score:parseInt(s.target.value)||null})}})]})]})]}),a&&a.score!==null&&a.max_score!==null&&e.jsxs("div",{className:"p-4 rounded-lg bg-primary/5 border border-primary/10",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Percentage"}),e.jsxs("span",{className:"font-bold text-primary",children:[Math.round(a.score/a.max_score*100),"%"]})]}),e.jsx(Z,{value:a.score/a.max_score*100,className:"h-2"})]}),e.jsxs("div",{className:"pt-4 border-t space-y-2",children:[e.jsx(o,{className:"w-full",onClick:async()=>{if(!(!a||!d))try{const{error:s}=await v.from("past_papers").update({score:a.score,max_score:a.max_score,completed_at:a.score!==null?new Date().toISOString():null}).eq("id",a.id);if(s)throw s;c({title:"Review Saved",description:"Your scores have been updated."}),b(null),A()}catch(s){c({title:"Error",description:s.message,variant:"destructive"})}},children:"Save Results"}),e.jsx(o,{variant:"outline",className:"w-full",onClick:()=>b(null),children:"Close"})]})]})]})]})})]})}export{cs as default};
