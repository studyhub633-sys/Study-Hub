import{n as _e,j as e,b as Te,ap as Le,m as P,d as F,l as ke,aq as Ae,ar as Ie,E as Pe,a9 as Re,aj as Fe,as as ze,at as U,au as Ee,K as z,a3 as $e,av as qe}from"./ui-vendor-CsSFJReh.js";import{A as Ge}from"./AppLayout-DI_SoCqt.js";import{B as w}from"./badge-C82RfJ-5.js";import{c as E,u as Me,j as Ve,k as De,B as C}from"./index-D0R12c3l.js";import{C as S,a as _,b as T,d as L,c as Q}from"./card-D_wUZn1S.js";import{I as H}from"./input-BOrw0D0Z.js";import{S as W,a as J,b as X,c as Z,d as k}from"./select-BnVVC8xh.js";import{r as o}from"./react-vendor-BmZbDsmQ.js";import{c as ee,R as Be,I as Ye}from"./index-Z_egXcke.js";import{u as Oe}from"./index-B5-l44BU.js";import{S as Ke}from"./paper-parser-BorTS_p9.js";import"./AnimatedLogoIcon-D5-EYdni.js";import"./sheet-0_ECFM1J.js";import"./supabase-vendor-BcRMW6g-.js";import"./query-vendor-DjEy6XLK.js";import"./index-BdQq_4o_.js";var R="Tabs",[Ue]=Te(R,[ee]),se=ee(),[Qe,$]=Ue(R),ae=o.forwardRef((t,i)=>{const{__scopeTabs:r,value:n,onValueChange:p,defaultValue:x,orientation:d="horizontal",dir:b,activationMode:v="automatic",...c}=t,f=Oe(b),[u,j]=_e({prop:n,onChange:p,defaultProp:x??"",caller:R});return e.jsx(Qe,{scope:r,baseId:Le(),value:u,onValueChange:j,orientation:d,dir:f,activationMode:v,children:e.jsx(P.div,{dir:f,"data-orientation":d,...c,ref:i})})});ae.displayName=R;var te="TabsList",re=o.forwardRef((t,i)=>{const{__scopeTabs:r,loop:n=!0,...p}=t,x=$(te,r),d=se(r);return e.jsx(Be,{asChild:!0,...d,orientation:x.orientation,dir:x.dir,loop:n,children:e.jsx(P.div,{role:"tablist","aria-orientation":x.orientation,...p,ref:i})})});re.displayName=te;var ie="TabsTrigger",le=o.forwardRef((t,i)=>{const{__scopeTabs:r,value:n,disabled:p=!1,...x}=t,d=$(ie,r),b=se(r),v=ce(d.baseId,n),c=de(d.baseId,n),f=n===d.value;return e.jsx(Ye,{asChild:!0,...b,focusable:!p,active:f,children:e.jsx(P.button,{type:"button",role:"tab","aria-selected":f,"aria-controls":c,"data-state":f?"active":"inactive","data-disabled":p?"":void 0,disabled:p,id:v,...x,ref:i,onMouseDown:F(t.onMouseDown,u=>{!p&&u.button===0&&u.ctrlKey===!1?d.onValueChange(n):u.preventDefault()}),onKeyDown:F(t.onKeyDown,u=>{[" ","Enter"].includes(u.key)&&d.onValueChange(n)}),onFocus:F(t.onFocus,()=>{const u=d.activationMode!=="manual";!f&&!p&&u&&d.onValueChange(n)})})})});le.displayName=ie;var oe="TabsContent",ne=o.forwardRef((t,i)=>{const{__scopeTabs:r,value:n,forceMount:p,children:x,...d}=t,b=$(oe,r),v=ce(b.baseId,n),c=de(b.baseId,n),f=n===b.value,u=o.useRef(f);return o.useEffect(()=>{const j=requestAnimationFrame(()=>u.current=!1);return()=>cancelAnimationFrame(j)},[]),e.jsx(ke,{present:p||f,children:({present:j})=>e.jsx(P.div,{"data-state":f?"active":"inactive","data-orientation":b.orientation,role:"tabpanel","aria-labelledby":v,hidden:!j,id:c,tabIndex:0,...d,ref:i,style:{...t.style,animationDuration:u.current?"0s":void 0},children:j&&x})})});ne.displayName=oe;function ce(t,i){return`${t}-trigger-${i}`}function de(t,i){return`${t}-content-${i}`}var He=ae,ue=re,me=le,he=ne;const We=He,pe=o.forwardRef(({className:t,...i},r)=>e.jsx(ue,{ref:r,className:E("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...i}));pe.displayName=ue.displayName;const A=o.forwardRef(({className:t,...i},r)=>e.jsx(me,{ref:r,className:E("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",t),...i}));A.displayName=me.displayName;const I=o.forwardRef(({className:t,...i},r)=>e.jsx(he,{ref:r,className:E("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...i}));I.displayName=he.displayName;function hs(){const{supabase:t,user:i}=Me(),{t:r}=Ve(),[n,p]=o.useState([]),[x,d]=o.useState([]),[b,v]=o.useState([]),[c,f]=o.useState(""),[u,j]=o.useState("all"),[y,xe]=o.useState("all"),[q,fe]=o.useState("papers"),[N,G]=o.useState(""),[M,V]=o.useState(!1),{toast:m}=De(),be=o.useMemo(()=>[...new Set(n.map(a=>a.year))].filter(Boolean).sort((a,l)=>l-a),[n]),ge=o.useMemo(()=>{const s=n.map(h=>h.subject),a=x.map(h=>h.subject),l=b.map(h=>h.subject);return[...new Set([...s,...a,...l])].filter(Boolean).sort()},[n,x,b]);o.useEffect(()=>{t&&(je(),ve(),ye())},[t]);const je=async()=>{const{data:s,error:a}=await t.from("global_past_papers").select("*").order("created_at",{ascending:!1});a||p(s||[])},ve=async()=>{const{data:s,error:a}=await t.from("global_knowledge_organizers").select("*").order("created_at",{ascending:!1});a||d(s||[])},ye=async()=>{const{data:s,error:a}=await t.from("global_flashcards").select("*").order("created_at",{ascending:!1});a||v(s||[])},Ne=async()=>{if(N.trim()){V(!0);try{const s=Ke.parse(N),{error:a}=await t.from("past_papers").insert({user_id:i==null?void 0:i.id,title:`${s.board} ${s.subjectCode||""} ${s.type} ${s.year||""} ${s.month||""}`,subject:s.subjectCode||"AQA General",year:s.year?parseInt(s.year):null,exam_board:s.board,file_url:N,file_type:"link"});if(a)throw a;m({title:"Smart Add Successful",description:"The paper has been added to your collection using AI parsing."}),G("")}catch{m({title:"Parsing Error",description:"We couldn't parse that link. Try adding it manually or check the URL.",variant:"destructive"})}finally{V(!1)}}},we=async s=>{if(!i){m({title:"Login Required",description:"You must be logged in to add papers.",variant:"destructive"});return}try{const{data:a}=await t.from("past_papers").select("id").eq("user_id",i.id).eq("file_url",s.file_url).maybeSingle();if(a){m({title:"Already Added",description:"This paper is already in your collection."});return}const{error:l}=await t.from("past_papers").insert({user_id:i.id,title:s.title,subject:s.subject,year:s.year,exam_board:s.exam_board,file_url:s.file_url,file_type:s.file_type});if(l)throw l;m({title:"Added to Library",description:`${s.title} has been added to your papers.`})}catch(a){m({title:"Error",description:a.message,variant:"destructive"})}},Ce=async s=>{if(!i){m({title:"Login Required",description:"You must be logged in to add organizers.",variant:"destructive"});return}try{const{data:a}=await t.from("knowledge_organizers").select("id").eq("user_id",i.id).eq("title",s.title).maybeSingle();if(a){m({title:"Already Added",description:"This organizer is already in your collection."});return}const{error:l}=await t.from("knowledge_organizers").insert({user_id:i.id,title:s.title,subject:s.subject,topic:s.topic,content:s.content});if(l)throw l;m({title:"Added to Library",description:`${s.title} has been added to your organizers.`})}catch(a){m({title:"Error",description:a.message,variant:"destructive"})}},Se=async s=>{if(!i){m({title:"Login Required",description:"You must be logged in to add flashcards.",variant:"destructive"});return}try{const{data:a}=await t.from("flashcards").select("id").eq("user_id",i.id).eq("front",s.front).maybeSingle();if(a){m({title:"Already Added",description:"This flashcard is already in your collection."});return}const{error:l}=await t.from("flashcards").insert({user_id:i.id,front:s.front,back:s.back,subject:s.subject,topic:s.topic,difficulty:1,review_count:0});if(l)throw l;m({title:"Added to Flashcards",description:"Flashcard added successfully."})}catch(a){m({title:"Error",description:a.message,variant:"destructive"})}},D=n.filter(s=>{var h,O,K;const a=(s.title||"").toLowerCase().includes(c.toLowerCase())||((h=s.subject)==null?void 0:h.toLowerCase().includes(c.toLowerCase()))||((O=s.exam_board)==null?void 0:O.toLowerCase().includes(c.toLowerCase())),l=u==="all"||((K=s.year)==null?void 0:K.toString())===u,g=y==="all"||s.subject===y;return a&&l&&g}),B=x.filter(s=>{var g,h;const a=(s.title||"").toLowerCase().includes(c.toLowerCase())||((g=s.subject)==null?void 0:g.toLowerCase().includes(c.toLowerCase()))||((h=s.topic)==null?void 0:h.toLowerCase().includes(c.toLowerCase())),l=y==="all"||s.subject===y;return a&&l}),Y=b.filter(s=>{var g,h;const a=(s.front||"").toLowerCase().includes(c.toLowerCase())||(s.back||"").toLowerCase().includes(c.toLowerCase())||((g=s.topic)==null?void 0:g.toLowerCase().includes(c.toLowerCase()))||((h=s.subject)==null?void 0:h.toLowerCase().includes(c.toLowerCase())),l=y==="all"||s.subject===y;return a&&l});return e.jsx(Ge,{children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8 animate-fade-in pb-20",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ae,{className:"h-8 w-8 text-primary"}),e.jsx("h1",{className:"text-4xl font-extrabold tracking-tight",children:r("library.title")})]}),e.jsx("p",{className:"text-muted-foreground text-lg",children:r("library.subtitle")})]}),e.jsx("div",{className:"flex flex-col items-end gap-2",children:e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-500/10 border border-emerald-500/20 text-emerald-600",children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-bold uppercase tracking-wider",children:r("library.trustedSources")})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-muted-foreground group-focus-within:text-primary transition-colors",children:e.jsx(Pe,{className:"h-5 w-5"})}),e.jsx(H,{placeholder:r("library.searchPlaceholder"),value:c,onChange:s=>f(s.target.value),className:"pl-10 h-12 bg-background border-primary/10 rounded-xl shadow-sm"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[q==="papers"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(W,{value:u,onValueChange:j,children:[e.jsx(J,{className:"w-[130px] h-10",children:e.jsx(X,{placeholder:"Year"})}),e.jsxs(Z,{children:[e.jsx(k,{value:"all",children:r("common.allYears")}),be.map(s=>e.jsx(k,{value:s.toString(),children:s},s))]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(W,{value:y,onValueChange:xe,children:[e.jsx(J,{className:"w-[160px] h-10",children:e.jsx(X,{placeholder:"Subject"})}),e.jsxs(Z,{children:[e.jsx(k,{value:"all",children:r("common.allSubjects")}),ge.map(s=>e.jsx(k,{value:s,children:s},s))]})]})]})]})]}),e.jsxs(We,{value:q,onValueChange:fe,className:"w-full",children:[e.jsxs(pe,{className:"grid w-full grid-cols-3 mb-8 h-12 p-1 bg-muted/50 backdrop-blur-sm rounded-xl",children:[e.jsxs(A,{value:"papers",className:"rounded-lg font-bold text-base flex gap-2",children:[e.jsx(ze,{className:"h-4 w-4"})," ",r("library.pastPapers")]}),e.jsxs(A,{value:"organizers",className:"rounded-lg font-bold text-base flex gap-2",children:[e.jsx(U,{className:"h-4 w-4"})," ",r("library.organisers")]}),e.jsxs(A,{value:"flashcards",className:"rounded-lg font-bold text-base flex gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"})," ",r("library.flashcards")]})]}),e.jsx(I,{value:"papers",className:"space-y-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[D.map(s=>e.jsxs(S,{className:"hover:shadow-lg transition-all border-primary/5 group",children:[e.jsxs(_,{className:"p-4 pb-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(w,{variant:"outline",className:"bg-primary/5 text-primary border-primary/10",children:s.exam_board}),e.jsx(C,{size:"icon",variant:"ghost",onClick:()=>we(s),className:"h-8 w-8 text-primary hover:bg-primary/10",children:e.jsx(z,{className:"h-5 w-5"})})]}),e.jsx(T,{className:"text-base mt-2 line-clamp-2",children:s.title})]}),e.jsxs(L,{className:"p-4 pt-0 flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:[s.subject," â€¢ ",s.year]}),e.jsx("div",{className:"text-[10px] font-bold text-emerald-500 bg-emerald-500/10 px-2 py-0.5 rounded-full uppercase",children:"Verified"})]})]},s.id)),D.length===0&&e.jsx("div",{className:"col-span-full py-20 text-center text-muted-foreground",children:r("library.noPapersFound")})]})}),e.jsx("div",{className:"md:col-span-1",children:e.jsx("div",{className:"sticky top-24",children:e.jsxs(S,{className:"border-primary/20 shadow-xl overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-primary"}),e.jsxs(_,{className:"bg-primary/5",children:[e.jsxs(T,{className:"flex items-center gap-2 text-primary",children:[e.jsx($e,{className:"h-5 w-5"})," ",r("library.smartLinkImporter")]}),e.jsx(Q,{children:r("library.smartLinkDesc")})]}),e.jsxs(L,{className:"p-6 space-y-4",children:[e.jsx(H,{placeholder:"https://...",value:N,onChange:s=>G(s.target.value),className:"border-primary/10 focus:border-primary focus:ring-primary h-12"}),e.jsx(C,{className:"w-full h-12 font-bold gap-2 text-lg shadow-primary/20",onClick:Ne,disabled:M||!N,children:r(M?"library.working":"library.addWithSmartParser")}),e.jsx("div",{className:"pt-4 border-t border-primary/5",children:e.jsxs("p",{className:"text-[10px] text-muted-foreground font-medium flex items-center gap-1",children:[e.jsx(qe,{className:"h-3 w-3"})," Note: This uses URLs only. Scientia.ai does not host or redistribute any PDF files."]})})]})]})})})]})}),e.jsx(I,{value:"organizers",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[B.map(s=>{var a,l,g;return e.jsxs(S,{className:"hover:shadow-xl transition-all border-primary/5 group relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-3",children:e.jsx(C,{size:"icon",variant:"secondary",onClick:()=>Ce(s),className:"h-10 w-10 shadow-lg",children:e.jsx(z,{className:"h-6 w-6"})})}),e.jsxs(_,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{className:"bg-primary/10 text-primary border-none",children:((a=s.content)==null?void 0:a.exam_board)||"General"}),e.jsx(w,{variant:"outline",className:"text-muted-foreground",children:s.subject})]}),e.jsx(T,{className:"text-xl group-hover:text-primary transition-colors",children:s.title}),e.jsx(Q,{className:"line-clamp-2 mt-2",children:s.topic})]}),e.jsx(L,{children:e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-2",children:[e.jsx(U,{className:"h-3 w-3"}),r("knowledge.sections",{count:((g=(l=s.content)==null?void 0:l.sections)==null?void 0:g.length)||0})]})})]},s.id)}),B.length===0&&e.jsx("div",{className:"col-span-full py-20 text-center text-muted-foreground",children:r("common.noResults")})]})}),e.jsx(I,{value:"flashcards",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[Y.map(s=>e.jsxs(S,{className:"hover:shadow-xl transition-all border-primary/5 group relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-3",children:e.jsx(C,{size:"icon",variant:"secondary",onClick:()=>Se(s),className:"h-10 w-10 shadow-lg",children:e.jsx(z,{className:"h-6 w-6"})})}),e.jsxs(_,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{variant:"outline",className:"text-muted-foreground",children:s.subject}),e.jsx(w,{className:"bg-primary/10 text-primary border-none",children:s.topic})]}),e.jsx(T,{className:"text-lg group-hover:text-primary transition-colors line-clamp-2",children:s.front})]}),e.jsx(L,{children:e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3",children:s.back})})]},s.id)),Y.length===0&&e.jsx("div",{className:"col-span-full py-20 text-center text-muted-foreground",children:r("common.noResults")})]})})]})]})})}export{hs as default};
