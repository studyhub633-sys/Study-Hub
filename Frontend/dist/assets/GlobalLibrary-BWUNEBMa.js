import{d as Se,j as e,b as _e,a9 as Te,P,f as F,e as Ae,aa as Le,ab as ke,p as Pe,O as Ie,a4 as Fe,ac as Re,H as U,ad as ze,v as R,G as Ee,ae as $e}from"./ui-vendor-C99L-hD9.js";import{A as Ge}from"./AppLayout-ByMpyPpA.js";import{B as N}from"./badge-CRXmZtPU.js";import{B as w}from"./button-BJr9rSp3.js";import{C,a as S,b as _,d as T,c as H}from"./card-BHHR0IqZ.js";import{I as K}from"./input-Bbf_O-WI.js";import{S as Q,a as W,b as J,c as X,d as A}from"./select-BY7ge8Oe.js";import{r as l}from"./react-vendor-CW_qxVlV.js";import{c as Z,R as Me,I as Ve}from"./index-CoosLqNh.js";import{u as qe}from"./index-ORJz1BqE.js";import{c as z,u as De,b as Be}from"./index-Dy4sOhmn.js";import{S as Oe}from"./paper-parser-BorTS_p9.js";import"./sheet-Cazz0_fh.js";import"./index-BdQq_4o_.js";import"./supabase-vendor-BFJX04bJ.js";import"./query-vendor-CVP6rs-5.js";var I="Tabs",[Ye]=_e(I,[Z]),ee=Z(),[Ue,E]=Ye(I),se=l.forwardRef((t,r)=>{const{__scopeTabs:i,value:d,onValueChange:u,defaultValue:g,orientation:n="horizontal",dir:j,activationMode:c="automatic",...v}=t,m=qe(j),[h,p]=Se({prop:d,onChange:u,defaultProp:g??"",caller:I});return e.jsx(Ue,{scope:i,baseId:Te(),value:h,onValueChange:p,orientation:n,dir:m,activationMode:c,children:e.jsx(P.div,{dir:m,"data-orientation":n,...v,ref:r})})});se.displayName=I;var ae="TabsList",te=l.forwardRef((t,r)=>{const{__scopeTabs:i,loop:d=!0,...u}=t,g=E(ae,i),n=ee(i);return e.jsx(Me,{asChild:!0,...n,orientation:g.orientation,dir:g.dir,loop:d,children:e.jsx(P.div,{role:"tablist","aria-orientation":g.orientation,...u,ref:r})})});te.displayName=ae;var re="TabsTrigger",ie=l.forwardRef((t,r)=>{const{__scopeTabs:i,value:d,disabled:u=!1,...g}=t,n=E(re,i),j=ee(i),c=ne(n.baseId,d),v=ce(n.baseId,d),m=d===n.value;return e.jsx(Ve,{asChild:!0,...j,focusable:!u,active:m,children:e.jsx(P.button,{type:"button",role:"tab","aria-selected":m,"aria-controls":v,"data-state":m?"active":"inactive","data-disabled":u?"":void 0,disabled:u,id:c,...g,ref:r,onMouseDown:F(t.onMouseDown,h=>{!u&&h.button===0&&h.ctrlKey===!1?n.onValueChange(d):h.preventDefault()}),onKeyDown:F(t.onKeyDown,h=>{[" ","Enter"].includes(h.key)&&n.onValueChange(d)}),onFocus:F(t.onFocus,()=>{const h=n.activationMode!=="manual";!m&&!u&&h&&n.onValueChange(d)})})})});ie.displayName=re;var oe="TabsContent",le=l.forwardRef((t,r)=>{const{__scopeTabs:i,value:d,forceMount:u,children:g,...n}=t,j=E(oe,i),c=ne(j.baseId,d),v=ce(j.baseId,d),m=d===j.value,h=l.useRef(m);return l.useEffect(()=>{const p=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(p)},[]),e.jsx(Ae,{present:u||m,children:({present:p})=>e.jsx(P.div,{"data-state":m?"active":"inactive","data-orientation":j.orientation,role:"tabpanel","aria-labelledby":c,hidden:!p,id:v,tabIndex:0,...n,ref:r,style:{...t.style,animationDuration:h.current?"0s":void 0},children:p&&g})})});le.displayName=oe;function ne(t,r){return`${t}-trigger-${r}`}function ce(t,r){return`${t}-content-${r}`}var He=se,de=te,ue=ie,me=le;const Ke=He,he=l.forwardRef(({className:t,...r},i)=>e.jsx(de,{ref:i,className:z("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...r}));he.displayName=de.displayName;const L=l.forwardRef(({className:t,...r},i)=>e.jsx(ue,{ref:i,className:z("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",t),...r}));L.displayName=ue.displayName;const k=l.forwardRef(({className:t,...r},i)=>e.jsx(me,{ref:i,className:z("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...r}));k.displayName=me.displayName;function us(){const{supabase:t,user:r}=De(),[i,d]=l.useState([]),[u,g]=l.useState([]),[n,j]=l.useState([]),[c,v]=l.useState(""),[m,h]=l.useState("all"),[p,pe]=l.useState("all"),[$,xe]=l.useState("papers"),[y,G]=l.useState(""),[M,V]=l.useState(!1),{toast:x}=Be(),fe=l.useMemo(()=>[...new Set(i.map(a=>a.year))].filter(Boolean).sort((a,o)=>o-a),[i]),ge=l.useMemo(()=>{const s=i.map(f=>f.subject),a=u.map(f=>f.subject),o=n.map(f=>f.subject);return[...new Set([...s,...a,...o])].filter(Boolean).sort()},[i,u,n]);l.useEffect(()=>{t&&(be(),je(),ve())},[t]);const be=async()=>{const{data:s,error:a}=await t.from("global_past_papers").select("*").order("created_at",{ascending:!1});a||d(s||[])},je=async()=>{const{data:s,error:a}=await t.from("global_knowledge_organizers").select("*").order("created_at",{ascending:!1});a||g(s||[])},ve=async()=>{const{data:s,error:a}=await t.from("global_flashcards").select("*").order("created_at",{ascending:!1});a||j(s||[])},ye=async()=>{if(y.trim()){V(!0);try{const s=Oe.parse(y),{error:a}=await t.from("past_papers").insert({user_id:r==null?void 0:r.id,title:`${s.board} ${s.subjectCode||""} ${s.type} ${s.year||""} ${s.month||""}`,subject:s.subjectCode||"AQA General",year:s.year?parseInt(s.year):null,exam_board:s.board,file_url:y,file_type:"link"});if(a)throw a;x({title:"Smart Add Successful",description:"The paper has been added to your collection using AI parsing."}),G("")}catch{x({title:"Parsing Error",description:"We couldn't parse that link. Try adding it manually or check the URL.",variant:"destructive"})}finally{V(!1)}}},Ne=async s=>{if(!r){x({title:"Login Required",description:"You must be logged in to add papers.",variant:"destructive"});return}try{const{data:a}=await t.from("past_papers").select("id").eq("user_id",r.id).eq("file_url",s.file_url).maybeSingle();if(a){x({title:"Already Added",description:"This paper is already in your collection."});return}const{error:o}=await t.from("past_papers").insert({user_id:r.id,title:s.title,subject:s.subject,year:s.year,exam_board:s.exam_board,file_url:s.file_url,file_type:s.file_type});if(o)throw o;x({title:"Added to Library",description:`${s.title} has been added to your papers.`})}catch(a){x({title:"Error",description:a.message,variant:"destructive"})}},we=async s=>{if(!r){x({title:"Login Required",description:"You must be logged in to add organizers.",variant:"destructive"});return}try{const{data:a}=await t.from("knowledge_organizers").select("id").eq("user_id",r.id).eq("title",s.title).maybeSingle();if(a){x({title:"Already Added",description:"This organizer is already in your collection."});return}const{error:o}=await t.from("knowledge_organizers").insert({user_id:r.id,title:s.title,subject:s.subject,topic:s.topic,content:s.content});if(o)throw o;x({title:"Added to Library",description:`${s.title} has been added to your organizers.`})}catch(a){x({title:"Error",description:a.message,variant:"destructive"})}},Ce=async s=>{if(!r){x({title:"Login Required",description:"You must be logged in to add flashcards.",variant:"destructive"});return}try{const{data:a}=await t.from("flashcards").select("id").eq("user_id",r.id).eq("front",s.front).maybeSingle();if(a){x({title:"Already Added",description:"This flashcard is already in your collection."});return}const{error:o}=await t.from("flashcards").insert({user_id:r.id,front:s.front,back:s.back,subject:s.subject,topic:s.topic,difficulty:1,review_count:0});if(o)throw o;x({title:"Added to Flashcards",description:"Flashcard added successfully."})}catch(a){x({title:"Error",description:a.message,variant:"destructive"})}},q=i.filter(s=>{var f,O,Y;const a=s.title.toLowerCase().includes(c.toLowerCase())||((f=s.subject)==null?void 0:f.toLowerCase().includes(c.toLowerCase()))||((O=s.exam_board)==null?void 0:O.toLowerCase().includes(c.toLowerCase())),o=m==="all"||((Y=s.year)==null?void 0:Y.toString())===m,b=p==="all"||s.subject===p;return a&&o&&b}),D=u.filter(s=>{var b,f;const a=s.title.toLowerCase().includes(c.toLowerCase())||((b=s.subject)==null?void 0:b.toLowerCase().includes(c.toLowerCase()))||((f=s.topic)==null?void 0:f.toLowerCase().includes(c.toLowerCase())),o=p==="all"||s.subject===p;return a&&o}),B=n.filter(s=>{var b,f;const a=s.front.toLowerCase().includes(c.toLowerCase())||s.back.toLowerCase().includes(c.toLowerCase())||((b=s.topic)==null?void 0:b.toLowerCase().includes(c.toLowerCase()))||((f=s.subject)==null?void 0:f.toLowerCase().includes(c.toLowerCase())),o=p==="all"||s.subject===p;return a&&o});return e.jsx(Ge,{children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8 animate-fade-in pb-20",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Le,{className:"h-8 w-8 text-primary"}),e.jsx("h1",{className:"text-4xl font-extrabold tracking-tight",children:"Global Library"})]}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Discover verified past papers, knowledge organizers, and flashcards."})]}),e.jsx("div",{className:"flex flex-col items-end gap-2",children:e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-500/10 border border-emerald-500/20 text-emerald-600",children:[e.jsx(ke,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-bold uppercase tracking-wider",children:"Trusted Sources Only"})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-muted-foreground group-focus-within:text-primary transition-colors",children:e.jsx(Pe,{className:"h-5 w-5"})}),e.jsx(K,{placeholder:"Search library...",value:c,onChange:s=>v(s.target.value),className:"pl-10 h-12 bg-background border-primary/10 rounded-xl shadow-sm"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[$==="papers"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(Q,{value:m,onValueChange:h,children:[e.jsx(W,{className:"w-[130px] h-10",children:e.jsx(J,{placeholder:"Year"})}),e.jsxs(X,{children:[e.jsx(A,{value:"all",children:"All Years"}),fe.map(s=>e.jsx(A,{value:s.toString(),children:s},s))]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(Q,{value:p,onValueChange:pe,children:[e.jsx(W,{className:"w-[160px] h-10",children:e.jsx(J,{placeholder:"Subject"})}),e.jsxs(X,{children:[e.jsx(A,{value:"all",children:"All Subjects"}),ge.map(s=>e.jsx(A,{value:s,children:s},s))]})]})]})]})]}),e.jsxs(Ke,{value:$,onValueChange:xe,className:"w-full",children:[e.jsxs(he,{className:"grid w-full grid-cols-3 mb-8 h-12 p-1 bg-muted/50 backdrop-blur-sm rounded-xl",children:[e.jsxs(L,{value:"papers",className:"rounded-lg font-bold text-base flex gap-2",children:[e.jsx(Re,{className:"h-4 w-4"})," Past Papers"]}),e.jsxs(L,{value:"organizers",className:"rounded-lg font-bold text-base flex gap-2",children:[e.jsx(U,{className:"h-4 w-4"})," Organisers"]}),e.jsxs(L,{value:"flashcards",className:"rounded-lg font-bold text-base flex gap-2",children:[e.jsx(ze,{className:"h-4 w-4"})," Flashcards"]})]}),e.jsx(k,{value:"papers",className:"space-y-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[q.map(s=>e.jsxs(C,{className:"hover:shadow-lg transition-all border-primary/5 group",children:[e.jsxs(S,{className:"p-4 pb-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(N,{variant:"outline",className:"bg-primary/5 text-primary border-primary/10",children:s.exam_board}),e.jsx(w,{size:"icon",variant:"ghost",onClick:()=>Ne(s),className:"h-8 w-8 text-primary hover:bg-primary/10",children:e.jsx(R,{className:"h-5 w-5"})})]}),e.jsx(_,{className:"text-base mt-2 line-clamp-2",children:s.title})]}),e.jsxs(T,{className:"p-4 pt-0 flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:[s.subject," â€¢ ",s.year]}),e.jsx("div",{className:"text-[10px] font-bold text-emerald-500 bg-emerald-500/10 px-2 py-0.5 rounded-full uppercase",children:"Verified"})]})]},s.id)),q.length===0&&e.jsx("div",{className:"col-span-full py-20 text-center text-muted-foreground",children:"No papers found matching your criteria."})]})}),e.jsx("div",{className:"md:col-span-1",children:e.jsx("div",{className:"sticky top-24",children:e.jsxs(C,{className:"border-primary/20 shadow-xl overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-primary"}),e.jsxs(S,{className:"bg-primary/5",children:[e.jsxs(_,{className:"flex items-center gap-2 text-primary",children:[e.jsx(Ee,{className:"h-5 w-5"})," Smart Link Importer"]}),e.jsx(H,{children:"Found a paper link on PMT or PapaCambridge? Paste it below and we'll auto-format it for you."})]}),e.jsxs(T,{className:"p-6 space-y-4",children:[e.jsx(K,{placeholder:"https://...",value:y,onChange:s=>G(s.target.value),className:"border-primary/10 focus:border-primary focus:ring-primary h-12"}),e.jsx(w,{className:"w-full h-12 font-bold gap-2 text-lg shadow-primary/20",onClick:ye,disabled:M||!y,children:M?"Working Magic...":"Add with Smart Parser"}),e.jsx("div",{className:"pt-4 border-t border-primary/5",children:e.jsxs("p",{className:"text-[10px] text-muted-foreground font-medium flex items-center gap-1",children:[e.jsx($e,{className:"h-3 w-3"})," Note: This uses URLs only. Scientia.ai does not host or redistribute any PDF files."]})})]})]})})})]})}),e.jsx(k,{value:"organizers",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[D.map(s=>{var a,o,b;return e.jsxs(C,{className:"hover:shadow-xl transition-all border-primary/5 group relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-3",children:e.jsx(w,{size:"icon",variant:"secondary",onClick:()=>we(s),className:"h-10 w-10 shadow-lg",children:e.jsx(R,{className:"h-6 w-6"})})}),e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(N,{className:"bg-primary/10 text-primary border-none",children:((a=s.content)==null?void 0:a.exam_board)||"General"}),e.jsx(N,{variant:"outline",className:"text-muted-foreground",children:s.subject})]}),e.jsx(_,{className:"text-xl group-hover:text-primary transition-colors",children:s.title}),e.jsx(H,{className:"line-clamp-2 mt-2",children:s.topic})]}),e.jsx(T,{children:e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-2",children:[e.jsx(U,{className:"h-3 w-3"}),((b=(o=s.content)==null?void 0:o.sections)==null?void 0:b.length)||0," Professional Sections"]})})]},s.id)}),D.length===0&&e.jsx("div",{className:"col-span-full py-20 text-center text-muted-foreground",children:"No organizers found matching your criteria."})]})}),e.jsx(k,{value:"flashcards",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[B.map(s=>e.jsxs(C,{className:"hover:shadow-xl transition-all border-primary/5 group relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-3",children:e.jsx(w,{size:"icon",variant:"secondary",onClick:()=>Ce(s),className:"h-10 w-10 shadow-lg",children:e.jsx(R,{className:"h-6 w-6"})})}),e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(N,{variant:"outline",className:"text-muted-foreground",children:s.subject}),e.jsx(N,{className:"bg-primary/10 text-primary border-none",children:s.topic})]}),e.jsx(_,{className:"text-lg group-hover:text-primary transition-colors line-clamp-2",children:s.front})]}),e.jsx(T,{children:e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3",children:s.back})})]},s.id)),B.length===0&&e.jsx("div",{className:"col-span-full py-20 text-center text-muted-foreground",children:"No flashcards found matching your criteria."})]})})]})]})})}export{us as default};
