import{j as e,M as be,N as re,X as Y,Q as je,V as ye,q as ve,Y as Ne,Z as Se,$ as ke,a0 as Ce,a1 as De,a2 as Ie,a3 as Te,a4 as Ee,a5 as ie,a6 as Me,L as oe,a7 as Re,a8 as Ae,a9 as ze}from"./ui-vendor-DvDVRjyp.js";import{B as R,c as q,A as Pe,b as _e,d as Le,e as Ue,f as He,g as Fe,h as Ve,i as Oe,j as de,u as ue,k as qe}from"./index-DEqmCALs.js";import{D as Be,a as We,b as Je,c as le}from"./dropdown-menu-CM08DgPQ.js";import{I as me}from"./input-CG8Ib3hH.js";import{r as t,h as $e,u as Ge}from"./react-vendor-Do86TxWo.js";import{A as Ye}from"./AppLayout-DSG6wxEf.js";import{L as Ke}from"./LimitReachedDialog-CC6bCfVB.js";import{S as Qe}from"./SimpleMarkdown-DbbLAUp0.js";import{S as Xe}from"./scroll-area-tuIny8oN.js";import{S as Ze,a as es,b as ss}from"./sheet-DlQTD0RE.js";import{g as ts,c as as}from"./ai-client-BhyPJ4fF.js";import"./supabase-vendor-C2nLxrxH.js";import"./query-vendor-Bk-KKE7Z.js";import"./index-Du_rhl89.js";import"./index-e3UtYKQr.js";import"./AnimatedLogoIcon-D6d7HWVb.js";import"./index-BdQq_4o_.js";function ce({sessions:n,currentSessionId:v,onSelectSession:H,onNewChat:w,onDeleteSession:h,onRenameSession:T,loading:i,onClose:a,isOpen:E=!0}){const[C,N]=t.useState(!1),[b,g]=t.useState(null),[x,p]=t.useState(""),[_,S]=t.useState(!1),[M,l]=t.useState(null),[r,c]=t.useState(()=>{try{const d=localStorage.getItem("hidden_chat_sessions");return d?JSON.parse(d):[]}catch{return[]}});t.useEffect(()=>{localStorage.setItem("hidden_chat_sessions",JSON.stringify(r))},[r]);const o=d=>{const f=new Date(d),A=new Date().getTime()-f.getTime(),z=Math.floor(A/(1e3*60)),I=Math.floor(A/(1e3*60*60)),U=Math.floor(A/(1e3*60*60*24));return z<1?"Just now":z<60?`${z}m ago`:I<24?`${I}h ago`:U===1?"Yesterday":U<7?`${U}d ago`:f.toLocaleDateString("en-US",{month:"short",day:"numeric"})},D=d=>{const f=new Date;f.setHours(0,0,0,0);const m=new Date(f);m.setDate(m.getDate()-1);const A=new Date(f);A.setDate(A.getDate()-7);const z=[{label:"Today",sessions:[]},{label:"Yesterday",sessions:[]},{label:"Previous 7 Days",sessions:[]},{label:"Older",sessions:[]}];return d.forEach(I=>{const U=new Date(I.updated_at);U.setHours(0,0,0,0),U.getTime()>=f.getTime()?z[0].sessions.push(I):U.getTime()>=m.getTime()?z[1].sessions.push(I):U.getTime()>=A.getTime()?z[2].sessions.push(I):z[3].sessions.push(I)}),z.filter(I=>I.sessions.length>0)},u=d=>{g(d.id),p(d.title)},k=async()=>{b&&x.trim()&&await T(b,x.trim()),g(null),p("")},F=()=>{g(null),p("")},K=d=>{l(d),S(!0)},B=async()=>{M&&await h(M),S(!1),l(null)},L=d=>{H(d),a&&window.innerWidth<1024&&a()},W=n.filter(d=>!r.includes(d.id)),$=D(W);return C?e.jsxs("div",{className:"w-12 h-full border-r border-border/50 bg-muted/30 flex flex-col items-center py-4 gap-2",children:[e.jsx(R,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>N(!1),children:e.jsx(be,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:w,children:e.jsx(re,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[E&&a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:a}),e.jsxs("div",{className:q("h-full border-r border-border/50 bg-background flex flex-col transition-transform duration-300","fixed inset-y-0 left-0 z-50 w-[280px] sm:w-[300px] md:w-80","lg:relative lg:z-auto lg:translate-x-0",!E&&"lg:hidden -translate-x-full",E&&"translate-x-0"),children:[e.jsxs("div",{className:"p-3 border-b border-border/50 flex items-center justify-between flex-shrink-0",children:[e.jsx("h3",{className:"text-sm font-medium text-foreground",children:"Chat History"}),e.jsxs(R,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:a||(()=>N(!0)),children:[e.jsx(Y,{className:"h-4 w-4 lg:hidden"}),e.jsx(je,{className:"h-4 w-4 hidden lg:block"})]})]}),e.jsx("div",{className:"p-3 flex-shrink-0",children:e.jsxs(R,{variant:"outline",className:"w-full justify-start gap-2",onClick:()=>{w(),a&&window.innerWidth<1024&&a()},children:[e.jsx(re,{className:"h-4 w-4"}),"New Chat"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:e.jsx("div",{className:"p-2 space-y-4 pb-4",children:i?e.jsx("div",{className:"text-center text-muted-foreground text-sm py-8",children:"Loading..."}):W.length===0?e.jsxs("div",{className:"text-center text-muted-foreground text-sm py-8 px-4",children:[e.jsx(ye,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No chat history yet"}),e.jsx("p",{className:"text-xs mt-1",children:"Start a new conversation!"})]}):$.map(d=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-muted-foreground px-2 mb-2 sticky top-0 bg-background/95 backdrop-blur-sm py-1",children:d.label}),e.jsx("div",{className:"space-y-1",children:d.sessions.map(f=>e.jsx("div",{className:q("group rounded-lg transition-colors mx-1",v===f.id?"bg-primary/10":"hover:bg-muted active:bg-muted"),children:b===f.id?e.jsxs("div",{className:"flex items-center gap-1 p-2",children:[e.jsx(me,{value:x,onChange:m=>p(m.target.value),className:"h-7 text-sm flex-1 min-w-0",autoFocus:!0,onKeyDown:m=>{m.key==="Enter"&&k(),m.key==="Escape"&&F()}}),e.jsx(R,{variant:"ghost",size:"icon",className:"h-7 w-7 shrink-0",onClick:k,children:e.jsx(ve,{className:"h-3 w-3"})}),e.jsx(R,{variant:"ghost",size:"icon",className:"h-7 w-7 shrink-0",onClick:F,children:e.jsx(Y,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"flex items-center gap-1 p-2",children:[e.jsxs("button",{className:"flex-1 text-left min-w-0",onClick:()=>L(f.id),children:[e.jsx("p",{className:"text-sm font-medium truncate text-foreground pr-1",children:f.title}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:o(f.updated_at)})]}),e.jsxs(Be,{children:[e.jsx(We,{asChild:!0,children:e.jsxs(R,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0 text-muted-foreground hover:text-foreground hover:bg-accent",onClick:m=>m.stopPropagation(),children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"More options"})]})}),e.jsxs(Je,{align:"end",className:"w-48",children:[e.jsxs(le,{onClick:m=>{m.stopPropagation(),u(f)},children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Rename"]}),e.jsxs(le,{onClick:m=>{m.stopPropagation(),K(f.id)},className:"text-destructive focus:text-destructive focus:bg-destructive/10",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})},f.id))})]},d.label))})})]}),e.jsx(Pe,{open:_,onOpenChange:S,children:e.jsxs(_e,{children:[e.jsxs(Le,{children:[e.jsx(Ue,{children:"Delete Chat?"}),e.jsx(He,{children:"Do you want to permanently delete this chat? This action cannot be undone."})]}),e.jsxs(Fe,{children:[e.jsx(Ve,{children:"Cancel"}),e.jsx(Oe,{onClick:B,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]})}function ns({isOpen:n,onClose:v,onSendMessage:H,isProcessing:w}){const{t:h,i18n:T}=de(),[i,a]=t.useState("idle"),[E,C]=t.useState(""),[N,b]=t.useState(null),g=t.useRef(null),x=t.useRef(window.speechSynthesis),[p,_]=t.useState([]);t.useEffect(()=>{if(!n)return;const r=window.SpeechRecognition||window.webkitSpeechRecognition;if(!r){b("Speech recognition is not supported in this browser.");return}const c=new r;return c.continuous=!1,c.interimResults=!0,c.lang=T.language||"en-US",c.onstart=()=>{a("listening"),b(null)},c.onresult=o=>{const D=o.resultIndex,u=o.results[D][0].transcript;C(u)},c.onerror=o=>{o.error==="no-speech"?a("idle"):o.error==="network"?(b("Network error: Browser blocked the connection. If you are using Brave, please switch to Chrome or Edge for voice features."),a("idle")):o.error==="not-allowed"||o.error==="service-not-allowed"?(b("Microphone access denied. Please allow microphone permissions in your browser."),a("idle")):(b("Error accessing microphone: "+o.error),a("idle"))},g.current=c,()=>{if(g.current)try{g.current.stop()}catch{}x.current&&x.current.cancel()}},[n,T.language]),t.useEffect(()=>{const r=()=>{const c=window.speechSynthesis.getVoices();_(c)};return r(),window.speechSynthesis.onvoiceschanged!==void 0&&(window.speechSynthesis.onvoiceschanged=r),()=>{window.speechSynthesis.onvoiceschanged=null}},[]);const S=()=>{if(g.current&&i!=="listening"&&i!=="speaking"&&i!=="processing")try{C(""),g.current.start()}catch{}},M=()=>{g.current&&g.current.stop()},l=r=>{if(!x.current)return;const c=r.replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").replace(/[*#_`]/g,"").replace(/\n+/g,". "),o=new SpeechSynthesisUtterance(c);if(o.onstart=()=>a("speaking"),o.onend=()=>{n&&(a("idle"),setTimeout(S,500))},o.onerror=()=>a("idle"),p.length>0){const D=p.find(u=>u.name.includes("Natural")&&u.lang.startsWith("en"))||p.find(u=>u.name.includes("Google US English"))||p.find(u=>u.name.includes("Samantha"))||p.find(u=>u.lang===(T.language||"en-US"))||p[0];D&&(o.voice=D)}a("speaking");try{x.current.speak(o)}catch{a("idle")}};return t.useEffect(()=>{g.current&&(g.current.onend=async()=>{if(E.trim().length>0&&i==="listening"){a("processing");try{const r=await H(E);l(r),C("")}catch{b("Failed to process message"),a("idle")}}else i==="listening"&&a("idle")})},[E,H,i,p]),t.useEffect(()=>{if(n&&i==="idle"&&!N){const r=setTimeout(()=>S(),500);return()=>clearTimeout(r)}},[n,i,N]),n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/95 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"relative w-full max-w-lg p-6 flex flex-col items-center justify-center space-y-8",children:[e.jsx(R,{variant:"ghost",size:"icon",className:"absolute top-0 right-4 rounded-full h-12 w-12 bg-muted/50 hover:bg-muted",onClick:()=>{M(),x.current.cancel(),v()},children:e.jsx(Y,{className:"h-6 w-6"})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("h2",{className:"text-2xl font-bold tracking-tight",children:[i==="listening"&&"Listening...",i==="processing"&&"Thinking...",i==="speaking"&&"Speaking...",i==="idle"&&"Tap to speak"]}),e.jsx("p",{className:"text-muted-foreground h-6 flex items-center justify-center px-4 text-center line-clamp-1",children:E||(i==="processing"?"Processing...":"")})]}),e.jsxs("div",{className:"relative h-64 w-64 flex items-center justify-center",children:[(i==="listening"||i==="speaking")&&e.jsx("div",{className:"absolute inset-0 rounded-full bg-primary/20 animate-ping opacity-75 duration-[3000ms]"}),(i==="listening"||i==="speaking")&&e.jsx("div",{className:"absolute inset-4 rounded-full bg-primary/20 animate-ping opacity-50 duration-[2000ms] delay-75"}),e.jsx("div",{className:q("relative z-10 w-32 h-32 rounded-full flex items-center justify-center transition-all duration-300 shadow-xl cursor-pointer hover:scale-105",i==="listening"?"bg-red-500 shadow-red-500/20":i==="speaking"?"bg-green-500 shadow-green-500/20":i==="processing"?"bg-yellow-500 animate-pulse":"bg-primary shadow-primary/20"),onClick:()=>{i==="speaking"?(x.current.cancel(),a("idle")):i==="listening"?M():S()},children:i==="listening"?e.jsx(Ce,{className:"h-12 w-12 text-white"}):i==="speaking"?e.jsx(De,{className:"h-12 w-12 text-white animate-pulse"}):e.jsx(Ie,{className:"h-12 w-12 text-white"})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground text-center max-w-xs",children:[i==="idle"&&"Tap the microphone to start handling the conversation",i==="listening"&&"I'm listening to your voice...",i==="speaking"&&"Tap to interrupt"]}),N&&e.jsx("div",{className:"bg-destructive/10 text-destructive text-sm px-4 py-2 rounded-lg",children:N})]})}):null}function rs(){const{supabase:n,user:v}=ue(),[H,w]=t.useState([]),[h,T]=t.useState(null),[i,a]=t.useState(!0),[E,C]=t.useState(null),N=t.useCallback(async()=>{if(!v||!n){w([]),a(!1);return}try{a(!0);const{data:l,error:r}=await n.from("ai_chat_sessions").select("*").eq("user_id",v.id).order("updated_at",{ascending:!1});if(r)throw r;w(l||[]),C(null)}catch(l){C(l.message)}finally{a(!1)}},[v,n]);t.useEffect(()=>{N()},[N]);const b=t.useCallback(async(l,r,c="chat")=>{if(!v||!n)return null;try{const o=l?[l]:[],D=l?l.content.slice(0,50)+(l.content.length>50?"...":""):"New Chat",{data:u,error:k}=await n.from("ai_chat_sessions").insert({user_id:v.id,title:D,messages:o,context:r||null,mode:c}).select().single();if(k)throw k;return w(F=>[u,...F]),T(u),u}catch(o){return C(o.message),null}},[v,n]),g=t.useCallback(async l=>{if(n)try{const{data:r,error:c}=await n.from("ai_chat_sessions").select("*").eq("id",l).single();if(c)throw c;T(r)}catch(r){C(r.message)}},[n]),x=t.useCallback(async(l,r)=>{if(n)try{const{data:c,error:o}=await n.from("ai_chat_sessions").update(r).eq("id",l).select().single();if(o)throw o;w(D=>D.map(u=>u.id===l?c:u)),(h==null?void 0:h.id)===l&&T(c)}catch(c){C(c.message)}},[n,h]),p=t.useCallback(async l=>{if(n)try{const{error:r}=await n.from("ai_chat_sessions").delete().eq("id",l);if(r)throw r;w(c=>c.filter(o=>o.id!==l)),(h==null?void 0:h.id)===l&&T(null)}catch(r){C(r.message)}},[n,h]),_=t.useCallback(async(l,r)=>{await x(l,{title:r})},[x]),S=t.useCallback(()=>{T(null)},[]),M=t.useCallback(async()=>{await N()},[N]);return{sessions:H,currentSession:h,loading:i,error:E,createSession:b,loadSession:g,updateSession:x,deleteSession:p,renameSession:_,clearCurrentSession:S,refreshSessions:M}}const Z=n=>({id:n.id,role:n.role,content:n.content,timestamp:n.timestamp.toISOString(),image:n.image}),is=n=>({id:n.id,role:n.role,content:n.content,timestamp:new Date(n.timestamp),image:n.image}),ee={id:"1",role:"assistant",content:`Hello! I'm your AI assistant. How can I help you today?

I can assist you with:

• Explaining concepts and topics
• Answering your questions
• Helping with homework and assignments
• Providing study tips and guidance
• Having conversations about any subject

Feel free to ask me anything!`,timestamp:new Date};function Ss(){const{supabase:n}=ue(),{toast:v}=qe(),[H,w]=$e(),{t:h,i18n:T}=de(),{sessions:i,currentSession:a,loading:E,createSession:C,loadSession:N,updateSession:b,deleteSession:g,renameSession:x,clearCurrentSession:p}=rs(),[_,S]=t.useState([ee]),[M,l]=t.useState(""),[r,c]=t.useState(!1),o=t.useRef(null),[D,u]=t.useState(!1),[k,F]=t.useState(null),[K,B]=t.useState(null),L=t.useRef(null),W=t.useRef(!1),[$,d]=t.useState(null),[f,m]=t.useState(!1),[A,z]=t.useState(!1),[I,U]=t.useState(null);Ge();const he=async()=>{if(!n)return;const s=await ts(n);s.data&&U(s.data)};t.useEffect(()=>{n&&he()},[n]),t.useEffect(()=>{const s=H.get("session");s&&(!a||a.id!==s)&&N(s)},[H,a,N]),t.useEffect(()=>{if(a){if(a.id!==$){const s=a.messages.map(is);S(s.length>0?s:[ee]),d(a.id),w({session:a.id},{replace:!0})}}else d(null)},[a,$,w]),t.useEffect(()=>{o.current&&o.current.scrollIntoView({behavior:"smooth"})},[_]);const ge=t.useCallback(async s=>{a&&await b(a.id,{messages:s.map(Z)})},[a,b]),se=t.useCallback(()=>{p(),S([ee]),W.current=!1,w({},{replace:!0})},[p,w]),te=t.useCallback(s=>{w({session:s})},[w]),fe=t.useCallback(s=>s.slice(-10).map(j=>({role:j.role,content:j.content})),[]),ae=async(s,j)=>{var G;const O={id:Date.now().toString(),role:"user",content:s,timestamp:new Date,image:j},J=[..._,O];S(J),c(!0);try{const y=fe(_),P=await as({message:s,history:y,language:T.language,image:j},n);if(P.error)throw new Error(P.error);const V=((G=P.data)==null?void 0:G.reply)||"I couldn't generate a response. Please try again.",we={id:(Date.now()+1).toString(),role:"assistant",content:V,timestamp:new Date},Q=[...J,we];if(S(Q),!a&&!W.current){W.current=!0;const X=await C(Z(O),void 0,"chat");X&&(d(X.id),await b(X.id,{messages:Q.map(Z),title:s.slice(0,50)+(s.length>50?"...":"")}))}else a&&await ge(Q);return V}catch(y){let P="Failed to get response. Please try again.";if(typeof y=="string")P=y;else if(y instanceof Error)try{const V=JSON.parse(y.message);V.error&&(P=V.error)}catch{P=y.message}else typeof y=="object"&&y!==null&&(P=y.message||y.error||JSON.stringify(y));return P.includes("limit")||y.status===429?(z(!0),c(!1),"Usage limit reached."):(P==="[object Object]"&&(P="An unexpected error occurred."),v({title:"Error",description:P,variant:"destructive"}),S(V=>[...V,{id:(Date.now()+1).toString(),role:"assistant",content:"I'm sorry, I encountered an error. Please try again.",timestamp:new Date}]),"I'm sorry, I encountered an error.")}finally{c(!1)}},xe=s=>{var J;const j=(J=s.target.files)==null?void 0:J[0];if(!j)return;if(!j.type.startsWith("image/")){v({title:"Invalid file",description:"Please upload an image file (PNG, JPG, GIF, etc.)",variant:"destructive"});return}if(j.size>4*1024*1024){v({title:"File too large",description:"Please upload an image smaller than 4MB",variant:"destructive"});return}const O=new FileReader;O.onload=G=>{var y;F((y=G.target)==null?void 0:y.result),B(j.name),v({title:"Image uploaded",description:"You can add a message or just send the image to analyze."})},O.readAsDataURL(j)},pe=()=>{F(null),B(null),L.current&&(L.current.value="")},ne=async()=>{if(!M.trim()&&!k||r)return;let s=M;const j=k||void 0;k&&!s.trim()&&(s="Analyzing image..."),l(""),F(null),B(null),L.current&&(L.current.value=""),await ae(s,j)};return e.jsxs(Ye,{fullWidth:!0,children:[e.jsx(Ke,{open:A,onOpenChange:z}),e.jsxs("div",{className:"flex h-[calc(100vh-3.5rem)] md:h-screen overflow-hidden bg-background pb-20 md:pb-0",children:[e.jsx("div",{className:"hidden lg:flex shrink-0",children:e.jsx(ce,{sessions:i,currentSessionId:(a==null?void 0:a.id)||null,onSelectSession:te,onNewChat:se,onDeleteSession:g,onRenameSession:x,loading:E})}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 h-full relative",children:[e.jsx("div",{className:"h-14 border-b border-border/40 flex items-center justify-between px-4 bg-background/80 backdrop-blur-sm z-10 shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Ze,{open:f,onOpenChange:m,children:[e.jsx(es,{asChild:!0,children:e.jsx(R,{variant:"ghost",size:"icon",className:"lg:hidden",children:e.jsx(Te,{className:"h-5 w-5"})})}),e.jsx(ss,{side:"left",className:"p-0 w-64 [&>button]:hidden",children:e.jsx(ce,{sessions:i,currentSessionId:(a==null?void 0:a.id)||null,onSelectSession:s=>{te(s),m(!1)},onNewChat:()=>{se(),m(!1)},onDeleteSession:g,onRenameSession:x,loading:E,onClose:()=>m(!1)})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"font-semibold text-lg",children:h("nav.aiTutor")}),I&&!I.isPremium&&e.jsx("div",{className:"ml-4 flex items-center px-3 py-1 bg-indigo-100 dark:bg-indigo-900/30 rounded-full border border-indigo-200 dark:border-indigo-800",children:e.jsxs("span",{className:"text-xs font-medium text-indigo-700 dark:text-indigo-300",children:[I.remaining," free uses left"]})})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden relative flex flex-col",children:e.jsx(Xe,{className:"flex-1",children:e.jsxs("div",{className:"w-full max-w-3xl mx-auto px-4 py-6 space-y-6",children:[_.map(s=>e.jsxs("div",{className:q("flex gap-4 group",s.role==="user"?"justify-end":"justify-start"),children:[s.role==="assistant"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-1",children:e.jsx(ie,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:q("max-w-[85%] sm:max-w-[75%]",s.role==="user"?"ml-auto":"mr-auto"),children:[s.role==="user"&&e.jsx("div",{className:"invisible group-hover:visible transition-opacity text-[10px] text-muted-foreground mb-1 text-right",children:h("aiTutor.you")}),s.role==="assistant"&&e.jsx("div",{className:"invisible group-hover:visible transition-opacity text-[10px] text-muted-foreground mb-1",children:h("aiTutor.aiName")}),e.jsx("div",{className:q("rounded-2xl px-5 py-3 text-sm shadow-sm",s.role==="user"?"bg-primary text-primary-foreground rounded-br-sm":"bg-muted/50 text-foreground border border-border/40 rounded-bl-sm"),children:s.role==="assistant"?e.jsx(Qe,{content:s.content}):e.jsxs(e.Fragment,{children:[s.image&&e.jsx("img",{src:s.image,alt:"Uploaded",className:"max-w-full max-h-[200px] rounded-lg object-contain mb-2"}),s.content!=="Analyzing image..."&&e.jsx("p",{className:"whitespace-pre-wrap break-words leading-relaxed",children:s.content})]})}),e.jsx("div",{className:"text-[10px] opacity-40 mt-1 px-1",children:s.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),s.role==="user"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-1",children:e.jsx(Me,{className:"h-4 w-4 text-primary"})})]},s.id)),r&&!D&&e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(ie,{className:"h-4 w-4 text-primary"})}),e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"bg-muted/50 rounded-2xl rounded-bl-sm p-4 w-32 flex items-center justify-center",children:e.jsx(oe,{className:"h-4 w-4 animate-spin text-muted-foreground"})})})]}),e.jsx("div",{ref:o,className:"h-4"})]})})}),e.jsx("div",{className:"p-4 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-t border-border/40",children:e.jsxs("div",{className:"w-full max-w-3xl mx-auto",children:[k&&e.jsxs("div",{className:"relative mb-2 rounded-lg border border-primary/30 p-2 bg-primary/5 inline-block",children:[e.jsx("img",{src:k,alt:"Uploaded",className:"max-h-[100px] rounded object-contain"}),e.jsx(R,{variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-5 w-5 rounded-full",onClick:pe,children:e.jsx(Y,{className:"h-3 w-3"})}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1 text-center truncate max-w-[150px]",children:K})]}),e.jsx("input",{type:"file",ref:L,accept:"image/*",onChange:xe,className:"hidden"}),e.jsxs("div",{className:"relative flex items-end gap-2 bg-muted/30 p-2 rounded-xl border border-border/40 focus-within:ring-2 focus-within:ring-primary/20 focus-within:border-primary/50 transition-all shadow-sm",children:[e.jsx(me,{value:M,onChange:s=>l(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),ne())},placeholder:k?"Ask something about the image...":A?"Usage limit reached":h("aiTutor.askAnything"),disabled:r||A,className:"border-0 focus-visible:ring-0 bg-transparent min-h-[44px] py-3 px-2 shadow-none resize-none"}),e.jsx(R,{variant:"ghost",size:"icon",className:"h-9 w-9 mb-1 shrink-0 rounded-lg text-muted-foreground hover:bg-muted/80 hover:text-foreground",onClick:()=>{var s;return(s=L.current)==null?void 0:s.click()},title:"Upload Image",children:e.jsx(Re,{className:"h-5 w-5"})}),e.jsx(R,{variant:"ghost",size:"icon",className:"h-9 w-9 mb-1 shrink-0 rounded-lg text-muted-foreground hover:bg-muted/80 hover:text-foreground",onClick:()=>u(!0),title:"Voice Mode",children:e.jsx(Ae,{className:"h-5 w-5"})}),e.jsx(R,{onClick:ne,disabled:r||!M.trim()&&!k||A,size:"icon",className:q("h-9 w-9 mb-1 shrink-0 rounded-lg transition-all",M.trim()||k?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:r?e.jsx(oe,{className:"h-4 w-4 animate-spin"}):e.jsx(ze,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-[10px] text-center text-muted-foreground mt-2",children:h("aiTutor.disclaimer")})]})})]}),e.jsx(ns,{isOpen:D,onClose:()=>u(!1),onSendMessage:async s=>{const j=k||void 0,O=await ae(s,j);return j&&(F(null),B(null),L.current&&(L.current.value="")),O},isProcessing:r})]})]})}export{Ss as default};
