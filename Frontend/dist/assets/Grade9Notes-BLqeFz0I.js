import{j as e,L as A,aw as N,b9 as se,z,Q as U,am as ae,ak as M,a4 as w,H as re,av as oe,aE as le}from"./ui-vendor-DvDVRjyp.js";import{h as ne,A as v}from"./AppLayout-DSG6wxEf.js";import{S as ie}from"./SimpleMarkdown-DbbLAUp0.js";import{B as $}from"./badge-BcqXIc_g.js";import{u as ce,k as de,B as m,c as p}from"./index-DEqmCALs.js";import{C as E,d as P}from"./card-C99jCs8O.js";import{D as me,b as xe,c as ue,d as he,e as pe,f as ge}from"./dialog-CeMj4lUC.js";import{I as fe}from"./input-CG8Ib3hH.js";import{L as je}from"./label-lvNOnDGI.js";import{S as be,a as Ne,b as we,c as ve,d as H}from"./select-9ZKIQjAc.js";import{T as ye}from"./textarea-F7PLQ3VZ.js";import{b as Se}from"./ai-client-BhyPJ4fF.js";import{u as Ce,r as l}from"./react-vendor-Do86TxWo.js";import"./AnimatedLogoIcon-D6d7HWVb.js";import"./sheet-DlQTD0RE.js";import"./supabase-vendor-C2nLxrxH.js";import"./query-vendor-Bk-KKE7Z.js";import"./index-BdQq_4o_.js";import"./index-Du_rhl89.js";function qe(){const{supabase:n,user:i}=ce(),{toast:x}=de(),y=Ce(),[S,L]=l.useState([]),[Q,I]=l.useState(!0),[C,W]=l.useState(!1),[q,D]=l.useState(!0),[g,R]=l.useState(""),[c,K]=l.useState("All Subjects"),[a,G]=l.useState(null),[V,f]=l.useState(!1),[h,_]=l.useState(""),[T,B]=l.useState(!1),Y=async()=>{var t;if(!(!h.trim()||!i)){if(!n){x({title:"Error",description:"Database connection not available. Please refresh the page.",variant:"destructive"});return}B(!0);try{const s=await Se({prompt:h,subject:c==="All Subjects"?"General":c,topic:h.substring(0,50)},n);if(s.error)throw new Error(s.error);if(s.data){const r=s.data.sections.map(b=>`## ${b.title}

${b.content}`).join(`

`),d=s.data.topic||((t=s.data.sections[0])==null?void 0:t.title)||"AI Generated Note",k=s.data.subject||(c==="All Subjects"?"General":c),u=["AI Generated","Grade 9 Premium","Knowledge Organizer"],{data:o,error:F}=await n.from("notes").insert({user_id:i.id,title:d,content:r,subject:k,topic:s.data.topic||"AI Generated",tags:u}).select().single();F&&x({title:"Save Warning",description:`Note generated but save failed: ${F.message}`,variant:"destructive"});const O={id:(o==null?void 0:o.id)||`ai-${Date.now()}`,title:d,content:r,subject:k,topic:s.data.topic||"AI Generated",grade_level:"9",tags:u,created_at:(o==null?void 0:o.created_at)||new Date().toISOString()};L(b=>[O,...b]),G(O),f(!1),_(""),x({title:"Note Generated & Saved",description:o?"Your AI note has been created and saved to your notes.":"Your AI note has been created (save to database failed)."})}}catch(s){x({title:"Generation Failed",description:s.message||"Failed to generate note.",variant:"destructive"})}finally{B(!1)}}},J=Array.from(new Set(S.map(t=>t.subject).filter(Boolean)));l.useEffect(()=>{i?X():D(!1)},[i]),l.useEffect(()=>{C&&Z()},[C]);const X=async()=>{if(!(!i||!n))try{const t=await ne(n);W(t)}catch{}finally{D(!1)}},Z=async()=>{if(!(!n||!i))try{I(!0);const{data:t,error:s}=await n.from("global_premium_notes").select("*").eq("grade_level","9").order("created_at",{ascending:!1}),{data:r,error:d}=await n.from("notes").select("*").eq("user_id",i.id).contains("tags",["Grade 9 Premium"]).order("created_at",{ascending:!1}),u=[...(r||[]).map(o=>({id:o.id,title:o.title,content:o.content,subject:o.subject||"General",topic:o.topic||"AI Generated",grade_level:"9",tags:o.tags||[],created_at:o.created_at})),...t||[]];L(u),u.length>0&&!a&&G(u[0])}catch{x({title:"Error",description:"Failed to load premium notes. Please try again.",variant:"destructive"})}finally{I(!1)}},ee=t=>{const s=document.createElement("a"),r=new Blob([t.content],{type:"text/markdown"});s.href=URL.createObjectURL(r),s.download=`${t.title.replace(/\s+/g,"_")}.md`,document.body.appendChild(s),s.click(),document.body.removeChild(s),x({title:"Exported",description:"Note downloaded as Markdown file"})},te=S.filter(t=>{var d;const s=c==="All Subjects"||t.subject===c,r=t.title.toLowerCase().includes(g.toLowerCase())||t.content.toLowerCase().includes(g.toLowerCase())||((d=t.topic)==null?void 0:d.toLowerCase().includes(g.toLowerCase()));return s&&r}).reduce((t,s)=>{const r=s.subject||"General";return t[r]||(t[r]=[]),t[r].push(s),t},{}),j=t=>({Mathematics:{bg:"bg-blue-500/10",text:"text-blue-500"},"English Literature":{bg:"bg-yellow-500/10",text:"text-yellow-500"},Biology:{bg:"bg-green-500/10",text:"text-green-500"},Chemistry:{bg:"bg-purple-500/10",text:"text-purple-500"},Physics:{bg:"bg-red-500/10",text:"text-red-500"},History:{bg:"bg-amber-500/10",text:"text-amber-500"},Geography:{bg:"bg-cyan-500/10",text:"text-cyan-500"}})[t]||{bg:"bg-gray-500/10",text:"text-gray-500"};return q?e.jsx(v,{children:e.jsx("div",{className:"max-w-6xl mx-auto flex items-center justify-center h-[60vh]",children:e.jsx(A,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):C?Q?e.jsx(v,{children:e.jsx("div",{className:"max-w-6xl mx-auto flex items-center justify-center h-[60vh]",children:e.jsx(A,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsxs(v,{children:[e.jsxs("div",{className:"max-w-6xl mx-auto animate-fade-in pb-12",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-r from-yellow-500/20 to-amber-500/20",children:e.jsx(N,{className:"w-8 h-8 text-yellow-500"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Grade 9 Premium Notes"}),e.jsxs($,{className:"bg-gradient-to-r from-yellow-500 to-amber-600 text-white border-0",children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),"Premium"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Exclusive study materials for top marks"})]})]}),e.jsxs(m,{onClick:()=>f(!0),className:"bg-gradient-to-r from-purple-500 to-blue-600 hover:from-purple-600 hover:to-blue-700 text-white",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"AI Note Generator"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(fe,{placeholder:"Search notes...",value:g,onChange:t=>R(t.target.value),className:"pl-9"})]}),e.jsxs(be,{value:c,onValueChange:K,children:[e.jsxs(Ne,{className:"w-full sm:w-[200px]",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),e.jsx(we,{})]}),e.jsxs(ve,{children:[e.jsx(H,{value:"All Subjects",children:"All Subjects"}),J.map(t=>e.jsx(H,{value:t,children:t},t))]})]})]}),S.length===0?e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(N,{className:"h-16 w-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No notes available yet"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Grade 9 premium notes are coming soon. Check back later for exclusive content!"}),e.jsxs(m,{variant:"outline",onClick:()=>y("/notes"),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Go to My Notes"]})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 space-y-4",children:Object.entries(te).map(([t,s])=>e.jsxs(E,{className:"overflow-hidden",children:[e.jsx("div",{className:p("p-3 border-b",j(t).bg),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:p("h-4 w-4",j(t).text)}),e.jsx("h3",{className:"font-semibold text-sm",children:t}),e.jsx($,{variant:"secondary",className:"ml-auto text-xs",children:s.length})]})}),e.jsx(P,{className:"p-2",children:s.map(r=>e.jsxs("button",{onClick:()=>G(r),className:p("w-full text-left p-3 rounded-lg transition-all group",(a==null?void 0:a.id)===r.id?"bg-primary/10 border border-primary/30":"hover:bg-muted/50"),children:[e.jsx("p",{className:p("font-medium text-sm truncate",(a==null?void 0:a.id)===r.id?"text-primary":"text-foreground"),children:r.title}),r.topic&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:r.topic})]},r.id))})]},t))}),e.jsx("div",{className:"lg:col-span-2",children:a?e.jsx(E,{className:"sticky top-4",children:e.jsxs(P,{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.subject&&e.jsx("span",{className:p("text-xs font-medium px-2 py-1 rounded-full",j(a.subject).bg,j(a.subject).text),children:a.subject}),a.topic&&e.jsx("span",{className:"text-xs text-muted-foreground px-2 py-1 rounded-md bg-muted",children:a.topic})]}),e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-foreground",children:a.title})]}),e.jsx(m,{variant:"outline",size:"icon",onClick:()=>ee(a),title:"Export as Markdown",children:e.jsx(le,{className:"h-4 w-4"})})]}),a.tags&&a.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:a.tags.map((t,s)=>e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full bg-muted text-muted-foreground border",children:["#",t]},s))}),e.jsx("div",{className:"prose prose-sm max-w-none prose-headings:font-bold prose-h1:text-2xl prose-h2:text-xl prose-a:text-primary dark:prose-invert max-h-[60vh] overflow-y-auto pr-2 scroll-smooth",style:{scrollbarWidth:"thin",scrollbarGutter:"stable"},children:e.jsx(ie,{content:a.content})})]})}):e.jsx(E,{children:e.jsxs(P,{className:"p-12 text-center",children:[e.jsx(N,{className:"h-16 w-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Select a note"}),e.jsx("p",{className:"text-muted-foreground",children:"Choose a note from the list to view its content"})]})})})]})]}),e.jsx(me,{open:V,onOpenChange:f,children:e.jsxs(xe,{className:"sm:max-w-[500px]",children:[e.jsxs(ue,{children:[e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5 text-purple-500"}),"AI Note Generator"]}),e.jsx(pe,{children:"Enter a topic or specific question below, and our AI will generate a comprehensive study note for you."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{htmlFor:"prompt",children:"Topic or Question"}),e.jsx(ye,{id:"prompt",placeholder:"E.g., 'Explain the causes of World War I' or 'How does photosynthesis work?'...",className:"min-h-[150px]",value:h,onChange:t=>_(t.target.value)})]})}),e.jsxs(ge,{children:[e.jsx(m,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(m,{onClick:Y,disabled:!h.trim()||T,className:"bg-gradient-to-r from-purple-500 to-blue-600 text-white",children:T?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"mr-2 h-4 w-4"}),"Generate Note"]})})]})]})})]}):e.jsx(v,{children:e.jsx("div",{className:"max-w-4xl mx-auto animate-fade-in",children:e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsxs("div",{className:"relative inline-block mb-6",children:[e.jsx(N,{className:"h-20 w-20 text-muted-foreground/50"}),e.jsx("div",{className:"absolute -top-2 -right-2 p-2 rounded-full bg-gradient-to-r from-yellow-500 to-amber-600",children:e.jsx(se,{className:"h-5 w-5 text-white"})})]}),e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-4",children:"Grade 9 Premium Notes"}),e.jsx("p",{className:"text-muted-foreground mb-8 max-w-md mx-auto",children:"Unlock exclusive Grade 9 study notes and materials designed to help you achieve top marks. These premium notes are curated by expert educators."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs(m,{size:"lg",className:"bg-gradient-to-r from-yellow-500 to-amber-600 hover:from-yellow-600 hover:to-amber-700 text-white",onClick:()=>y("/premium-dashboard"),children:[e.jsx(z,{className:"h-5 w-5 mr-2"}),"Upgrade to Premium"]}),e.jsxs(m,{variant:"outline",size:"lg",onClick:()=>y(-1),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Go Back"]})]}),e.jsxs("div",{className:"mt-12 grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"p-4 rounded-xl bg-muted/50",children:[e.jsx(ae,{className:"h-8 w-8 text-yellow-500 mx-auto mb-3"}),e.jsx("h3",{className:"font-semibold text-foreground mb-1",children:"Top Grade Content"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Notes designed for Grade 9 achievement"})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-muted/50",children:[e.jsx(M,{className:"h-8 w-8 text-blue-500 mx-auto mb-3"}),e.jsx("h3",{className:"font-semibold text-foreground mb-1",children:"All Subjects"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Comprehensive coverage across subjects"})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-muted/50",children:[e.jsx(w,{className:"h-8 w-8 text-purple-500 mx-auto mb-3"}),e.jsx("h3",{className:"font-semibold text-foreground mb-1",children:"Expert Curated"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Created by experienced educators"})]})]})]})})})}export{qe as default};
