import{u as L,d as K,j as e,b as Q,P as Y,f as X,x as Z,aC as J,ba as ee,S as M,bb as ae,L as R,bc as se,C as B,al as te,aW as re,W as ie}from"./ui-vendor-BkbvuH_y.js";import{A as le,a as ne,b as oe,c as ce}from"./AppLayout-CN79_BfK.js";import{B as _}from"./button-EqlKTezP.js";import{I as P}from"./input-BZEgG1eO.js";import{L as S}from"./label-Bxm2S76w.js";import{u as de,S as me,a as ue,b as pe,c as he,d as D}from"./select-BfIDHEDX.js";import{r as c}from"./react-vendor-CW_qxVlV.js";import{h as fe,c as U,u as xe,d as ge,b as ve}from"./index-DN2StWe2.js";import"./sheet-YK_0sUrL.js";import"./index-BdQq_4o_.js";import"./index-Ca2jQLVk.js";import"./supabase-vendor-DI52Tw1b.js";import"./query-vendor-B5gxQqnu.js";var I="Switch",[je]=Q(I),[ye,be]=je(I),$=c.forwardRef((r,s)=>{const{__scopeSwitch:l,name:x,checked:h,defaultChecked:d,required:m,disabled:g,value:j="on",onCheckedChange:C,form:u,...v}=r,[a,o]=c.useState(null),y=L(s,N=>o(N)),k=c.useRef(!1),A=a?u||!!a.closest("form"):!0,[b,E]=K({prop:h,defaultProp:d??!1,onChange:C,caller:I});return e.jsxs(ye,{scope:l,checked:b,disabled:g,children:[e.jsx(Y.button,{type:"button",role:"switch","aria-checked":b,"aria-required":m,"data-state":G(b),"data-disabled":g?"":void 0,disabled:g,value:j,...v,ref:y,onClick:X(r.onClick,N=>{E(F=>!F),A&&(k.current=N.isPropagationStopped(),k.current||N.stopPropagation())})}),A&&e.jsx(W,{control:a,bubbles:!k.current,name:x,value:j,checked:b,required:m,disabled:g,form:u,style:{transform:"translateX(-100%)"}})]})});$.displayName=I;var z="SwitchThumb",q=c.forwardRef((r,s)=>{const{__scopeSwitch:l,...x}=r,h=be(z,l);return e.jsx(Y.span,{"data-state":G(h.checked),"data-disabled":h.disabled?"":void 0,...x,ref:s})});q.displayName=z;var Ne="SwitchBubbleInput",W=c.forwardRef(({__scopeSwitch:r,control:s,checked:l,bubbles:x=!0,...h},d)=>{const m=c.useRef(null),g=L(m,d),j=de(l),C=fe(s);return c.useEffect(()=>{const u=m.current;if(!u)return;const v=window.HTMLInputElement.prototype,o=Object.getOwnPropertyDescriptor(v,"checked").set;if(j!==l&&o){const y=new Event("click",{bubbles:x});o.call(u,l),u.dispatchEvent(y)}},[j,l,x]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:l,...h,tabIndex:-1,ref:g,style:{...h.style,...C,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});W.displayName=Ne;function G(r){return r?"checked":"unchecked"}var H=$,we=q;const O=c.forwardRef(({className:r,...s},l)=>e.jsx(H,{className:U("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",r),...s,ref:l,children:e.jsx(we,{className:U("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));O.displayName=H.displayName;const _e=[{icon:Z,label:"Profile",id:"profile"},{icon:J,label:"Notifications",id:"notifications"},{icon:ee,label:"Appearance",id:"appearance"},{icon:M,label:"Privacy",id:"privacy"},{icon:ae,label:"Subscription",id:"subscription"}];function Le(){var F;const{supabase:r,user:s}=xe(),{theme:l,toggleTheme:x,setTheme:h}=ge(),{toast:d}=ve(),[m,g]=c.useState("profile"),[j,C]=c.useState(!0),[u,v]=c.useState(!1),[a,o]=c.useState({full_name:"",email:"",first_name:"",last_name:"",school:"",year_group:"",subjects:"",avatar_url:"",is_premium:!1}),[y,k]=c.useState({studyReminders:!0,progressUpdates:!0,newContentAlerts:!1,achievementNotifications:!0});c.useEffect(()=>{if(!s)return;(async()=>{var n,f;try{const{data:i,error:p}=await r.from("profiles").select("*").eq("id",s.id).single();if(p&&p.code,i){const w=((n=i.full_name)==null?void 0:n.split(" "))||[],T=w[0]||"",V=w.slice(1).join(" ")||"";o({full_name:i.full_name||"",email:i.email||s.email||"",first_name:T,last_name:V,school:i.school||"",year_group:i.year_group||"",subjects:i.subjects||"",avatar_url:i.avatar_url||"",is_premium:i.is_premium||!1})}else o({full_name:((f=s.email)==null?void 0:f.split("@")[0])||"",email:s.email||"",first_name:"",last_name:"",school:"",year_group:"",subjects:"",avatar_url:"",is_premium:!1})}catch{}finally{C(!1)}})()},[s,r]);const A=async t=>{var i;const n=(i=t.target.files)==null?void 0:i[0];if(!n)return;if(!n.type.startsWith("image/")){d({title:"Invalid file type",description:"Please upload an image file.",variant:"destructive"});return}if(n.size>2*1024*1024){d({title:"File too large",description:"Please upload an image smaller than 2MB.",variant:"destructive"});return}const f=new FileReader;f.onloadend=async()=>{const p=f.result;if(o({...a,avatar_url:p}),s)try{const{error:w}=await r.from("profiles").upsert({id:s.id,avatar_url:p},{onConflict:"id"});if(w)throw w;const T=`avatar_url_${s.id}`;localStorage.setItem(T,p),window.dispatchEvent(new CustomEvent("avatarUpdated",{detail:{avatarUrl:p}})),window.dispatchEvent(new StorageEvent("storage",{key:T,newValue:p,storageArea:localStorage})),d({title:"Avatar updated",description:"Your profile picture has been updated."})}catch{d({title:"Error",description:"Failed to save avatar. Please try again.",variant:"destructive"})}},f.onerror=()=>{d({title:"Error",description:"Failed to read image file.",variant:"destructive"})},f.readAsDataURL(n)},b=async()=>{var t;if(s){v(!0);try{const n=a.first_name&&a.last_name?`${a.first_name} ${a.last_name}`:a.first_name||a.last_name||a.full_name||"";if(a.email&&a.email!==s.email){const{error:p}=await r.auth.updateUser({email:a.email});if(p)throw p}const f={id:s.id,email:a.email||s.email,full_name:n,avatar_url:a.avatar_url||null,school:a.school||null,year_group:a.year_group||null,subjects:a.subjects||null},{error:i}=await r.from("profiles").upsert(f,{onConflict:"id"});if(i)throw(t=i.message)!=null&&t.includes("column")||i.code==="42703"?new Error("School, year group, and subjects fields are not available. Please run the database migration (add_profile_fields.sql) first."):i;d({title:"Profile updated",description:a.email!==s.email?"Your profile has been updated. Please check your email to verify the new address.":"Your profile information has been saved successfully."})}catch(n){d({title:"Error",description:n.message||"Failed to save profile. Please try again.",variant:"destructive"})}finally{v(!1)}}},E=a.first_name&&a.last_name?`${a.first_name} ${a.last_name}`:a.full_name||((F=a.email)==null?void 0:F.split("@")[0])||"User",N=a.first_name&&a.last_name?`${a.first_name[0]}${a.last_name[0]}`:E.substring(0,2).toUpperCase();return e.jsx(le,{children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground",children:"Settings"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"md:col-span-1",children:e.jsx("nav",{className:"space-y-1 animate-slide-up",style:{animationDelay:"0.1s",opacity:0},children:_e.map(t=>e.jsxs("button",{onClick:()=>g(t.id),className:U("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors",m===t.id?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-muted"),children:[e.jsx(t.icon,{className:"h-4 w-4"}),t.label]},t.id))})}),e.jsx("div",{className:"md:col-span-3 space-y-6",children:j?e.jsx("div",{className:"glass-card p-6 flex items-center justify-center",children:e.jsx(R,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):e.jsxs(e.Fragment,{children:[m==="profile"&&e.jsxs("div",{className:"glass-card p-6 animate-slide-up",style:{animationDelay:"0.2s",opacity:0},children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-6",children:"Profile Information"}),e.jsxs("div",{className:"flex items-center gap-6 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(ne,{className:"h-20 w-20 border-4 border-primary/20",children:[e.jsx(oe,{src:a.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${s==null?void 0:s.email}`}),e.jsx(ce,{children:N})]}),e.jsxs("label",{className:"absolute bottom-0 right-0 p-1.5 rounded-full bg-primary text-primary-foreground shadow-lg hover:bg-primary/90 transition-colors cursor-pointer",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx("input",{type:"file",accept:"image/*",onChange:A,className:"hidden"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground",children:E}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.email||(s==null?void 0:s.email)}),e.jsx("div",{className:"flex items-center gap-1 mt-1",children:a.is_premium?e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gradient-to-r from-yellow-400 to-yellow-600 text-white font-medium flex items-center gap-1",children:[e.jsx(B,{className:"w-3 h-3"})," Premium User"]}):e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-primary/10 text-primary",children:"Free Plan"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"firstName",children:"First Name"}),e.jsx(P,{id:"firstName",value:a.first_name,onChange:t=>o({...a,first_name:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"lastName",children:"Last Name"}),e.jsx(P,{id:"lastName",value:a.last_name,onChange:t=>o({...a,last_name:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"email",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(P,{id:"email",type:"email",value:a.email,onChange:t=>o({...a,email:t.target.value}),className:"pl-9"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"To change your email, update it here and save. You'll need to verify the new email address."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"school",children:"School / Institution"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(P,{id:"school",value:a.school,onChange:t=>o({...a,school:t.target.value}),className:"pl-9"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"year",children:"Year Group"}),e.jsxs(me,{value:a.year_group,onValueChange:t=>o({...a,year_group:t}),children:[e.jsx(ue,{children:e.jsx(pe,{placeholder:"Select year group"})}),e.jsxs(he,{children:[e.jsx(D,{value:"10",children:"Year 10"}),e.jsx(D,{value:"11",children:"Year 11"}),e.jsx(D,{value:"12",children:"Year 12"}),e.jsx(D,{value:"13",children:"Year 13"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"subjects",children:"Subjects (comma separated)"}),e.jsx(P,{id:"subjects",value:a.subjects,onChange:t=>o({...a,subjects:t.target.value}),placeholder:"Biology, Chemistry, Physics, Maths"})]})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx(_,{onClick:b,disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Changes"})})]}),m==="notifications"&&e.jsxs("div",{className:"glass-card p-6 animate-slide-up",style:{animationDelay:"0.3s",opacity:0},children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-6",children:"Notifications"}),e.jsx("div",{className:"space-y-4",children:[{key:"studyReminders",label:"Study reminders",description:"Get daily reminders to study"},{key:"progressUpdates",label:"Progress updates",description:"Weekly summary of your progress"},{key:"newContentAlerts",label:"New content alerts",description:"When new papers or notes are added"},{key:"achievementNotifications",label:"Achievement notifications",description:"Celebrate your milestones"}].map(t=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:t.label}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description})]}),e.jsx(O,{checked:y[t.key],onCheckedChange:n=>k({...y,[t.key]:n})})]},t.key))})]}),m==="appearance"&&e.jsxs("div",{className:"glass-card p-6 animate-slide-up",style:{animationDelay:"0.3s",opacity:0},children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-6",children:"Appearance"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Theme"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose between light and dark mode"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{variant:l==="light"?"default":"outline",size:"sm",onClick:()=>h("light"),children:"Light"}),e.jsx(_,{variant:l==="dark"?"default":"outline",size:"sm",onClick:()=>h("dark"),children:"Dark"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Quick Toggle"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Toggle between light and dark mode"})]}),e.jsx(_,{variant:"outline",size:"sm",onClick:x,className:"gap-2",children:l==="light"?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"ðŸŒ™"})," Switch to Dark"]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â˜€ï¸"})," Switch to Light"]})})]})]})]}),m==="privacy"&&e.jsxs("div",{className:"glass-card p-6 animate-slide-up",style:{animationDelay:"0.3s",opacity:0},children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-6",children:"Privacy & Account"}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"p-4 rounded-xl bg-destructive/10 border border-destructive/20",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-2",children:"Danger Zone"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Permanently delete your account and all associated data. This action cannot be undone."}),e.jsx(_,{variant:"destructive",onClick:async()=>{if(confirm("Are you sure you want to delete your account? This action cannot be undone and all your data will be permanently deleted.")&&confirm("This is your last chance. Are you absolutely sure?")){v(!0);try{const t=["notes","flashcards","past_papers","knowledge_organizers","extracurriculars"];for(const n of t)await r.from(n).delete().eq("user_id",s==null?void 0:s.id);await r.from("profiles").delete().eq("id",s==null?void 0:s.id),await r.auth.signOut(),d({title:"Account Deletion Initiated",description:"Your local data has been deleted. Please contact support to complete account deletion, or your account will be automatically cleaned up."}),window.location.href="/landing"}catch(t){d({title:"Error",description:t.message||"Failed to delete account. Please contact support.",variant:"destructive"})}finally{v(!1)}}},disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Delete Account"]})})]})})]}),m==="subscription"&&e.jsxs("div",{className:"glass-card p-6 animate-slide-up",style:{animationDelay:"0.4s",opacity:0},children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-6",children:"Subscription"}),e.jsx("div",{className:"p-4 rounded-xl bg-muted/50 border border-border mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:a.is_premium?"Premium Plan":"Free Plan"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.is_premium?"You have full access to all premium features.":"Basic access to study materials"})]}),!a.is_premium&&e.jsxs(_,{className:"bg-premium hover:bg-premium/90 text-premium-foreground",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Upgrade to Premium"]}),a.is_premium&&e.jsxs("div",{className:"flex items-center text-green-500 font-medium",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Active"]})]})}),!a.is_premium&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Unlock AI-powered features, advanced analytics, and ad-free studying with Premium."})]})]})})]})]})})}export{Le as default};
