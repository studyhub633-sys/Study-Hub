import{j as e,L as W,H as P,v as E,p as et,a2 as tt,A as st,ai as at,aj as rt,a8 as q,af as it,ak as we,al as nt,ad as lt,X as be}from"./ui-vendor-C99L-hD9.js";import{A as Ne}from"./AppLayout-BFdv2Mth.js";import{B as ot}from"./badge-C_rvkMXd.js";import{B as d}from"./button-CTbG2CuD.js";import{R as ct,C as dt,a as mt}from"./index-CmAeJYAH.js";import{D as Se,b as Ce,c as ke,d as Pe,e as ze,f as Ae}from"./dialog-CgZzBsHu.js";import{I as S}from"./input-Cw2xi0UF.js";import{L as f}from"./label-BjmZLFhB.js";import{S as z,a as A,b as T,c as O,d as p}from"./select-BUwiLVXY.js";import{T as Te}from"./textarea-Bi7Y5FIW.js";import{u as ut,b as ht,c as b}from"./index-Bze4zWta.js";import{d as xt}from"./ai-client-D_3hX6eY.js";import{E as Oe}from"./constants-DeIw5BhA.js";import{h as gt}from"./premium-eVfGSoKP.js";import{u as pt,i as jt,r as c}from"./react-vendor-CW_qxVlV.js";import"./sheet-HbvxctKK.js";import"./index-BdQq_4o_.js";import"./index-ORJz1BqE.js";import"./supabase-vendor-BFJX04bJ.js";import"./query-vendor-CVP6rs-5.js";const ft=ct,yt=dt,vt=mt;function Mt(){var ye;const{supabase:w,user:h}=ut(),{toast:m}=ht(),B=pt(),X=jt(),[H,V]=c.useState([]),[_e,Z]=c.useState(!0),[Y,I]=c.useState(""),[L,ee]=c.useState("All Subjects"),[R,te]=c.useState("All Boards"),[_,se]=c.useState("All Tiers"),[i,N]=c.useState(null),[ae,D]=c.useState([]),[De,C]=c.useState(!1),[F,re]=c.useState(null),[o,g]=c.useState({title:"",subject:"",topic:"",exam_board:"",tier:"",sections:[]}),[ie,ne]=c.useState(null),[Fe,$]=c.useState(!1),[M,le]=c.useState(""),[U,oe]=c.useState(""),[G,ce]=c.useState(""),[k,de]=c.useState(!1),[u,me]=c.useState(null),[y,Ke]=c.useState(10),[Ee,Be]=c.useState(!1);c.useEffect(()=>{h&&(J(),ue())},[h]);const ue=async()=>{if(!(!h||!w))try{const t=new Date(Date.now()-864e5).toISOString(),{count:s,error:a}=await w.from("ai_usage_tracking").select("*",{count:"exact",head:!0}).eq("user_id",h.id).gt("created_at",t);if(a)return;const r=await gt(w),n=r?1e6:10;me(s||0),Ke(n),Be(r)}catch{}};c.useEffect(()=>{var t;(t=X.state)!=null&&t.context},[X.state,i]);const he=t=>{var r;const s=((r=t.content)==null?void 0:r.sections)||[];if(s.length===0)return 0;const a=s.filter(n=>n.reviewed).length;return Math.round(a/s.length*100)},J=async()=>{var t;if(h)try{Z(!0);const{data:s,error:a}=await w.from("knowledge_organizers").select("*").eq("user_id",h.id).order("updated_at",{ascending:!1});if(a)throw a;if(V(s||[]),s&&s.length>0&&!i){N(s[0]);const r=s[0];(t=r.content)!=null&&t.sections&&r.content.sections.length>0&&D([r.content.sections[0].title])}}catch{m({title:"Error",description:"Failed to load knowledge organizers. Please try again.",variant:"destructive"})}finally{Z(!1)}},xe=()=>{re(null),g({title:"",subject:"",topic:"",exam_board:"",tier:"",sections:[]}),C(!0)},Le=async()=>{var t;if(!h||!M.trim()){m({title:"Error",description:"Please enter a prompt to generate a knowledge organizer",variant:"destructive"});return}if(u!==null&&u>=y){m({title:"Limit Reached",description:"You have reached the daily limit of AI generation attempts. Please upgrade to premium for higher limits (500/day).",variant:"destructive"});return}de(!0);try{const s=await xt({prompt:M,subject:U||void 0,topic:G||void 0},w);if(s.error){if(s.error.includes("limit")||s.error.includes("429"))m({title:"Limit Reached",description:s.error,variant:"destructive"}),ue();else throw new Error(s.error);return}(t=s.data)!=null&&t.sections&&(g({title:G||U||"AI Generated Organizer",subject:U||"",topic:G||"",exam_board:"",tier:"",sections:s.data.sections}),$(!1),C(!0),le(""),oe(""),ce(""),s.data.usageCount!==void 0&&me(s.data.usageCount),m({title:"Success",description:`Generated ${s.data.sections.length} sections! Review and edit before saving.`}))}catch(s){m({title:"Error",description:s.message||"Failed to generate knowledge organizer. Please try again.",variant:"destructive"})}finally{de(!1)}},Re=t=>{var r,n;re(t);const a=(((r=t.content)==null?void 0:r.sections)||[]).map(l=>{var x;return{...l,keyPoints:((x=l.keyPoints)==null?void 0:x.map(v=>typeof v=="string"?{text:v,mastered:!1}:v))||[]}});g({title:t.title,subject:t.subject||"",topic:t.topic||"",exam_board:((n=t.content)==null?void 0:n.exam_board)||"",tier:t.tier||"",sections:a}),C(!0)},ge=()=>{g({...o,sections:[...o.sections,{title:"",content:"",keyPoints:[],color:"primary"}]})},$e=t=>{g({...o,sections:o.sections.filter((s,a)=>a!==t)})},Q=(t,s,a)=>{const r=[...o.sections];r[t]={...r[t],[s]:a},g({...o,sections:r})},Me=t=>{const s=[...o.sections],r=(s[t].keyPoints||[]).map(n=>typeof n=="string"?{text:n,mastered:!1}:n);r.push({text:"",mastered:!1}),s[t].keyPoints=r,g({...o,sections:s})},Ue=(t,s)=>{const a=[...o.sections];a[t].keyPoints=a[t].keyPoints.filter((r,n)=>n!==s),g({...o,sections:a})},Ge=(t,s,a)=>{const r=[...o.sections],l=(r[t].keyPoints||[]).map(x=>typeof x=="string"?{text:x,mastered:!1}:x);l[s]={...l[s],text:a},r[t].keyPoints=l,g({...o,sections:r})},qe=(t,s)=>{const a=[...o.sections],n=(a[t].keyPoints||[]).map(l=>typeof l=="string"?{text:l,mastered:!1}:l);n[s]={...n[s],mastered:!n[s].mastered,lastReviewed:n[s].mastered?n[s].lastReviewed:new Date().toISOString()},a[t].keyPoints=n,g({...o,sections:a})},He=async()=>{if(!h||!o.title.trim()){m({title:"Error",description:"Title is required",variant:"destructive"});return}if(!o.tier){m({title:"Error",description:"Please select a Tier (Foundation or Higher)",variant:"destructive"});return}const t=o.sections.filter(s=>s.title.trim()&&s.content.trim());try{const s={sections:t,exam_board:o.exam_board},a={user_id:h.id,title:o.title,subject:o.subject||null,topic:o.topic||null,tier:o.tier||null,content:s};if(F){const{error:r}=await w.from("knowledge_organizers").update(a).eq("id",F.id).eq("user_id",h.id);if(r)throw r;m({title:"Success",description:"Knowledge organizer updated successfully"})}else{const{error:r}=await w.from("knowledge_organizers").insert(a);if(r)throw r;m({title:"Success",description:"Knowledge organizer created successfully"})}C(!1),J()}catch(s){m({title:"Error",description:s.message||"Failed to save knowledge organizer. Please try again.",variant:"destructive"})}},Ve=async t=>{var s;if(!(!i||!h))try{ne(t);const a=[...((s=i.content)==null?void 0:s.sections)||[]];a[t]&&(a[t].reviewed=!0,a[t].lastReviewedAt=new Date().toISOString());const{error:r}=await w.from("knowledge_organizers").update({content:{sections:a}}).eq("id",i.id).eq("user_id",h.id);if(r)throw r;const{error:n}=await w.from("study_sessions").insert({user_id:h.id,organizer_id:i.id,duration:0,sections_reviewed:[t],date:new Date().toISOString()}),l={...i,content:{...i.content,sections:a}};N(l),V(x=>x.map(v=>v.id===i.id?l:v)),m({title:"Section Reviewed",description:`"${a[t].title}" marked as reviewed`})}catch(a){m({title:"Error",description:a.message||"Failed to mark section as reviewed. Please try again.",variant:"destructive"})}finally{ne(null)}},Ye=async(t,s)=>{var a;if(!(!i||!h))try{const r=[...((a=i.content)==null?void 0:a.sections)||[]],n=r[t];if(!n||!n.keyPoints)return;const l=n.keyPoints.map(K=>typeof K=="string"?{text:K,mastered:!1}:K);l[s]={...l[s],mastered:!l[s].mastered,lastReviewed:l[s].mastered?l[s].lastReviewed:new Date().toISOString()},r[t]={...n,keyPoints:l};const{error:x}=await w.from("knowledge_organizers").update({content:{sections:r}}).eq("id",i.id).eq("user_id",h.id);if(x)throw x;const v={...i,content:{...i.content,sections:r}};N(v),V(K=>K.map(ve=>ve.id===i.id?v:ve))}catch(r){m({title:"Error",description:r.message||"Failed to update key point. Please try again.",variant:"destructive"})}},Je=async t=>{if(h&&confirm("Are you sure you want to delete this knowledge organizer?"))try{const{error:s}=await w.from("knowledge_organizers").delete().eq("id",t).eq("user_id",h.id);if(s)throw s;m({title:"Success",description:"Knowledge organizer deleted successfully"}),(i==null?void 0:i.id)===t&&N(null),J()}catch{m({title:"Error",description:"Failed to delete knowledge organizer. Please try again.",variant:"destructive"})}},Qe=t=>{const s=JSON.stringify(t.content,null,2),a=new Blob([s],{type:"application/json"}),r=URL.createObjectURL(a),n=document.createElement("a");n.href=r,n.download=`${t.title.replace(/\s+/g,"_")}.json`,n.click(),URL.revokeObjectURL(r),m({title:"Downloaded",description:"Knowledge organizer downloaded as JSON"})},We=()=>{var s,a;if(!i)return;const t=((a=(s=i.content)==null?void 0:s.sections)==null?void 0:a.map(r=>`${r.title}: ${r.content}`).join(`

`))||"";B("/ai-tutor",{state:{context:t,mode:"question",organizerTitle:i.title}})},Xe=async()=>{var t,s;if(!(!i||!h))try{const a=((s=(t=i.content)==null?void 0:t.sections)==null?void 0:s.map(r=>{var n;return`${r.title}: ${r.content}
Key Points: ${((n=r.keyPoints)==null?void 0:n.map(l=>typeof l=="string"?l:l.text).join(", "))||""}`}).join(`

`))||"";if(!a.trim()){m({title:"No content",description:"This organizer doesn't have any content to create flashcards from.",variant:"destructive"});return}B("/flashcards",{state:{organizerContent:a,subject:i.subject||"General",topic:i.topic}})}catch{m({title:"Error",description:"Failed to proceed to flashcards.",variant:"destructive"})}},j=H.filter(t=>{var x,v;const s=t.title.toLowerCase().includes(Y.toLowerCase()),a=L==="All Subjects"||t.subject===L,r=(x=t.content)==null?void 0:x.exam_board,n=R==="All Boards"||r===R,l=_==="All Tiers"||_==="Unassigned"&&!t.tier||((v=t.tier)==null?void 0:v.toLowerCase())===_.toLowerCase();return s&&a&&n&&l});c.useEffect(()=>{var t,s,a,r;i&&j.length>0?j.some(l=>l.id===i.id)||(N(j[0]),((s=(t=j[0].content)==null?void 0:t.sections)==null?void 0:s.length)>0&&D([j[0].content.sections[0].title])):i&&j.length===0?N(null):!i&&j.length>0&&(N(j[0]),((r=(a=j[0].content)==null?void 0:a.sections)==null?void 0:r.length)>0&&D([j[0].content.sections[0].title]))},[Y,L,R,_,j.length]);const Ze=t=>{D(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},pe=t=>{const s=new Date(t),r=Math.floor((new Date().getTime()-s.getTime())/1e3);return r<60?"Just now":r<3600?`${Math.floor(r/60)} minutes ago`:r<86400?`${Math.floor(r/3600)} hours ago`:r<604800?`${Math.floor(r/86400)} days ago`:s.toLocaleDateString()},Ie=Array.from(new Set(H.map(t=>t.subject).filter(Boolean))),je=((ye=i==null?void 0:i.content)==null?void 0:ye.sections)||[],fe=i?he(i):0;return _e?e.jsx(Ne,{children:e.jsx("div",{className:"max-w-6xl mx-auto flex items-center justify-center h-[60vh]",children:e.jsx(W,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsxs(Ne,{children:[e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground",children:"Knowledge Organizers"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Visual summaries to consolidate your learning"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-2 w-full md:w-auto",children:[e.jsxs(d,{variant:"outline",onClick:()=>$(!0),className:"whitespace-nowrap",children:[e.jsx(P,{className:"h-4 w-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"whitespace-nowrap",children:"Generate with AI"}),u!==null&&e.jsx("span",{className:"ml-2 text-xs opacity-70 whitespace-nowrap",children:Ee?"(∞)":`(${y-u})`})]}),e.jsxs(d,{onClick:xe,children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Create Organizer"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 animate-slide-up",style:{animationDelay:"0.1s",opacity:0},children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(et,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(S,{placeholder:"Search organizers...",value:Y,onChange:t=>I(t.target.value),className:"pl-9"})]}),e.jsxs(z,{value:L,onValueChange:ee,children:[e.jsx(A,{className:"w-full sm:w-[180px]",children:e.jsx(T,{})}),e.jsxs(O,{children:[e.jsx(p,{value:"All Subjects",children:"All Subjects"}),Ie.map(t=>e.jsx(p,{value:t,children:t},t))]})]}),e.jsxs(z,{value:R,onValueChange:te,children:[e.jsx(A,{className:"w-full sm:w-[150px]",children:e.jsx(T,{})}),e.jsxs(O,{children:[e.jsx(p,{value:"All Boards",children:"All Boards"}),Oe.map(t=>e.jsx(p,{value:t,children:t},t))]})]}),e.jsxs(z,{value:_,onValueChange:se,children:[e.jsx(A,{className:"w-full sm:w-[150px]",children:e.jsx(T,{})}),e.jsxs(O,{children:[e.jsx(p,{value:"All Tiers",children:"All Tiers"}),e.jsx(p,{value:"Higher",children:"Higher Tier"}),e.jsx(p,{value:"Foundation",children:"Foundation Tier"}),e.jsx(p,{value:"Unassigned",children:"Unassigned"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 space-y-3 animate-slide-up",style:{animationDelay:"0.2s",opacity:0},children:H.length===0?e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(P,{className:"h-12 w-12 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No organisers yet"}),e.jsxs("p",{className:"text-muted-foreground mb-4",children:["Create your first knowledge organiser, generate one with AI, or add from the"," ",e.jsx("button",{type:"button",onClick:()=>B("/library"),className:"text-primary hover:underline font-medium",children:"Global Library"})," ","(Organisers tab)."]}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsxs(d,{onClick:xe,children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Create Organiser"]}),e.jsx(d,{variant:"outline",onClick:()=>B("/library"),children:"Browse Global Library"})]})]}):j.length===0?e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(P,{className:"h-12 w-12 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No organizers found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Try adjusting your filters or create a new organizer"}),e.jsx(d,{variant:"outline",onClick:()=>{ee("All Subjects"),te("All Boards"),se("All Tiers"),I("")},children:"Clear Filters"})]}):j.map(t=>{const s=he(t);return e.jsx("button",{onClick:()=>{var a;N(t),(a=t.content)!=null&&a.sections&&t.content.sections.length>0&&D([t.content.sections[0].title])},className:b("w-full text-left p-4 rounded-xl transition-all duration-200",(i==null?void 0:i.id)===t.id?"glass-card border-primary/30 shadow-glow":"bg-muted/50 hover:bg-muted"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 flex-shrink-0",children:e.jsx(P,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-foreground truncate",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.subject||"General"," • ",t.topic||"General",t.tier&&e.jsx(ot,{variant:"secondary",className:b("text-[10px] h-4 px-1 ml-1",t.tier==="Higher"?"text-red-500 bg-red-500/10":"text-green-500 bg-green-500/10"),children:t.tier})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full transition-all duration-500",style:{width:`${s}%`}})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s,"%"]})]})]})]})},t.id)})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx("div",{className:"lg:sticky lg:top-24 animate-slide-up",style:{animationDelay:"0.3s",opacity:0},children:i?e.jsxs("div",{className:"glass-card p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.subject&&e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-primary/10 text-primary",children:i.subject}),i.topic&&e.jsx("span",{className:"text-xs text-muted-foreground",children:i.topic})]}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-foreground",children:i.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("div",{className:"flex-1 max-w-[200px]",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[fe,"%"]})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full transition-all duration-500",style:{width:`${fe}%`}})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Last updated ",pe(i.updated_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"outline",size:"icon",onClick:()=>Re(i),children:e.jsx(tt,{className:"h-4 w-4"})}),e.jsx(d,{variant:"outline",size:"icon",onClick:()=>Je(i.id),children:e.jsx(st,{className:"h-4 w-4 text-destructive"})}),e.jsx(d,{variant:"outline",size:"icon",onClick:()=>Qe(i),children:e.jsx(at,{className:"h-4 w-4"})})]})]}),je.length>0?e.jsx("div",{className:"space-y-4",children:je.map((t,s)=>e.jsxs(ft,{open:ae.includes(t.title),onOpenChange:()=>Ze(t.title),children:[e.jsx(yt,{className:"w-full",children:e.jsxs("div",{className:b("flex items-center justify-between p-4 rounded-xl transition-all duration-200",t.color==="primary"&&"bg-primary/10 hover:bg-primary/15",t.color==="secondary"&&"bg-secondary/10 hover:bg-secondary/15",t.color==="accent"&&"bg-accent/20 hover:bg-accent/25"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:b("w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold",t.color==="primary"&&"bg-primary text-primary-foreground",t.color==="secondary"&&"bg-secondary text-secondary-foreground",t.color==="accent"&&"bg-accent text-accent-foreground"),children:s+1}),e.jsx("span",{className:"font-semibold text-foreground",children:t.title})]}),e.jsx(rt,{className:b("h-5 w-5 text-muted-foreground transition-transform duration-200",ae.includes(t.title)&&"rotate-180")})]})}),e.jsx(vt,{children:e.jsxs("div",{className:"p-4 pt-2 ml-11 space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsx("p",{className:"text-foreground whitespace-pre-wrap flex-1",children:t.content}),!t.reviewed&&e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>Ve(s),disabled:ie===s,className:"flex-shrink-0",children:[ie===s?e.jsx(W,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(q,{className:"h-4 w-4 mr-2"}),"Mark as Reviewed"]}),t.reviewed&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground flex-shrink-0",children:[e.jsx(q,{className:"h-4 w-4 text-primary"}),e.jsx("span",{children:"Reviewed"}),t.lastReviewedAt&&e.jsx("span",{className:"text-xs",children:pe(t.lastReviewedAt)})]})]}),t.keyPoints&&t.keyPoints.length>0&&e.jsxs("div",{className:b("p-4 rounded-lg",t.color==="primary"&&"bg-primary/5 border border-primary/20",t.color==="secondary"&&"bg-secondary/5 border border-secondary/20",t.color==="accent"&&"bg-accent/10 border border-accent/20"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(it,{className:b("h-4 w-4",t.color==="primary"&&"text-primary",t.color==="secondary"&&"text-secondary",t.color==="accent"&&"text-accent-foreground")}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:"Key Points"})]}),e.jsx("ul",{className:"space-y-2",children:t.keyPoints.map((a,r)=>{const n=typeof a=="string"?a:a.text,l=typeof a=="object"?a.mastered:!1;return e.jsxs("li",{className:"flex items-start gap-2 text-sm text-foreground group",children:[e.jsx("button",{onClick:()=>Ye(s,r),className:b("h-4 w-4 mt-0.5 flex-shrink-0 transition-colors cursor-pointer",l?t.color==="primary"&&"text-primary"||t.color==="secondary"&&"text-secondary"||t.color==="accent"&&"text-accent-foreground"||"text-primary":"text-muted-foreground hover:text-foreground"),title:l?"Mark as not mastered":"Mark as mastered",children:l?e.jsx(q,{className:"h-4 w-4"}):e.jsx(we,{className:"h-4 w-4"})}),e.jsx("span",{className:b("flex-1",l&&"line-through opacity-60"),children:n})]},r)})})]})]})})]},t.title))}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{children:"No sections yet. Edit this organizer to add sections."})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 mt-6 pt-6 border-t border-border",children:[e.jsxs(d,{className:"w-full md:flex-1",onClick:We,children:[e.jsx(nt,{className:"h-4 w-4 mr-2"}),"Test Your Knowledge"]}),e.jsxs(d,{variant:"outline",className:"w-full md:flex-1",onClick:Xe,children:[e.jsx(lt,{className:"h-4 w-4 mr-2"}),"Create Flashcards"]})]})]}):e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(P,{className:"h-16 w-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Select an organizer"}),e.jsx("p",{className:"text-muted-foreground",children:"Choose a knowledge organizer to view its contents"})]})})})]})]}),e.jsx(Se,{open:De,onOpenChange:C,children:e.jsxs(Ce,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ke,{children:[e.jsx(Pe,{children:F?"Edit Knowledge Organizer":"Create New Knowledge Organizer"}),e.jsx(ze,{children:F?"Update your knowledge organizer below":"Create a visual summary of your study material"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"title",children:"Title *"}),e.jsx(S,{id:"title",value:o.title,onChange:t=>g({...o,title:t.target.value}),placeholder:"e.g., Cell Biology Overview"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"subject",children:"Subject"}),e.jsx(S,{id:"subject",value:o.subject,onChange:t=>g({...o,subject:t.target.value}),placeholder:"e.g., Biology"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"topic",children:"Topic"}),e.jsx(S,{id:"topic",value:o.topic,onChange:t=>g({...o,topic:t.target.value}),placeholder:"e.g., Cell Biology"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"exam_board",children:"Exam Board"}),e.jsxs(z,{value:o.exam_board,onValueChange:t=>g({...o,exam_board:t}),children:[e.jsx(A,{id:"exam_board",children:e.jsx(T,{placeholder:"Select board"})}),e.jsx(O,{children:Oe.map(t=>e.jsx(p,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"tier",children:"Tier"}),e.jsxs(z,{value:o.tier,onValueChange:t=>g({...o,tier:t}),children:[e.jsx(A,{id:"tier",children:e.jsx(T,{placeholder:"Select Tier"})}),e.jsxs(O,{children:[e.jsx(p,{value:"Higher",children:"Higher Tier"}),e.jsx(p,{value:"Foundation",children:"Foundation Tier"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{children:"Sections"}),e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:ge,children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Add Section"]})]}),o.sections.map((t,s)=>e.jsxs("div",{className:"p-4 border rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-semibold",children:["Section ",s+1]}),e.jsx(d,{type:"button",variant:"ghost",size:"icon",onClick:()=>$e(s),children:e.jsx(be,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Section Title *"}),e.jsx(S,{value:t.title,onChange:a=>Q(s,"title",a.target.value),placeholder:"e.g., Cell Structure"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Content *"}),e.jsx(Te,{value:t.content,onChange:a=>Q(s,"content",a.target.value),placeholder:"Describe this section...",className:"min-h-[100px]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Color"}),e.jsxs(z,{value:t.color,onValueChange:a=>Q(s,"color",a),children:[e.jsx(A,{children:e.jsx(T,{})}),e.jsxs(O,{children:[e.jsx(p,{value:"primary",children:"Primary (Blue)"}),e.jsx(p,{value:"secondary",children:"Secondary (Purple)"}),e.jsx(p,{value:"accent",children:"Accent (Orange)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{children:"Key Points"}),e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:()=>Me(s),children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Add Point"]})]}),t.keyPoints.map((a,r)=>{const n=typeof a=="string"?a:a.text,l=typeof a=="object"?a.mastered:!1;return e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(S,{value:n,onChange:x=>Ge(s,r,x.target.value),placeholder:"Enter key point...",className:b(l&&"line-through opacity-60")}),e.jsx(d,{type:"button",variant:l?"default":"outline",size:"icon",onClick:()=>qe(s,r),title:l?"Mark as not mastered":"Mark as mastered",children:l?e.jsx(q,{className:"h-4 w-4"}):e.jsx(we,{className:"h-4 w-4"})}),e.jsx(d,{type:"button",variant:"ghost",size:"icon",onClick:()=>Ue(s,r),children:e.jsx(be,{className:"h-4 w-4"})})]},r)})]})]},s)),o.sections.length===0&&e.jsxs("div",{className:"text-center py-8 border border-dashed rounded-lg",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"No sections yet"}),e.jsxs(d,{type:"button",variant:"outline",onClick:ge,children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Add Your First Section"]})]})]})]}),e.jsxs(Ae,{children:[e.jsx(d,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsxs(d,{onClick:He,children:[F?"Update":"Create"," Organizer"]})]})]})}),e.jsx(Se,{open:Fe,onOpenChange:$,children:e.jsxs(Ce,{className:"max-w-2xl",children:[e.jsxs(ke,{children:[e.jsx(Pe,{children:"Generate Knowledge Organizer with AI"}),e.jsxs(ze,{children:["Describe what you want to learn, and AI will create a structured knowledge organizer with sections and key points.",u!==null&&e.jsx("span",{className:"block mt-2 text-sm font-medium",children:u!==null&&u>=y?e.jsx("span",{className:"text-destructive",children:"You've reached the daily limit."}):e.jsx("span",{children:y>1e3?"You have Unlimited generation attempts.":`You have ${u!==null?y-u:"..."} generation attempts remaining today.`})})]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"ai-prompt",children:"What would you like to learn? *"}),e.jsx(Te,{id:"ai-prompt",value:M,onChange:t=>le(t.target.value),placeholder:"e.g., Cell biology including organelles, their functions, and how they work together",className:"min-h-[100px]",disabled:k||u!==null&&u>=y})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"ai-subject",children:"Subject (optional)"}),e.jsx(S,{id:"ai-subject",value:U,onChange:t=>oe(t.target.value),placeholder:"e.g., Biology",disabled:k||u!==null&&u>=y})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"ai-topic",children:"Topic (optional)"}),e.jsx(S,{id:"ai-topic",value:G,onChange:t=>ce(t.target.value),placeholder:"e.g., Cell Biology",disabled:k||u!==null&&u>=y})]})]}),u!==null&&u>=y&&e.jsx("div",{className:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-destructive font-medium",children:["You've reached the daily limit of ",y," AI generation attempts. ",y<=10?"Please upgrade to premium for higher limits.":"Please try again tomorrow."]})})]}),e.jsxs(Ae,{children:[e.jsx(d,{variant:"outline",onClick:()=>$(!1),disabled:k,children:"Cancel"}),e.jsx(d,{onClick:Le,disabled:k||!M.trim()||u!==null&&u>=y,children:k?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Generate"]})})]})]})})]})}export{Mt as default};
