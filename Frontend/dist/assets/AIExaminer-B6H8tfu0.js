import{j as e,L as E,b6 as I,$ as H,N as J,a9 as U,b7 as V,aC as K}from"./ui-vendor-BhfTkEdL.js";import{h as W,A}from"./AppLayout-DyYlXr0M.js";import{u as X,k as Z,B as j}from"./index-BWIqSF27.js";import{C as o,a as g,b,c as N,d as x}from"./card-af-OxtCo.js";import{I as d}from"./input-BIlMOJxd.js";import{L as l}from"./label-aiGua7-D.js";import{T}from"./textarea-D4LyRJDD.js";import{r as i}from"./react-vendor-Do86TxWo.js";import"./AnimatedLogoIcon-BNgjqHPG.js";import"./sheet-ByTzbT0g.js";import"./supabase-vendor-CklQTOeK.js";import"./query-vendor-C5_dwEAA.js";function xe(){var P;const{supabase:u,user:m}=X(),{toast:f}=Z(),[_,q]=i.useState(!1),[C,S]=i.useState(!1),[h,B]=i.useState(""),[v,L]=i.useState("Mathematics"),[y,Y]=i.useState("AQA"),[k,D]=i.useState(2024),[n,w]=i.useState([{questionNumber:"1",studentAnswer:"",maxMarks:5}]),[c,F]=i.useState(null),[G,M]=i.useState(!0);i.useEffect(()=>{Q()},[m]);const Q=async()=>{if(!m||!u){M(!1);return}try{const s=await W(u);q(s)}catch{}finally{M(!1)}},$=()=>{w([...n,{questionNumber:`${n.length+1}`,studentAnswer:"",maxMarks:5}])},p=(s,r,a)=>{const t=[...n];t[s]={...t[s],[r]:a},w(t)},O=s=>{n.length>1&&w(n.filter((r,a)=>a!==s))},R=async()=>{var s;if(!h||n.some(r=>!r.studentAnswer.trim())){f({title:"Error",description:"Please fill in paper title and all answers",variant:"destructive"});return}S(!0);try{const r=await u.auth.getSession(),a=await fetch("/api/ai/grade-exam",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(s=r.data.session)==null?void 0:s.access_token}`},body:JSON.stringify({paperTitle:h,subject:v,examBoard:y,year:k,answers:n})}),t=await a.json();if(!a.ok)throw new Error(t.error||"Failed to grade exam");const{error:z}=await u.from("exam_submissions").insert({user_id:m==null?void 0:m.id,paper_title:h,subject:v,exam_board:y,year:k,total_marks:t.totalMarks,achieved_marks:t.achievedMarks,grade:t.grade,ai_feedback:t});F(t),f({title:"Success!",description:`Paper marked! You achieved Grade ${t.grade}`})}catch(r){f({title:"Error",description:r.message,variant:"destructive"})}finally{S(!1)}};return G?e.jsx(A,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(E,{className:"h-8 w-8 animate-spin text-primary"})})}):_?e.jsx(A,{children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 pb-12 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-blue-500/20 to-cyan-500/20",children:e.jsx(I,{className:"w-8 h-8 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"AI Examiner"}),e.jsx("p",{className:"text-muted-foreground",children:"Get your past papers marked and graded by AI"})]})]}),e.jsxs(o,{className:"animate-slide-up",children:[e.jsxs(g,{children:[e.jsx(b,{children:"Paper Details"}),e.jsx(N,{children:"Enter information about your completed past paper"})]}),e.jsx(x,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Paper Title *"}),e.jsx(d,{placeholder:"e.g., June 2024 Paper 1",value:h,onChange:s=>B(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Subject"}),e.jsx(d,{value:v,onChange:s=>L(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Exam Board"}),e.jsx(d,{value:y,onChange:s=>Y(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Year"}),e.jsx(d,{type:"number",value:k,onChange:s=>D(parseInt(s.target.value)||2024)})]})]})})]}),e.jsxs(o,{className:"animate-slide-up",style:{animationDelay:"0.1s",opacity:0},children:[e.jsxs(g,{children:[e.jsx(b,{children:"Your Answers"}),e.jsx(N,{children:"Enter your answers for each question"})]}),e.jsxs(x,{className:"space-y-4",children:[n.map((s,r)=>e.jsxs("div",{className:"p-4 border rounded-lg space-y-3 bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(l,{className:"text-base font-semibold",children:["Question ",s.questionNumber]}),n.length>1&&e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>O(r),children:e.jsx(H,{className:"w-4 h-4 text-destructive"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-xs",children:"Question Number"}),e.jsx(d,{value:s.questionNumber,onChange:a=>p(r,"questionNumber",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-xs",children:"Max Marks"}),e.jsx(d,{type:"number",value:s.maxMarks,onChange:a=>p(r,"maxMarks",parseInt(a.target.value)||0)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-xs",children:"Your Answer *"}),e.jsx(T,{placeholder:"Type your answer here...",className:"min-h-[100px]",value:s.studentAnswer,onChange:a=>p(r,"studentAnswer",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-xs",children:"Mark Scheme (Optional)"}),e.jsx(T,{placeholder:"Paste mark scheme if available...",className:"min-h-[60px]",value:s.markScheme||"",onChange:a=>p(r,"markScheme",a.target.value)})]})]},r)),e.jsxs(j,{variant:"outline",className:"w-full border-dashed",onClick:$,children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Add Another Question"]})]})]}),e.jsx(j,{className:"w-full bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 animate-slide-up",style:{animationDelay:"0.2s",opacity:0},size:"lg",onClick:R,disabled:C,children:C?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-5 h-5 mr-2 animate-spin"}),"Marking..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-5 h-5 mr-2"}),"Submit for AI Marking"]})}),c&&e.jsxs(o,{className:"border-green-500/20 bg-green-500/5 animate-slide-up",children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"w-6 h-6 text-green-500"}),e.jsxs("div",{children:[e.jsxs(b,{className:"text-green-700 dark:text-green-400",children:["Results: Grade ",c.grade]}),e.jsxs(N,{children:[c.achievedMarks,"/",c.totalMarks," marks (",c.percentage,"%)"]})]})]})}),e.jsx(x,{className:"space-y-4",children:(P=c.gradedAnswers)==null?void 0:P.map((s,r)=>e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-900 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-semibold",children:["Question ",s.questionNumber]}),e.jsxs("span",{className:`text-sm font-medium px-2 py-1 rounded ${s.marksAwarded/s.maxMarks>=.7?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":s.marksAwarded/s.maxMarks>=.5?"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"}`,children:[s.marksAwarded,"/",s.maxMarks," marks"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3 italic",children:s.feedback}),s.strengths&&s.strengths.length>0&&e.jsxs("div",{className:"text-sm mb-2",children:[e.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:"✓ Strengths:"}),e.jsx("ul",{className:"list-disc list-inside ml-2 mt-1",children:s.strengths.map((a,t)=>e.jsx("li",{className:"text-muted-foreground",children:a},t))})]}),s.improvements&&s.improvements.length>0&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-amber-600 dark:text-amber-400",children:"⚠ Improvements:"}),e.jsx("ul",{className:"list-disc list-inside ml-2 mt-1",children:s.improvements.map((a,t)=>e.jsx("li",{className:"text-muted-foreground",children:a},t))})]})]},r))})]}),!c&&e.jsx(o,{className:"border-blue-500/20 bg-blue-500/5 animate-slide-up",style:{animationDelay:"0.3s",opacity:0},children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(K,{className:"w-5 h-5 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-700 dark:text-blue-400 mb-1",children:"How it works"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Our AI examiner uses advanced language models to mark your answers against GCSE marking criteria. You'll receive detailed feedback, marks for each question, and an overall grade. Results are saved to your performance analytics for tracking progress over time."})]})]})})})]})}):e.jsx(A,{children:e.jsx("div",{className:"max-w-4xl mx-auto py-12",children:e.jsxs(o,{className:"border-amber-500/20 bg-amber-500/5",children:[e.jsxs(g,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-6 h-6 text-amber-500"}),"Premium Feature"]}),e.jsx(N,{children:"AI Examiner is a premium feature"})]}),e.jsxs(x,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Upgrade to premium to get your past papers marked and graded by AI instantly."}),e.jsx(j,{onClick:()=>window.location.href="/premium-dashboard",className:"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700",children:"View Premium Plans"})]})]})})})}export{xe as default};
