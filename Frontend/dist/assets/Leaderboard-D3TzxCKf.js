import{c as U,u as A,n as _,r as l,j as e,L as b,B as q}from"./index-7wMNJNZJ.js";import{A as o,b as n,c as i,d as c,h as M}from"./AppLayout-Cb4f3Rcb.js";import{B as T}from"./badge-CT5QE6KZ.js";import{C as h,a as g,b as w,c as E,d as v}from"./card-BDQx_yt9.js";import{T as p}from"./trophy-CIdFvAMW.js";import"./AnimatedLogoIcon-DY32PEux.js";import"./sheet-D4eoD1m7.js";import"./sun-CnDoiXzg.js";const R=U("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]);function G(){const{supabase:x,user:m}=A(),{toast:u}=_(),[y,f]=l.useState(!0),[a,d]=l.useState([]),[N,k]=l.useState(!1),[P,j]=l.useState(!0);l.useEffect(()=>{(async()=>{if(!m||!x){j(!1);return}try{const r=await M(x);k(r)}catch{}finally{j(!1)}})()},[m]),l.useEffect(()=>{S()},[m]);const S=async()=>{try{f(!0);const{data:s,error:r}=await x.rpc("get_leaderboard",{limit_count:50});if(r){(r.message.includes("function")||r.code==="42883")&&u({title:"Setup Required",description:"Please run the leaderboard_function.sql migration in Supabase to enable the leaderboard.",variant:"destructive"}),d([]);return}if(s&&s.length>0){const C=s.map(t=>({rank:t.rank,name:t.name,xp:t.xp,streak:t.streak,avatar:t.avatar_url,user_id:t.user_id,isUser:t.user_id===m?.id}));d(C)}else d([])}catch{u({title:"Error",description:"Failed to load leaderboard. Please try again later.",variant:"destructive"}),d([])}finally{f(!1)}},L=s=>s.toLocaleString();return P?e.jsx(o,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(b,{className:"h-8 w-8 animate-spin text-primary"})})}):N?e.jsx(o,{children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-fade-in pb-12",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-orange-500/10 text-orange-500",children:e.jsx(p,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Study Leaderboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Review your weekly rankings and compete with peers."})]})]}),y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(b,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):a.length===0?e.jsx(h,{className:"p-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"p-4 rounded-full bg-orange-500/10",children:e.jsx(p,{className:"w-12 h-12 text-orange-500"})}),e.jsx("h3",{className:"text-xl font-semibold",children:"No Rankings Yet"}),e.jsx("p",{className:"text-muted-foreground max-w-md",children:"The leaderboard will populate as students start studying. Create notes, flashcards, or use the AI Tutor to earn XP and appear on the leaderboard!"}),e.jsx("div",{className:"flex gap-3 mt-4",children:e.jsx("a",{href:"/",className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 transition-colors",children:"Start Studying"})})]})}):e.jsxs(e.Fragment,{children:[a.length>=3&&e.jsxs("div",{className:"flex items-end justify-center gap-3 sm:gap-4 md:gap-6 lg:gap-8 h-64 sm:h-64 md:h-64 mt-8 sm:mt-12 mb-8 sm:mb-10 md:mb-12 px-4 sm:px-6 md:px-8",children:[e.jsxs("div",{className:"flex flex-col items-center w-[28%] sm:w-[30%] md:flex-1 min-w-[80px] sm:min-w-[100px] md:max-w-[140px] lg:max-w-none",children:[e.jsxs(n,{className:"w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 lg:w-16 lg:h-16 border-2 sm:border-4 border-slate-300 mb-1 sm:mb-2",children:[e.jsx(i,{src:a[1]?.avatar||void 0}),e.jsx(c,{children:a[1]?.name[0]||"2"})]}),e.jsx("div",{className:"w-full h-20 sm:h-22 md:h-24 bg-slate-200 dark:bg-slate-800 rounded-t-xl flex items-center justify-center text-lg sm:text-xl md:text-2xl font-bold text-slate-400",children:"2"}),e.jsx("span",{className:"font-semibold text-[10px] sm:text-xs md:text-sm mt-1 sm:mt-2 truncate max-w-full text-center px-1",children:a[1]?.name||"User"})]}),e.jsxs("div",{className:"flex flex-col items-center w-[32%] sm:w-[34%] md:flex-1 min-w-[90px] sm:min-w-[110px] md:max-w-[160px] lg:max-w-none z-10 relative",children:[e.jsxs(n,{className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 lg:w-20 lg:h-20 border-2 sm:border-4 border-yellow-400 mb-1 sm:mb-2 ring-2 sm:ring-4 ring-yellow-400/20",children:[e.jsx(i,{src:a[0]?.avatar||void 0}),e.jsx(c,{children:a[0]?.name[0]||"1"})]}),e.jsx("div",{className:"w-full h-28 sm:h-30 md:h-32 bg-yellow-400/20 border border-yellow-400 rounded-t-xl flex items-center justify-center text-2xl sm:text-3xl md:text-4xl font-bold text-yellow-600",children:"1"}),e.jsx("span",{className:"font-semibold text-[10px] sm:text-xs md:text-sm mt-1 sm:mt-2 truncate max-w-full text-center px-1",children:a[0]?.name||"User"})]}),e.jsxs("div",{className:"flex flex-col items-center w-[28%] sm:w-[30%] md:flex-1 min-w-[80px] sm:min-w-[100px] md:max-w-[140px] lg:max-w-none",children:[e.jsxs(n,{className:"w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 lg:w-16 lg:h-16 border-2 sm:border-4 border-amber-600 mb-1 sm:mb-2",children:[e.jsx(i,{src:a[2]?.avatar||void 0}),e.jsx(c,{children:a[2]?.name[0]||"3"})]}),e.jsx("div",{className:"w-full h-16 sm:h-18 md:h-20 bg-amber-700/20 rounded-t-xl flex items-center justify-center text-lg sm:text-xl md:text-2xl font-bold text-amber-700",children:"3"}),e.jsx("span",{className:"font-semibold text-[10px] sm:text-xs md:text-sm mt-1 sm:mt-2 truncate max-w-full text-center px-1",children:a[2]?.name||"User"})]})]}),e.jsxs(h,{children:[e.jsx(g,{children:e.jsx(w,{children:"Global Rankings"})}),e.jsx(v,{className:"p-0",children:e.jsx("div",{className:"divide-y",children:a.map(s=>e.jsxs("div",{className:`flex items-center p-4 gap-4 ${s.isUser?"bg-primary/5":"hover:bg-muted/50"}`,children:[e.jsx("div",{className:"w-8 text-center font-bold text-muted-foreground",children:s.rank<=3?e.jsx(R,{className:`w-5 h-5 mx-auto ${s.rank===1?"text-yellow-500":s.rank===2?"text-slate-400":"text-amber-600"}`}):s.rank}),e.jsxs(n,{children:[e.jsx(i,{src:s.avatar||void 0}),e.jsx(c,{children:s.name[0]})]}),e.jsx("div",{className:"flex-1",children:e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[s.name,s.isUser&&e.jsx(T,{variant:"secondary",className:"text-[10px]",children:"YOU"})]})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold",children:[L(s.xp)," XP"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.streak," day streak"]})]})]},s.user_id))})})]})]})]})}):e.jsx(o,{children:e.jsx("div",{className:"max-w-4xl mx-auto py-12",children:e.jsxs(h,{className:"border-amber-500/20 bg-amber-500/5",children:[e.jsxs(g,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-6 h-6 text-amber-500"}),"Premium Feature"]}),e.jsx(E,{children:"Study Leaderboard is a premium feature"})]}),e.jsxs(v,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Upgrade to premium to see your weekly rankings and compete with peers."}),e.jsx(q,{onClick:()=>window.location.href="/premium-dashboard",className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:"View Premium Plans"})]})]})})})}export{G as default};
