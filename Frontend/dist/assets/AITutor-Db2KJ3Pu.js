import{j as e,A as H,s as J,v as V,w as $,x as X,L as K,y as Y}from"./ui-vendor-DGv3KiO9.js";import{A as Z}from"./AppLayout-sFUUKKCT.js";import{S as ee}from"./SimpleMarkdown-kgPygRTb.js";import{B as f}from"./button-DKINiv1g.js";import{C as I,a as A,b as T,c as M,d as E}from"./card-Cht8Cdj-.js";import{I as te}from"./input-C_jrEiMJ.js";import{S as se}from"./scroll-area-Dw_qTHJN.js";import{T as re}from"./textarea-CvUQI63m.js";import{u as ae,b as ne,c as _}from"./index-D0d5eCQC.js";import{e as B,g as oe,a as ie,c as le}from"./ai-client-4II0fbSk.js";import{i as ce,r as o,u as ue}from"./react-vendor-CW_qxVlV.js";import"./sheet-BtLaM5v0.js";import"./index-BV-fk3R2.js";import"./index-BdQq_4o_.js";import"./supabase-vendor-CkhQzPV-.js";import"./query-vendor-BaxnY8JC.js";function Se(){var Q;const{supabase:u,user:g}=ae(),{toast:W}=ne(),l=ce(),[D,y]=o.useState([{id:"1",role:"assistant",content:`Hello! I'm your AI tutoring assistant. I can help you with:

â€¢ Explaining concepts from your notes
â€¢ Generating practice questions
â€¢ Evaluating your answers
â€¢ Providing study tips

What would you like to learn today?`,timestamp:new Date}]),[x,L]=o.useState(""),[w,z]=o.useState(""),[h,P]=o.useState(!1),[r,j]=o.useState("chat"),[C,G]=o.useState(null),[p,v]=o.useState(null),k=o.useRef(null);o.useEffect(()=>{var t;(t=l.state)!=null&&t.context&&(z(l.state.context),l.state.mode&&j(l.state.mode),l.state.organizerTitle&&y([{id:"1",role:"assistant",content:`I have context from "${l.state.organizerTitle}". I can help you test your knowledge with practice questions based on this material. Would you like me to generate a question?`,timestamp:new Date}]))},[l.state]);const U=async()=>{if(!(!g||!u))try{const t=new Date(Date.now()-864e5).toISOString(),{count:s}=await u.from("ai_usage_tracking").select("*",{count:"exact",head:!0}).eq("user_id",g.id).gt("created_at",t),{data:c}=await u.from("profiles").select("is_premium, email").eq("id",g.id).single(),N=["admin@studyhub.com","tester@studyhub.com","andre@studyhub.com"],b=(c==null?void 0:c.is_premium)||N.includes((c==null?void 0:c.email)||"");G({count:s||0,limit:b?500:10})}catch{}};o.useEffect(()=>{U()},[g,u]),o.useEffect(()=>{k.current&&k.current.scrollIntoView({behavior:"smooth"})},[D]);const F=async()=>{var c,N,b;if(!x.trim()||h)return;const t={id:Date.now().toString(),role:"user",content:x,timestamp:new Date};y(a=>[...a,t]);const s=x;L(""),P(!0);try{let a="";if(p){const i=await B({correctAnswer:p.context,studentAnswer:s,threshold:.6},u);if(v(null),i.error)throw new Error(i.error);if(i.data){const{isCorrect:m,similarity:n,feedback:q}=i.data;a=`**Evaluation:**

${m?"âœ… Correct!":"âŒ Not quite right"}

**Similarity Score:** ${(n*100).toFixed(1)}%

**Feedback:** ${q||"Keep practicing!"}

---

Would you like another question? Just say "yes" or "next question"!`}else a="I couldn't evaluate your answer. Would you like to try another question?"}else{const i=r==="question"||s.toLowerCase().includes("generate question")||s.toLowerCase().includes("create question")||s.toLowerCase().includes("make a question")||s.toLowerCase().includes("ask me a question")||s.toLowerCase().includes("yes")||s.toLowerCase().includes("next question")||s.toLowerCase().includes("another question"),m=w.trim()||s;if(i&&m){const d=await(((c=l.state)==null?void 0:c.organizerTitle)?oe:ie)({context:m,subject:"General",difficulty:"medium"},u);if(d.error)throw new Error(d.error);(N=d.data)!=null&&N.question?(v({question:d.data.question,context:m}),a=`Here's a practice question based on your context:

**Question:** ${d.data.question}

Type your answer below, and I'll evaluate it!`):a="I couldn't generate a question. Please try again."}else if(r==="evaluate"&&w.trim()){const n=await B({correctAnswer:w,studentAnswer:s,threshold:.7},u);if(n.error)throw new Error(n.error);if(n.data){const{isCorrect:q,similarity:d,feedback:R}=n.data;a=`**Evaluation:**

${q?"âœ… Correct!":"âŒ Not quite right"}

**Similarity Score:** ${(d*100).toFixed(1)}%

**Feedback:** ${R||"Keep practicing!"}`}}else{const n=await le({message:s,context:m},u);if(n.error)throw new Error(n.error);a=((b=n.data)==null?void 0:b.reply)||"I couldn't generate a response. Please try again."}}const S={id:(Date.now()+1).toString(),role:"assistant",content:a,timestamp:new Date};y(i=>[...i,S])}catch(a){W({title:"Error",description:a.message||"Failed to get response. Please try again.",variant:"destructive"});const S={id:(Date.now()+1).toString(),role:"assistant",content:"I'm sorry, I encountered an error. Please try again or check your connection.",timestamp:new Date};y(i=>[...i,S])}finally{P(!1)}},O=ue();return e.jsx(Z,{children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 animate-fade-in",children:e.jsxs("div",{children:[((Q=l.state)==null?void 0:Q.organizerTitle)&&e.jsxs(f,{variant:"ghost",className:"mb-2 p-0 h-auto hover:bg-transparent text-muted-foreground hover:text-foreground",onClick:()=>O("/knowledge"),children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Back to Knowledge Organizer"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(J,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground",children:"AI Tutoring Bot"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Get personalized help with your studies"}),C&&e.jsxs("div",{className:"mt-2 inline-flex items-center px-3 py-1 rounded-full bg-primary/10 border border-primary/20 text-xs font-medium text-primary",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),C.limit-C.count," AI generations remaining today"]})]})}),e.jsxs("div",{className:"flex gap-2 animate-slide-up",style:{animationDelay:"0.1s",opacity:0},children:[e.jsx(f,{variant:r==="chat"?"default":"outline",size:"sm",onClick:()=>{j("chat"),v(null)},children:"Chat"}),e.jsx(f,{variant:r==="question"?"default":"outline",size:"sm",onClick:()=>j("question"),children:"Generate Question"}),e.jsx(f,{variant:r==="evaluate"?"default":"outline",size:"sm",onClick:()=>{j("evaluate"),v(null)},children:"Evaluate Answer"})]}),p&&e.jsxs("div",{className:"bg-primary/10 border border-primary/30 rounded-lg p-3 text-sm",children:[e.jsx("span",{className:"font-medium text-primary",children:"ðŸ“ Waiting for your answer:"}),e.jsx("p",{className:"mt-1 text-foreground",children:p.question})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:e.jsxs(I,{className:"h-[600px] flex flex-col",children:[e.jsxs(A,{children:[e.jsx(T,{children:"Conversation"}),e.jsxs(M,{children:[r==="chat"&&"Ask me anything about your studies",r==="question"&&"I'll generate questions from your notes",r==="evaluate"&&"I'll evaluate your answers"]})]}),e.jsxs(E,{className:"flex-1 flex flex-col p-0 overflow-hidden min-h-0",children:[e.jsx(se,{className:"flex-1 px-6 min-h-0",children:e.jsxs("div",{className:"space-y-4 py-4",children:[D.map(t=>e.jsxs("div",{className:_("flex gap-3",t.role==="user"?"justify-end":"justify-start"),children:[t.role==="assistant"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx($,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:_("max-w-[80%] rounded-lg p-4",t.role==="user"?"bg-primary text-primary-foreground":"bg-muted text-foreground"),children:[t.role==="assistant"?e.jsx(ee,{content:t.content,className:"text-sm"}):e.jsx("p",{className:"whitespace-pre-wrap text-sm break-words",children:t.content}),e.jsx("p",{className:"text-xs opacity-70 mt-2",children:t.timestamp.toLocaleTimeString()})]}),t.role==="user"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(X,{className:"h-4 w-4 text-primary"})})]},t.id)),h&&e.jsxs("div",{className:"flex gap-3 justify-start",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx($,{className:"h-4 w-4 text-primary"})}),e.jsx("div",{className:"bg-muted rounded-lg p-4",children:e.jsx(K,{className:"h-4 w-4 animate-spin text-muted-foreground"})})]}),e.jsx("div",{ref:k})]})}),e.jsx("div",{className:"p-6 border-t border-border",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(te,{value:x,onChange:t=>L(t.target.value),onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),F())},placeholder:p||r==="evaluate"?"Type your answer here...":"Type your message...",disabled:h}),e.jsx(f,{onClick:F,disabled:h||!x.trim(),children:h?e.jsx(K,{className:"h-4 w-4 animate-spin"}):e.jsx(Y,{className:"h-4 w-4"})})]})})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(I,{children:[e.jsxs(A,{children:[e.jsx(T,{children:"Context / Notes"}),e.jsx(M,{children:"Paste your notes here for better assistance"})]}),e.jsxs(E,{children:[e.jsx(re,{value:w,onChange:t=>z(t.target.value),placeholder:"Paste your notes, study material, or the correct answer here...",className:"min-h-[200px]"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[r==="question"&&"I'll generate practice questions based on this context",r==="evaluate"&&"This should be the correct answer to compare against",r==="chat"&&"Provide context for better responses"]})]})]}),e.jsxs(I,{children:[e.jsx(A,{children:e.jsx(T,{children:"Tips"})}),e.jsxs(E,{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsx("p",{children:"â€¢ Provide clear context from your notes for better questions"}),e.jsx("p",{children:'â€¢ Use "Generate Question" mode to create practice questions'}),e.jsx("p",{children:"â€¢ After a question is generated, just type your answer"}),e.jsx("p",{children:"â€¢ The AI will automatically evaluate your response"})]})]})]})]})]})})}export{Se as default};
