import{j as e,L as I,b8 as w,aC as h,ar as k}from"./ui-vendor-DvDVRjyp.js";import{h as q,A as y}from"./AppLayout-DSG6wxEf.js";import{u as B,k as T,B as C}from"./index-DEqmCALs.js";import{C as i,a as o,b as m,c as g,d}from"./card-C99jCs8O.js";import{r as p}from"./react-vendor-Do86TxWo.js";import"./AnimatedLogoIcon-D6d7HWVb.js";import"./sheet-DlQTD0RE.js";import"./supabase-vendor-C2nLxrxH.js";import"./query-vendor-Bk-KKE7Z.js";function z(){const{supabase:f,user:s}=B(),{toast:P}=T(),[S,A]=p.useState(!1),[r,v]=p.useState([]),[_,j]=p.useState(!0),[D,b]=p.useState(!0);p.useEffect(()=>{s?(E(),F()):(b(!1),j(!1))},[s]);const E=async()=>{if(!s||!f){b(!1);return}try{const t=await q(f);A(t)}catch{}finally{b(!1)}},F=async()=>{try{j(!0);const{data:t,error:a}=await f.from("performance_analytics").select("*").eq("user_id",s==null?void 0:s.id).order("performance_score",{ascending:!1});if(a)throw a;if(t&&t.length>0){const x=t.map(n=>({subject:n.subject,topic:n.topic||"Overall",performanceScore:Math.round(n.performance_score||0),status:n.status||"amber",totalAttempts:n.total_attempts||0}));v(x)}else{const{data:x,error:n}=await f.from("exam_submissions").select("*").eq("user_id",s==null?void 0:s.id);if(n)throw n;if(x&&x.length>0){const N=new Map;x.forEach(u=>{const l=u.subject,c=N.get(l)||{total:0,achieved:0,count:0};c.total+=u.total_marks||0,c.achieved+=u.achieved_marks||0,c.count+=1,N.set(l,c)});const H=Array.from(N.entries()).map(([u,l])=>{const c=l.total>0?Math.round(l.achieved/l.total*100):0;return{subject:u,topic:"Overall",performanceScore:c,status:c>=70?"green":c>=50?"amber":"red",totalAttempts:l.count}});v(H)}}}catch{P({title:"Error",description:"Failed to load performance data",variant:"destructive"})}finally{j(!1)}},M=t=>{switch(t){case"green":return"bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30";case"amber":return"bg-amber-500/20 text-amber-700 dark:text-amber-400 border-amber-500/30";case"red":return"bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30";default:return""}},L=t=>{switch(t){case"green":return e.jsx(k,{className:"w-5 h-5"});case"amber":return e.jsx(h,{className:"w-5 h-5"});case"red":return e.jsx(h,{className:"w-5 h-5"});default:return null}};return D?e.jsx(y,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(I,{className:"h-8 w-8 animate-spin text-primary"})})}):S?e.jsx(y,{children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 pb-12 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-orange-500/20 to-red-500/20",children:e.jsx(w,{className:"w-8 h-8 text-orange-500"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Performance Heat Map"}),e.jsx("p",{className:"text-muted-foreground",children:"Visual analysis of your strengths and areas to improve"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 animate-slide-up",children:[e.jsxs(i,{children:[e.jsx(o,{className:"pb-3",children:e.jsx(m,{className:"text-sm text-green-600 dark:text-green-400",children:"Strong Areas"})}),e.jsxs(d,{children:[e.jsx("p",{className:"text-4xl font-bold",children:r.filter(t=>t.status==="green").length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"70%+ performance"})]})]}),e.jsxs(i,{children:[e.jsx(o,{className:"pb-3",children:e.jsx(m,{className:"text-sm text-amber-600 dark:text-amber-400",children:"Needs Practice"})}),e.jsxs(d,{children:[e.jsx("p",{className:"text-4xl font-bold",children:r.filter(t=>t.status==="amber").length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"50-69% performance"})]})]}),e.jsxs(i,{children:[e.jsx(o,{className:"pb-3",children:e.jsx(m,{className:"text-sm text-red-600 dark:text-red-400",children:"Focus Required"})}),e.jsxs(d,{children:[e.jsx("p",{className:"text-4xl font-bold",children:r.filter(t=>t.status==="red").length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Below 50%"})]})]})]}),e.jsxs(i,{className:"animate-slide-up",style:{animationDelay:"0.1s",opacity:0},children:[e.jsxs(o,{children:[e.jsx(m,{children:"Performance by Subject"}),e.jsx(g,{children:"Color-coded performance across all your submitted work"})]}),e.jsx(d,{children:_?e.jsx("p",{className:"text-center text-muted-foreground py-12",children:"Loading performance data..."}):r.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(h,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No performance data yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Complete some past papers using the AI Examiner to see your performance analysis"}),e.jsx(C,{onClick:()=>window.location.href="/premium/ai-examiner",variant:"outline",children:"Go to AI Examiner"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map((t,a)=>e.jsxs("div",{className:`p-6 rounded-xl border-2 ${M(t.status)} transition-all hover:scale-105 cursor-pointer`,children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:t.subject}),e.jsxs("div",{className:"flex items-baseline gap-2 mb-3",children:[e.jsxs("span",{className:"text-5xl font-bold",children:[t.performanceScore,"%"]}),L(t.status)]}),e.jsxs("p",{className:"text-sm opacity-75 mb-3",children:[t.totalAttempts," ",t.totalAttempts===1?"attempt":"attempts"]}),e.jsx("div",{className:"pt-3 border-t border-current/20",children:e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide",children:t.status==="green"?"âœ“ Strong Performance":t.status==="amber"?"âš  Keep Practicing":"âœ— Focus Needed"})})]},a))})})]}),r.filter(t=>t.status==="red").length>0&&e.jsxs(i,{className:"border-red-500/20 bg-red-500/5 animate-slide-up",style:{animationDelay:"0.2s",opacity:0},children:[e.jsxs(o,{children:[e.jsxs(m,{className:"text-red-700 dark:text-red-400 flex items-center gap-2",children:[e.jsx(h,{className:"w-5 h-5"}),"Priority Focus Areas"]}),e.jsx(g,{children:"Subjects that need your immediate attention"})]}),e.jsxs(d,{children:[e.jsx("ul",{className:"space-y-2",children:r.filter(t=>t.status==="red").map((t,a)=>e.jsxs("li",{className:"flex items-center justify-between p-3 bg-red-50 dark:bg-red-950/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"font-medium",children:t.subject})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.performanceScore,"% (",t.totalAttempts," ",t.totalAttempts===1?"attempt":"attempts",")"]})]},a))}),e.jsx("p",{className:"text-sm text-muted-foreground mt-4 italic",children:"ðŸ’¡ Tip: Focus on reviewing these topics and practice more past papers to improve your performance."})]})]}),r.filter(t=>t.status==="green").length>0&&e.jsxs(i,{className:"border-green-500/20 bg-green-500/5 animate-slide-up",style:{animationDelay:"0.3s",opacity:0},children:[e.jsxs(o,{children:[e.jsxs(m,{className:"text-green-700 dark:text-green-400 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Your Strengths"]}),e.jsx(g,{children:"Well done! Keep up the great work in these areas"})]}),e.jsx(d,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:r.filter(t=>t.status==="green").map((t,a)=>e.jsxs("div",{className:"px-3 py-2 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-lg text-sm font-medium",children:[t.subject," (",t.performanceScore,"%)"]},a))})})]})]})}):e.jsx(y,{children:e.jsx("div",{className:"max-w-4xl mx-auto py-12",children:e.jsxs(i,{className:"border-amber-500/20 bg-amber-500/5",children:[e.jsxs(o,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-6 h-6 text-amber-500"}),"Premium Feature"]}),e.jsx(g,{children:"Performance Heat Map is a premium feature"})]}),e.jsxs(d,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Upgrade to premium to see visual analytics of your performance across all subjects."}),e.jsx(C,{onClick:()=>window.location.href="/premium-dashboard",className:"bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700",children:"View Premium Plans"})]})]})})})}export{z as default};
