import{j as e,L,K as G,as as T,aB as Ee,aP as $e,aQ as De,E as Ae,ay as Q,F as Ue,ai as Be,au as Le,az as Ie,aI as I,aR as Re,a3 as We}from"./ui-vendor-CsSFJReh.js";import{A as Y}from"./AppLayout-DI_SoCqt.js";import{B as R}from"./badge-C82RfJ-5.js";import{u as He,k as Me,j as Oe,B as m,c as ze}from"./index-D0R12c3l.js";import{D as K,b as X,c as J,d as Z,e as ee,f as Ve}from"./dialog-BfoGBpVh.js";import{I as b}from"./input-BOrw0D0Z.js";import{L as f}from"./label-CYC1LVAb.js";import{P as se}from"./progress-qwrdNt2A.js";import{S as w,a as S,b as C,c as k,d as p}from"./select-BnVVC8xh.js";import{E as te}from"./constants-DeIw5BhA.js";import{S as qe}from"./paper-parser-BorTS_p9.js";import{u as Ge,h as Qe,r as c}from"./react-vendor-BmZbDsmQ.js";import"./AnimatedLogoIcon-D5-EYdni.js";import"./sheet-0_ECFM1J.js";import"./supabase-vendor-BcRMW6g-.js";import"./query-vendor-DjEy6XLK.js";import"./index-BdQq_4o_.js";import"./index-B5-l44BU.js";function xs(){const{supabase:N,user:h}=He(),{toast:u}=Me(),{t:i}=Oe(),ae=Ge(),[le]=Qe(),[j,re]=c.useState([]),[ie,W]=c.useState(!0),[H,ne]=c.useState(""),[E,ce]=c.useState("All Subjects"),[$,oe]=c.useState("All Boards"),[P,de]=c.useState(le.get("tier")||"All Tiers"),[ue,F]=c.useState(!1),[v,me]=c.useState(null),[t,x]=c.useState({title:"",subject:"",year:"",exam_board:"",tier:"",file_url:"",file_type:"link",file:null,score:"",max_score:""}),[a,y]=c.useState(null),[M,O]=c.useState(!1),[he,D]=c.useState(0),[Ye,A]=c.useState(null),[xe,_]=c.useState(!1),[fe,g]=c.useState(!1);c.useEffect(()=>{if(a!=null&&a.file_url){if(_(!0),g(!1),a.file_url.startsWith("http://")||a.file_url.startsWith("https://")){_(!1),g(!1);return}const s=new AbortController,r=setTimeout(()=>s.abort(),5e3);fetch(a.file_url,{method:"HEAD",signal:s.signal}).then(l=>{clearTimeout(r),!l.ok&&l.status!==0?g(!0):g(!1)}).catch(l=>{clearTimeout(r),l.name,g(!1)}).finally(()=>_(!1))}else _(!1),g(!1)},[a]),c.useEffect(()=>{h&&(U(),pe())},[h]),c.useEffect(()=>{if(!a||!h){A(null);return}const s=new Date;A(s);let r=s;const l=setInterval(()=>{D(n=>n+1)},1e3);return()=>{clearInterval(l);const n=Math.floor((new Date().getTime()-r.getTime())/1e3);n>0&&a&&je(a.id,n)}},[a,h]);const pe=async()=>{if(h)try{const r=j.filter(l=>l.completed_at).length*1;D(r*3600)}catch{}},je=async(s,r)=>{if(!(!h||r<=0))try{D(l=>l+r)}catch{}},U=async()=>{if(h)try{W(!0);const{data:s,error:r}=await N.from("past_papers").select("*").eq("user_id",h.id).order("created_at",{ascending:!1});if(r)throw r;re(s||[])}catch{u({title:"Error",description:"Failed to load past papers. Please try again.",variant:"destructive"})}finally{W(!1)}},z=()=>{me(null),x({title:"",subject:"",year:"",exam_board:"",tier:"",file_url:"",file_type:"link",file:null,score:"",max_score:""}),F(!0)},ge=async s=>{if(!h)return null;try{O(!0);const r=s.name.split(".").pop(),n=`${h.id}/${Date.now()}_${Math.random().toString(36).substring(7)}.${r}`,{error:o,data:q}=await N.storage.from("past-papers").upload(n,s,{cacheControl:"3600",upsert:!1});if(o)throw o;const{data:d}=N.storage.from("past-papers").getPublicUrl(n);return d.publicUrl}catch(r){return u({title:"Upload Error",description:r.message||"Failed to upload file. Please try again.",variant:"destructive"}),null}finally{O(!1)}},be=()=>{if(!t.file_url){u({title:"No Link Found",description:"Please paste a link first to use auto-fill.",variant:"destructive"});return}const s=qe.parse(t.file_url);if(s.board==="Unknown"&&s.type==="Other"&&!s.subjectCode){u({title:"Could not parse link",description:"This link format is not recognized for auto-fill.",variant:"destructive"});return}let r=t.title;if(s.subjectCode||s.board!=="Unknown"){const l=[];s.subjectCode&&l.push(s.subjectCode),s.type!=="Other"&&l.push(s.type),s.year&&l.push(s.year),s.month&&l.push(s.month),s.board!=="Unknown"&&l.push(`(${s.board})`),r=l.join(" ")}x(l=>({...l,title:r||l.title,subject:s.subjectCode||l.subject,exam_board:s.board!=="Unknown"?s.board:l.exam_board,year:s.year||l.year})),u({title:"Auto-filled!",description:`Parsed ${s.board} paper details.`})},ve=async()=>{if(!h||!t.title.trim()){u({title:"Error",description:"Title is required",variant:"destructive"});return}if(!t.tier){u({title:"Error",description:"Please select a Tier (Foundation or Higher)",variant:"destructive"});return}try{let s=t.file_url;if(t.file_type==="upload"&&t.file){const l=await ge(t.file);if(!l)return;s=l}else t.file_type==="link"&&!t.file_url.trim()&&(s=null);const r={user_id:h.id,title:t.title,subject:t.subject||null,year:t.year?parseInt(t.year):null,exam_board:t.exam_board||null,tier:t.tier||null,file_url:s,file_type:t.file_type,score:t.score?parseInt(t.score):null,max_score:t.max_score?parseInt(t.max_score):null,completed_at:t.score?new Date().toISOString():null};if(v){const{error:l}=await N.from("past_papers").update(r).eq("id",v.id).eq("user_id",h.id);if(l)throw l;u({title:"Success",description:"Past paper updated successfully"})}else{const{error:l}=await N.from("past_papers").insert(r);if(l)throw l;u({title:"Success",description:"Past paper created successfully"})}F(!1),U()}catch(s){u({title:"Error",description:s.message||"Failed to save past paper. Please try again.",variant:"destructive"})}},ye=async s=>{if(!s.file_url){u({title:"No file available",description:"This paper doesn't have a file attached yet.",variant:"destructive"});return}if(s.file_type==="upload"||!s.file_type&&!s.file_url.startsWith("http"))try{const r=await fetch(s.file_url);if(!r.ok)throw new Error(`Failed to fetch file: ${r.status} ${r.statusText}`);const l=await r.blob(),n=window.URL.createObjectURL(l),o=document.createElement("a");o.href=n,o.download=`${s.title.replace(/\s+/g,"_")}.pdf`,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(n),document.body.removeChild(o)}catch{u({title:"Download failed",description:"Could not download the file. It may have been deleted or moved.",variant:"destructive"})}else window.open(s.file_url,"_blank")},Ne=s=>{y(s),A(new Date)},_e=s=>{const r=Math.floor(s/3600),l=Math.floor(s%3600/60);return r>0?`${r}h ${l}m`:`${l}m`},we=s=>{if(!s.subject){u({title:"No subject available",description:"This paper needs a subject to generate flashcards.",variant:"destructive"});return}ae("/flashcards",{state:{organizerContent:`Generate flashcards for ${s.subject} based on the ${s.exam_board||"GCSE"} syllabus. Year: ${s.year||"recent"}. Paper title: ${s.title}. Focus on key concepts, definitions, and exam-style questions that would appear in this type of paper.`,subject:s.subject,topic:s.title}}),u({title:"Generating flashcards...",description:`Creating flashcards for ${s.subject}`})},V=j.filter(s=>{const r=(s.title||"").toLowerCase().includes(H.toLowerCase()),l=E==="All Subjects"||s.subject===E,n=$==="All Boards"||s.exam_board===$;let o=s.tier;if(!o&&s.title){const d=s.title.toLowerCase(),Fe=d.includes("foundation")||d.includes(" 1f")||d.includes(" 2f")||d.includes(" 3f")||d.endsWith("1f")||d.endsWith("2f")||d.endsWith("3f")||/\b[1-3]f\b/.test(d),Te=d.includes("higher")||d.includes(" 1h")||d.includes(" 2h")||d.includes(" 3h")||d.endsWith("1h")||d.endsWith("2h")||d.endsWith("3h")||/\b[1-3]h\b/.test(d);Fe?o="Foundation":Te&&(o="Higher")}const q=P==="All Tiers"||P==="Unassigned"&&!o||(o==null?void 0:o.toLowerCase())===P.toLowerCase();return r&&l&&n&&q}),Se=j.filter(s=>s.completed_at).length,B=j.filter(s=>s.score!==null&&s.max_score!==null),Ce=B.length>0?B.reduce((s,r)=>s+(r.score||0)/(r.max_score||1)*100,0)/B.length:0,ke=Array.from(new Set(j.map(s=>s.subject).filter(Boolean)));c.useEffect(()=>{if(!v&&t.year&&t.subject&&t.tier){const s=t.tier==="Higher"?"H":"F",r=t.exam_board?` ${t.exam_board}`:"",l=`${t.year}${s} ${t.subject}${r}`;(!t.title||t.title.trim()==="")&&x(n=>({...n,title:l}))}},[t.year,t.subject,t.tier,t.exam_board,v]);const Pe=s=>{if(s.year&&s.subject&&s.tier){const r=s.tier==="Higher"?"H":"F",l=s.exam_board?` ${s.exam_board}`:"",n=s.title.match(/(?:Paper|Component)\s*(\d+)/i),o=n?` P${n[1]}`:"";return`${s.year}${r} ${s.subject}${o}${l}`}return s.title};return ie?e.jsx(Y,{children:e.jsx("div",{className:"max-w-6xl mx-auto flex items-center justify-center h-[60vh]",children:e.jsx(L,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsxs(Y,{children:[e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground",children:i("pastPapers.title")}),e.jsx("p",{className:"text-muted-foreground mt-1",children:i("pastPapers.subtitle",{count:j.length,plural:j.length!==1?"s":""})})]}),e.jsxs(m,{onClick:z,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),i("pastPapers.addPaper")]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 animate-slide-up",style:{animationDelay:"0.1s"},children:[{label:i("pastPapers.totalPapers"),value:j.length,icon:T},{label:i("pastPapers.completed"),value:Se,icon:Ee},{label:i("pastPapers.averageScore"),value:`${Math.round(Ce)}%`,icon:$e},{label:i("pastPapers.studyTime"),value:_e(he),icon:De}].map(s=>e.jsx("div",{className:"glass-card p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(s.icon,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-foreground",children:s.value}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.label})]})]})},s.label))}),e.jsxs("div",{className:"flex flex-wrap gap-3 animate-slide-up",style:{animationDelay:"0.2s"},children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(b,{placeholder:i("pastPapers.searchPlaceholder"),value:H,onChange:s=>ne(s.target.value),className:"pl-9"})]}),e.jsxs(w,{value:E,onValueChange:ce,children:[e.jsx(S,{className:"w-[150px]",children:e.jsx(C,{})}),e.jsxs(k,{children:[e.jsx(p,{value:"All Subjects",children:i("common.allSubjects")}),ke.map(s=>e.jsx(p,{value:s,children:s},s))]})]}),e.jsxs(w,{value:$,onValueChange:oe,children:[e.jsx(S,{className:"w-[140px]",children:e.jsx(C,{})}),e.jsxs(k,{children:[e.jsx(p,{value:"All Boards",children:i("common.allBoards")}),te.map(s=>e.jsx(p,{value:s,children:s},s))]})]}),e.jsxs(w,{value:P,onValueChange:de,children:[e.jsx(S,{className:"w-[180px]",children:e.jsx(C,{})}),e.jsxs(k,{children:[e.jsx(p,{value:"All Tiers",children:i("common.allTiers")}),e.jsx(p,{value:"Higher",children:i("flashcards.higher")}),e.jsx(p,{value:"Foundation",children:i("flashcards.foundation")}),e.jsx(p,{value:"Unassigned",children:i("pastPapers.unassigned")})]})]})]}),j.length===0?e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(T,{className:"h-16 w-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:i("pastPapers.noPapers")}),e.jsx("p",{className:"text-muted-foreground mb-4",children:i("pastPapers.createFirst")}),e.jsxs(m,{onClick:z,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),i("pastPapers.addPaper")]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:V.map((s,r)=>{const l=!!s.completed_at,n=s.score&&s.max_score?s.score/s.max_score*100:0;return e.jsxs("div",{className:"glass-card p-5 hover-lift animate-slide-up",style:{animationDelay:`${.1*r}s`},children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.subject&&e.jsx(R,{variant:"outline",children:s.subject}),s.exam_board&&e.jsx(R,{variant:"outline",children:s.exam_board}),s.tier&&e.jsx(R,{variant:"secondary",className:s.tier==="Higher"?"bg-red-500/10 text-red-500 border-red-500/20":"bg-green-500/10 text-green-500 border-green-500/20",children:s.tier})]})}),e.jsx("h3",{className:"font-semibold text-foreground mb-1",children:Pe(s)}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:[s.subject," • ",s.year]}),l&&s.score!==null&&s.max_score!==null?e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-muted-foreground",children:i("pastPapers.yourScore")}),e.jsxs("span",{className:ze("font-bold",n>=70?"text-secondary":n>=50?"text-accent-foreground":"text-destructive"),children:[Math.round(n),"%"]})]}),e.jsx(se,{value:n,className:"h-2"})]}):e.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-muted/50 flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:i("pastPapers.notAttempted")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:l?"outline":"default",className:"flex-1",onClick:()=>Ne(s),children:l?e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),i("common.review")]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),i("pastPapers.startQuiz")]})}),e.jsx(m,{variant:"outline",size:"icon",onClick:()=>we(s),title:i("pastPapers.generateFlashcards"),children:e.jsx(Le,{className:"h-4 w-4"})}),s.file_url&&e.jsxs(e.Fragment,{children:[(s.file_type==="upload"||!s.file_type&&s.file_url&&!s.file_url.startsWith("http"))&&e.jsx(m,{variant:"outline",size:"icon",onClick:()=>ye(s),children:e.jsx(Ie,{className:"h-4 w-4"})}),s.file_url&&s.file_url.startsWith("http")&&e.jsx(m,{variant:"outline",size:"icon",onClick:()=>window.open(s.file_url,"_blank"),children:e.jsx(I,{className:"h-4 w-4"})})]})]})]},s.id)})}),V.length===0&&j.length>0&&e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(T,{className:"h-16 w-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No papers found"}),e.jsx("p",{className:"text-muted-foreground",children:"Try adjusting your filters"})]})]}),e.jsx(K,{open:ue,onOpenChange:F,children:e.jsxs(X,{className:"max-w-2xl",children:[e.jsxs(J,{children:[e.jsx(Z,{children:v?"Edit Past Paper":"Create New Past Paper"}),e.jsx(ee,{children:v?"Update your past paper details below":"Fill in the details to create a new past paper"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"title",children:"Title *"}),e.jsx(b,{id:"title",value:t.title,onChange:s=>x({...t,title:s.target.value}),placeholder:"Enter paper title"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"subject",children:"Subject"}),e.jsx(b,{id:"subject",value:t.subject,onChange:s=>x({...t,subject:s.target.value}),placeholder:"e.g., Biology"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"exam_board",children:"Exam Board"}),e.jsxs(w,{value:t.exam_board,onValueChange:s=>x({...t,exam_board:s}),children:[e.jsx(S,{id:"exam_board",children:e.jsx(C,{placeholder:"Select board"})}),e.jsx(k,{children:te.map(s=>e.jsx(p,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"year",children:"Year"}),e.jsx(b,{id:"year",type:"number",value:t.year,onChange:s=>x({...t,year:s.target.value}),placeholder:"2024"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"tier",children:"Tier"}),e.jsxs(w,{value:t.tier,onValueChange:s=>x({...t,tier:s}),children:[e.jsx(S,{id:"tier",children:e.jsx(C,{placeholder:"Select Tier"})}),e.jsxs(k,{children:[e.jsx(p,{value:"Higher",children:"Higher Tier"}),e.jsx(p,{value:"Foundation",children:"Foundation Tier"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"File Attachment"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsxs(m,{type:"button",variant:t.file_type==="link"?"default":"outline",size:"sm",onClick:()=>x({...t,file_type:"link",file:null}),children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Link"]}),e.jsxs(m,{type:"button",variant:t.file_type==="upload"?"default":"outline",size:"sm",onClick:()=>x({...t,file_type:"upload",file_url:""}),children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Upload File"]})]}),t.file_type==="link"?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{id:"file_url",value:t.file_url,onChange:s=>x({...t,file_url:s.target.value}),placeholder:"https://example.com/past-paper.pdf",className:"flex-1"}),e.jsx(m,{type:"button",variant:"secondary",size:"icon",onClick:be,title:"Auto-fill from link",children:e.jsx(We,{className:"h-4 w-4 text-primary"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Paste a link to the past paper and click the sparkles ✨ to auto-fill details."})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{id:"file",type:"file",accept:".pdf,.doc,.docx,.txt",onChange:s=>{var l;const r=(l=s.target.files)==null?void 0:l[0];if(r){if(r.size>10*1024*1024){u({title:"File too large",description:"Please upload a file smaller than 10MB.",variant:"destructive"});return}x({...t,file:r})}},className:"cursor-pointer"}),t.file&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Selected: ",t.file.name," (",(t.file.size/1024/1024).toFixed(2)," MB)"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Upload PDF, Word, or text files (max 10MB)"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"score",children:"Score"}),e.jsx(b,{id:"score",type:"number",value:t.score,onChange:s=>x({...t,score:s.target.value}),placeholder:"82"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"max_score",children:"Max Score"}),e.jsx(b,{id:"max_score",type:"number",value:t.max_score,onChange:s=>x({...t,max_score:s.target.value}),placeholder:"100"})]})]})]}),e.jsxs(Ve,{children:[e.jsx(m,{variant:"outline",onClick:()=>F(!1),children:"Cancel"}),e.jsx(m,{onClick:ve,disabled:M,children:M?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[v?"Update":"Create"," Paper"]})})]})]})}),e.jsx(K,{open:!!a,onOpenChange:s=>!s&&y(null),children:e.jsxs(X,{className:"max-w-5xl h-[90vh] flex flex-col p-0 overflow-hidden",children:[e.jsxs(J,{className:"p-6 pb-2",children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5 text-primary"}),a==null?void 0:a.title]}),e.jsxs(ee,{children:[a==null?void 0:a.subject," • ",a==null?void 0:a.exam_board," • ",a==null?void 0:a.year]})]}),e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row border-t overflow-hidden",children:[e.jsx("div",{className:"flex-1 bg-muted/30 relative min-h-[300px]",children:a!=null&&a.file_url?xe?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(L,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading preview..."})]})}):fe?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center p-8 text-center bg-background/50 backdrop-blur-sm",children:[e.jsx("div",{className:"bg-destructive/10 p-4 rounded-full mb-4",children:e.jsx(Q,{className:"h-8 w-8 text-destructive"})}),e.jsx("h4",{className:"font-semibold mb-2 text-lg",children:"File Not Found"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6 max-w-xs",children:"The file for this past paper seems to be missing or deleted."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{variant:"outline",onClick:()=>y(null),children:"Close"}),e.jsx(m,{variant:"default",onClick:()=>{_(!0),g(!1),fetch(a.file_url).then(s=>{if(!s.ok)throw new Error("Status "+s.status);g(!1)}).catch(()=>g(!0)).finally(()=>_(!1))},children:"Retry"})]})]}):a.file_url.startsWith("https://filestore.aqa.org.uk")||a.file_url.endsWith(".pdf")?e.jsx("iframe",{src:a.file_url,className:"w-full h-full border-none",title:"Paper Content"}):e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(I,{className:"h-12 w-12 text-muted-foreground mb-4 opacity-20"}),e.jsx("h4",{className:"font-semibold mb-2",children:"External Content"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"This paper is hosted on an external site. Open it in a new tab to study."}),e.jsx(m,{onClick:()=>window.open(a.file_url,"_blank"),children:"Open Paper in New Tab"})]}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-muted-foreground",children:"No file content available."})}),e.jsxs("div",{className:"w-full md:w-80 border-l bg-background p-6 space-y-6 overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx(f,{className:"text-sm font-medium mb-3 block",children:"Review Results"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"review-score",children:"Your Score"}),e.jsx(b,{id:"review-score",type:"number",placeholder:"e.g. 85",defaultValue:(a==null?void 0:a.score)||"",onChange:s=>{a&&y({...a,score:parseInt(s.target.value)||null})}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"review-max",children:"Max Score"}),e.jsx(b,{id:"review-max",type:"number",placeholder:"e.g. 100",defaultValue:(a==null?void 0:a.max_score)||"",onChange:s=>{a&&y({...a,max_score:parseInt(s.target.value)||null})}})]})]})]}),a&&a.score!==null&&a.max_score!==null&&e.jsxs("div",{className:"p-4 rounded-lg bg-primary/5 border border-primary/10",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Percentage"}),e.jsxs("span",{className:"font-bold text-primary",children:[Math.round(a.score/a.max_score*100),"%"]})]}),e.jsx(se,{value:a.score/a.max_score*100,className:"h-2"})]}),e.jsxs("div",{className:"pt-4 border-t space-y-2",children:[e.jsx(m,{className:"w-full",onClick:async()=>{if(!(!a||!h))try{const{error:s}=await N.from("past_papers").update({score:a.score,max_score:a.max_score,completed_at:a.score!==null?new Date().toISOString():null}).eq("id",a.id);if(s)throw s;u({title:"Review Saved",description:"Your scores have been updated."}),y(null),U()}catch(s){u({title:"Error",description:s.message,variant:"destructive"})}},children:"Save Results"}),e.jsx(m,{variant:"outline",className:"w-full",onClick:()=>y(null),children:"Close"})]})]})]})]})})]})}export{xs as default};
