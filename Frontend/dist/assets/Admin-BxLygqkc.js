import{c as D,r as n,j as e,a as m,u as Y,b as Z,d as c,L as R,S as b,B as p}from"./index-7wMNJNZJ.js";import{i as ee,A as U,C as _}from"./AppLayout-Cb4f3Rcb.js";import{D as se,a as ae,b as te,c as re,d as ie,e as ne}from"./dialog-CGZvDN6x.js";import{I as le}from"./input-CURGwIC-.js";import{U as ce}from"./users-BPQvDXIc.js";import{T as oe}from"./trending-up-BHQkB8Iw.js";import{S as de}from"./search-D5Hb3sC3.js";import{E as me}from"./eye-COppsmZo.js";import"./AnimatedLogoIcon-DY32PEux.js";import"./sheet-D4eoD1m7.js";import"./sun-CnDoiXzg.js";const z=D("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);const xe=D("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);const he=D("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),E=n.forwardRef(({className:t,...a},l)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:l,className:m("w-full caption-bottom text-sm",t),...a})}));E.displayName="Table";const B=n.forwardRef(({className:t,...a},l)=>e.jsx("thead",{ref:l,className:m("[&_tr]:border-b",t),...a}));B.displayName="TableHeader";const L=n.forwardRef(({className:t,...a},l)=>e.jsx("tbody",{ref:l,className:m("[&_tr:last-child]:border-0",t),...a}));L.displayName="TableBody";const ue=n.forwardRef(({className:t,...a},l)=>e.jsx("tfoot",{ref:l,className:m("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...a}));ue.displayName="TableFooter";const A=n.forwardRef(({className:t,...a},l)=>e.jsx("tr",{ref:l,className:m("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",t),...a}));A.displayName="TableRow";const h=n.forwardRef(({className:t,...a},l)=>e.jsx("th",{ref:l,className:m("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...a}));h.displayName="TableHead";const u=n.forwardRef(({className:t,...a},l)=>e.jsx("td",{ref:l,className:m("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...a}));u.displayName="TableCell";const pe=n.forwardRef(({className:t,...a},l)=>e.jsx("caption",{ref:l,className:m("mt-4 text-sm text-muted-foreground",t),...a}));pe.displayName="TableCaption";const f=window.location.origin;function Ue(){const{user:t,supabase:a}=Y(),l=Z(),[H,C]=n.useState(!0),[v,M]=n.useState(!1),[q,J]=n.useState([]),[x,G]=n.useState(null),[w,O]=n.useState(""),[F,$]=n.useState(null),[o,P]=n.useState(null),[j,k]=n.useState(1),[y,Q]=n.useState(1);n.useEffect(()=>{X()},[t]);const X=async()=>{if(!t||!a){l("/");return}const s=await ee(a,t.id);if(M(s),!s){c.error("Admin access required"),l("/");return}I()},I=async()=>{if(!(!t||!a)){C(!0);try{await Promise.all([g(),S()])}catch{c.error("Failed to load admin data")}finally{C(!1)}}},g=async()=>{if(!(!t||!a))try{const{data:{session:s}}=await a.auth.getSession();if(!s)return;const r=await fetch(`${f}/api/admin/users?page=${j}&limit=20&search=${w}`,{headers:{Authorization:`Bearer ${s.access_token}`}}),i=await r.json();r.ok?(J(i.users||[]),Q(i.pagination?.totalPages||1)):c.error(i.error||"Failed to load users")}catch{c.error("Failed to load users")}},S=async()=>{if(!(!t||!a))try{const{data:{session:s}}=await a.auth.getSession();if(!s)return;const r=await fetch(`${f}/api/admin/stats`,{headers:{Authorization:`Bearer ${s.access_token}`}}),i=await r.json();r.ok&&G(i)}catch{}},T=async s=>{if(!(!t||!a))try{const{data:{session:r}}=await a.auth.getSession();if(!r)return;const i=await fetch(`${f}/api/admin/users/${s}`,{headers:{Authorization:`Bearer ${r.access_token}`}}),d=await i.json();i.ok?P(d):c.error(d.error||"Failed to load user details")}catch{c.error("Failed to load user details")}},K=async(s,r)=>{if(!(!t||!a))try{const{data:{session:i}}=await a.auth.getSession();if(!i)return;const d=await fetch(`${f}/api/admin/users/${s}/premium`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.access_token}`},body:JSON.stringify({is_premium:r})}),N=await d.json();d.ok?(c.success(N.message||`Premium access ${r?"granted":"revoked"}`),g(),S(),F?.id===s&&T(s)):c.error(N.error||"Failed to update premium status")}catch{c.error("Failed to update premium status")}},V=async(s,r)=>{if(!(!t||!a))try{const{data:{session:i}}=await a.auth.getSession();if(!i)return;const d=await fetch(`${f}/api/admin/users/${s}/admin`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.access_token}`},body:JSON.stringify({is_admin:r})}),N=await d.json();d.ok?(c.success(N.message||`Admin access ${r?"granted":"revoked"}`),g(),F?.id===s&&T(s)):c.error(N.error||"Failed to update admin status")}catch{c.error("Failed to update admin status")}},W=async s=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone.")&&!(!t||!a))try{const{data:{session:r}}=await a.auth.getSession();if(!r)return;const i=await fetch(`${f}/api/admin/users/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${r.access_token}`}}),d=await i.json();i.ok?(c.success("User deleted successfully"),g(),S(),$(null),P(null)):c.error(d.error||"Failed to delete user")}catch{c.error("Failed to delete user")}};return n.useEffect(()=>{v&&g()},[j,w,v]),v?H&&!x?e.jsx(U,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(R,{className:"h-8 w-8 animate-spin text-primary"})})}):e.jsx(U,{children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(b,{className:"h-8 w-8 text-premium"}),"Admin Dashboard"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage users, subscriptions, and payments"})]})}),x&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"glass-card p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ce,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Users"})]}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:x.totalUsers})]}),e.jsxs("div",{className:"glass-card p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(_,{className:"h-5 w-5 text-premium"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Premium Users"})]}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:x.premiumUsers})]}),e.jsxs("div",{className:"glass-card p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(oe,{className:"h-5 w-5 text-secondary"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Active Subs"})]}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:x.activeSubscriptions})]}),e.jsxs("div",{className:"glass-card p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(z,{className:"h-5 w-5 text-accent"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Revenue"})]}),e.jsxs("p",{className:"text-2xl font-bold text-foreground",children:["£",x.totalRevenue.toFixed(2)]})]}),e.jsxs("div",{className:"glass-card p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(z,{className:"h-5 w-5 text-secondary"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Monthly Revenue"})]}),e.jsxs("p",{className:"text-2xl font-bold text-foreground",children:["£",x.monthlyRevenue.toFixed(2)]})]})]}),e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Users"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(le,{placeholder:"Search users...",value:w,onChange:s=>{O(s.target.value),k(1)},className:"pl-9 w-64"})]})})]}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(E,{children:[e.jsx(B,{children:e.jsxs(A,{children:[e.jsx(h,{children:"Email"}),e.jsx(h,{children:"Name"}),e.jsx(h,{children:"Premium"}),e.jsx(h,{children:"Admin"}),e.jsx(h,{children:"Joined"}),e.jsx(h,{className:"text-right",children:"Actions"})]})}),e.jsx(L,{children:q.map(s=>e.jsxs(A,{children:[e.jsx(u,{className:"font-medium",children:s.email}),e.jsx(u,{children:s.full_name||"—"}),e.jsx(u,{children:s.is_premium?e.jsxs("span",{className:"inline-flex items-center gap-1 text-premium",children:[e.jsx(_,{className:"h-4 w-4"}),"Premium"]}):e.jsx("span",{className:"text-muted-foreground",children:"Free"})}),e.jsx(u,{children:s.is_admin?e.jsxs("span",{className:"inline-flex items-center gap-1 text-premium",children:[e.jsx(b,{className:"h-4 w-4"}),"Admin"]}):e.jsx("span",{className:"text-muted-foreground",children:"—"})}),e.jsx(u,{className:"text-sm text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()}),e.jsx(u,{className:"text-right",children:e.jsx("div",{className:"flex items-center justify-end gap-2",children:e.jsxs(se,{children:[e.jsx(ae,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>{$(s),T(s.id)},children:e.jsx(me,{className:"h-4 w-4"})})}),e.jsxs(te,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(re,{children:[e.jsx(ie,{children:"User Details"}),e.jsx(ne,{children:"Manage user account and permissions"})]}),o&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Profile"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Email:"})," ",o.profile.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Name:"})," ",o.profile.full_name||"—"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Joined:"})," ",new Date(o.profile.created_at).toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Permissions"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Premium:"}),e.jsx(p,{variant:o.profile.is_premium?"default":"outline",size:"sm",onClick:()=>K(s.id,!o.profile.is_premium),children:o.profile.is_premium?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),"Revoke"]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-4 w-4 mr-1"}),"Grant"]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Admin:"}),e.jsx(p,{variant:o.profile.is_admin?"default":"outline",size:"sm",onClick:()=>V(s.id,!o.profile.is_admin),children:o.profile.is_admin?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-4 w-4 mr-1"}),"Revoke"]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-4 w-4 mr-1"}),"Grant"]})})]})]})]}),o.subscription&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Subscription"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Plan:"})," ",o.subscription.plan_type]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Status:"})," ",o.subscription.status]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Period End:"})," ",new Date(o.subscription.current_period_end).toLocaleDateString()]})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsxs(p,{variant:"destructive",size:"sm",onClick:()=>W(s.id),children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Delete User"]})})]})]})]})})})]},s.id))})]})}),y>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Page ",j," of ",y]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>k(s=>Math.max(1,s-1)),disabled:j===1,children:"Previous"}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>k(s=>Math.min(y,s+1)),disabled:j===y,children:"Next"})]})]})]})]})}):e.jsx(U,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(R,{className:"h-8 w-8 animate-spin text-primary"})})})}export{Ue as default};
