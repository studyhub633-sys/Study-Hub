import{j as e,L as H,ax as p,X as D,aX as Q,a4 as A}from"./ui-vendor-DvDVRjyp.js";import{A as h,h as Y}from"./AppLayout-DSG6wxEf.js";import{L as M}from"./LimitReachedDialog-CC6bCfVB.js";import{u as W,k as X,B as m}from"./index-DEqmCALs.js";import{C as x,a as f,b as g,c as j,d as v}from"./card-C99jCs8O.js";import{T as $}from"./textarea-F7PLQ3VZ.js";import{c as J}from"./ai-client-BhyPJ4fF.js";import{r as t}from"./react-vendor-Do86TxWo.js";import"./AnimatedLogoIcon-D6d7HWVb.js";import"./sheet-DlQTD0RE.js";import"./supabase-vendor-C2nLxrxH.js";import"./query-vendor-Bk-KKE7Z.js";function oe(){const{supabase:u,user:y}=W(),{toast:l}=X(),[o,R]=t.useState(""),[b,N]=t.useState(!1),[c,w]=t.useState(null),[i,k]=t.useState(null),[F,S]=t.useState(null),d=t.useRef(null),[q,E]=t.useState(!1),[L,I]=t.useState(!0);t.useEffect(()=>{(async()=>{if(!y||!u){I(!1);return}try{const s=await Y(u);E(s)}catch{}finally{I(!1)}})()},[y]);const T=r=>{var n;const s=(n=r.target.files)==null?void 0:n[0];if(!s)return;if(!s.type.startsWith("image/")){l({title:"Invalid file",description:"Please upload an image file (PNG, JPG, GIF, etc.)",variant:"destructive"});return}if(s.size>5*1024*1024){l({title:"File too large",description:"Please upload an image smaller than 5MB",variant:"destructive"});return}const a=new FileReader;a.onload=G=>{var P;k((P=G.target)==null?void 0:P.result),S(s.name),l({title:"Image uploaded",description:"You can add a specific question or just click Solve to analyze the image."})},a.readAsDataURL(s)},U=()=>{k(null),S(null),d.current&&(d.current.value="")},z=async()=>{var r;if(!o.trim()&&!i){l({title:"Error",description:"Please enter a question or upload an image to solve.",variant:"destructive"});return}N(!0),w(null);try{let s="Please solve this homework question step-by-step. Provide a clear explanation of each step, show your work, and explain the reasoning behind each step. If applicable, identify the key concepts being tested.";o&&(s+=`

Question: ${o}`);const a=await J({message:s,context:"You are an expert tutor who provides clear, step-by-step solutions to homework problems. Always show your work and explain your reasoning.",image:i||void 0},u);if(a.error){if(a.error.includes("limit")||a.error.includes("429")){C(!0);return}throw new Error(a.error)}const n=(r=a.data)==null?void 0:r.reply;if(n)w(n),l({title:"Success",description:"Solution generated successfully!"});else throw new Error("No response from AI")}catch(s){l({title:"Error",description:s.message||"Failed to solve question. Please try again.",variant:"destructive"})}finally{N(!1)}},[B,C]=t.useState(!1);return L?e.jsx(h,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(H,{className:"h-8 w-8 animate-spin text-primary"})})}):q?e.jsxs(h,{children:[e.jsx(M,{open:B,onOpenChange:C}),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-fade-in pb-12",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 rounded-xl bg-purple-500/10 text-purple-500",children:e.jsx(p,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"AI Homework Solver"}),e.jsx("p",{className:"text-muted-foreground",children:"Get instant, step-by-step solutions for any subject."})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(x,{children:[e.jsxs(f,{children:[e.jsx(g,{children:"Your Question"}),e.jsx(j,{children:"Type your question or upload an image"})]}),e.jsxs(v,{className:"space-y-4",children:[i&&e.jsxs("div",{className:"relative rounded-lg border-2 border-dashed border-purple-500/30 p-2 bg-purple-500/5",children:[e.jsx("img",{src:i,alt:"Uploaded homework",className:"max-h-[150px] w-full object-contain rounded"}),e.jsx(m,{variant:"destructive",size:"icon",className:"absolute top-1 right-1 h-6 w-6 rounded-full",onClick:U,children:e.jsx(D,{className:"h-3 w-3"})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1 text-center truncate",children:F})]}),e.jsx($,{placeholder:i?"Add any specific instructions or context for the image...":"Paste your homework question here...",className:"min-h-[150px] resize-none",value:o,onChange:r=>R(r.target.value)}),e.jsx("input",{type:"file",ref:d,accept:"image/*",onChange:T,className:"hidden"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(m,{variant:"outline",className:"flex-1",onClick:()=>{var r;return(r=d.current)==null?void 0:r.click()},children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),i?"Change Image":"Upload Image"]}),e.jsx(m,{className:"flex-1 bg-purple-600 hover:bg-purple-700",onClick:z,disabled:!o&&!i||b,children:b?e.jsx(e.Fragment,{children:"Processing..."}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Solve with AI"]})})]})]})]}),e.jsxs(x,{className:`border-purple-500/20 ${c?"bg-purple-500/5":""}`,children:[e.jsxs(f,{children:[e.jsx(g,{children:"AI Solution"}),e.jsx(j,{children:c?"Analysis complete":"Solution will appear here"})]}),e.jsx(v,{children:c?e.jsxs("div",{className:"prose dark:prose-invert max-h-[400px] overflow-y-auto",children:[e.jsx("p",{className:"whitespace-pre-line",children:c}),e.jsxs("div",{className:"mt-6 p-4 bg-purple-500/10 rounded-lg border border-purple-500/20",children:[e.jsxs("h4",{className:"font-semibold text-purple-400 mb-2 flex items-center",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Key Concept"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This problem relates to [Topic Name]. Mastering this concept will help you solve similar problems in the future."})]})]}):e.jsxs("div",{className:"h-[200px] flex flex-col items-center justify-center text-muted-foreground opacity-50",children:[e.jsx(p,{className:"w-12 h-12 mb-4"}),e.jsx("p",{children:"Ready to solve"})]})})]})]})]})]}):e.jsx(h,{children:e.jsx("div",{className:"max-w-4xl mx-auto py-12",children:e.jsxs(x,{className:"border-amber-500/20 bg-amber-500/5",children:[e.jsxs(f,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-6 h-6 text-amber-500"}),"Premium Feature"]}),e.jsx(j,{children:"AI Homework Solver is a premium feature"})]}),e.jsxs(v,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Upgrade to premium to get instant, step-by-step solutions for any subject."}),e.jsx(m,{onClick:()=>window.location.href="/premium-dashboard",className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:"View Premium Plans"})]})]})})})}export{oe as default};
