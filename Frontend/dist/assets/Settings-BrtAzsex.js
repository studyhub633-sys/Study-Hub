import{u as Y,p as Z,j as e,e as J,o as q,g as Q,a6 as ee,aY as se,bj as te,S as L,bk as ae,L as U,a7 as ie,z as $,bl as re,b6 as ne,$ as le}from"./ui-vendor-DvDVRjyp.js";import{A as oe,a as ce,b as de,c as me}from"./AppLayout-DSG6wxEf.js";import{s as ue,t as pe,c as I,u as fe,l as he,k as ge,j as xe,B as C}from"./index-DEqmCALs.js";import{I as E}from"./input-CG8Ib3hH.js";import{L as k}from"./label-lvNOnDGI.js";import{S as ve,a as je,b as be,c as ye,d as T}from"./select-9ZKIQjAc.js";import{r as c}from"./react-vendor-Do86TxWo.js";import"./AnimatedLogoIcon-D6d7HWVb.js";import"./sheet-DlQTD0RE.js";import"./supabase-vendor-C2nLxrxH.js";import"./query-vendor-Bk-KKE7Z.js";import"./index-BdQq_4o_.js";import"./index-Du_rhl89.js";var R="Switch",[Ne]=J(R),[we,_e]=Ne(R),z=c.forwardRef((r,a)=>{const{__scopeSwitch:l,name:x,checked:f,defaultChecked:d,required:s,disabled:m,value:b="on",onCheckedChange:S,form:v,...j}=r,[h,y]=c.useState(null),t=Y(a,w=>y(w)),u=c.useRef(!1),P=h?v||!!h.closest("form"):!0,[N,A]=Z({prop:f,defaultProp:d??!1,onChange:S,caller:R});return e.jsxs(we,{scope:l,checked:N,disabled:m,children:[e.jsx(q.button,{type:"button",role:"switch","aria-checked":N,"aria-required":s,"data-state":O(N),"data-disabled":m?"":void 0,disabled:m,value:b,...j,ref:t,onClick:Q(r.onClick,w=>{A(D=>!D),P&&(u.current=w.isPropagationStopped(),u.current||w.stopPropagation())})}),P&&e.jsx(G,{control:h,bubbles:!u.current,name:x,value:b,checked:N,required:s,disabled:m,form:v,style:{transform:"translateX(-100%)"}})]})});z.displayName=R;var M="SwitchThumb",H=c.forwardRef((r,a)=>{const{__scopeSwitch:l,...x}=r,f=_e(M,l);return e.jsx(q.span,{"data-state":O(f.checked),"data-disabled":f.disabled?"":void 0,...x,ref:a})});H.displayName=M;var Ce="SwitchBubbleInput",G=c.forwardRef(({__scopeSwitch:r,control:a,checked:l,bubbles:x=!0,...f},d)=>{const s=c.useRef(null),m=Y(s,d),b=ue(l),S=pe(a);return c.useEffect(()=>{const v=s.current;if(!v)return;const j=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(j,"checked").set;if(b!==l&&y){const t=new Event("click",{bubbles:x});y.call(v,l),v.dispatchEvent(t)}},[b,l,x]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:l,...f,tabIndex:-1,ref:m,style:{...f.style,...S,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});G.displayName=Ce;function O(r){return r?"checked":"unchecked"}var V=z,ke=H;const W=c.forwardRef(({className:r,...a},l)=>e.jsx(V,{className:I("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",r),...a,ref:l,children:e.jsx(ke,{className:I("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));W.displayName=V.displayName;function Ye(){var B;const{supabase:r,user:a}=fe(),{theme:l,toggleTheme:x,setTheme:f}=he(),{toast:d}=ge(),{t:s}=xe(),[m,b]=c.useState("profile"),[S,v]=c.useState(!0),[j,h]=c.useState(!1),y=[{icon:ee,label:s("settings.profile.title"),id:"profile"},{icon:se,label:s("settings.notifications.title"),id:"notifications"},{icon:te,label:s("settings.appearance.title"),id:"appearance"},{icon:L,label:s("settings.privacy.title"),id:"privacy"},{icon:ae,label:s("settings.subscription.title"),id:"subscription"}],[t,u]=c.useState({full_name:"",email:"",first_name:"",last_name:"",school:"",year_group:"",subjects:"",avatar_url:"",is_premium:!1}),[P,N]=c.useState({studyReminders:!0,progressUpdates:!0,newContentAlerts:!1,achievementNotifications:!0});c.useEffect(()=>{if(!a)return;(async()=>{var o,g;try{const{data:n,error:p}=await r.from("profiles").select("*").eq("id",a.id).single();if(p&&p.code,n){const _=((o=n.full_name)==null?void 0:o.split(" "))||[],F=_[0]||"",X=_.slice(1).join(" ")||"";u({full_name:n.full_name||"",email:n.email||a.email||"",first_name:F,last_name:X,school:n.school||"",year_group:n.year_group||"",subjects:n.subjects||"",avatar_url:n.avatar_url||"",is_premium:n.is_premium||!1})}else u({full_name:((g=a.email)==null?void 0:g.split("@")[0])||"",email:a.email||"",first_name:"",last_name:"",school:"",year_group:"",subjects:"",avatar_url:"",is_premium:!1})}catch{}finally{v(!1)}})()},[a,r]);const A=async i=>{var n;const o=(n=i.target.files)==null?void 0:n[0];if(!o)return;if(!o.type.startsWith("image/")){d({title:"Invalid file type",description:"Please upload an image file.",variant:"destructive"});return}if(o.size>2*1024*1024){d({title:"File too large",description:"Please upload an image smaller than 2MB.",variant:"destructive"});return}const g=new FileReader;g.onloadend=async()=>{const p=g.result;if(u({...t,avatar_url:p}),a)try{const{error:_}=await r.from("profiles").upsert({id:a.id,avatar_url:p},{onConflict:"id"});if(_)throw _;const F=`avatar_url_${a.id}`;localStorage.setItem(F,p),window.dispatchEvent(new CustomEvent("avatarUpdated",{detail:{avatarUrl:p}})),window.dispatchEvent(new StorageEvent("storage",{key:F,newValue:p,storageArea:localStorage})),d({title:"Avatar updated",description:"Your profile picture has been updated."})}catch{d({title:"Error",description:"Failed to save avatar. Please try again.",variant:"destructive"})}},g.onerror=()=>{d({title:"Error",description:"Failed to read image file.",variant:"destructive"})},g.readAsDataURL(o)},w=async()=>{var i;if(a){h(!0);try{const o=t.first_name&&t.last_name?`${t.first_name} ${t.last_name}`:t.first_name||t.last_name||t.full_name||"";if(t.email&&t.email!==a.email){const{error:p}=await r.auth.updateUser({email:t.email});if(p)throw p}const g={id:a.id,email:t.email||a.email,full_name:o,avatar_url:t.avatar_url||null,school:t.school||null,year_group:t.year_group||null,subjects:t.subjects||null},{error:n}=await r.from("profiles").upsert(g,{onConflict:"id"});if(n)throw(i=n.message)!=null&&i.includes("column")||n.code==="42703"?new Error("School, year group, and subjects fields are not available. Please run the database migration (add_profile_fields.sql) first."):n;d({title:"Profile updated",description:t.email!==a.email?"Your profile has been updated. Please check your email to verify the new address.":"Your profile information has been saved successfully."})}catch(o){d({title:"Error",description:o.message||"Failed to save profile. Please try again.",variant:"destructive"})}finally{h(!1)}}},D=t.first_name&&t.last_name?`${t.first_name} ${t.last_name}`:t.full_name||((B=t.email)==null?void 0:B.split("@")[0])||"User",K=t.first_name&&t.last_name?`${t.first_name[0]}${t.last_name[0]}`:D.substring(0,2).toUpperCase();return e.jsx(oe,{children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground",children:"Settings"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"md:col-span-1",children:e.jsx("nav",{className:"space-y-1 animate-slide-up",style:{animationDelay:"0.1s",opacity:0},children:y.map(i=>e.jsxs("button",{onClick:()=>b(i.id),className:I("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors",m===i.id?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-muted"),children:[e.jsx(i.icon,{className:"h-4 w-4"}),i.label]},i.id))})}),e.jsx("div",{className:"md:col-span-3 space-y-6",children:S?e.jsx("div",{className:"glass-card p-6 flex items-center justify-center",children:e.jsx(U,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):e.jsxs(e.Fragment,{children:[m==="profile"&&e.jsxs("div",{className:"glass-card p-6 animate-slide-up",style:{animationDelay:"0.2s",opacity:0},children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-6",children:s("settings.profile.heading")}),e.jsxs("div",{className:"flex items-center gap-6 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(ce,{className:"h-20 w-20 border-4 border-primary/20",children:[e.jsx(de,{src:t.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${a==null?void 0:a.email}`}),e.jsx(me,{children:K})]}),e.jsxs("label",{className:"absolute bottom-0 right-0 p-1.5 rounded-full bg-primary text-primary-foreground shadow-lg hover:bg-primary/90 transition-colors cursor-pointer",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("input",{type:"file",accept:"image/*",onChange:A,className:"hidden"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground",children:D}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.email||(a==null?void 0:a.email)}),e.jsx("div",{className:"flex items-center gap-1 mt-1",children:t.is_premium?e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gradient-to-r from-yellow-400 to-yellow-600 text-white font-medium flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"})," ",s("settings.profile.premiumUser")]}):e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-primary/10 text-primary",children:s("settings.profile.freePlan")})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"firstName",children:s("settings.profile.firstName")}),e.jsx(E,{id:"firstName",value:t.first_name,onChange:i=>u({...t,first_name:i.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"lastName",children:s("settings.profile.lastName")}),e.jsx(E,{id:"lastName",value:t.last_name,onChange:i=>u({...t,last_name:i.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"email",children:s("settings.profile.email")}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(E,{id:"email",type:"email",value:t.email,onChange:i=>u({...t,email:i.target.value}),className:"pl-9"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s("settings.profile.emailHint")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"school",children:s("settings.profile.school")}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(E,{id:"school",value:t.school,onChange:i=>u({...t,school:i.target.value}),className:"pl-9"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"year",children:s("settings.profile.yearGroup")}),e.jsxs(ve,{value:t.year_group,onValueChange:i=>u({...t,year_group:i}),children:[e.jsx(je,{children:e.jsx(be,{placeholder:s("settings.profile.selectYearGroup")})}),e.jsxs(ye,{children:[e.jsx(T,{value:"10",children:"Year 10"}),e.jsx(T,{value:"11",children:"Year 11"}),e.jsx(T,{value:"12",children:"Year 12"}),e.jsx(T,{value:"13",children:"Year 13"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"subjects",children:s("settings.profile.subjects")}),e.jsx(E,{id:"subjects",value:t.subjects,onChange:i=>u({...t,subjects:i.target.value}),placeholder:s("settings.profile.subjectsPlaceholder")})]})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx(C,{onClick:w,disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mr-2 h-4 w-4 animate-spin"}),s("settings.profile.saving")]}):s("settings.profile.saveChanges")})})]}),m==="notifications"&&e.jsxs("div",{className:"glass-card p-6 animate-slide-up",style:{animationDelay:"0.3s",opacity:0},children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-6",children:s("settings.notifications.title")}),e.jsx("div",{className:"space-y-4",children:[{key:"studyReminders",label:s("settings.notifications.studyReminders"),description:s("settings.notifications.studyRemindersDesc")},{key:"progressUpdates",label:s("settings.notifications.progressUpdates"),description:s("settings.notifications.progressUpdatesDesc")},{key:"newContentAlerts",label:s("settings.notifications.newContentAlerts"),description:s("settings.notifications.newContentAlertsDesc")},{key:"achievementNotifications",label:s("settings.notifications.achievementNotifications"),description:s("settings.notifications.achievementNotificationsDesc")}].map(i=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:i.label}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.description})]}),e.jsx(W,{checked:P[i.key],onCheckedChange:o=>N({...P,[i.key]:o})})]},i.key))})]}),m==="appearance"&&e.jsxs("div",{className:"glass-card p-6 animate-slide-up",style:{animationDelay:"0.3s",opacity:0},children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-6",children:s("settings.appearance.title")}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s("settings.appearance.theme")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("settings.appearance.themeDesc")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{variant:l==="light"?"default":"outline",size:"sm",onClick:()=>f("light"),children:s("settings.appearance.light")}),e.jsx(C,{variant:l==="dark"?"default":"outline",size:"sm",onClick:()=>f("dark"),children:s("settings.appearance.dark")})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s("settings.appearance.quickToggle")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("settings.appearance.quickToggleDesc")})]}),e.jsx(C,{variant:"outline",size:"sm",onClick:x,className:"gap-2",children:l==="light"?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"ðŸŒ™"})," ",s("settings.appearance.switchToDark")]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â˜€ï¸"})," ",s("settings.appearance.switchToLight")]})})]})]})]}),m==="privacy"&&e.jsxs("div",{className:"glass-card p-6 animate-slide-up",style:{animationDelay:"0.3s",opacity:0},children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-6",children:s("settings.privacy.heading")}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"p-4 rounded-xl bg-destructive/10 border border-destructive/20",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-2",children:s("settings.privacy.dangerZone")}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:s("settings.privacy.deleteWarning")}),e.jsx(C,{variant:"destructive",onClick:async()=>{if(confirm(s("settings.privacy.deleteConfirm1"))&&confirm(s("settings.privacy.deleteConfirm2"))){h(!0);try{const i=["notes","flashcards","past_papers","knowledge_organizers","extracurriculars"];for(const o of i)await r.from(o).delete().eq("user_id",a==null?void 0:a.id);await r.from("profiles").delete().eq("id",a==null?void 0:a.id),await r.auth.signOut(),d({title:s("settings.privacy.deletionInitiated"),description:s("settings.privacy.deletionInitiatedDesc")}),window.location.href="/landing"}catch(i){d({title:s("common.error"),description:i.message||"Failed to delete account. Please contact support.",variant:"destructive"})}finally{h(!1)}}},disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mr-2 h-4 w-4 animate-spin"}),s("settings.privacy.deleting")]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),s("settings.privacy.deleteAccount")]})})]})})]}),m==="subscription"&&e.jsxs("div",{className:"glass-card p-6 animate-slide-up",style:{animationDelay:"0.4s",opacity:0},children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-6",children:s("settings.subscription.title")}),e.jsx("div",{className:"p-4 rounded-xl bg-muted/50 border border-border mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:t.is_premium?s("settings.subscription.premiumPlan"):s("settings.subscription.freePlan")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.is_premium?s("settings.subscription.premiumDesc"):s("settings.subscription.freeDesc")})]}),!t.is_premium&&e.jsxs(C,{className:"bg-premium hover:bg-premium/90 text-premium-foreground",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),s("settings.subscription.upgradeToPremium")]}),t.is_premium&&e.jsxs("div",{className:"flex items-center text-green-500 font-medium",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),s("settings.subscription.active")]})]})}),!t.is_premium&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s("settings.subscription.upgradeHint")})]})]})})]})]})})}export{Ye as default};
