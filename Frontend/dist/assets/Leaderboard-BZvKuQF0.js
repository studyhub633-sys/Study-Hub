import{j as e,L as C,ac as o,aZ as X}from"./ui-vendor-BhfTkEdL.js";import{A as h,a as i,b as d,c as x,h as q}from"./AppLayout-DyYlXr0M.js";import{B as D}from"./badge-DYsJC1XO.js";import{u as Y,k as $,B as z}from"./index-BWIqSF27.js";import{C as p,a as U,b as L,c as G,d as _}from"./card-af-OxtCo.js";import{r as l}from"./react-vendor-Do86TxWo.js";import"./AnimatedLogoIcon-BNgjqHPG.js";import"./sheet-ByTzbT0g.js";import"./supabase-vendor-CklQTOeK.js";import"./query-vendor-C5_dwEAA.js";function se(){var g,b,w,v,N,y,k,P,S;const{supabase:c,user:r}=Y(),{toast:f}=$(),[A,u]=l.useState(!0),[a,n]=l.useState([]),[E,R]=l.useState(!1),[T,j]=l.useState(!0);l.useEffect(()=>{(async()=>{if(!r||!c){j(!1);return}try{const m=await q(c);R(m)}catch{}finally{j(!1)}})()},[r]),l.useEffect(()=>{B()},[r]);const B=async()=>{try{u(!0);const{data:s,error:m}=await c.rpc("get_leaderboard",{limit_count:50});if(m){(m.message.includes("function")||m.code==="42883")&&f({title:"Setup Required",description:"Please run the leaderboard_function.sql migration in Supabase to enable the leaderboard.",variant:"destructive"}),n([]);return}if(s&&s.length>0){const I=s.map(t=>({rank:t.rank,name:t.name,xp:t.xp,streak:t.streak,avatar:t.avatar_url,user_id:t.user_id,isUser:t.user_id===(r==null?void 0:r.id)}));n(I)}else n([])}catch{f({title:"Error",description:"Failed to load leaderboard. Please try again later.",variant:"destructive"}),n([])}finally{u(!1)}},F=s=>s.toLocaleString();return T?e.jsx(h,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(C,{className:"h-8 w-8 animate-spin text-primary"})})}):E?e.jsx(h,{children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-fade-in pb-12",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-orange-500/10 text-orange-500",children:e.jsx(o,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Study Leaderboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Review your weekly rankings and compete with peers."})]})]}),A?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(C,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):a.length===0?e.jsx(p,{className:"p-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"p-4 rounded-full bg-orange-500/10",children:e.jsx(o,{className:"w-12 h-12 text-orange-500"})}),e.jsx("h3",{className:"text-xl font-semibold",children:"No Rankings Yet"}),e.jsx("p",{className:"text-muted-foreground max-w-md",children:"The leaderboard will populate as students start studying. Create notes, flashcards, or use the AI Tutor to earn XP and appear on the leaderboard!"}),e.jsx("div",{className:"flex gap-3 mt-4",children:e.jsx("a",{href:"/",className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 transition-colors",children:"Start Studying"})})]})}):e.jsxs(e.Fragment,{children:[a.length>=3&&e.jsxs("div",{className:"flex items-end justify-center gap-3 sm:gap-4 md:gap-6 lg:gap-8 h-64 sm:h-64 md:h-64 mt-8 sm:mt-12 mb-8 sm:mb-10 md:mb-12 px-4 sm:px-6 md:px-8",children:[e.jsxs("div",{className:"flex flex-col items-center w-[28%] sm:w-[30%] md:flex-1 min-w-[80px] sm:min-w-[100px] md:max-w-[140px] lg:max-w-none",children:[e.jsxs(i,{className:"w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 lg:w-16 lg:h-16 border-2 sm:border-4 border-slate-300 mb-1 sm:mb-2",children:[e.jsx(d,{src:((g=a[1])==null?void 0:g.avatar)||void 0}),e.jsx(x,{children:((b=a[1])==null?void 0:b.name[0])||"2"})]}),e.jsx("div",{className:"w-full h-20 sm:h-22 md:h-24 bg-slate-200 dark:bg-slate-800 rounded-t-xl flex items-center justify-center text-lg sm:text-xl md:text-2xl font-bold text-slate-400",children:"2"}),e.jsx("span",{className:"font-semibold text-[10px] sm:text-xs md:text-sm mt-1 sm:mt-2 truncate max-w-full text-center px-1",children:((w=a[1])==null?void 0:w.name)||"User"})]}),e.jsxs("div",{className:"flex flex-col items-center w-[32%] sm:w-[34%] md:flex-1 min-w-[90px] sm:min-w-[110px] md:max-w-[160px] lg:max-w-none z-10 relative",children:[e.jsxs(i,{className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 lg:w-20 lg:h-20 border-2 sm:border-4 border-yellow-400 mb-1 sm:mb-2 ring-2 sm:ring-4 ring-yellow-400/20",children:[e.jsx(d,{src:((v=a[0])==null?void 0:v.avatar)||void 0}),e.jsx(x,{children:((N=a[0])==null?void 0:N.name[0])||"1"})]}),e.jsx("div",{className:"w-full h-28 sm:h-30 md:h-32 bg-yellow-400/20 border border-yellow-400 rounded-t-xl flex items-center justify-center text-2xl sm:text-3xl md:text-4xl font-bold text-yellow-600",children:"1"}),e.jsx("span",{className:"font-semibold text-[10px] sm:text-xs md:text-sm mt-1 sm:mt-2 truncate max-w-full text-center px-1",children:((y=a[0])==null?void 0:y.name)||"User"})]}),e.jsxs("div",{className:"flex flex-col items-center w-[28%] sm:w-[30%] md:flex-1 min-w-[80px] sm:min-w-[100px] md:max-w-[140px] lg:max-w-none",children:[e.jsxs(i,{className:"w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 lg:w-16 lg:h-16 border-2 sm:border-4 border-amber-600 mb-1 sm:mb-2",children:[e.jsx(d,{src:((k=a[2])==null?void 0:k.avatar)||void 0}),e.jsx(x,{children:((P=a[2])==null?void 0:P.name[0])||"3"})]}),e.jsx("div",{className:"w-full h-16 sm:h-18 md:h-20 bg-amber-700/20 rounded-t-xl flex items-center justify-center text-lg sm:text-xl md:text-2xl font-bold text-amber-700",children:"3"}),e.jsx("span",{className:"font-semibold text-[10px] sm:text-xs md:text-sm mt-1 sm:mt-2 truncate max-w-full text-center px-1",children:((S=a[2])==null?void 0:S.name)||"User"})]})]}),e.jsxs(p,{children:[e.jsx(U,{children:e.jsx(L,{children:"Global Rankings"})}),e.jsx(_,{className:"p-0",children:e.jsx("div",{className:"divide-y",children:a.map(s=>e.jsxs("div",{className:`flex items-center p-4 gap-4 ${s.isUser?"bg-primary/5":"hover:bg-muted/50"}`,children:[e.jsx("div",{className:"w-8 text-center font-bold text-muted-foreground",children:s.rank<=3?e.jsx(X,{className:`w-5 h-5 mx-auto ${s.rank===1?"text-yellow-500":s.rank===2?"text-slate-400":"text-amber-600"}`}):s.rank}),e.jsxs(i,{children:[e.jsx(d,{src:s.avatar||void 0}),e.jsx(x,{children:s.name[0]})]}),e.jsx("div",{className:"flex-1",children:e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[s.name,s.isUser&&e.jsx(D,{variant:"secondary",className:"text-[10px]",children:"YOU"})]})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold",children:[F(s.xp)," XP"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.streak," day streak"]})]})]},s.user_id))})})]})]})]})}):e.jsx(h,{children:e.jsx("div",{className:"max-w-4xl mx-auto py-12",children:e.jsxs(p,{className:"border-amber-500/20 bg-amber-500/5",children:[e.jsxs(U,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(o,{className:"w-6 h-6 text-amber-500"}),"Premium Feature"]}),e.jsx(G,{children:"Study Leaderboard is a premium feature"})]}),e.jsxs(_,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Upgrade to premium to see your weekly rankings and compete with peers."}),e.jsx(z,{onClick:()=>window.location.href="/premium-dashboard",className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:"View Premium Plans"})]})]})})})}export{se as default};
