import{c as J,r as t,j as e,B as z,X as K,C as ye,a as B,A as be,e as je,f as ve,g as Ne,h as Se,i as ke,k as Ce,l as De,m as de,u as ue,n as Ie,o as Me,b as Te,L as re}from"./index-7wMNJNZJ.js";import{D as Ee,a as ze,b as Ae,c as ie}from"./dropdown-menu-BwE0Hcir.js";import{I as me}from"./input-CURGwIC-.js";import{C as Re,S as Pe,a as _e,M as Le,b as He}from"./sheet-D4eoD1m7.js";import{P as oe}from"./plus-BgtP8iNg.js";import{a as Ue,A as Ve,B as le,U as Fe}from"./AppLayout-Cb4f3Rcb.js";import{P as Oe}from"./pencil-BPthp9JK.js";import{T as Be}from"./trash-2-CodGuS8N.js";import{L as qe}from"./LimitReachedDialog-DRrwZmYv.js";import{S as We}from"./SimpleMarkdown-Dw47DD2y.js";import{S as Je}from"./scroll-area-Dz-2y2_q.js";import{V as Ge}from"./volume-2-CXkl9Gey.js";import{g as $e,c as Ke}from"./ai-client-SJ9RPCaW.js";import{S as Ye}from"./sparkles-BGeiEV-p.js";import{C as Xe}from"./camera-Lim5GATx.js";import{S as Ze}from"./send-qsvD08Ca.js";import"./index-8ugP4A3I.js";import"./index-BVEf_URQ.js";import"./AnimatedLogoIcon-DY32PEux.js";import"./sun-CnDoiXzg.js";import"./index-BdQq_4o_.js";const Qe=J("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);const es=J("Headphones",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]);const ss=J("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);const ts=J("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const ns=J("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);function ce({sessions:a,currentSessionId:b,onSelectSession:U,onNewChat:w,onDeleteSession:S,onRenameSession:I,loading:i,onClose:n,isOpen:M=!0}){const[k,j]=t.useState(!1),[y,h]=t.useState(null),[x,p]=t.useState(""),[_,v]=t.useState(!1),[T,l]=t.useState(null),[r,c]=t.useState(()=>{try{const d=localStorage.getItem("hidden_chat_sessions");return d?JSON.parse(d):[]}catch{return[]}});t.useEffect(()=>{localStorage.setItem("hidden_chat_sessions",JSON.stringify(r))},[r]);const o=d=>{const g=new Date(d),A=new Date().getTime()-g.getTime(),R=Math.floor(A/(1e3*60)),D=Math.floor(A/(1e3*60*60)),H=Math.floor(A/(1e3*60*60*24));return R<1?"Just now":R<60?`${R}m ago`:D<24?`${D}h ago`:H===1?"Yesterday":H<7?`${H}d ago`:g.toLocaleDateString("en-US",{month:"short",day:"numeric"})},C=d=>{const g=new Date;g.setHours(0,0,0,0);const m=new Date(g);m.setDate(m.getDate()-1);const A=new Date(g);A.setDate(A.getDate()-7);const R=[{label:"Today",sessions:[]},{label:"Yesterday",sessions:[]},{label:"Previous 7 Days",sessions:[]},{label:"Older",sessions:[]}];return d.forEach(D=>{const H=new Date(D.updated_at);H.setHours(0,0,0,0),H.getTime()>=g.getTime()?R[0].sessions.push(D):H.getTime()>=m.getTime()?R[1].sessions.push(D):H.getTime()>=A.getTime()?R[2].sessions.push(D):R[3].sessions.push(D)}),R.filter(D=>D.sessions.length>0)},u=d=>{h(d.id),p(d.title)},N=async()=>{y&&x.trim()&&await I(y,x.trim()),h(null),p("")},V=()=>{h(null),p("")},Y=d=>{l(d),v(!0)},q=async()=>{T&&await S(T),v(!1),l(null)},L=d=>{U(d),n&&window.innerWidth<1024&&n()},W=a.filter(d=>!r.includes(d.id)),G=C(W);return k?e.jsxs("div",{className:"w-12 h-full border-r border-border/50 bg-muted/30 flex flex-col items-center py-4 gap-2",children:[e.jsx(z,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>j(!1),children:e.jsx(Re,{className:"h-4 w-4"})}),e.jsx(z,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:w,children:e.jsx(oe,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[M&&n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:n}),e.jsxs("div",{className:B("h-full border-r border-border/50 bg-background flex flex-col transition-transform duration-300","fixed inset-y-0 left-0 z-50 w-[280px] sm:w-[300px] md:w-80","lg:relative lg:z-auto lg:translate-x-0",!M&&"lg:hidden -translate-x-full",M&&"translate-x-0"),children:[e.jsxs("div",{className:"p-3 border-b border-border/50 flex items-center justify-between flex-shrink-0",children:[e.jsx("h3",{className:"text-sm font-medium text-foreground",children:"Chat History"}),e.jsxs(z,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:n||(()=>j(!0)),children:[e.jsx(K,{className:"h-4 w-4 lg:hidden"}),e.jsx(Ue,{className:"h-4 w-4 hidden lg:block"})]})]}),e.jsx("div",{className:"p-3 flex-shrink-0",children:e.jsxs(z,{variant:"outline",className:"w-full justify-start gap-2",onClick:()=>{w(),n&&window.innerWidth<1024&&n()},children:[e.jsx(oe,{className:"h-4 w-4"}),"New Chat"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:e.jsx("div",{className:"p-2 space-y-4 pb-4",children:i?e.jsx("div",{className:"text-center text-muted-foreground text-sm py-8",children:"Loading..."}):W.length===0?e.jsxs("div",{className:"text-center text-muted-foreground text-sm py-8 px-4",children:[e.jsx(ss,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No chat history yet"}),e.jsx("p",{className:"text-xs mt-1",children:"Start a new conversation!"})]}):G.map(d=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-muted-foreground px-2 mb-2 sticky top-0 bg-background/95 backdrop-blur-sm py-1",children:d.label}),e.jsx("div",{className:"space-y-1",children:d.sessions.map(g=>e.jsx("div",{className:B("group rounded-lg transition-colors mx-1",b===g.id?"bg-primary/10":"hover:bg-muted active:bg-muted"),children:y===g.id?e.jsxs("div",{className:"flex items-center gap-1 p-2",children:[e.jsx(me,{value:x,onChange:m=>p(m.target.value),className:"h-7 text-sm flex-1 min-w-0",autoFocus:!0,onKeyDown:m=>{m.key==="Enter"&&N(),m.key==="Escape"&&V()}}),e.jsx(z,{variant:"ghost",size:"icon",className:"h-7 w-7 shrink-0",onClick:N,children:e.jsx(ye,{className:"h-3 w-3"})}),e.jsx(z,{variant:"ghost",size:"icon",className:"h-7 w-7 shrink-0",onClick:V,children:e.jsx(K,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"flex items-center gap-1 p-2",children:[e.jsxs("button",{className:"flex-1 text-left min-w-0",onClick:()=>L(g.id),children:[e.jsx("p",{className:"text-sm font-medium truncate text-foreground pr-1",children:g.title}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:o(g.updated_at)})]}),e.jsxs(Ee,{children:[e.jsx(ze,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0 text-muted-foreground hover:text-foreground hover:bg-accent",onClick:m=>m.stopPropagation(),children:[e.jsx(Qe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"More options"})]})}),e.jsxs(Ae,{align:"end",className:"w-48",children:[e.jsxs(ie,{onClick:m=>{m.stopPropagation(),u(g)},children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Rename"]}),e.jsxs(ie,{onClick:m=>{m.stopPropagation(),Y(g.id)},className:"text-destructive focus:text-destructive focus:bg-destructive/10",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})},g.id))})]},d.label))})})]}),e.jsx(be,{open:_,onOpenChange:v,children:e.jsxs(je,{children:[e.jsxs(ve,{children:[e.jsx(Ne,{children:"Delete Chat?"}),e.jsx(Se,{children:"Do you want to permanently delete this chat? This action cannot be undone."})]}),e.jsxs(ke,{children:[e.jsx(Ce,{children:"Cancel"}),e.jsx(De,{onClick:q,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]})}function as({isOpen:a,onClose:b,onSendMessage:U,isProcessing:w}){const{t:S,i18n:I}=de(),[i,n]=t.useState("idle"),[M,k]=t.useState(""),[j,y]=t.useState(null),h=t.useRef(null),x=t.useRef(window.speechSynthesis),[p,_]=t.useState([]);t.useEffect(()=>{if(!a)return;const r=window.SpeechRecognition||window.webkitSpeechRecognition;if(!r){y("Speech recognition is not supported in this browser.");return}const c=new r;return c.continuous=!1,c.interimResults=!0,c.lang=I.language||"en-US",c.onstart=()=>{n("listening"),y(null)},c.onresult=o=>{const C=o.resultIndex,u=o.results[C][0].transcript;k(u)},c.onerror=o=>{o.error==="no-speech"?n("idle"):o.error==="network"?(y("Network error: Browser blocked the connection. If you are using Brave, please switch to Chrome or Edge for voice features."),n("idle")):o.error==="not-allowed"||o.error==="service-not-allowed"?(y("Microphone access denied. Please allow microphone permissions in your browser."),n("idle")):(y("Error accessing microphone: "+o.error),n("idle"))},h.current=c,()=>{if(h.current)try{h.current.stop()}catch{}x.current&&x.current.cancel()}},[a,I.language]),t.useEffect(()=>{const r=()=>{const c=window.speechSynthesis.getVoices();_(c)};return r(),window.speechSynthesis.onvoiceschanged!==void 0&&(window.speechSynthesis.onvoiceschanged=r),()=>{window.speechSynthesis.onvoiceschanged=null}},[]);const v=()=>{if(h.current&&i!=="listening"&&i!=="speaking"&&i!=="processing")try{k(""),h.current.start()}catch{}},T=()=>{h.current&&h.current.stop()},l=r=>{if(!x.current)return;const c=r.replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").replace(/[*#_`]/g,"").replace(/\n+/g,". "),o=new SpeechSynthesisUtterance(c);if(o.onstart=()=>n("speaking"),o.onend=()=>{a&&(n("idle"),setTimeout(v,500))},o.onerror=()=>n("idle"),p.length>0){const C=p.find(u=>u.name.includes("Natural")&&u.lang.startsWith("en"))||p.find(u=>u.name.includes("Google US English"))||p.find(u=>u.name.includes("Samantha"))||p.find(u=>u.lang===(I.language||"en-US"))||p[0];C&&(o.voice=C)}n("speaking");try{x.current.speak(o)}catch{n("idle")}};return t.useEffect(()=>{h.current&&(h.current.onend=async()=>{if(M.trim().length>0&&i==="listening"){n("processing");try{const r=await U(M);l(r),k("")}catch{y("Failed to process message"),n("idle")}}else i==="listening"&&n("idle")})},[M,U,i,p]),t.useEffect(()=>{if(a&&i==="idle"&&!j){const r=setTimeout(()=>v(),500);return()=>clearTimeout(r)}},[a,i,j]),a?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/95 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"relative w-full max-w-lg p-6 flex flex-col items-center justify-center space-y-8",children:[e.jsx(z,{variant:"ghost",size:"icon",className:"absolute top-0 right-4 rounded-full h-12 w-12 bg-muted/50 hover:bg-muted",onClick:()=>{T(),x.current.cancel(),b()},children:e.jsx(K,{className:"h-6 w-6"})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("h2",{className:"text-2xl font-bold tracking-tight",children:[i==="listening"&&"Listening...",i==="processing"&&"Thinking...",i==="speaking"&&"Speaking...",i==="idle"&&"Tap to speak"]}),e.jsx("p",{className:"text-muted-foreground h-6 flex items-center justify-center px-4 text-center line-clamp-1",children:M||(i==="processing"?"Processing...":"")})]}),e.jsxs("div",{className:"relative h-64 w-64 flex items-center justify-center",children:[(i==="listening"||i==="speaking")&&e.jsx("div",{className:"absolute inset-0 rounded-full bg-primary/20 animate-ping opacity-75 duration-[3000ms]"}),(i==="listening"||i==="speaking")&&e.jsx("div",{className:"absolute inset-4 rounded-full bg-primary/20 animate-ping opacity-50 duration-[2000ms] delay-75"}),e.jsx("div",{className:B("relative z-10 w-32 h-32 rounded-full flex items-center justify-center transition-all duration-300 shadow-xl cursor-pointer hover:scale-105",i==="listening"?"bg-red-500 shadow-red-500/20":i==="speaking"?"bg-green-500 shadow-green-500/20":i==="processing"?"bg-yellow-500 animate-pulse":"bg-primary shadow-primary/20"),onClick:()=>{i==="speaking"?(x.current.cancel(),n("idle")):i==="listening"?T():v()},children:i==="listening"?e.jsx(ns,{className:"h-12 w-12 text-white"}):i==="speaking"?e.jsx(Ge,{className:"h-12 w-12 text-white animate-pulse"}):e.jsx(ts,{className:"h-12 w-12 text-white"})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground text-center max-w-xs",children:[i==="idle"&&"Tap the microphone to start handling the conversation",i==="listening"&&"I'm listening to your voice...",i==="speaking"&&"Tap to interrupt"]}),j&&e.jsx("div",{className:"bg-destructive/10 text-destructive text-sm px-4 py-2 rounded-lg",children:j})]})}):null}function rs(){const{supabase:a,user:b}=ue(),[U,w]=t.useState([]),[S,I]=t.useState(null),[i,n]=t.useState(!0),[M,k]=t.useState(null),j=t.useCallback(async()=>{if(!b||!a){w([]),n(!1);return}try{n(!0);const{data:l,error:r}=await a.from("ai_chat_sessions").select("*").eq("user_id",b.id).order("updated_at",{ascending:!1});if(r)throw r;w(l||[]),k(null)}catch(l){k(l.message)}finally{n(!1)}},[b,a]);t.useEffect(()=>{j()},[j]);const y=t.useCallback(async(l,r,c="chat")=>{if(!b||!a)return null;try{const o=l?[l]:[],C=l?l.content.slice(0,50)+(l.content.length>50?"...":""):"New Chat",{data:u,error:N}=await a.from("ai_chat_sessions").insert({user_id:b.id,title:C,messages:o,context:r||null,mode:c}).select().single();if(N)throw N;return w(V=>[u,...V]),I(u),u}catch(o){return k(o.message),null}},[b,a]),h=t.useCallback(async l=>{if(a)try{const{data:r,error:c}=await a.from("ai_chat_sessions").select("*").eq("id",l).single();if(c)throw c;I(r)}catch(r){k(r.message)}},[a]),x=t.useCallback(async(l,r)=>{if(a)try{const{data:c,error:o}=await a.from("ai_chat_sessions").update(r).eq("id",l).select().single();if(o)throw o;w(C=>C.map(u=>u.id===l?c:u)),S?.id===l&&I(c)}catch(c){k(c.message)}},[a,S]),p=t.useCallback(async l=>{if(a)try{const{error:r}=await a.from("ai_chat_sessions").delete().eq("id",l);if(r)throw r;w(c=>c.filter(o=>o.id!==l)),S?.id===l&&I(null)}catch(r){k(r.message)}},[a,S]),_=t.useCallback(async(l,r)=>{await x(l,{title:r})},[x]),v=t.useCallback(()=>{I(null)},[]),T=t.useCallback(async()=>{await j()},[j]);return{sessions:U,currentSession:S,loading:i,error:M,createSession:y,loadSession:h,updateSession:x,deleteSession:p,renameSession:_,clearCurrentSession:v,refreshSessions:T}}const Q=a=>({id:a.id,role:a.role,content:a.content,timestamp:a.timestamp.toISOString(),image:a.image}),is=a=>({id:a.id,role:a.role,content:a.content,timestamp:new Date(a.timestamp),image:a.image}),ee={id:"1",role:"assistant",content:`Hello! I'm your AI assistant. How can I help you today?

I can assist you with:

• Explaining concepts and topics
• Answering your questions
• Helping with homework and assignments
• Providing study tips and guidance
• Having conversations about any subject

Feel free to ask me anything!`,timestamp:new Date};function Is(){const{supabase:a}=ue(),{toast:b}=Ie(),[U,w]=Me(),{t:S,i18n:I}=de(),{sessions:i,currentSession:n,loading:M,createSession:k,loadSession:j,updateSession:y,deleteSession:h,renameSession:x,clearCurrentSession:p}=rs(),[_,v]=t.useState([ee]),[T,l]=t.useState(""),[r,c]=t.useState(!1),o=t.useRef(null),[C,u]=t.useState(!1),[N,V]=t.useState(null),[Y,q]=t.useState(null),L=t.useRef(null),W=t.useRef(!1),[G,d]=t.useState(null),[g,m]=t.useState(!1),[A,R]=t.useState(!1),[D,H]=t.useState(null);Te();const he=async()=>{if(!a)return;const s=await $e(a);s.data&&H(s.data)};t.useEffect(()=>{a&&he()},[a]),t.useEffect(()=>{const s=U.get("session");s&&(!n||n.id!==s)&&j(s)},[U,n,j]),t.useEffect(()=>{if(n){if(n.id!==G){const s=n.messages.map(is);v(s.length>0?s:[ee]),d(n.id),w({session:n.id},{replace:!0})}}else d(null)},[n,G,w]),t.useEffect(()=>{o.current&&o.current.scrollIntoView({behavior:"smooth"})},[_]);const ge=t.useCallback(async s=>{n&&await y(n.id,{messages:s.map(Q)})},[n,y]),se=t.useCallback(()=>{p(),v([ee]),W.current=!1,w({},{replace:!0})},[p,w]),te=t.useCallback(s=>{w({session:s})},[w]),fe=t.useCallback(s=>s.filter(f=>f.id!=="1").slice(-20).map(f=>({role:f.role,content:f.content})),[]),ne=async(s,f)=>{const O={id:Date.now().toString(),role:"user",content:s,timestamp:new Date,image:f},$=[..._,O];v($),c(!0);try{const E=fe(_),P=await Ke({message:s,history:E,language:I.language,image:f},a);if(P.error)throw new Error(P.error);const F=P.data?.reply||"I couldn't generate a response. Please try again.",we={id:(Date.now()+1).toString(),role:"assistant",content:F,timestamp:new Date},X=[...$,we];if(v(X),!n&&!W.current){W.current=!0;const Z=await k(Q(O),void 0,"chat");Z&&(d(Z.id),await y(Z.id,{messages:X.map(Q),title:s.slice(0,50)+(s.length>50?"...":"")}))}else n&&await ge(X);return F}catch(E){let P="Failed to get response. Please try again.";if(typeof E=="string")P=E;else if(E instanceof Error)try{const F=JSON.parse(E.message);F.error&&(P=F.error)}catch{P=E.message}else typeof E=="object"&&E!==null&&(P=E.message||E.error||JSON.stringify(E));return P.includes("limit")||E.status===429?(R(!0),c(!1),"Usage limit reached."):(P==="[object Object]"&&(P="An unexpected error occurred."),b({title:"Error",description:P,variant:"destructive"}),v(F=>[...F,{id:(Date.now()+1).toString(),role:"assistant",content:"I'm sorry, I encountered an error. Please try again.",timestamp:new Date}]),"I'm sorry, I encountered an error.")}finally{c(!1)}},xe=s=>{const f=s.target.files?.[0];if(!f)return;if(!f.type.startsWith("image/")){b({title:"Invalid file",description:"Please upload an image file (PNG, JPG, GIF, etc.)",variant:"destructive"});return}if(f.size>4*1024*1024){b({title:"File too large",description:"Please upload an image smaller than 4MB",variant:"destructive"});return}const O=new FileReader;O.onload=$=>{V($.target?.result),q(f.name),b({title:"Image uploaded",description:"You can add a message or just send the image to analyze."})},O.readAsDataURL(f)},pe=()=>{V(null),q(null),L.current&&(L.current.value="")},ae=async()=>{if(!T.trim()&&!N||r)return;let s=T;const f=N||void 0;N&&!s.trim()&&(s="Analyzing image..."),l(""),V(null),q(null),L.current&&(L.current.value=""),await ne(s,f)};return e.jsxs(Ve,{fullWidth:!0,children:[e.jsx(qe,{open:A,onOpenChange:R}),e.jsxs("div",{className:"flex h-[calc(100vh-3.5rem)] md:h-screen overflow-hidden bg-background pb-20 md:pb-0",children:[e.jsx("div",{className:"hidden lg:flex shrink-0",children:e.jsx(ce,{sessions:i,currentSessionId:n?.id||null,onSelectSession:te,onNewChat:se,onDeleteSession:h,onRenameSession:x,loading:M})}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 h-full relative",children:[e.jsx("div",{className:"h-14 border-b border-border/40 flex items-center justify-between px-4 bg-background/80 backdrop-blur-sm z-10 shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Pe,{open:g,onOpenChange:m,children:[e.jsx(_e,{asChild:!0,children:e.jsx(z,{variant:"ghost",size:"icon",className:"lg:hidden",children:e.jsx(Le,{className:"h-5 w-5"})})}),e.jsx(He,{side:"left",className:"p-0 w-64 [&>button]:hidden",children:e.jsx(ce,{sessions:i,currentSessionId:n?.id||null,onSelectSession:s=>{te(s),m(!1)},onNewChat:()=>{se(),m(!1)},onDeleteSession:h,onRenameSession:x,loading:M,onClose:()=>m(!1)})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"font-semibold text-lg",children:S("nav.aiTutor")}),D&&!D.isPremium&&e.jsx("div",{className:"ml-4 flex items-center px-3 py-1 bg-indigo-100 dark:bg-indigo-900/30 rounded-full border border-indigo-200 dark:border-indigo-800",children:e.jsxs("span",{className:"text-xs font-medium text-indigo-700 dark:text-indigo-300",children:[D.remaining," free uses left"]})})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden relative flex flex-col",children:e.jsx(Je,{className:"flex-1",children:e.jsxs("div",{className:"w-full max-w-3xl mx-auto px-4 py-6 space-y-6",children:[_.map(s=>e.jsxs("div",{className:B("flex gap-4 group",s.role==="user"?"justify-end":"justify-start"),children:[s.role==="assistant"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-1",children:e.jsx(le,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:B("max-w-[85%] sm:max-w-[75%]",s.role==="user"?"ml-auto":"mr-auto"),children:[s.role==="user"&&e.jsx("div",{className:"invisible group-hover:visible transition-opacity text-[10px] text-muted-foreground mb-1 text-right",children:S("aiTutor.you")}),s.role==="assistant"&&e.jsx("div",{className:"invisible group-hover:visible transition-opacity text-[10px] text-muted-foreground mb-1",children:S("aiTutor.aiName")}),e.jsx("div",{className:B("rounded-2xl px-5 py-3 text-sm shadow-sm",s.role==="user"?"bg-primary text-primary-foreground rounded-br-sm":"bg-muted/50 text-foreground border border-border/40 rounded-bl-sm"),children:s.role==="assistant"?e.jsx(We,{content:s.content}):e.jsxs(e.Fragment,{children:[s.image&&e.jsx("img",{src:s.image,alt:"Uploaded",className:"max-w-full max-h-[200px] rounded-lg object-contain mb-2"}),s.content!=="Analyzing image..."&&e.jsx("p",{className:"whitespace-pre-wrap break-words leading-relaxed",children:s.content})]})}),e.jsx("div",{className:"text-[10px] opacity-40 mt-1 px-1",children:s.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),s.role==="user"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-1",children:e.jsx(Fe,{className:"h-4 w-4 text-primary"})})]},s.id)),r&&!C&&e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(le,{className:"h-4 w-4 text-primary"})}),e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"bg-muted/50 rounded-2xl rounded-bl-sm p-4 w-32 flex items-center justify-center",children:e.jsx(re,{className:"h-4 w-4 animate-spin text-muted-foreground"})})})]}),e.jsx("div",{ref:o,className:"h-4"})]})})}),e.jsx("div",{className:"p-4 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-t border-border/40",children:e.jsxs("div",{className:"w-full max-w-3xl mx-auto",children:[N&&e.jsxs("div",{className:"relative mb-2 rounded-lg border border-primary/30 p-2 bg-primary/5 inline-block",children:[e.jsx("img",{src:N,alt:"Uploaded",className:"max-h-[100px] rounded object-contain"}),e.jsx(z,{variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-5 w-5 rounded-full",onClick:pe,children:e.jsx(K,{className:"h-3 w-3"})}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1 text-center truncate max-w-[150px]",children:Y})]}),e.jsx("input",{type:"file",ref:L,accept:"image/*",onChange:xe,className:"hidden"}),e.jsxs("div",{className:"relative flex items-end gap-2 bg-muted/30 p-2 rounded-xl border border-border/40 focus-within:ring-2 focus-within:ring-primary/20 focus-within:border-primary/50 transition-all shadow-sm",children:[e.jsx(me,{value:T,onChange:s=>l(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),ae())},placeholder:N?"Ask something about the image...":A?"Usage limit reached":S("aiTutor.askAnything"),disabled:r||A,className:"border-0 focus-visible:ring-0 bg-transparent min-h-[44px] py-3 px-2 shadow-none resize-none"}),e.jsx(z,{variant:"ghost",size:"icon",className:"h-9 w-9 mb-1 shrink-0 rounded-lg text-muted-foreground hover:bg-muted/80 hover:text-foreground",onClick:()=>L.current?.click(),title:"Upload Image",children:e.jsx(Xe,{className:"h-5 w-5"})}),e.jsx(z,{variant:"ghost",size:"icon",className:"h-9 w-9 mb-1 shrink-0 rounded-lg text-muted-foreground hover:bg-muted/80 hover:text-foreground",onClick:()=>u(!0),title:"Voice Mode",children:e.jsx(es,{className:"h-5 w-5"})}),e.jsx(z,{onClick:ae,disabled:r||!T.trim()&&!N||A,size:"icon",className:B("h-9 w-9 mb-1 shrink-0 rounded-lg transition-all",T.trim()||N?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:r?e.jsx(re,{className:"h-4 w-4 animate-spin"}):e.jsx(Ze,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-[10px] text-center text-muted-foreground mt-2",children:S("aiTutor.disclaimer")})]})})]}),e.jsx(as,{isOpen:C,onClose:()=>u(!1),onSendMessage:async s=>{const f=N||void 0,O=await ne(s,f);return f&&(V(null),q(null),L.current&&(L.current.value="")),O},isProcessing:r})]})]})}export{Is as default};
