import{j as e,aa as N,L as A,aV as y,aW as P}from"./ui-vendor-CsSFJReh.js";import{A as R,a as m,b as d,c as n}from"./AppLayout-DI_SoCqt.js";import{B as T}from"./badge-C82RfJ-5.js";import{C as k,a as E,b as F,d as X}from"./card-D_wUZn1S.js";import{u as q,k as B}from"./index-D0R12c3l.js";import{r as x}from"./react-vendor-BmZbDsmQ.js";import"./AnimatedLogoIcon-D5-EYdni.js";import"./sheet-0_ECFM1J.js";import"./supabase-vendor-BcRMW6g-.js";import"./query-vendor-DjEy6XLK.js";function W(){var h,p,f,g,b,j,u,w,v;const{supabase:U,user:r}=q(),{toast:o}=B(),[C,c]=x.useState(!0),[a,l]=x.useState([]);x.useEffect(()=>{L()},[r]);const L=async()=>{try{c(!0);const{data:s,error:i}=await U.rpc("get_leaderboard",{limit_count:50});if(i){(i.message.includes("function")||i.code==="42883")&&o({title:"Setup Required",description:"Please run the leaderboard_function.sql migration in Supabase to enable the leaderboard.",variant:"destructive"}),l([]);return}if(s&&s.length>0){const _=s.map(t=>({rank:t.rank,name:t.name,xp:t.xp,streak:t.streak,avatar:t.avatar_url,user_id:t.user_id,isUser:t.user_id===(r==null?void 0:r.id)}));l(_)}else l([])}catch{o({title:"Error",description:"Failed to load leaderboard. Please try again later.",variant:"destructive"}),l([])}finally{c(!1)}},S=s=>s.toLocaleString();return e.jsx(R,{children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-fade-in pb-12",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-orange-500/10 text-orange-500",children:e.jsx(N,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Study Leaderboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Review your weekly rankings and compete with peers."})]})]}),C?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(A,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):a.length===0?e.jsx(k,{className:"p-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"p-4 rounded-full bg-orange-500/10",children:e.jsx(N,{className:"w-12 h-12 text-orange-500"})}),e.jsx("h3",{className:"text-xl font-semibold",children:"No Rankings Yet"}),e.jsx("p",{className:"text-muted-foreground max-w-md",children:"The leaderboard will populate as students start studying. Create notes, flashcards, or use the AI Tutor to earn XP and appear on the leaderboard!"}),e.jsx("div",{className:"flex gap-3 mt-4",children:e.jsx("a",{href:"/dashboard",className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 transition-colors",children:"Start Studying"})})]})}):e.jsxs(e.Fragment,{children:[a.length>=3&&e.jsxs("div",{className:"flex items-end justify-center gap-3 sm:gap-4 md:gap-6 lg:gap-8 h-64 sm:h-64 md:h-64 mt-8 sm:mt-12 mb-8 sm:mb-10 md:mb-12 px-4 sm:px-6 md:px-8",children:[e.jsxs("div",{className:"flex flex-col items-center w-[28%] sm:w-[30%] md:flex-1 min-w-[80px] sm:min-w-[100px] md:max-w-[140px] lg:max-w-none",children:[e.jsxs(m,{className:"w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 lg:w-16 lg:h-16 border-2 sm:border-4 border-slate-300 mb-1 sm:mb-2",children:[e.jsx(d,{src:((h=a[1])==null?void 0:h.avatar)||void 0}),e.jsx(n,{children:((p=a[1])==null?void 0:p.name[0])||"2"})]}),e.jsx("div",{className:"w-full h-20 sm:h-22 md:h-24 bg-slate-200 dark:bg-slate-800 rounded-t-xl flex items-center justify-center text-lg sm:text-xl md:text-2xl font-bold text-slate-400",children:"2"}),e.jsx("span",{className:"font-semibold text-[10px] sm:text-xs md:text-sm mt-1 sm:mt-2 truncate max-w-full text-center px-1",children:((f=a[1])==null?void 0:f.name)||"User"})]}),e.jsxs("div",{className:"flex flex-col items-center w-[32%] sm:w-[34%] md:flex-1 min-w-[90px] sm:min-w-[110px] md:max-w-[160px] lg:max-w-none z-10 relative",children:[e.jsx(y,{className:"w-5 h-5 sm:w-6 sm:h-6 md:w-7 md:h-7 lg:w-8 lg:h-8 text-orange-500 absolute -top-7 sm:-top-8 md:-top-10 left-1/2 -translate-x-1/2 animate-bounce"}),e.jsxs(m,{className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 lg:w-20 lg:h-20 border-2 sm:border-4 border-yellow-400 mb-1 sm:mb-2 ring-2 sm:ring-4 ring-yellow-400/20",children:[e.jsx(d,{src:((g=a[0])==null?void 0:g.avatar)||void 0}),e.jsx(n,{children:((b=a[0])==null?void 0:b.name[0])||"1"})]}),e.jsx("div",{className:"w-full h-28 sm:h-30 md:h-32 bg-yellow-400/20 border border-yellow-400 rounded-t-xl flex items-center justify-center text-2xl sm:text-3xl md:text-4xl font-bold text-yellow-600",children:"1"}),e.jsx("span",{className:"font-semibold text-[10px] sm:text-xs md:text-sm mt-1 sm:mt-2 truncate max-w-full text-center px-1",children:((j=a[0])==null?void 0:j.name)||"User"})]}),e.jsxs("div",{className:"flex flex-col items-center w-[28%] sm:w-[30%] md:flex-1 min-w-[80px] sm:min-w-[100px] md:max-w-[140px] lg:max-w-none",children:[e.jsxs(m,{className:"w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 lg:w-16 lg:h-16 border-2 sm:border-4 border-amber-600 mb-1 sm:mb-2",children:[e.jsx(d,{src:((u=a[2])==null?void 0:u.avatar)||void 0}),e.jsx(n,{children:((w=a[2])==null?void 0:w.name[0])||"3"})]}),e.jsx("div",{className:"w-full h-16 sm:h-18 md:h-20 bg-amber-700/20 rounded-t-xl flex items-center justify-center text-lg sm:text-xl md:text-2xl font-bold text-amber-700",children:"3"}),e.jsx("span",{className:"font-semibold text-[10px] sm:text-xs md:text-sm mt-1 sm:mt-2 truncate max-w-full text-center px-1",children:((v=a[2])==null?void 0:v.name)||"User"})]})]}),e.jsxs(k,{children:[e.jsx(E,{children:e.jsx(F,{children:"Global Rankings"})}),e.jsx(X,{className:"p-0",children:e.jsx("div",{className:"divide-y",children:a.map(s=>e.jsxs("div",{className:`flex items-center p-4 gap-4 ${s.isUser?"bg-primary/5":"hover:bg-muted/50"}`,children:[e.jsx("div",{className:"w-8 text-center font-bold text-muted-foreground",children:s.rank<=3?e.jsx(P,{className:`w-5 h-5 mx-auto ${s.rank===1?"text-yellow-500":s.rank===2?"text-slate-400":"text-amber-600"}`}):s.rank}),e.jsxs(m,{children:[e.jsx(d,{src:s.avatar||void 0}),e.jsx(n,{children:s.name[0]})]}),e.jsx("div",{className:"flex-1",children:e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[s.name,s.isUser&&e.jsx(T,{variant:"secondary",className:"text-[10px]",children:"YOU"})]})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold",children:[S(s.xp)," XP"]}),e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center justify-end gap-1",children:[e.jsx(y,{className:"w-3 h-3 text-orange-500"})," ",s.streak," day streak"]})]})]},s.user_id))})})]})]})]})})}export{W as default};
