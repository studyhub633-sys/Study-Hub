import{u as re,m as ne,n as le,b as ie,p as oe,r as o,j as e,L as O,B as d,a as k}from"./index-7wMNJNZJ.js";import{A as $}from"./AppLayout-Cb4f3Rcb.js";import{D as M,b as R,c as z,d as Q,e as U,f as q}from"./dialog-CGZvDN6x.js";import{I as D}from"./input-CURGwIC-.js";import{L as S}from"./label-4_8C0ZIE.js";import{a as H}from"./ai-client-SJ9RPCaW.js";import{L as ce,B as de,C as me}from"./sheet-D4eoD1m7.js";import{S as N}from"./sparkles-BGeiEV-p.js";import{P as K}from"./plus-BgtP8iNg.js";import{S as ue}from"./search-D5Hb3sC3.js";import{C as he}from"./clock-BKqJKRJR.js";import"./AnimatedLogoIcon-DY32PEux.js";import"./sun-CnDoiXzg.js";function v(r){return r===0?"new":r<=2?"learning":r<=4?"almostDone":"mastered"}function xe(r){if(r.totalCards===0)return 0;const l=r.learning*.33+r.almostDone*.66+r.mastered*1;return Math.round(l/r.totalCards*100)}function Fe(){const{supabase:r,user:l}=re(),{t:h}=ne(),{toast:c}=le(),G=ie(),m=oe(),[x,W]=o.useState([]),[Y,F]=o.useState(!0),[y,J]=o.useState(""),[V,f]=o.useState(!1),[u,L]=o.useState(""),[X,g]=o.useState(!1),[j,E]=o.useState(""),[I,_]=o.useState(""),[A,T]=o.useState(!1);o.useEffect(()=>{l&&w()},[l]),o.useEffect(()=>{(async()=>{if(l){if(m.state?.generatedFlashcards){await b(m.state.generatedFlashcards,m.state.subject||"General");return}if(m.state?.organizerContent){const a=m.state.organizerContent,t=m.state.subject||"General";try{c({title:h("flashcards.generating"),description:h("flashcards.generatingDesc")});const n=await H({notes:a,subject:t,count:10},r);if(n.error)throw new Error(n.error);n.data?.flashcards&&await b(n.data.flashcards,t)}catch(n){c({title:"Generation Failed",description:n.message||"Failed to generate flashcards. Please try again.",variant:"destructive"})}}}})()},[m.state,l]);const b=async(s,a)=>{try{if(!l)return;const t=s.map(p=>({user_id:l.id,front:p.question,back:p.answer,subject:p.subject||a,topic:null,difficulty:1,review_count:0})),{error:n}=await r.from("flashcards").insert(t);if(n)throw n;c({title:h("flashcards.successCreated"),description:h("flashcards.successCreatedDesc",{count:s.length})}),window.history.replaceState({},document.title),w()}catch{c({title:"Error",description:"Failed to save generated flashcards.",variant:"destructive"})}},w=async()=>{if(l)try{F(!0);const{data:s,error:a}=await r.from("flashcards").select("*").eq("user_id",l.id).order("created_at",{ascending:!1});if(a)throw a;W(s||[])}catch{c({title:"Error",description:"Failed to load flashcards. Please try again.",variant:"destructive"})}finally{F(!1)}},P=async()=>{if(!(!l||!u.trim()))try{const{error:s}=await r.from("flashcards").insert({user_id:l.id,front:"Sample Question",back:"Sample Answer — edit or delete this card",subject:u.trim(),topic:"General",difficulty:1,review_count:0});if(s)throw s;c({title:"Deck Created",description:`"${u.trim()}" deck has been created.`}),f(!1),L(""),w(),G(`/flashcards/${encodeURIComponent(u.trim())}`)}catch{c({title:"Error",description:"Failed to create deck. Please try again.",variant:"destructive"})}},Z=async()=>{if(!(!l||!j.trim())){T(!0);try{const s=I.trim()||"General",a=await H({notes:j,subject:s,count:10},r);if(a.error)throw new Error(a.error);a.data?.flashcards&&(await b(a.data.flashcards,s),g(!1),E(""),_(""))}catch(s){c({title:"Generation Failed",description:s.message||"Failed to generate flashcards.",variant:"destructive"})}finally{T(!1)}}},C=(()=>{const s={};return x.forEach(a=>{const t=a.subject||"Uncategorised";s[t]||(s[t]=[]),s[t].push(a)}),Object.entries(s).map(([a,t])=>{const n=t.filter(i=>v(i.review_count)==="new").length,p=t.filter(i=>v(i.review_count)==="learning").length,ee=t.filter(i=>v(i.review_count)==="almostDone").length,se=t.filter(i=>v(i.review_count)==="mastered").length,te=Array.from(new Set(t.map(i=>i.topic).filter(Boolean))),ae=t.map(i=>i.last_reviewed).filter(Boolean).sort().reverse()[0]||null;return{subject:a,cards:t,totalCards:t.length,newCards:n,learning:p,almostDone:ee,mastered:se,lastStudied:ae,topics:te}})})(),B=C.filter(s=>s.subject.toLowerCase().includes(y.toLowerCase())||s.topics.some(a=>a.toLowerCase().includes(y.toLowerCase())));return Y?e.jsx($,{children:e.jsx("div",{className:"max-w-5xl mx-auto flex items-center justify-center h-[60vh]",children:e.jsx(O,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsxs($,{children:[e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 pb-12",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 animate-fade-in",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-foreground flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 rounded-xl bg-gradient-to-br from-primary/20 to-primary/5",children:e.jsx(ce,{className:"h-7 w-7 text-primary"})}),h("flashcards.title")]}),e.jsxs("p",{className:"text-muted-foreground mt-1.5 ml-14",children:[C.length," ",C.length===1?"deck":"decks"," • ",x.length," total cards"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(d,{variant:"outline",onClick:()=>g(!0),className:"gap-2",children:[e.jsx(N,{className:"h-4 w-4"}),"AI Generate"]}),e.jsxs(d,{onClick:()=>f(!0),className:"gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"New Deck"]})]})]}),e.jsxs("div",{className:"relative animate-slide-up",style:{animationDelay:"0.1s"},children:[e.jsx(ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:"Search decks by name or topic...",value:y,onChange:s=>J(s.target.value),className:"pl-9"})]}),B.length===0?e.jsxs("div",{className:"glass-card p-12 text-center animate-fade-in",children:[e.jsx(de,{className:"h-16 w-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:x.length===0?"No flashcard decks yet":"No decks match your search"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:x.length===0?"Create your first deck to start organising your flashcards":"Try a different search term"}),x.length===0&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(d,{onClick:()=>f(!0),className:"gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Create a Deck"]}),e.jsxs(d,{variant:"outline",onClick:()=>g(!0),className:"gap-2",children:[e.jsx(N,{className:"h-4 w-4"}),"AI Generate Cards"]})]})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 animate-slide-up",style:{animationDelay:"0.2s"},children:B.map((s,a)=>{const t=xe(s);return e.jsxs("button",{onClick:()=>G(`/flashcards/${encodeURIComponent(s.subject)}`),className:k("group glass-card p-5 text-left transition-all duration-300","hover:shadow-lg hover:shadow-primary/5 hover:border-primary/20","hover:translate-y-[-2px] active:translate-y-0"),style:{animationDelay:`${.05*a}s`},children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-foreground text-base truncate group-hover:text-primary transition-colors",children:s.subject}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5",children:[s.totalCards," ",s.totalCards===1?"card":"cards"]})]}),e.jsx(me,{className:"h-5 w-5 text-muted-foreground/50 group-hover:text-primary transition-all group-hover:translate-x-0.5 flex-shrink-0 mt-0.5"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progress"}),e.jsxs("span",{className:k("font-semibold",t>=80?"text-emerald-500":t>=40?"text-blue-500":"text-muted-foreground"),children:[t,"%"]})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsxs("div",{className:"h-full flex",children:[s.mastered>0&&e.jsx("div",{className:"bg-emerald-500 transition-all duration-500",style:{width:`${s.mastered/s.totalCards*100}%`}}),s.almostDone>0&&e.jsx("div",{className:"bg-blue-500 transition-all duration-500",style:{width:`${s.almostDone/s.totalCards*100}%`}}),s.learning>0&&e.jsx("div",{className:"bg-amber-500 transition-all duration-500",style:{width:`${s.learning/s.totalCards*100}%`}})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-rose-400/80"}),e.jsx("span",{className:"text-muted-foreground",children:"New"}),e.jsx("span",{className:"ml-auto font-medium text-foreground",children:s.newCards})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-amber-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Learning"}),e.jsx("span",{className:"ml-auto font-medium text-foreground",children:s.learning})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Almost"}),e.jsx("span",{className:"ml-auto font-medium text-foreground",children:s.almostDone})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Mastered"}),e.jsx("span",{className:"ml-auto font-medium text-foreground",children:s.mastered})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-border/50",children:[s.topics.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1.5 mb-2",children:[s.topics.slice(0,3).map(n=>e.jsx("span",{className:"text-[10px] font-medium px-1.5 py-0.5 rounded bg-primary/10 text-primary",children:n},n)),s.topics.length>3&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["+",s.topics.length-3," more"]})]}),s.lastStudied&&e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-muted-foreground",children:[e.jsx(he,{className:"h-3 w-3"}),"Last studied ",new Date(s.lastStudied).toLocaleDateString()]})]})]},s.subject)})})]}),e.jsx(M,{open:V,onOpenChange:f,children:e.jsxs(R,{className:"max-w-md",children:[e.jsxs(z,{children:[e.jsx(Q,{children:"Create New Deck"}),e.jsx(U,{children:"Give your flashcard deck a name. You can add cards after creating it."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"deckName",children:"Deck Name"}),e.jsx(D,{id:"deckName",value:u,onChange:s=>L(s.target.value),placeholder:"e.g., Cold War, Cell Biology, Macbeth...",onKeyDown:s=>s.key==="Enter"&&P(),autoFocus:!0})]})}),e.jsxs(q,{children:[e.jsx(d,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(d,{onClick:P,disabled:!u.trim(),children:"Create Deck"})]})]})}),e.jsx(M,{open:X,onOpenChange:g,children:e.jsxs(R,{className:"max-w-md",children:[e.jsxs(z,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5 text-purple-500"}),"AI Flashcard Generator"]}),e.jsx(U,{children:"Enter your study notes or a topic and our AI will generate flashcards for you."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"genSubject",children:"Deck Name (Subject)"}),e.jsx(D,{id:"genSubject",value:I,onChange:s=>_(s.target.value),placeholder:"e.g., Biology, History..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"genTopic",children:"Topic or Notes"}),e.jsx("textarea",{id:"genTopic",value:j,onChange:s=>E(s.target.value),placeholder:"Paste your notes or enter a topic...",className:"flex min-h-[120px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring resize-none"})]})]}),e.jsxs(q,{children:[e.jsx(d,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(d,{onClick:Z,disabled:!j.trim()||A,className:"bg-gradient-to-r from-purple-500 to-blue-600 text-white",children:A?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"mr-2 h-4 w-4"}),"Generate Cards"]})})]})]})})]})}export{Fe as default};
