import{j as e,L as De,ai as Ae,K as ae,Z as re,E as ze,aj as Ee,ak as qe,al as le,o as ce,X as ie,ah as _e,M as Pe,am as ne,J as Le}from"./ui-vendor-CsSFJReh.js";import{A as oe}from"./AppLayout-DI_SoCqt.js";import{u as Be,j as Me,k as Ge,B as i,c as A,C as Ie}from"./index-D0R12c3l.js";import{D as He,b as Qe,c as Oe,d as Ve,e as Re,f as Ue}from"./dialog-BfoGBpVh.js";import{I as O}from"./input-BOrw0D0Z.js";import{L as z}from"./label-CYC1LVAb.js";import{S as P,a as L,b as B,c as M,d as x}from"./select-BnVVC8xh.js";import{T as de}from"./textarea-FxOJ6OHy.js";import{g as Je}from"./ai-client-BnMomkG2.js";import{i as Ke,r as n}from"./react-vendor-BmZbDsmQ.js";import"./AnimatedLogoIcon-D5-EYdni.js";import"./sheet-0_ECFM1J.js";import"./supabase-vendor-BcRMW6g-.js";import"./query-vendor-DjEy6XLK.js";import"./index-BdQq_4o_.js";import"./index-B5-l44BU.js";function hs(){const{supabase:f,user:l}=Be(),{t}=Me(),{toast:d}=Ge(),p=Ke(),[b,V]=n.useState([]),[he,E]=n.useState(!0),[q,C]=n.useState(0),[R,w]=n.useState(!1),[S,ue]=n.useState("All Subjects"),[G,U]=n.useState("All Topics"),[I,me]=n.useState("All Tiers"),[H,fe]=n.useState(""),[k,xe]=n.useState(!1),[_,Q]=n.useState({correct:0,incorrect:0}),[pe,F]=n.useState(!1),[T,J]=n.useState(null),[r,j]=n.useState({front:"",back:"",subject:"",topic:"",tier:""}),[g,K]=n.useState(!1),[u,D]=n.useState(new Set);n.useEffect(()=>{l&&N()},[l]),n.useEffect(()=>{(async()=>{var a,c,h;if(l){if((a=p.state)!=null&&a.generatedFlashcards){await X(p.state.generatedFlashcards,p.state.subject||"General");return}if((c=p.state)!=null&&c.organizerContent){const v=p.state.organizerContent,te=p.state.subject||"General";try{d({title:t("flashcards.generating"),description:t("flashcards.generatingDesc")});const y=await Je({notes:v,subject:te,count:10},f);if(y.error)throw new Error(y.error);(h=y.data)!=null&&h.flashcards&&await X(y.data.flashcards,te)}catch(y){d({title:"Generation Failed",description:y.message||"Failed to generate flashcards. Please try again.",variant:"destructive"})}}}})()},[p.state,l]);const X=async(s,a)=>{try{if(!l)return;const c=s.map(v=>({user_id:l.id,front:v.question,back:v.answer,subject:v.subject||a,topic:null,difficulty:1,review_count:0})),{error:h}=await f.from("flashcards").insert(c);if(h)throw h;d({title:t("flashcards.successCreated"),description:t("flashcards.successCreatedDesc",{count:s.length})}),window.history.replaceState({},document.title),N()}catch{d({title:"Error",description:"Failed to save generated flashcards.",variant:"destructive"})}},N=async()=>{if(l)try{E(!0);const{data:s,error:a}=await f.from("flashcards").select("*").eq("user_id",l.id).order("created_at",{ascending:!1});if(a)throw a;V(s||[])}catch{d({title:"Error",description:"Failed to load flashcards. Please try again.",variant:"destructive"})}finally{E(!1)}},Z=()=>{J(null),j({front:"",back:"",subject:"",topic:"",tier:""}),F(!0)},je=s=>{J(s),j({front:s.front,back:s.back,subject:s.subject||"",topic:s.topic||"",tier:s.tier||""}),F(!0)},ge=async()=>{if(!l||!r.front.trim()||!r.back.trim()){d({title:"Error",description:"Both front and back are required",variant:"destructive"});return}if(!r.tier){d({title:"Error",description:"Please select a Tier (Foundation or Higher)",variant:"destructive"});return}try{if(T){const{error:s}=await f.from("flashcards").update({front:r.front,back:r.back,subject:r.subject||null,topic:r.topic||null,tier:r.tier||null}).eq("id",T.id).eq("user_id",l.id);if(s)throw s;d({title:t("common.success"),description:t("flashcards.successUpdated")})}else{const{error:s}=await f.from("flashcards").insert({user_id:l.id,front:r.front,back:r.back,subject:r.subject||null,topic:r.topic||null,tier:r.tier||null,difficulty:1,review_count:0});if(s)throw s;d({title:t("common.success"),description:t("flashcards.successCreatedSingle")})}F(!1),N()}catch(s){d({title:"Error",description:s.message||"Failed to save flashcard. Please try again.",variant:"destructive"})}},ve=async s=>{if(l&&confirm(t("flashcards.deleteConfirm")))try{const{error:a}=await f.from("flashcards").delete().eq("id",s).eq("user_id",l.id);if(a)throw a;d({title:t("common.success"),description:t("flashcards.successDeleted")}),N()}catch{d({title:"Error",description:"Failed to delete flashcard. Please try again.",variant:"destructive"})}},be=async(s,a)=>{if(l)try{const{data:c}=await f.from("flashcards").select("review_count").eq("id",s).eq("user_id",l.id).single(),{error:h}=await f.from("flashcards").update({last_reviewed:new Date().toISOString(),review_count:((c==null?void 0:c.review_count)||0)+1}).eq("id",s).eq("user_id",l.id);if(h)throw h;N()}catch{}},$=()=>{K(!g),D(new Set)},W=s=>{const a=new Set(u);a.has(s)?a.delete(s):a.add(s),D(a)},we=()=>{if(u.size===o.length)D(new Set);else{const s=new Set(o.map(a=>a.id));D(s)}},Ne=async()=>{if(!(!l||u.size===0)&&confirm(t("flashcards.bulkDeleteConfirm",{count:u.size})))try{E(!0);const{error:s}=await f.from("flashcards").delete().in("id",Array.from(u)).eq("user_id",l.id);if(s)throw s;d({title:t("common.success"),description:t("flashcards.bulkDeleted",{count:u.size})}),D(new Set),K(!1),N()}catch{d({title:"Error",description:"Failed to delete flashcards. Please try again.",variant:"destructive"}),E(!1)}},o=b.filter(s=>{const a=S==="All Subjects"||s.subject===S,c=G==="All Topics"||s.topic===G,h=I==="All Tiers"||s.tier===I,v=(s.front||"").toLowerCase().includes(H.toLowerCase())||(s.back||"").toLowerCase().includes(H.toLowerCase());return a&&c&&h&&v});o.reduce((s,a)=>{const c=a.subject||"Uncategorized",h=a.topic||"General";return s[c]||(s[c]={}),s[c][h]||(s[c][h]=[]),s[c][h].push(a),s},{});const ye=Array.from(new Set(b.map(s=>s.subject).filter(Boolean))),Ce=S!=="All Subjects"?Array.from(new Set(b.filter(s=>s.subject===S).map(s=>s.topic).filter(Boolean))):Array.from(new Set(b.map(s=>s.topic).filter(Boolean))),m=o[q],Se=o.length>0?(q+1)/o.length*100:0,Y=()=>{w(!1),C(s=>(s+1)%o.length)},ke=()=>{w(!1),C(s=>(s-1+o.length)%o.length)},ee=()=>{w(!R)},se=async s=>{Q(s?a=>({...a,correct:a.correct+1}):a=>({...a,incorrect:a.incorrect+1})),Y(),m&&be(m.id).catch(console.error)},Fe=()=>{Q({correct:0,incorrect:0}),C(0),w(!1)},Te=()=>{const s=[...o].sort(()=>Math.random()-.5);V(s),C(0),w(!1)};return he?e.jsx(oe,{children:e.jsx("div",{className:"max-w-4xl mx-auto flex items-center justify-center h-[60vh]",children:e.jsx(De,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsxs(oe,{children:[e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground",children:t("flashcards.title")}),e.jsx("p",{className:"text-muted-foreground mt-1",children:t("flashcards.totalCards",{count:b.length,plural:b.length!==1?"s":""})})]}),e.jsx("div",{className:"flex items-center gap-2",children:g?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium mr-2",children:t("flashcards.selected",{count:u.size})}),e.jsx(i,{variant:"outline",onClick:we,children:u.size===o.length?t("flashcards.deselectAll"):t("flashcards.selectAll")}),e.jsxs(i,{variant:"destructive",onClick:Ne,disabled:u.size===0,children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),t("flashcards.deleteSelected",{count:u.size})]}),e.jsx(i,{variant:"ghost",onClick:$,children:t("common.cancel")})]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"outline",onClick:$,children:t("flashcards.select")}),e.jsxs(i,{variant:k?"default":"outline",onClick:()=>xe(!k),children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),t(k?"flashcards.exitQuiz":"flashcards.quizMode")]}),e.jsxs(i,{onClick:Z,children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),t("flashcards.addCard")]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 animate-slide-up",style:{animationDelay:"0.1s"},children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(O,{placeholder:t("flashcards.searchPlaceholder"),value:H,onChange:s=>fe(s.target.value),className:"pl-9"})]}),e.jsxs(P,{value:S,onValueChange:s=>{ue(s),U("All Topics")},children:[e.jsxs(L,{className:"w-full sm:w-[180px]",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),e.jsx(B,{})]}),e.jsxs(M,{children:[e.jsx(x,{value:"All Subjects",children:t("flashcards.allSubjects")}),ye.map(s=>e.jsx(x,{value:s,children:s},s))]})]}),e.jsxs(P,{value:G,onValueChange:U,children:[e.jsx(L,{className:"w-full sm:w-[150px]",children:e.jsx(B,{})}),e.jsxs(M,{children:[e.jsx(x,{value:"All Topics",children:t("flashcards.allTopics")}),Ce.map(s=>e.jsx(x,{value:s,children:s},s))]})]}),e.jsxs(P,{value:I,onValueChange:me,children:[e.jsx(L,{className:"w-full sm:w-[150px]",children:e.jsx(B,{})}),e.jsxs(M,{children:[e.jsx(x,{value:"All Tiers",children:t("flashcards.allTiers")}),e.jsx(x,{value:"Higher",children:t("flashcards.higherTier")}),e.jsx(x,{value:"Foundation",children:t("flashcards.foundationTier")})]})]}),e.jsx(i,{variant:"outline",size:"icon",onClick:Te,children:e.jsx(qe,{className:"h-4 w-4"})})]}),o.length===0?e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(le,{className:"h-16 w-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:t("flashcards.noCards")}),e.jsx("p",{className:"text-muted-foreground mb-4",children:t("flashcards.createFirst")}),e.jsxs(i,{onClick:Z,children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),t("flashcards.addCard")]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass-card p-4 animate-slide-up",style:{animationDelay:"0.2s"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:t("flashcards.cardProgress",{current:q+1,total:o.length})}),k&&e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-secondary flex items-center gap-1",children:[e.jsx(ce,{className:"h-4 w-4"})," ",_.correct]}),e.jsxs("span",{className:"text-destructive flex items-center gap-1",children:[e.jsx(ie,{className:"h-4 w-4"})," ",_.incorrect]})]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all",style:{width:`${Se}%`}})})]}),m&&e.jsxs("div",{className:A("flip-card h-80 md:h-96 cursor-pointer animate-scale-in relative",R&&"flipped"),style:{animationDelay:"0.3s"},onClick:ee,children:[e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2 z-10",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:s=>{s.stopPropagation(),je(m)},children:e.jsx(_e,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:s=>{s.stopPropagation(),ve(m.id)},children:e.jsx(re,{className:"h-4 w-4 text-destructive"})})]}),e.jsxs("div",{className:"flip-card-inner",children:[e.jsxs("div",{className:"flip-card-front glass-card p-8 flex flex-col items-center justify-center text-center",children:[e.jsxs("div",{className:"absolute top-4 left-4 flex gap-2",children:[m.subject&&e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-primary/10 text-primary",children:m.subject}),m.tier&&e.jsx("span",{className:A("text-xs font-medium px-2 py-1 rounded-full",m.tier==="Higher"?"bg-red-500/10 text-red-500":"bg-green-500/10 text-green-500"),children:m.tier})]}),e.jsx(le,{className:"h-8 w-8 text-primary mb-4"}),e.jsx("h3",{className:"text-xl md:text-2xl font-semibold text-foreground",children:m.front}),e.jsx("p",{className:"text-sm text-muted-foreground mt-4",children:t("flashcards.revealAnswer")})]}),e.jsxs("div",{className:"flip-card-back glass-card p-8 flex flex-col items-center justify-center text-center bg-gradient-to-br from-secondary/10 to-primary/10",children:[e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-secondary/20 text-secondary-foreground",children:t("common.answer")})}),e.jsx("p",{className:"text-lg md:text-xl text-foreground leading-relaxed",children:m.back})]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 animate-slide-up",style:{animationDelay:"0.4s"},children:[e.jsx(i,{variant:"outline",size:"icon",onClick:ke,className:"h-12 w-12 rounded-full",children:e.jsx(Pe,{className:"h-5 w-5"})}),k?e.jsxs(e.Fragment,{children:[e.jsxs(i,{variant:"outline",className:"h-12 px-6 border-destructive text-destructive hover:bg-destructive hover:text-destructive-foreground",onClick:()=>se(!1),children:[e.jsx(ie,{className:"h-5 w-5 mr-2"}),t("flashcards.incorrect")]}),e.jsxs(i,{className:"h-12 px-6 bg-secondary hover:bg-secondary/90 text-secondary-foreground",onClick:()=>se(!0),children:[e.jsx(ce,{className:"h-5 w-5 mr-2"}),t("flashcards.correct")]}),_.correct+_.incorrect>0&&e.jsxs(i,{variant:"outline",onClick:Fe,className:"h-12 px-6",children:[e.jsx(ne,{className:"h-5 w-5 mr-2"}),t("flashcards.reset")]})]}):e.jsxs(i,{variant:"outline",onClick:ee,className:"h-12 px-6",children:[e.jsx(ne,{className:"h-5 w-5 mr-2"}),t("flashcards.flipCard")]}),e.jsx(i,{variant:"outline",size:"icon",onClick:Y,className:"h-12 w-12 rounded-full",children:e.jsx(Le,{className:"h-5 w-5"})})]}),o.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:t("flashcards.allCards")}),e.jsx("div",{className:"max-h-[50vh] overflow-y-auto pr-2 custom-scrollbar",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 animate-slide-up",style:{animationDelay:"0.5s"},children:o.map((s,a)=>e.jsxs("button",{onClick:()=>{g?W(s.id):(C(a),w(!1))},className:A("p-4 rounded-xl text-left transition-all duration-200 relative group",q===a&&!g?"bg-primary text-primary-foreground shadow-glow":"bg-muted/50 hover:bg-muted text-foreground",g&&u.has(s.id)&&"ring-2 ring-primary bg-primary/10"),children:[g&&e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsx(Ie,{checked:u.has(s.id),onCheckedChange:()=>W(s.id),className:A("data-[state=checked]:bg-primary data-[state=checked]:border-primary",u.has(s.id)?"border-primary":"border-muted-foreground/50")})}),e.jsx("p",{className:A("text-xs font-medium mb-1 opacity-70",g&&"mr-6"),children:s.subject||"General"}),e.jsx("p",{className:"text-sm font-medium line-clamp-2",children:s.front})]},s.id))})})]})]})]}),e.jsx(He,{open:pe,onOpenChange:F,children:e.jsxs(Qe,{className:"max-w-2xl",children:[e.jsxs(Oe,{children:[e.jsx(Ve,{children:T?"Edit Flashcard":"Create New Flashcard"}),e.jsx(Re,{children:T?"Update your flashcard details below":"Fill in the details to create a new flashcard"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"subject",children:"Subject"}),e.jsx(O,{id:"subject",value:r.subject,onChange:s=>j({...r,subject:s.target.value}),placeholder:"e.g., Biology"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"topic",children:"Topic"}),e.jsx(O,{id:"topic",value:r.topic,onChange:s=>j({...r,topic:s.target.value}),placeholder:"e.g., Cell Biology"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"tier",children:"Tier"}),e.jsxs(P,{value:r.tier,onValueChange:s=>j({...r,tier:s}),children:[e.jsx(L,{id:"tier",children:e.jsx(B,{placeholder:"Tier"})}),e.jsxs(M,{children:[e.jsx(x,{value:"Higher",children:"Higher"}),e.jsx(x,{value:"Foundation",children:"Foundation"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"front",children:"Front (Question) *"}),e.jsx(de,{id:"front",value:r.front,onChange:s=>j({...r,front:s.target.value}),placeholder:"Enter the question or prompt...",className:"min-h-[100px]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"back",children:"Back (Answer) *"}),e.jsx(de,{id:"back",value:r.back,onChange:s=>j({...r,back:s.target.value}),placeholder:"Enter the answer...",className:"min-h-[100px]"})]})]}),e.jsxs(Ue,{children:[e.jsx(i,{variant:"outline",onClick:()=>F(!1),children:"Cancel"}),e.jsxs(i,{onClick:ge,children:[T?"Update":"Create"," Card"]})]})]})})]})}export{hs as default};
