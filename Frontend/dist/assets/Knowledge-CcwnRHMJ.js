import{j as e,L as X,at as z,K as B,E as tt,ah as st,Z as at,az as rt,aA as it,ao as V,aw as nt,aB as be,aC as lt,au as ot,X as Ne}from"./ui-vendor-CsSFJReh.js";import{A as Se}from"./AppLayout-DI_SoCqt.js";import{B as ct}from"./badge-C82RfJ-5.js";import{u as dt,j as mt,k as ut,B as d,c as N}from"./index-D0R12c3l.js";import{R as ht,C as xt,a as gt}from"./index-B3JJ2MxW.js";import{D as Ce,b as ke,c as Pe,d as ze,e as Ae,f as Te}from"./dialog-BfoGBpVh.js";import{I as C}from"./input-BOrw0D0Z.js";import{L as y}from"./label-CYC1LVAb.js";import{S as A,a as T,b as O,c as _,d as j}from"./select-BnVVC8xh.js";import{T as Oe}from"./textarea-FxOJ6OHy.js";import{a as pt}from"./ai-client-BnMomkG2.js";import{E as _e}from"./constants-DeIw5BhA.js";import{h as jt}from"./premium-eVfGSoKP.js";import{u as ft,i as yt,r as c}from"./react-vendor-BmZbDsmQ.js";import"./AnimatedLogoIcon-D5-EYdni.js";import"./sheet-0_ECFM1J.js";import"./supabase-vendor-BcRMW6g-.js";import"./query-vendor-DjEy6XLK.js";import"./index-BdQq_4o_.js";import"./index-B5-l44BU.js";const vt=ht,wt=xt,bt=gt;function qt(){var ve;const{supabase:b,user:h}=dt(),{t:g}=mt(),{toast:m}=ut(),L=ft(),Z=yt(),[Y,H]=c.useState([]),[De,I]=c.useState(!0),[J,ee]=c.useState(""),[R,te]=c.useState("All Subjects"),[$,se]=c.useState("All Boards"),[D,ae]=c.useState("All Tiers"),[i,S]=c.useState(null),[re,K]=c.useState([]),[Ke,k]=c.useState(!1),[F,ie]=c.useState(null),[o,p]=c.useState({title:"",subject:"",topic:"",exam_board:"",tier:"",sections:[]}),[ne,le]=c.useState(null),[Fe,M]=c.useState(!1),[U,oe]=c.useState(""),[q,ce]=c.useState(""),[G,de]=c.useState(""),[P,me]=c.useState(!1),[u,ue]=c.useState(null),[v,Ee]=c.useState(10),[Be,Le]=c.useState(!1);c.useEffect(()=>{h&&(Q(),he())},[h]);const he=async()=>{if(!(!h||!b))try{const t=new Date(Date.now()-864e5).toISOString(),{count:s,error:a}=await b.from("ai_usage_tracking").select("*",{count:"exact",head:!0}).eq("user_id",h.id).gt("created_at",t);if(a)return;const r=await jt(b),n=r?1e6:10;ue(s||0),Ee(n),Le(r)}catch{}};c.useEffect(()=>{var t;(t=Z.state)!=null&&t.context},[Z.state,i]);const xe=t=>{var r;const s=((r=t.content)==null?void 0:r.sections)||[];if(s.length===0)return 0;const a=s.filter(n=>n.reviewed).length;return Math.round(a/s.length*100)},Q=async()=>{var t;if(h)try{I(!0);const{data:s,error:a}=await b.from("knowledge_organizers").select("*").eq("user_id",h.id).order("updated_at",{ascending:!1});if(a)throw a;if(H(s||[]),s&&s.length>0&&!i){S(s[0]);const r=s[0];(t=r.content)!=null&&t.sections&&r.content.sections.length>0&&K([r.content.sections[0].title])}}catch{m({title:"Error",description:"Failed to load knowledge organizers. Please try again.",variant:"destructive"})}finally{I(!1)}},ge=()=>{ie(null),p({title:"",subject:"",topic:"",exam_board:"",tier:"",sections:[]}),k(!0)},Re=async()=>{var t;if(!h||!U.trim()){m({title:"Error",description:"Please enter a prompt to generate a knowledge organizer",variant:"destructive"});return}if(u!==null&&u>=v){m({title:"Limit Reached",description:"You have reached the daily limit of AI generation attempts. Please upgrade to premium for higher limits (500/day).",variant:"destructive"});return}me(!0);try{const s=await pt({prompt:U,subject:q||void 0,topic:G||void 0},b);if(s.error){if(s.error.includes("limit")||s.error.includes("429"))m({title:"Limit Reached",description:s.error,variant:"destructive"}),he();else throw new Error(s.error);return}(t=s.data)!=null&&t.sections&&(p({title:G||q||"AI Generated Organizer",subject:q||"",topic:G||"",exam_board:"",tier:"",sections:s.data.sections}),M(!1),k(!0),oe(""),ce(""),de(""),s.data.usageCount!==void 0&&ue(s.data.usageCount),m({title:"Success",description:`Generated ${s.data.sections.length} sections! Review and edit before saving.`}))}catch(s){m({title:"Error",description:s.message||"Failed to generate knowledge organizer. Please try again.",variant:"destructive"})}finally{me(!1)}},$e=t=>{var r,n;ie(t);const a=(((r=t.content)==null?void 0:r.sections)||[]).map(l=>{var x;return{...l,keyPoints:((x=l.keyPoints)==null?void 0:x.map(w=>typeof w=="string"?{text:w,mastered:!1}:w))||[]}});p({title:t.title,subject:t.subject||"",topic:t.topic||"",exam_board:((n=t.content)==null?void 0:n.exam_board)||"",tier:t.tier||"",sections:a}),k(!0)},pe=()=>{p({...o,sections:[...o.sections,{title:"",content:"",keyPoints:[],color:"primary"}]})},Me=t=>{p({...o,sections:o.sections.filter((s,a)=>a!==t)})},W=(t,s,a)=>{const r=[...o.sections];r[t]={...r[t],[s]:a},p({...o,sections:r})},Ue=t=>{const s=[...o.sections],r=(s[t].keyPoints||[]).map(n=>typeof n=="string"?{text:n,mastered:!1}:n);r.push({text:"",mastered:!1}),s[t].keyPoints=r,p({...o,sections:s})},qe=(t,s)=>{const a=[...o.sections];a[t].keyPoints=a[t].keyPoints.filter((r,n)=>n!==s),p({...o,sections:a})},Ge=(t,s,a)=>{const r=[...o.sections],l=(r[t].keyPoints||[]).map(x=>typeof x=="string"?{text:x,mastered:!1}:x);l[s]={...l[s],text:a},r[t].keyPoints=l,p({...o,sections:r})},Ve=(t,s)=>{const a=[...o.sections],n=(a[t].keyPoints||[]).map(l=>typeof l=="string"?{text:l,mastered:!1}:l);n[s]={...n[s],mastered:!n[s].mastered,lastReviewed:n[s].mastered?n[s].lastReviewed:new Date().toISOString()},a[t].keyPoints=n,p({...o,sections:a})},Ye=async()=>{if(!h||!o.title.trim()){m({title:"Error",description:"Title is required",variant:"destructive"});return}if(!o.tier){m({title:"Error",description:"Please select a Tier (Foundation or Higher)",variant:"destructive"});return}const t=o.sections.filter(s=>s.title.trim()&&s.content.trim());try{const s={sections:t,exam_board:o.exam_board},a={user_id:h.id,title:o.title,subject:o.subject||null,topic:o.topic||null,tier:o.tier||null,content:s};if(F){const{error:r}=await b.from("knowledge_organizers").update(a).eq("id",F.id).eq("user_id",h.id);if(r)throw r;m({title:"Success",description:"Knowledge organizer updated successfully"})}else{const{error:r}=await b.from("knowledge_organizers").insert(a);if(r)throw r;m({title:"Success",description:"Knowledge organizer created successfully"})}k(!1),Q()}catch(s){m({title:"Error",description:s.message||"Failed to save knowledge organizer. Please try again.",variant:"destructive"})}},He=async t=>{var s;if(!(!i||!h))try{le(t);const a=[...((s=i.content)==null?void 0:s.sections)||[]];a[t]&&(a[t].reviewed=!0,a[t].lastReviewedAt=new Date().toISOString());const{error:r}=await b.from("knowledge_organizers").update({content:{sections:a}}).eq("id",i.id).eq("user_id",h.id);if(r)throw r;const{error:n}=await b.from("study_sessions").insert({user_id:h.id,organizer_id:i.id,duration:0,sections_reviewed:[t],date:new Date().toISOString()}),l={...i,content:{...i.content,sections:a}};S(l),H(x=>x.map(w=>w.id===i.id?l:w)),m({title:"Section Reviewed",description:`"${a[t].title}" marked as reviewed`})}catch(a){m({title:"Error",description:a.message||"Failed to mark section as reviewed. Please try again.",variant:"destructive"})}finally{le(null)}},Je=async(t,s)=>{var a;if(!(!i||!h))try{const r=[...((a=i.content)==null?void 0:a.sections)||[]],n=r[t];if(!n||!n.keyPoints)return;const l=n.keyPoints.map(E=>typeof E=="string"?{text:E,mastered:!1}:E);l[s]={...l[s],mastered:!l[s].mastered,lastReviewed:l[s].mastered?l[s].lastReviewed:new Date().toISOString()},r[t]={...n,keyPoints:l};const{error:x}=await b.from("knowledge_organizers").update({content:{sections:r}}).eq("id",i.id).eq("user_id",h.id);if(x)throw x;const w={...i,content:{...i.content,sections:r}};S(w),H(E=>E.map(we=>we.id===i.id?w:we))}catch(r){m({title:"Error",description:r.message||"Failed to update key point. Please try again.",variant:"destructive"})}},Qe=async t=>{if(h&&confirm("Are you sure you want to delete this knowledge organizer?"))try{const{error:s}=await b.from("knowledge_organizers").delete().eq("id",t).eq("user_id",h.id);if(s)throw s;m({title:"Success",description:"Knowledge organizer deleted successfully"}),(i==null?void 0:i.id)===t&&S(null),Q()}catch{m({title:"Error",description:"Failed to delete knowledge organizer. Please try again.",variant:"destructive"})}},We=t=>{const s=JSON.stringify(t.content,null,2),a=new Blob([s],{type:"application/json"}),r=URL.createObjectURL(a),n=document.createElement("a");n.href=r,n.download=`${t.title.replace(/\s+/g,"_")}.json`,n.click(),URL.revokeObjectURL(r),m({title:"Downloaded",description:"Knowledge organizer downloaded as JSON"})},Xe=()=>{var s,a;if(!i)return;const t=((a=(s=i.content)==null?void 0:s.sections)==null?void 0:a.map(r=>`${r.title}: ${r.content}`).join(`

`))||"";L("/ai-tutor",{state:{context:t,mode:"question",organizerTitle:i.title}})},Ze=async()=>{var t,s;if(!(!i||!h))try{const a=((s=(t=i.content)==null?void 0:t.sections)==null?void 0:s.map(r=>{var n;return`${r.title}: ${r.content}
Key Points: ${((n=r.keyPoints)==null?void 0:n.map(l=>typeof l=="string"?l:l.text).join(", "))||""}`}).join(`

`))||"";if(!a.trim()){m({title:"No content",description:"This organizer doesn't have any content to create flashcards from.",variant:"destructive"});return}L("/flashcards",{state:{organizerContent:a,subject:i.subject||"General",topic:i.topic}})}catch{m({title:"Error",description:"Failed to proceed to flashcards.",variant:"destructive"})}},f=Y.filter(t=>{var x,w;const s=(t.title||"").toLowerCase().includes(J.toLowerCase()),a=R==="All Subjects"||t.subject===R,r=(x=t.content)==null?void 0:x.exam_board,n=$==="All Boards"||r===$,l=D==="All Tiers"||D==="Unassigned"&&!t.tier||((w=t.tier)==null?void 0:w.toLowerCase())===D.toLowerCase();return s&&a&&n&&l});c.useEffect(()=>{var t,s,a,r;i&&f.length>0?f.some(l=>l.id===i.id)||(S(f[0]),((s=(t=f[0].content)==null?void 0:t.sections)==null?void 0:s.length)>0&&K([f[0].content.sections[0].title])):i&&f.length===0?S(null):!i&&f.length>0&&(S(f[0]),((r=(a=f[0].content)==null?void 0:a.sections)==null?void 0:r.length)>0&&K([f[0].content.sections[0].title]))},[J,R,$,D,f.length]);const Ie=t=>{K(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},je=t=>{const s=new Date(t),r=Math.floor((new Date().getTime()-s.getTime())/1e3);return r<60?"Just now":r<3600?`${Math.floor(r/60)} minutes ago`:r<86400?`${Math.floor(r/3600)} hours ago`:r<604800?`${Math.floor(r/86400)} days ago`:s.toLocaleDateString()},et=Array.from(new Set(Y.map(t=>t.subject).filter(Boolean))),fe=((ve=i==null?void 0:i.content)==null?void 0:ve.sections)||[],ye=i?xe(i):0;return De?e.jsx(Se,{children:e.jsx("div",{className:"max-w-6xl mx-auto flex items-center justify-center h-[60vh]",children:e.jsx(X,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsxs(Se,{children:[e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground",children:g("knowledge.title")}),e.jsx("p",{className:"text-muted-foreground mt-1",children:g("knowledge.subtitle")})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-2 w-full md:w-auto",children:[e.jsxs(d,{variant:"outline",onClick:()=>M(!0),className:"whitespace-nowrap",children:[e.jsx(z,{className:"h-4 w-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"whitespace-nowrap",children:g("knowledge.generateAI")}),u!==null&&e.jsx("span",{className:"ml-2 text-xs opacity-70 whitespace-nowrap",children:Be?"(∞)":`(${v-u})`})]}),e.jsxs(d,{onClick:ge,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),g("knowledge.createOrganizer")]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 animate-slide-up",style:{animationDelay:"0.1s"},children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(tt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(C,{placeholder:g("knowledge.searchPlaceholder"),value:J,onChange:t=>ee(t.target.value),className:"pl-9"})]}),e.jsxs(A,{value:R,onValueChange:te,children:[e.jsx(T,{className:"w-full sm:w-[180px]",children:e.jsx(O,{})}),e.jsxs(_,{children:[e.jsx(j,{value:"All Subjects",children:g("knowledge.allSubjects")}),et.map(t=>e.jsx(j,{value:t,children:t},t))]})]}),e.jsxs(A,{value:$,onValueChange:se,children:[e.jsx(T,{className:"w-full sm:w-[150px]",children:e.jsx(O,{})}),e.jsxs(_,{children:[e.jsx(j,{value:"All Boards",children:g("knowledge.allBoards")}),_e.map(t=>e.jsx(j,{value:t,children:t},t))]})]}),e.jsxs(A,{value:D,onValueChange:ae,children:[e.jsx(T,{className:"w-full sm:w-[150px]",children:e.jsx(O,{})}),e.jsxs(_,{children:[e.jsx(j,{value:"All Tiers",children:g("common.allTiers")}),e.jsx(j,{value:"Higher",children:g("flashcards.higher")}),e.jsx(j,{value:"Foundation",children:g("flashcards.foundation")}),e.jsx(j,{value:"Unassigned",children:g("pastPapers.unassigned")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 space-y-3 animate-slide-up",style:{animationDelay:"0.2s",opacity:0},children:Y.length===0?e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(z,{className:"h-12 w-12 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:g("knowledge.noOrganizers")}),e.jsxs("p",{className:"text-muted-foreground mb-4",children:["Create your first knowledge organiser, generate one with AI, or add from the"," ",e.jsx("button",{type:"button",onClick:()=>L("/library"),className:"text-primary hover:underline font-medium",children:"Global Library"})," ","(Organisers tab)."]}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsxs(d,{onClick:ge,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),g("knowledge.createOrganizer")]}),e.jsx(d,{variant:"outline",onClick:()=>L("/library"),children:g("library.title")})]})]}):f.length===0?e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(z,{className:"h-12 w-12 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No organizers found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Try adjusting your filters or create a new organizer"}),e.jsx(d,{variant:"outline",onClick:()=>{te("All Subjects"),se("All Boards"),ae("All Tiers"),ee("")},children:"Clear Filters"})]}):f.map(t=>{const s=xe(t);return e.jsx("button",{onClick:()=>{var a;S(t),(a=t.content)!=null&&a.sections&&t.content.sections.length>0&&K([t.content.sections[0].title])},className:N("w-full text-left p-4 rounded-xl transition-all duration-200",(i==null?void 0:i.id)===t.id?"glass-card border-primary/30 shadow-glow":"bg-muted/50 hover:bg-muted"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 flex-shrink-0",children:e.jsx(z,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-foreground truncate",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.subject||"General"," • ",t.topic||"General",t.tier&&e.jsx(ct,{variant:"secondary",className:N("text-[10px] h-4 px-1 ml-1",t.tier==="Higher"?"text-red-500 bg-red-500/10":"text-green-500 bg-green-500/10"),children:t.tier})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full transition-all duration-500",style:{width:`${s}%`}})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s,"%"]})]})]})]})},t.id)})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx("div",{className:"lg:sticky lg:top-24 animate-slide-up",style:{animationDelay:"0.3s",opacity:0},children:i?e.jsxs("div",{className:"glass-card p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.subject&&e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-primary/10 text-primary",children:i.subject}),i.topic&&e.jsx("span",{className:"text-xs text-muted-foreground",children:i.topic})]}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-foreground",children:i.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("div",{className:"flex-1 max-w-[200px]",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[ye,"%"]})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full transition-all duration-500",style:{width:`${ye}%`}})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Last updated ",je(i.updated_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"outline",size:"icon",onClick:()=>$e(i),children:e.jsx(st,{className:"h-4 w-4"})}),e.jsx(d,{variant:"outline",size:"icon",onClick:()=>Qe(i.id),children:e.jsx(at,{className:"h-4 w-4 text-destructive"})}),e.jsx(d,{variant:"outline",size:"icon",onClick:()=>We(i),children:e.jsx(rt,{className:"h-4 w-4"})})]})]}),fe.length>0?e.jsx("div",{className:"space-y-4",children:fe.map((t,s)=>e.jsxs(vt,{open:re.includes(t.title),onOpenChange:()=>Ie(t.title),children:[e.jsx(wt,{className:"w-full",children:e.jsxs("div",{className:N("flex items-center justify-between p-4 rounded-xl transition-all duration-200",t.color==="primary"&&"bg-primary/10 hover:bg-primary/15",t.color==="secondary"&&"bg-secondary/10 hover:bg-secondary/15",t.color==="accent"&&"bg-accent/20 hover:bg-accent/25"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:N("w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold",t.color==="primary"&&"bg-primary text-primary-foreground",t.color==="secondary"&&"bg-secondary text-secondary-foreground",t.color==="accent"&&"bg-accent text-accent-foreground"),children:s+1}),e.jsx("span",{className:"font-semibold text-foreground",children:t.title})]}),e.jsx(it,{className:N("h-5 w-5 text-muted-foreground transition-transform duration-200",re.includes(t.title)&&"rotate-180")})]})}),e.jsx(bt,{children:e.jsxs("div",{className:"p-4 pt-2 ml-11 space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsx("p",{className:"text-foreground whitespace-pre-wrap flex-1",children:t.content}),!t.reviewed&&e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>He(s),disabled:ne===s,className:"flex-shrink-0",children:[ne===s?e.jsx(X,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(V,{className:"h-4 w-4 mr-2"}),"Mark as Reviewed"]}),t.reviewed&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground flex-shrink-0",children:[e.jsx(V,{className:"h-4 w-4 text-primary"}),e.jsx("span",{children:"Reviewed"}),t.lastReviewedAt&&e.jsx("span",{className:"text-xs",children:je(t.lastReviewedAt)})]})]}),t.keyPoints&&t.keyPoints.length>0&&e.jsxs("div",{className:N("p-4 rounded-lg",t.color==="primary"&&"bg-primary/5 border border-primary/20",t.color==="secondary"&&"bg-secondary/5 border border-secondary/20",t.color==="accent"&&"bg-accent/10 border border-accent/20"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(nt,{className:N("h-4 w-4",t.color==="primary"&&"text-primary",t.color==="secondary"&&"text-secondary",t.color==="accent"&&"text-accent-foreground")}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:"Key Points"})]}),e.jsx("ul",{className:"space-y-2",children:t.keyPoints.map((a,r)=>{const n=typeof a=="string"?a:a.text,l=typeof a=="object"?a.mastered:!1;return e.jsxs("li",{className:"flex items-start gap-2 text-sm text-foreground group",children:[e.jsx("button",{onClick:()=>Je(s,r),className:N("h-4 w-4 mt-0.5 flex-shrink-0 transition-colors cursor-pointer",l?t.color==="primary"&&"text-primary"||t.color==="secondary"&&"text-secondary"||t.color==="accent"&&"text-accent-foreground"||"text-primary":"text-muted-foreground hover:text-foreground"),title:l?"Mark as not mastered":"Mark as mastered",children:l?e.jsx(V,{className:"h-4 w-4"}):e.jsx(be,{className:"h-4 w-4"})}),e.jsx("span",{className:N("flex-1",l&&"line-through opacity-60"),children:n})]},r)})})]})]})})]},t.title))}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{children:g("knowledge.noSections")})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 mt-6 pt-6 border-t border-border",children:[e.jsxs(d,{className:"w-full md:flex-1",onClick:Xe,children:[e.jsx(lt,{className:"h-4 w-4 mr-2"}),"Test Your Knowledge"]}),e.jsxs(d,{variant:"outline",className:"w-full md:flex-1",onClick:Ze,children:[e.jsx(ot,{className:"h-4 w-4 mr-2"}),"Create Flashcards"]})]})]}):e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(z,{className:"h-16 w-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Select an organizer"}),e.jsx("p",{className:"text-muted-foreground",children:"Choose a knowledge organizer to view its contents"})]})})})]})]}),e.jsx(Ce,{open:Ke,onOpenChange:k,children:e.jsxs(ke,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Pe,{children:[e.jsx(ze,{children:F?"Edit Knowledge Organizer":"Create New Knowledge Organizer"}),e.jsx(Ae,{children:F?"Update your knowledge organizer below":"Create a visual summary of your study material"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"title",children:"Title *"}),e.jsx(C,{id:"title",value:o.title,onChange:t=>p({...o,title:t.target.value}),placeholder:"e.g., Cell Biology Overview"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"subject",children:"Subject"}),e.jsx(C,{id:"subject",value:o.subject,onChange:t=>p({...o,subject:t.target.value}),placeholder:"e.g., Biology"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"topic",children:"Topic"}),e.jsx(C,{id:"topic",value:o.topic,onChange:t=>p({...o,topic:t.target.value}),placeholder:"e.g., Cell Biology"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"exam_board",children:"Exam Board"}),e.jsxs(A,{value:o.exam_board,onValueChange:t=>p({...o,exam_board:t}),children:[e.jsx(T,{id:"exam_board",children:e.jsx(O,{placeholder:"Select board"})}),e.jsx(_,{children:_e.map(t=>e.jsx(j,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"tier",children:"Tier"}),e.jsxs(A,{value:o.tier,onValueChange:t=>p({...o,tier:t}),children:[e.jsx(T,{id:"tier",children:e.jsx(O,{placeholder:"Select Tier"})}),e.jsxs(_,{children:[e.jsx(j,{value:"Higher",children:"Higher Tier"}),e.jsx(j,{value:"Foundation",children:"Foundation Tier"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{children:"Sections"}),e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:pe,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Add Section"]})]}),o.sections.map((t,s)=>e.jsxs("div",{className:"p-4 border rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-semibold",children:["Section ",s+1]}),e.jsx(d,{type:"button",variant:"ghost",size:"icon",onClick:()=>Me(s),children:e.jsx(Ne,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Section Title *"}),e.jsx(C,{value:t.title,onChange:a=>W(s,"title",a.target.value),placeholder:"e.g., Cell Structure"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Content *"}),e.jsx(Oe,{value:t.content,onChange:a=>W(s,"content",a.target.value),placeholder:"Describe this section...",className:"min-h-[100px]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Color"}),e.jsxs(A,{value:t.color,onValueChange:a=>W(s,"color",a),children:[e.jsx(T,{children:e.jsx(O,{})}),e.jsxs(_,{children:[e.jsx(j,{value:"primary",children:"Primary (Blue)"}),e.jsx(j,{value:"secondary",children:"Secondary (Purple)"}),e.jsx(j,{value:"accent",children:"Accent (Orange)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{children:"Key Points"}),e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:()=>Ue(s),children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Add Point"]})]}),t.keyPoints.map((a,r)=>{const n=typeof a=="string"?a:a.text,l=typeof a=="object"?a.mastered:!1;return e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(C,{value:n,onChange:x=>Ge(s,r,x.target.value),placeholder:"Enter key point...",className:N(l&&"line-through opacity-60")}),e.jsx(d,{type:"button",variant:l?"default":"outline",size:"icon",onClick:()=>Ve(s,r),title:l?"Mark as not mastered":"Mark as mastered",children:l?e.jsx(V,{className:"h-4 w-4"}):e.jsx(be,{className:"h-4 w-4"})}),e.jsx(d,{type:"button",variant:"ghost",size:"icon",onClick:()=>qe(s,r),children:e.jsx(Ne,{className:"h-4 w-4"})})]},r)})]})]},s)),o.sections.length===0&&e.jsxs("div",{className:"text-center py-8 border border-dashed rounded-lg",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"No sections yet"}),e.jsxs(d,{type:"button",variant:"outline",onClick:pe,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Add Your First Section"]})]})]})]}),e.jsxs(Te,{children:[e.jsx(d,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsxs(d,{onClick:Ye,children:[F?"Update":"Create"," Organizer"]})]})]})}),e.jsx(Ce,{open:Fe,onOpenChange:M,children:e.jsxs(ke,{className:"max-w-2xl",children:[e.jsxs(Pe,{children:[e.jsx(ze,{children:"Generate Knowledge Organizer with AI"}),e.jsxs(Ae,{children:["Describe what you want to learn, and AI will create a structured knowledge organizer with sections and key points.",u!==null&&e.jsx("span",{className:"block mt-2 text-sm font-medium",children:u!==null&&u>=v?e.jsx("span",{className:"text-destructive",children:"You've reached the daily limit."}):e.jsx("span",{children:v>1e3?"You have Unlimited generation attempts.":`You have ${u!==null?v-u:"..."} generation attempts remaining today.`})})]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"ai-prompt",children:"What would you like to learn? *"}),e.jsx(Oe,{id:"ai-prompt",value:U,onChange:t=>oe(t.target.value),placeholder:"e.g., Cell biology including organelles, their functions, and how they work together",className:"min-h-[100px]",disabled:P||u!==null&&u>=v})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"ai-subject",children:"Subject (optional)"}),e.jsx(C,{id:"ai-subject",value:q,onChange:t=>ce(t.target.value),placeholder:"e.g., Biology",disabled:P||u!==null&&u>=v})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"ai-topic",children:"Topic (optional)"}),e.jsx(C,{id:"ai-topic",value:G,onChange:t=>de(t.target.value),placeholder:"e.g., Cell Biology",disabled:P||u!==null&&u>=v})]})]}),u!==null&&u>=v&&e.jsx("div",{className:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-destructive font-medium",children:["You've reached the daily limit of ",v," AI generation attempts. ",v<=10?"Please upgrade to premium for higher limits.":"Please try again tomorrow."]})})]}),e.jsxs(Te,{children:[e.jsx(d,{variant:"outline",onClick:()=>M(!1),disabled:P,children:"Cancel"}),e.jsx(d,{onClick:Re,disabled:P||!U.trim()||u!==null&&u>=v,children:P?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Generate"]})})]})]})})]})}export{qt as default};
